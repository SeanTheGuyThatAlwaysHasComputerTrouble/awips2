C$PRAGMA C (UDATL)
C$PRAGMA C (DATIM2)
C MODULE FCKILL
C-----------------------------------------------------------------------
C
      SUBROUTINE FKSMSG (IFN,ISTOP,FUNNAM)
C
C  THIS ROUTINE PRINTS A SUMMARY OF ERRORS AND WARNINGS.
C
      CHARACTER*8   FUNNAM
      DIMENSION     IDAT1(6)
      CHARACTER*28  DAT2
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/errdat'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/toterz'
      INCLUDE 'common/killcd'
      INCLUDE 'common/fprog'
      COMMON /HCPUCK/ ITOTCP,IBGSEC,ILASEC
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/shared_util/RCS/fksmsg.f,v $
     . $',                                                             '
     .$Id: fksmsg.f,v 1.5 2002/02/11 12:50:33 michaelo Exp $
     . $' /
C    ===================================================================
C
C
      IF (ITRACE.GE.1) WRITE (IODBUG,80)
C
      IF (IFN.EQ.0) GO TO 20
      IF (MAINUM.GT.2) GO TO 10
C
C  IN OPERATIONAL PROGRAM - PRINT MESSAGE WITH CPU AND CLOCK TIME
      CALL URTIMR (LAPSE,ITOTCP)
      CALL UDATL (IDAT1)
      ELAPSE=LAPSE/100.
      ITEMP=(IDAT1(5)/100)*3600+MOD(IDAT1(5),100)*60+(IDAT1(6)+50)/100
      INCCLK=ITEMP-ILASEC
      IF (INCCLK.LT.0) INCCLK=INCCLK+86400
      INCMIN=INCCLK/60
      INCSEC=MOD(INCCLK,60)
      ILASEC=ITEMP
      WRITE (IPR,90)
     *   FUNNAM,NERRS,NWARN,ELAPSE,INCMIN,INCSEC
      IF (IOERR.NE.IPR) WRITE (IOERR,90)
     *   FUNNAM,NERRS,NWARN,ELAPSE,INCMIN,INCSEC
      GO TO 20
C
C  NOT IN OPERATIONAL PROGRAM - DO NOT PRINT CPU AND CLOCK TIMES
10    WRITE (IPR,100) FUNNAM,NERRS,NWARN
      IF (IOERR.NE.IPR) WRITE (IOERR,100) FUNNAM,NERRS,NWARN
C
20    IF (IFN.EQ.1.OR.MAINUM.GT.2) GO TO 30
C
C  IN OPERATIONAL PROGRAM - NOT CALLED FROM FUNCTION
C  MUST BE AT END OF PROGRAM - WRITE MESSAGE WITH CPU AND CLOCK TIME
      CALL URTIMR (LAPSE,ITOTCP)
      CALL UDATL (IDAT1)
      TOTCPU=ITOTCP/100.
      ITEMP=(IDAT1(5)/100)*3600+MOD(IDAT1(5),100)*60+(IDAT1(6)+50)/100
      ITOCLK=ITEMP-IBGSEC
      IF (ITOCLK.LT.0) ITOCLK=ITOCLK+86400
      ITOMIN=ITOCLK/60
      ITOSEC=MOD(ITOCLK,60)
C
30    IF (MAINUM.LT.3.AND.IFN.EQ.0) GO TO 40
C
C  EITHER NOT IN OPERATIONAL PROGRAM OR WITHIN A FUNCTION
C  DO NOT PRINT CPU AND CLOCK TIMES
      WRITE (IPR,110) NERRST,NWARNT
      IF (IOERR.NE.IPR) WRITE (IOERR,110) NERRST,NWARNT
      GO TO 50
C
C  IN OPERATIONAL PROGRAM - NOT WITHIN FUNCTION
40    WRITE (IPR,120)
     *   NERRST,NWARNT,TOTCPU,ITOMIN,ITOSEC
      IF (IOERR.NE.IPR) WRITE (IOERR,120)
     *   NERRST,NWARNT,TOTCPU,ITOMIN,ITOSEC
C
50    CALL DATIM2 (DAT2)
      WRITE (IPR,130) DAT2(2:13),DAT2(17:27)
      IF (IOERR.NE.IPR) WRITE (IOERR,130) DAT2(2:13),DAT2(17:27)
      WRITE (IPR,60) ISTOP
60    FORMAT ('0',15X,'COMPLETION CODE=',I2)
      IF (IOERR.NE.IPR) WRITE (IOERR,60) ISTOP
      WRITE (IPR,140)
      IF (IOERR.NE.IPR) WRITE (IOERR,140)
C
C  IF KLSTOP IN COMMON BLOCK KILLCD IS ZERO, DO NOT STOP
C  SET KLCODE IN CB KILLCD AND RETURN
      IF (KLSTOP.NE.0) GO TO 70
      IF (ISTOP.GT.KLCODE) KLCODE=ISTOP
C
      RETURN
C
C  STOP THE PROGRAM
70    CONTINUE
      INCLUDE 'cluprimc'
C
      IF (ISTOP.EQ.16) STOP 16
      IF (ISTOP.EQ.8)  STOP  8
      IF (ISTOP.EQ.4)  STOP  4
      STOP 0
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
80    FORMAT (' *** ENTER FKSMSG')
90    FORMAT ('0',15X,'SUMMARY OF ERRORS, WARNINGS AND TIME USED FOR ',
     *      'FUNCTION ',A,':' /
     *   26X,'NUMBER OF ERRORS=',I6 /
     *   26X,'NUMBER OF WARNINGS=',I4 /
     *   26X,'CPU TIME USED=',F7.2,' SECONDS' /
     *   26X,'CLOCK TIME USED=',I4,' MINUTES, ',I2,' SECONDS')
100   FORMAT ('0',15X,'SUMMARY OF ERRORS AND WARNINGS FOR ',
     *      'FUNCTION ',A,':' /
     *   26X,'NUMBER OF ERRORS=',I6 /
     *   26X,'NUMBER OF WARNINGS=',I4)
110   FORMAT ('0',15X,'SUMMARY OF ERRORS AND WARNINGS FOR THIS RUN:' /
     *   26X,'TOTAL NUMBER OF ERRORS=',I6 /
     *   26X,'TOTAL NUMBER OF WARNINGS=',I4)
120   FORMAT ('0',15X,'SUMMARY OF ERRORS, WARNINGS AND TIME USED FOR ',
     *      'THIS RUN:' /
     *   26X,'NUMBER OF ERRORS=',I6 /
     *   26X,'NUMBER OF WARNINGS=',I4 /
     *   26X,'TOTAL CPU TIME USED=',F7.2,' SECONDS' /
     *   26X,'TOTAL CLOCK TIME USED=',I4,' MINUTES,',I3,' SECONDS')
130   FORMAT ('0',15X,'NATIONAL WEATHER SERVICE   -   RIVER FORECAST ',
     *   'SYSTEM',6X,A12,6X,'TIME',1X,A11)
140   FORMAT ('0',132('*'))
C
      END
