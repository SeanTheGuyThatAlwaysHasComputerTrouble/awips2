#!/bin/csh
# This is the script to execute the morning climate
# summary.

#setenv DB_VERIFICATION verify41
#setenv INFORMIXDIR /opt/informix
#setenv INFORMIXSERVER ONLINE
#setenv DBSERVERNAME ONLINE

# Set the paths

#echo ${CLIMATE_DIR} > tmp.txt

set CLIMATE_DATA_DIR=${CLIMATE_DIR}/data

#echo ${CLIMATE_DATA_DIR} >> tmp.txt

set CLIMATE_BIN_DIR=${CLIMATE_DIR}/bin

#echo ${CLIMATE_BIN_DIR} >> tmp.txt

set CLIMATE_TMP_DIR=${CLIMATE_DIR}/tmp

#######################################
#
# Change the directory to the temporary
# climate directory

cd ${CLIMATE_TMP_DIR}

#######################################
# Set the waiting times for the 
# create_climate and format_climate.
# The waiting times determine the amount
# of time the notification server will 
# wait before sending back a message that
# the user didn't acknowledge the alert.

setenv DATA_WAIT_TIME 200

setenv PRODUCT_WAIT_TIME 100

# Copy the default versions of the main control
# file for the morning run from the data directory
# to the bin directory

# Copy the control file if it exists.  Notify the user
# if it doesn't

if (-e ${CLIMATE_DATA_DIR}/control_am) then
   echo "Copying "${CLIMATE_DATA_DIR}/control_am >> tmp.txt  
   cp ${CLIMATE_DATA_DIR}/control_am ${CLIMATE_TMP_DIR}
else
   echo "Problems with ${CLIMATE_DATA_DIR}/control_am in the climate/data directory"  >> tmp.txt
endif


# Run create_climate

echo "Starting create_climate"  >> tmp.txt

${CLIMATE_BIN_DIR}/create_climate auto am >> tmp.txt

echo "Starting display_climate"  >> tmp.txt

#display_climate auto am $status
${CLIMATE_BIN_DIR}/display_climate auto am >> tmp.txt

# Copy the files generated by set_up_climate from
# the data directory to the bin directory.  These
# are necessary to run format_climate

cp ${CLIMATE_DATA_DIR}/*_am_* ${CLIMATE_TMP_DIR}

# Run format climate

echo "Starting format_climate" >> tmp.txt

${CLIMATE_BIN_DIR}/format_climate auto am >> tmp.txt 


# Remove all temporary files from the tmp directory

#clean_up_am

