      SUBROUTINE INTBI55(PO,CO,Z,ST1,LTST1,T1,LTT1,POLH,LTPOLH,ITWT,
     . LTITWT,NCML,ITQ,NDD,I,J,QQ,YLS,YRS,KRCH,YU,HS,YCR,
     1 K1,K2,K7,K8,K9,K15,K16,K19,K20,K21)
C
C  THIS SUBROUTINE PERFORMS INITIAL CONDITION COMPUTATION
C  ON INTERNAL BOUNDARY CONDITION SUCH AS DAM, BRIDGE ETC.
C  NDD= 2 -- SUB CRITICAL FLOW AT U/S AND D/S OF DAM OR BRIDGE
C     = 3 -- SUPER CRITICAL FLOW AT U/S AND D/S OF DAM OR BRIDGE
C
      COMMON/M155/NU,JN,JJ,KIT,G,DT,TT,TIMF,F1
      COMMON/SS55/ NCS,A,B,DB,R,DR,AT,BT,P,DP,ZH
      COMMON/IONUM/IN,IPR,IPU

      INCLUDE 'common/fdbug'
      INCLUDE 'common/ofs55'

      DIMENSION PO(*),CO(*),Z(*),ST1(*),LTST1(*),T1(*),LTT1(*),POLH(*)
      DIMENSION LTPOLH(*),ITWT(*),LTITWT(*),KRCH(K2,K1),HS(K9,K2,K1)
      DIMENSION YCR(K2,K1),YU(K2,K1)
      CHARACTER*8 SNAME
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_fldwav/RCS/intbi55.f,v $
     . $',                                                             '
     .$Id: intbi55.f,v 1.4 2000/12/19 15:52:49 dws Exp $
     . $' /
C    ===================================================================
C

      DATA SNAME/ 'INTBI55 ' /

      CALL FPRBUG(SNAME,1,55,IBUG)

      ITRS=1
      IX=1
      CALL IDDB55(I,J,PO(LONLAD),PO(LOLAD),LL,K1,K16)
      KRA=IABS(KRCH(I,J))
      IF(KRA.EQ.35) GO TO 78
      IF(KRA.EQ.41) GO TO 83
C  DAM INTERNAL BOUNDARY
      YU(I+1,J)=YRS
      DY=1.0
      YT=YRS
      DO 41 IY=1,1000
      YT=YT+DY
      YU(I,J)=YT
      DTIM=1.0
      CALL DAM55(PO,CO,Z,ST1,LTST1,T1,LTT1,POLH,LTPOLH,ITWT,LTITWT,
     . Z(LZD),Z(LZC),Z(LZQU),Z(LZQD),YU,Z(LZYD),PO(LOHDD),PO(LOHSPD),
     . PO(LOHGTD),PO(LOCSD),PO(LOCGD),PO(LOZBCH),PO(LOCDOD),PO(LCNFLD),
     . Z(LZBBP),Z(LZYBP),Z(LZSQS1),Z(LZSQS2),Z(LZSQO),Z(LZQBCH),
     . Z(LZQOTP),Z(LZQOTR),KRCH,PO(LOQGH),PO(LOCLL),PO(LOSPL),PO(LORHI),
     . PO(LORQI),PO(LOTIQH),CO(LXQDI),QTS,DQNYU,DTIM,IFL,ITRS,IX,IX,IX,
     . IX,IX,IX,ITQ,I,J,K1,K2,K7,K8,K9,K15,K16,K19,K20,K21)
      IF (KRA.EQ.28) GOTO 100
      ERQ=QTS-QQ
      IF(ABS(ERQ).LE.0.01) GO TO 100
      IF(ERQ.LT.0.0) GO TO 41
      ITQ=0
      YLS=YT-0.5*DY
      YT=YT-DY
      DY=DY*0.1
      IF(DY.LT.0.009) GO TO 100
   41 CONTINUE
      WRITE(IPR,881) LL,ERQ
  881 FORMAT(5X,' ***** WARNING WARNING *****',
     & /5X,'BACKWATER COMPUTATION AT DAM',I3,' NOT CONVERGE',
     & ' WITH ERQ= ',F10.0,5X,'AFTER 1000 ITERATION.')
      GO TO 100
C  BRIDGE INTERNAL BOUNDARY
   78 LTT=0
      IF(NDD.EQ.3) GO TO 79
C  SUBCRITICAL FLOW -- COMPUTE UPSTREAM ELEVATION
      CALL SECT55(PO(LCPR),PO(LOAS),PO(LOBS),HS,PO(LOASS),PO(LOBSS),
     * J,I,YRS,PO(LCHCAV),PO(LCIFCV),K1,K2,K9)
      YMX=YRS+1.0+(QQ/(0.8*8.02*A))**2
      YMN=YRS
      YOLD=YMX
      GO TO 80
C  SUPERCRITICAL FLOW -- COMPUTE DOWNSTREAM ELEVATION
   79 YMX=YLS
      YMN=HS(1,I,J)
      YOLD=YMX
   80 YT=0.5*(YMX+YMN)
      IF(NDD.EQ.2) YLS=YT
      IF(NDD.EQ.3) YRS=YT
      CALL BRIDGE55(PO,Z,NCML,PO(LONQCM),I,J,IX,IX,IX,IX,IX,IX,YLS,YRS,
     1 YRS,PO(LCDDX),PO(LOEBE1),PO(LOEBE2),PO(LOBRGW),PO(LOCDBR),Z(LZD),
     1 Z(LZC),Z(LZQU),PO(LCNFLD), Z(LZBBP),Z(LZYBP),Z(LZSQW),Z(LZSQS1),
     2 Z(LZSQO),Z(LZQBCH),Z(LZQOTP), Z(LZQOTR),HS,QTS,TT,QQ,PO(LOZBCH),
     3 PO(LCTOPN),PO(LOEBW2),PO(LOEBW1),K1,K2,K7,K8,K9,K15,K16)
     3

      ERY=YT-YOLD
      IF(ABS(ERY).LT.0.004) GO TO 100
      F=QTS-QQ
      IF(F.GT.0.0) YMX=YT
      IF(F.LE.0.0) YMN=YT
      YOLD=YT
      LTT=LTT+1
      IF(LTT.LT.50) GO TO 80
      WRITE(IPR,882) LL,ERY
  882 FORMAT(5X,' ***** WARNING WARNING *****',
     & /5X,'BACK/DOWNWATER COMPUTATION AT BRIDGE',I3,' NOT CONVERGE',
     & ' WITH ERY=',F10.5,5X,'AFTER 50 ITERATION.')
      GO TO 100
C  CRITICAL FLOW INTERNAL BOUNDARY
   83 IF(NDD.EQ.2) YLS=YCR(I,J)
      IF(NDD.EQ.3) YRS=YCR(I,J)
  100 CONTINUE
      RETURN
      END
