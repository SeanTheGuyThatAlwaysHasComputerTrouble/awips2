      SUBROUTINE WAPLOT55(PO,Z,T1,LTT1,TII,QTC,LTQTC,STC,LTSTC,STT,
     . LTSTT,STQ,LTSTQ,FS,FFS,NGAGE,STTNAM,NGS,FLDSTG,TYPK,YPK,TQPK,
     . QPK,GZ,KHR,KDA,KMO,KYR,ISTRT,INOW,KSTG,K1,K2,K4,K28)
C
C      THIS SUBROUTINE DETERMINES WHICH HYDROGRAPHS ARE TO BE PLOTTED
C
C  DTHYD <= 0 NO OBSERVED DATA
C         = 1  WITH OBSERVED DATA
C  KKP  =0 PLOT BOTH OBSERVED DATA AND COMPUTED RESULTS
C       =1 PLOT COMPUTED RESULTS ONLY
      CHARACTER*4 UNTQ,UNTY
cc      COMMON/COPER55/ISTRT,INOW,IEND
      COMMON/M155/NU,JN,JJ,KIT,G,DT,TT,TIMF,F1
      COMMON/M655/KTIME,DTHYD,J1
      COMMON/M3255/IOBS,KTERM,KPL,JNK,TEH
      COMMON/METR55/METRIC
      COMMON/TPL55/DTHPLT
      COMMON/IDOS55/IDOS,IFCST
      COMMON/IONUM/IN,IPR,IPU
C
      INCLUDE 'common/fdbug'
      INCLUDE 'common/fnopr'
      INCLUDE 'common/fpltab'
      INCLUDE 'common/ofs55'
C
      DIMENSION PO(*),Z(*),T1(*),LTT1(*),TII(*),QTC(*),LTQTC(*),STC(*)
      DIMENSION STT(*),LTSTT(*),STQ(*),LTSTQ(*),FS(*),FFS(*),NGS(K4,1)
      DIMENSION FLDSTG(K2,K1),NGAGE(K1),STTNAM(5,K28),LTSTC(*)
      DIMENSION GZ(K4,K1),TYPK(K2,K1),YPK(K2,K1),TQPK(K2,K1),QPK(K2,K1)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_fldwav/RCS/waplot55.f,v $
     . $',                                                             '
     .$Id: waplot55.f,v 1.3 2000/07/20 12:02:10 page Exp $
     . $' /
C    ===================================================================
C
C
      IST=5
      IF(IDOS.GE.3) IST=3
      KKP = 1
      FACY=1.
      FACQ=1.
      UNTQ='CFS '
      UNTY='FEET'
      IF(METRIC.EQ.1) THEN
        FACY=3.281
        FACQ=35.32
        UNTQ='CMS '
        UNTY='M   '
      ENDIF
      DO 1880 J=1,JN
      J1 = J
      NGAG=NGAGE(J)
      IF(KPL) 1870,1870,1750
 1750 IF(KPL-2) 1760,1810,1760
 1760 IF(NGAG) 1810,1810,1770

 1770 DO 1800 K=1,NGAG
      IF (IOBS.GT.0) KKP = 0
      I=NGS(K,J)
      IGAG=K
      KI=0
      NKI=1
      KJ=LCAT21(K,J,NGAGE)
      LSTT=LTSTT(KJ)-1
      LSTC=LTSTC(KJ)-1
      LQTC=LTQTC(KJ)-1
      LSTQ=LTSTQ(KJ)-1
      IF(DTHYD.GT.0.) LKI=DTHPLT/DTHYD+0.0001
      DO 1780 KP=1,KTIME
      IF(DTHYD.LE.0.) GO TO 1778
      IF(KKP.EQ.1) GO TO 1778
      IF(DTHPLT.GE.DTHYD) GO TO 1776
      IF(KP.NE.NKI) GO TO 1778
      KI=KI+1
      NKI=KI*DTHYD/DTHPLT+1.001
      FFS(KI)=STT(KI+LSTT)/FACY
      GO TO 1778
 1776 DO 1777 KPI=1,LKI
      KI=KI+1
      FFS(KI)=STT(KI+LSTT)/FACY
 1777 CONTINUE
 1778 FS(KP)=STC(KP+LSTC)/FACY
      IF(KSTG.EQ.1) FS(KP)=FS(KP)-GZ(K,J)
CC      STC(KP,K,J)=STC(KP,K,J)/FACY
CC      QTC(KP,K,J)=QTC(KP,K,J)/FACQ
 1780 CONTINUE
      FLDHT=FLDSTG(I,J)/FACY
      PYPK=YPK(I,J)/FACY
      PQPK=QPK(I,J)/FACQ
      IF(KSTG.NE.1) THEN
        IF(IDOS.LT.3) THEN
          WRITE(IPR,2140) J,I,(STTNAM(KK,KJ),KK = 1,IST),FLDHT,UNTY
        ELSE
          WRITE(IPR,2141) J,I,(STTNAM(KK,KJ),KK = 1,IST),FLDHT,UNTY
        ENDIF
        WRITE(IPR,2142) PYPK,UNTY,TYPK(I,J)
 2142   FORMAT(10X,'MAX ELEV =',F12.2,1X,A4, 5X,'AT TIME =',F10.3,
     .    ' HOUR')
        WRITE(IPR,2144) PQPK,UNTQ,TQPK(I,J)
 2144   FORMAT(10X,' MAX FLOW =',F14.2,1X,A4,5X,'AT TIME =',F10.3,
     .    ' HOUR')
        WRITE(IPR,1790) UNTY
 1790   FORMAT (10X,30H*----COMPUTED    +----OBSERVED,15X,
     2    20H              ELEV (,A4,1H))
      ELSE
        FLDHT=FLDHT-GZ(K,J)
        PYPK=PYPK-GZ(K,J)
        IF(IDOS.LT.3) THEN
          WRITE(IPR,2240) J,I,(STTNAM(KK,KJ),KK = 1,IST),FLDHT,UNTY
        ELSE
          WRITE(IPR,2241) J,I,(STTNAM(KK,KJ),KK = 1,IST),FLDHT,UNTY
        ENDIF
        WRITE(IPR,2146) PYPK,UNTY,TYPK(I,J)
 2146   FORMAT(11X,'MAX STAGE =',F12.2,1X,A4, 5X,'AT TIME =',F10.3,
     .    ' HOUR')
        WRITE(IPR,2148) PQPK,UNTQ,TQPK(I,J)
 2148   FORMAT(10X,' MAX FLOW =',F14.2,1X,A4,5X,'AT TIME =',F10.3,
     .    ' HOUR')
        WRITE(IPR,1792) UNTY
 1792   FORMAT (10X,30H*----COMPUTED    +----OBSERVED,15X,
     2    21H              STAGE (,A4,1H))
      ENDIF
      CALL PLOT55(T1,LTT1,TII,QTC,LTQTC,STC,LTSTC,FS,FFS,NGAGE,
     . PO(LOSTM),Z(LZST0),Z(LZQT0),PO(LOKU),KKP,FLDHT,KTIME,KHR,KDA,
     . KMO,KYR,ISTRT,INOW,IGAG,GZ(K,J),KSTG,K1,K28)
 1800 CONTINUE
 1810 IF(KPL-2) 1870,1820,1820
 1820 IF(NGAG) 1870,1870,1830
 1830 DO 1860 K=1,NGAG
      IF (IOBS.GT.0) KKP = 0
      IGAG=K
      I=NGS(K,J)
      IF(KPL.EQ.2.AND.IOBS.EQ.0) THEN
        IJ=LCAT21(I,J,NGAGE)
        LQTC=LTQTC(IJ)-1
      ENDIF
      KI=0
      NKI=1
      IF(DTHYD.GT.0.) LKI=DTHPLT/DTHYD+0.0001
      DO 1840 KP=1,KTIME
      IF(DTHYD.LE.0.) GO TO 1835
      IF(KKP.EQ.1) GO TO 1835
      IF(DTHPLT.GE.DTHYD) GO TO 1833
      IF(KP.NE.NKI) GO TO 1835
      KI=KI+1
      NKI=KI*DTHYD/DTHPLT+1.001
      IF(KPL.GT.2) FFS(KI)=STQ(KI+LSTQ)/FACQ*0.001
      IF(KPL.EQ.2) FFS(KI)=STT(KI+LSTT)/FACQ*0.001
      GO TO 1835
 1833 DO 1834 KPI=1,LKI
      KI=KI+1
      IF(KPL.GT.2) FFS(KI)=STQ(KI+LSTQ)/FACQ*0.001
      IF(KPL.EQ.2) FFS(KI)=STT(KI+LSTT)/FACQ*0.001
 1834 CONTINUE
 1835 FS(KP)=QTC(KP+LQTC)/FACQ*0.001
CC      QTC(KP,K,J)=QTC(KP,K,J)/FACQ
CC      STC(KP,K,J)=STC(KP,K,J)/FACY
 1840 CONTINUE
      FLDHT=FLDSTG(K,J)/FACY
      PYPK=YPK(I,J)/FACY
      PQPK=QPK(I,J)/FACQ
      IF(KSTG.NE.1) THEN
        WRITE(IPR,2140)J,I,(STTNAM(KK,KJ),KK = 1, IST),FLDHT,UNTY
        WRITE(IPR,2142) PYPK,UNTY,TYPK(I,J)
        WRITE(IPR,2144) PQPK,UNTQ,TQPK(I,J)
      ELSE
        FLDHT=FLDHT-GZ(K,J)
        PYPK=PYPK-GZ(K,J)
        WRITE(IPR,2240)J,I,(STTNAM(KK,KJ),KK = 1, IST),FLDHT,UNTY
        WRITE(IPR,2146) PYPK,UNTY,TYPK(I,J)
        WRITE(IPR,2148) PQPK,UNTQ,TQPK(I,J)
      ENDIF
      WRITE(IPR,1850) UNTQ
 1850 FORMAT (10X,30H*----COMPUTED    +----OBSERVED,15X,
     2  16HDISCHARGE (1000 ,A4,1H))
      CALL PLOT55(T1,LTT1,TII,QTC,LTQTC,STC,LTSTC,FS,FFS,NGAGE,
     . PO(LOSTM),Z(LZST0),Z(LZQT0), PO(LOKU),KKP,FLDHT,KTIME,KHR,KDA,
     . KMO,KYR,ISTRT,INOW,IGAG,GZ(K,J),KSTG,K1,K28)
 1860 CONTINUE
 1870 CONTINUE
 1880 CONTINUE
 2140 FORMAT(///5X,'RIVER =',I3,5X,'STATION =',I3,5X,5A4,
     1   5X,'FLOOD ELEV = ',F6.2,1X,A4)
 2141 FORMAT (///5X,'RIVER =',I3,5X,'STATION =',I3,5X,2A4,2X,A4,
     1   5X,'FLOOD ELEV = ' ,F6.2,1X,A4)
 2240 FORMAT (///5X,'RIVER =',I3,5X,'STATION =',I3,5X,5A4,
     1   5X,'FLOOD STAGE = ',F6.2,1X,A4)
 2241 FORMAT (///5X,'RIVER =',I3,5X,'STATION =',I3,5X,2A4,2X,A4,
     1   5X,'FLOOD STAGE = ',F6.2,1X,A4)
      RETURN
      END
