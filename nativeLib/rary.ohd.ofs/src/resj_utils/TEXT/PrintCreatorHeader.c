/*------------------------------------------------------------------------------
** PrintCreatorHeader - print out a file header with creator information
**------------------------------------------------------------------------------
** Copyright:	See the COPYRIGHT file.
**------------------------------------------------------------------------------
** Notes: 	(1)	This routine uses information set by the
**			HMSetProgramData routine to generate a file header
**			like:

# File generated by...
# program:   demandts 2.7 (25 Jun 1995)
# user:      sam
# date:      Mon Jun 26 14:49:18 MDT 1995
# host:      white
# directory: /crdss/dmiutils/demandts/data
# command:   ../src/demandts -d1 -w1,10 -demands -istatemod 
#            /crdss/statemod/data/white/white.ddh -icu 
#            /crdss/statemod/data/white/white.ddc -sstatemod 
#            /crdss/statemod/data/white/white.dds -eff12 

**
**------------------------------------------------------------------------------
** History:
**
** 06-26-95	Steven A. Malers, RTi	Created routine.
** 07-06-95	SAM, RTi		Modify so that less space is wasted
**					across the page.
** 07-19-95	SAM, RTi		Modify so that comment can be multiple
**					characters (e.g., to allow "##" or
**					"REM".
** 07-20-95	SAM, RTi		Print working directory so we know what
**					the paths are relative to.
** 07-26-95	SAM, RTi		Print hostname.
** 26 Sep 1995	SAM, RTi		Print command file contents if one is
**					available.
** 24 Oct 1995	SAM, RTi		Change so leading and trailing lines of
**					--- are omitted.  Let the calling
**					application deal with that.
** 06 Sep 1996	SAM, RTi		Split out of HMUtil.c file.
** 27 Sep 1996	CEN, RTi		Copied from HMData
** 03 Dec 1996	SAM, RTi		Change commandfile to ESPcommandfile.
**------------------------------------------------------------------------------
** Variable	I/O	Description
**
** cfp		L	Pointer to command file.
** column	L	Current column.
** column0	L	Start of output after colons.
** comment	L	Character string to use for comments.
** comment0	I	Comment supplied by calling routine.
** comentlen	L	Length of comment string.
** comment_space L	String containing comment and spaces when printing
**			command line.
** dir		L	Current working directory.
** flag		L	Currently unused - may be used for file format.
** hostname	L	Name of host.
** i		L	Loop counter for command line arguments.
** left_border	L	Characters on left for labels disregarding comment
**			string.
** len		L	Length of a command line argument.
** message	L	Message string.
** now		L	Current date.
** ofp		I	Output file pointer.
** routine	L	Name of this routine.
** string	L	String used to read command file.
** user		L	Program user.
**------------------------------------------------------------------------------
*/

#include "resj/Extern.h"

#ifndef MAXHEADERSTRING
#define MAXHEADERSTRING 2000
#endif

int PrintCreatorHeader (	FILE *ofp, char *comment0, int maxwidth,
				unsigned int flag )
{	char	comment[256], comment_space[256], dir[256],
		hostname[256], now[256], progname[256],
		progver[256], routine[] = "PrintCreatorHeader",
		string[MAXHEADERSTRING], user[256];
	int	column, column0, commentlen, i, left_border = 12, len;
	FILE	*cfp;

	if ( !ofp ) {
		PrintWarning ( 2, routine, "Output file pointer is NULL" );
		return STATUS_FAILURE;
	}

	GetUser ( user );
	len = 256;
	GetWorkingDir ( dir, &len );
	len = 256;
	GetHostname ( hostname, &len, 0 );
	GetSystemTimeString ( now, (char *)"" );
	GetProgramData ( progname, progver );

	/*
	** Make sure that a valid comment string is used...
	*/

	if ( comment0 ) {
		commentlen	= strlen ( comment0 );
		strcpy ( comment, comment0 );
	}
	else {	commentlen	= 0;
		comment[0]	= '\0';
	}

	/*
	** Format the comment string for the command line printout...
	*/

	sprintf ( comment_space, "%s", comment );
	for ( i = 0; i < left_border; i++ )
		strcat ( comment_space, " " );

	fprintf ( ofp, "\
%s File generated by...\n\
%s program:   %s %s\n\
%s user:      %s\n\
%s date:      %s\n\
%s host:      %s\n\
%s directory: %s\n\
%s command:   ",
	comment, comment, progname, progver, comment, user, comment,
	now, comment, hostname, comment, dir, comment );
	column0	= commentlen + left_border;	/*initial column */
	column	= column0;
	for ( i = 0; i < prog_argc; i++ ) {
		len = strlen ( prog_argv[i] );
		if ( (column + len) >= maxwidth ) {
			/*
			** Put the argument on a new line...
			*/
			fprintf ( ofp, "\n%s%s ",
			comment_space, prog_argv[i] );
			column = column0 + len + 1;
		}
		else {	/*
			** Put the argument on the same line...
			*/
			fprintf ( ofp, "%s ", prog_argv[i] );
			column += (len + 1);
		}
	}
	fprintf ( ofp, "\n" );
	if ( program_initialized && FileReadable(ESPcommandfile) ) {
		/*
		** Print the command file contents...
		*/
		fprintf ( ofp, "\
%s-----------------------------------------------------------------------\n\
%s Command file:\n\
%s\n",		comment, comment, comment );
		cfp = fopen ( ESPcommandfile, "r" );
		while ( fgets(string,MAXHEADERSTRING,cfp) ) {
			fprintf ( ofp, "%s %s", comment, string );
		}
		fclose ( cfp );
	}
	return STATUS_SUCCESS;

/*  ==============  Statements containing RCS keywords:  */
{static char rcs_id1[] = "$Source: /fs/hseb/ob72/rfc/ofs/src/resj_utils/RCS/PrintCreatorHeader.c,v $";
 static char rcs_id2[] = "$Id: PrintCreatorHeader.c,v 1.2 2000/05/18 13:08:33 dws Exp $";}
/*  ===================================================  */

}
