C MEMBER PDRRSD
C-----------------------------------------------------------------------
C
C @PROCESS LVL(77)
C
C                             LAST UPDATE: 07/18/94.13:29:51 BY $WC20SV
C
      SUBROUTINE PDRRSD
C
C  THIS ROUTINE DUMPS ALL THE DATA FOR ONE RRS STATION/DATA TYPE
C
C
      CHARACTER*72 XSTRNG
C
      DIMENSION XRBUF(16),IRBUF(16),ISTAID(2)
C
      INCLUDE 'uio'
      INCLUDE 'udebug'
      INCLUDE 'ufreei'
      INCLUDE 'pdbcommon/pdunts'
      INCLUDE 'pdbcommon/pdrrsc'
C
      EQUIVALENCE (XRBUF(1),IRBUF(1))
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppdutil/RCS/pdrrsd.f,v $
     . $',                                                             '
     .$Id: pdrrsd.f,v 1.1 1995/09/17 19:09:31 dws Exp $
     . $' /
C    ===================================================================
C
C
C
      I1=1
      I3=3
      I8=8
      I9=9
      I10=10
      I16=16
C
C  READ CARD
10    CALL RPCARD (IBUF,IERR)
      CALL WPCARD (IBUF)
C
C  FIND FIELDS ON CARD
      CALL UFREE (1,72)
C
C  CHECK IF NO FIELDS ON CARD
      IF (NFIELD.EQ.0) GO TO 10
C
C  GET FIRST FIELD
      XSTRNG=' '
      NFLD=1
      NCHAR=IFSTOP(NFLD)-IFSTRT(NFLD)+1
      IF (NCHAR.GT.LEN(XSTRNG)) NCHAR=LEN(XSTRNG)
      CALL UPACK1 (IBUF(IFSTRT(NFLD)),XSTRNG,NCHAR)
      IF (IPDDB.GT.0) THEN
         CALL ULINE (LPD,1)
         WRITE (LPD,*) 'XSTRNG=',XSTRNG
         ENDIF
C
      IF (XSTRNG.EQ.'END') GO TO 140
C
      CALL SUBSTR (XSTRNG,1,8,ISTAID,-1)
      IF (NCHAR.GT.8) THEN
         CALL SUBSTR (XSTRNG,9,4,IDTYPE,-1)
         ELSE
            NFLD=2
            NCHAR=IFSTOP(NFLD)-IFSTRT(NFLD)+1
            CALL UPACK1 (IBUF(IFSTRT(NFLD)),IDTYPE,NCHAR)
         ENDIF
C
      IF (IPDDB.GT.0) THEN
         CALL ULINE (LPD,1)
         WRITE (LPD,'(1X,A,2A4)') 'ISTAID=',ISTAID
         WRITE (LPD,'(1X,A,2A4)') 'IDTYPE=',IDTYPE
         ENDIF
C
C  READ PRIMARY FILE CONTROL RECORD
      IREC=1
      CALL UREADT (KPDRRS,IREC,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 120
      LASTRC=IRBUF(2)-1
      IF (LASTRC.GT.2) GO TO 20
         WRITE (LP,150)
         GO TO 140
20    IREC=2
C
C  SCAN THROUGH PRIMARY FILE READING HEADERS
30    CALL UREADT (KPDRRS,IREC,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 120
C
C  AT END OF PRIMARY RRS FILE IF IRBUF(1) LT 1
      LPRIM=IRBUF(1)
      IF (LPRIM.GT.0) GO TO 40
      WRITE (LPE,160) IDTYPE,ISTAID
      GO TO 10
40    NXREC=IREC+1+(LPRIM-1)/16
C
C  SEE IF STATION IS ONE WANTED, IF SO BEGIN PRINTING INFO
      IF (IRBUF(2).EQ.ISTAID(1).AND.IRBUF(3).EQ.ISTAID(2).AND.
     *   IRBUF(5).EQ.IDTYPE) GO TO 50
      GO TO 70
C
C  PRINT PRIMARY RECORD FOR THIS STATION
50    IREC1=IREC
      IFREC=IRBUF(13)
      NVPOB=IRBUF(14)
      WRITE (LP,170) IREC1,IRBUF
      IREC1=IREC1+1
      CALL UREADT (KPDRRS,IREC1,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 120
      NSTAT=IRBUF(1)
      NST1=NSTAT+1
      WRITE (LP,180) NSTAT,IREC1,(IRBUF(I),I=2,4),(XRBUF(I),IRBUF(I+1),
     *   I=5,9,2),XRBUF(11),(IRBUF(I),I=12,13)
      NSTRT=NSTAT+2
      WRITE (LP,190) IREC1
      WRITE (LP,200) NSTRT,I16,(IRBUF(I),I=NSTRT,I16)
      WRITE (LP,210) NSTRT,I16,(XRBUF(I),I=NSTRT,I16)
      IREC1=IREC1+1
      IF (IREC1.GE.NXREC) GO TO 80
C
C  MORE DATA IN PRIMARY RECORDS
      CALL UREADT (KPDRRS,IREC1,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 120
60    WRITE (LP,220) IREC1
      WRITE (LP,200) I1,I8,(IRBUF(I),I=I1,I8)
      WRITE (LP,210) I1,I8,(XRBUF(I),I=I1,I8)
      WRITE (LP,200) I9,I16,(IRBUF(I),I=I9,I16)
      WRITE (LP,210) I9,I16,(XRBUF(I),I=I9,I16)
      IREC1=IREC1+1
      IF (IREC1.GE.NXREC) GO TO 80
C
C  MORE DATA IN PRIMARY RECORDS
      CALL UREADT (KPDRRS,IREC1,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 120
      GO TO 60
70    IREC=NXREC
      IF (IREC.LE.LASTRC) GO TO 30
      WRITE (LPE,160) IDTYPE,ISTAID
      GO TO 10
C
C  SEE IF ANY FREE POOL RECORDS
80    IF (IFREC.LT.1) GO TO 10
C
C  LOOP THROUGH CHAIN IN FREE POOL FILE
      WRITE (LP,230)
      KUNIT=KPDDDF(LUFREE)
90    IF (IFREC.LT.1) GO TO 10
      CALL UREADT (KUNIT,IFREC,IRBUF,IERR)
      IF (IERR.GT.0) GO TO 130
      WRITE (LP,240) IFREC,IRBUF(2),NVPOB,IRBUF(1)
C
      IF (NVPOB.EQ.3) GO TO 100
C
C  TWO VALUES PER OBSERVATION
C
      WRITE (LP,250) (IRBUF(I),XRBUF(I+1),I=3,7,2),IRBUF(9)
      WRITE (LP,260) (XRBUF(I),IRBUF(I+1),I=10,14,2),XRBUF(16)
      GO TO 110
C
C  THREE VALUES PER OBSERVATION
C
100   WRITE (LP,270) (IRBUF(I),IRBUF(I+1),XRBUF(I+2),I=3,6,3),IRBUF(9)
      WRITE (LP,280) (IRBUF(I),XRBUF(I+1),IRBUF(I+2),I=3,6,3),IRBUF(16)
110   IFREC=IRBUF(1)
      IF (IFREC.GT.0) GO TO 90
      GO TO 10
C
120   WRITE (LPE,290) 'READING PRIMARY',IREC
      GO TO 140
130   WRITE (LPE,290) 'READING FREEPOOL',IFREC
C
140   RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
150   FORMAT ('0**WARNING** NO RRS STATIONS ARE DEFINED.')
160   FORMAT ('0**WARNING** NO RRS DATA RECORDS FOUND ',
     *   'FOR DATA TYPE ',A4,' FOR STATION ',2A4,'.')
170   FORMAT ('0FIRST 16 WORDS OF PRIMARY RECORD NUMBER ',I6 /
     * 1X,I11,1X,2A4,I11,1X,A4/5(1X,I11)/6(1X,I11))
180   FORMAT ('0',I3,' RRS STATISTICS IN PRIMARY RECORD ',I6 /
     *   3(1X,I11),1X,G11.3,1X,I11,1X,G11.3 /
     *   2(1X,I11,1X,G11.3),2(1X,I11))
190   FORMAT ('0DATA IN PRIMARY RECORD NUMBER ',I6)
200   FORMAT (' INTEGER WORDS',I3,' TO',I3,2X,8(1X,I11))
210   FORMAT ('    REAL WORDS',I3,' TO',I3,2X,8(1X,G11.3))
220   FORMAT ('0NEXT PRIMARY RECORD NUMBER ',I6)
230   FORMAT ('0DATA IN FREE POOL RECORDS')
240   FORMAT ('0CURRENT FREE POOL RECORD = ',I6,3X,
     *   'NUMBER OF OBSERVATIONS = ',I3,3X,
     *   'NUMBER OF VALUES PER OBSERVATION =',I3,3X,
     *   ' POINTER TO NEXT FREE POOL RECORD =',I6)
250   FORMAT (' WORDS  3 TO  9 ',9(I11,1X,G11.3,1X))
260   FORMAT (' WORDS 10 TO 16 ',9(G11.3,1X,I11,1X))
270   FORMAT (' WORDS  3 TO  9 ',9(I11,1X,I11,1X,G10.3,1X))
280   FORMAT (' WORDS 10 TO 16 ',9(I11,1X,G10.3,1X,I11,1X))
290   FORMAT ('0**ERROR** ',A,' RECORD ',I6,'.')
C
      END
