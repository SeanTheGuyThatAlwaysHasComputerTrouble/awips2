C     MODULE MIGNOR
C
C     DESC - THIS SUBROUTINE PERFORMS THE IGNORETS MOD
C
C
C <><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
C
      SUBROUTINE MIGNOR(NCARDS,MODCRD,IIDATE,LLDATE,
     1  NXTOPN,NXTNAM,IHZERO)
C
      LOGICAL FIRST
      CHARACTER*8   FIELD,NXTNAM,OPID,BLANK8,SLASH8,KEYWRD
C
      INCLUDE 'ufreex'
      INCLUDE 'common/ionum'
      INCLUDE 'common/fctime'
      INCLUDE 'common/fctim2'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/fpwarn'
      INCLUDE 'common/fmodft'
      COMMON/FIGNOR/NIGNOR,IGNOPT(10),IGSDAT(10),IGEDAT(10)
C
      DIMENSION KEYWRD(5),IOPVAL(5)
      DIMENSION OLDOPN(2),MODCRD(20,NCARDS)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_mods/RCS/mignor.f,v $
     . $',                                                             '
     .$Id: mignor.f,v 1.2 1998/07/02 20:45:19 page Exp $
     . $' /
C    ===================================================================
C
C
      DATA SLASH8/4H/       /,BLANK8/8H        /
      DATA KEYWRD/8HINST    ,8HMEAN    ,8HPOOL    ,8HALL     ,
     1            8H        /
      DATA IOPVAL/1,2,4,7,7/
C
      CALL FSTWHR(8HMIGNOR  ,0,OLDOPN,IOLDOP)
C
C     SET DEBUG FLAG
C
      IBUG=IFBUG(4HMODS)+IFBUG(4HIGNO)
C
      IF(IBUG.GT.0)WRITE(IODBUG,799)IIDATE,LLDATE,NXTOPN,NXTNAM
  799 FORMAT(1H0,10X,'*** SUBROUTINE MIGNOR ENTERED ***  IIDATE=',I11,
     1 ', LLDATE=',I11,', NXTOPN=',I3,', NXTNAM= ',A8)
C
      IF(NXTOPN.NE.14.AND.NXTOPN.NE.26)GO TO 999
C
      IDATE=IABS(IIDATE)
      LDATE=IABS(LLDATE)
C
C     CHECK TIME PERIOD AGAINST RUN PERIOD - PRINT WARNING ONLY IF
C     ENTIRE PERIOD BEING CHANGED IS OUTSIDE OF RUN PERIOD
C
      ISTHR=(IDA-1)*24+IHZERO
      IENHR=(LDA-1)*24+LHR
C
C     NOW SEE IF ANY OF PERIOD ENTERED IS WITHIN THE CURRENT RUN PERIOD
C
      IF(IDATE.GT.IENHR.OR.LDATE.LT.ISTHR)GO TO 131
C
C     SOME OF PERIOD BEING CHANGED IS WITHIN THE RUN PERIOD
C
      GO TO 11
C
C     NONE OF THE PERIOD BEING CHANGED IS WITHIN THE RUN PERIOD
C
  131 IF(MODWRN.EQ.0)GO TO 999
      CALL MDYH2(IDA,IHZERO,IM1,ID1,IY1,IH1,DUM1,DUM2,MODTZC)
      CALL MDYH2(LDA,LHR,IM2,ID2,IY2,IH2,DUM1,DUM2,MODTZC)
      IXDA=IDATE/24+1
      IXHR=IDATE-(IXDA-1)*24
      IF(IXHR.EQ.0)IXDA=IXDA-1
      IF(IXHR.EQ.0)IXHR=24
      CALL MDYH2(IXDA,IXHR,IM3,ID3,IY3,IH3,DUM1,DUM2,MODTZC)
      LXDA=LDATE/24+1
      LXHR=LDATE-(LXDA-1)*24
      IF(LXHR.EQ.0)LXDA=LXDA-1
      IF(LXHR.EQ.0)LXHR=24
      CALL MDYH2(LXDA,LXHR,IM4,ID4,IY4,IH4,DUM1,DUM2,MODTZC)
C
      WRITE(IPR,602)IM3,ID3,IY3,IH3,MODTZC,IM4,ID4,IY4,IH4,MODTZC,
     1 IM1,ID1,IY1,IH1,MODTZC,IM2,ID2,IY2,IH2,MODTZC
  602 FORMAT(1H0,10X,'**WARNING** THE DATES FOR CHANGES IN THE ',
     1 'IGNORETS MOD (',I2,1H/,I2,1H/,I4,1H-,I2,1X,A4,
     1 4H TO ,I2,1H/,I2,1H/,I4,1H-,I2,1X,A4,1H)/11X,
     2 'ARE NOT WITHIN THE CURRENT RUN PERIOD (',I2,1H/,I2,
     3 1H/,I4,1H-,I2,1X,A4,4H TO ,I2,1H/,I2,1H/,I4,1H-,I2,1X,A4,1H)/
     4 11X,'THESE CHANGES WILL BE IGNORED.')
      CALL WARN
      GO TO 999
C
C     READ CARD - IF COMMAND LEAVE - IF COMMAND AND 1ST CARD ERROR
C
   11 FIRST=.TRUE.
      IF(NRDCRD.EQ.NCARDS)GO TO 113
C
  888 IF(NRDCRD.EQ.NCARDS)GO TO 999
C
      IOPT=7
      NOPOPT=0
      OPID=BLANK8
C
      IF(MISCMD(NCARDS,MODCRD).EQ.0)GO TO 17
C
      IF(.NOT.FIRST)GO TO 999
C
C     HAVE FOUND COMMAND AS FIRST SUBSEQUENT CARD - ERROR
C
  113 IF(MODWRN.EQ.0)GO TO 999
      WRITE(IPR,920)
  920 FORMAT(1H0,10X,'**WARNING** NO SUBSEQUENT CARDS FOUND FOR THE ',
     1 'IGNORETS MOD.  PROCESSING CONTINUES.')
      GO TO 999
C
   17 FIRST=.FALSE.
C
C  READ 2ND FIELD ON CARD
C
      NFLD=1
      NRDCRD=NRDCRD+1
C
  777 ISTRT=-3
      NCHAR=2
      ICKDAT=0
C
      CALL UFIEL2(NCARDS,MODCRD,NFLD,ISTRT,LEN,ITYPE,NREP,INTGER,REAL,
     1  NCHAR,FIELD,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTRT.NE.-2)GO TO 200
C
C  NO MORE FIELDS ON CARD - STORE INFO IN /CB/
C
      GO TO 800
C
C  FIELD FOUND - IF 2ND FIELD - SEE IF A KEYWORD
C                IF 3RD FIELD - SEE IF AN OPTYPE
C                IF 4TH FIELD - SEE IF A SLASH
C
  200 IF(NFLD.EQ.3)GO TO 215
      IF(NFLD.EQ.4)GO TO 218
C
      DO 210 I=1,5
      IKEY=I
      IF(FIELD.EQ.KEYWRD(I))GO TO 220
  210 CONTINUE
C
C  DOES NOT MATCH A KEYWORD - SEE IF AN OPTYPE
C
  215 CALL FOPCDE(FIELD,NUMOP)
      IF(NUMOP.GT.0)GO TO 230
C
C  DOES NOT MATCH AN OPTYPE - SEE IF A SLASH
C
  218 IF(FIELD.EQ.SLASH8)GO TO 240
C
C  NOT A VALID FIELD - WRITE MESSAGE IF WANTED
C
      IF(MODWRN.EQ.0)GO TO 888
      WRITE(IPR,620)(MODCRD(I,NRDCRD),I=1,20)
  620 FORMAT(1H0,10X,'** WARNING ** IN IGNORETS MOD - ',
     1 'AN INVALID FIELD WAS FOUND ON THE FOLLOWING MOD CARD'/
     2 11X,20A4/11X,'PROCESSING OF MOD CARDS CONTINUES.')
      CALL WARN
      GO TO 888
C
C  MATCHED A KEYWORD
C
  220 IOPT=IOPVAL(IKEY)
C  NOW SEE IF THERE IS ANOTHER FIELD
C
      GO TO 777
C
C  FOUND AN OPTYPE - SEE IF A VALID TYPE FOR THIS MOD
C
  230 NOPOPT=NUMOP
      IF(NOPOPT.EQ.14.OR.NOPOPT.EQ.26)GO TO 777
C
C  INVALID OPERATION TYPE - WRITE MESSAGE IF WANTED
C
      IF(MODWRN.EQ.0)GO TO 888
      WRITE(IPR,621)(MODCRD(I,NRDCRD),I=1,20)
  621 FORMAT(1H0,10X,'** WARNING ** IN IGNORETS MOD - ',
     1 'AN INVALID OPERATION TYPE WAS FOUND ON THE FOLLOWING ',
     2 'MOD CARD'/11X,20A4/11X,'PROCESSING OF MOD CARDS CONTINUES.')
      CALL WARN
      GO TO 888
C
C  READ ANOTHER FIELD
C
  240 ISTRT=-3
      NCHAR=2
      ICKDAT=0
C
      CALL UFIEL2(NCARDS,MODCRD,NFLD,ISTRT,LEN,ITYPE,NREP,INTGER,REAL,
     1  NCHAR,OPID,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTRT.NE.-2)GO TO 250
C
C  NO MORE FIELDS ON CARD - PRINT WARNING IF WANTED
C
      IF(MODWRN.EQ.0)GO TO 888
      WRITE(IPR,622)(MODCRD(I,NRDCRD),I=1,20)
  622 FORMAT(1H0,10X,'** WARNING ** IN IGNORETS MOD - ',
     1 'NO OPERATION NAME WAS FOUND AFTER A SLASH ON ',
     2 'THE FOLLOWING MOD CARD'/11X,20A4/11X,
     3 'PROCESSING OF MOD CARDS CONTINUES.')
      CALL WARN
      GO TO 888
C
C  SEE IF OPTYPE AND OPID MATCH THE NEXT OPERATION
C  IF OPTYPE NOT ENTERED (I.E. NOPOPT=0) ONLY CHECK OPID
C
  250 IF(IBUG.GT.0)WRITE(IODBUG,932)NOPOPT,OPID,NXTOPN,NXTNAM
  932 FORMAT(11X,'CHECKING TO SEE IF OPERATION NUMBERS AND ',
     1 'IDS MATCH'/11X,'NOPOPT,    OPID, NXTOPN,    NXTNAM ='/
     1 11X,I4,5X,A8,I4,5X,A8)
      IF(NOPOPT.EQ.0)GO TO 255
      IF(NOPOPT.NE.NXTOPN)GO TO 260
  255 IF(OPID.NE.NXTNAM)GO TO 260
      GO TO 800
C
  260 IF(IBUG.GT.0)WRITE(IODBUG,935)
  935 FORMAT(11X,'OPERATION NUMBERS AND IDS DO NOT MATCH'/
     1 11X,'NO CHANGES WILL BE MADE TO THE FIGNOR CB')
      GO TO 888
C
C  TYPE AND ID MATCH - MAKE ENTRY IN /CB/
C
  800 IF(NIGNOR.EQ.0)GO TO 820
C
C  SOME ENTRIES ALREADY IN /CB/ - SEE IF DATES MATCH
C
      DO 810 I=1,NIGNOR
      IF(IGSDAT(I).NE.IDATE)GO TO 810
      IF(IGEDAT(I).NE.LDATE)GO TO 810
C
C  DATES MATCH - STORE OPTION THAT INCLUDES ALL ENTRIES
C  CURRENTLY IN /CB/ AND THOSE BEING ADDED
C
      IF(IOPT.EQ.7)IGNOPT(I)=7
      IF(IGNOPT(I).EQ.7)GO TO 805
      ITEMP=IGNOPT(I)
      IF(IOPT.EQ.1.AND.
     1(ITEMP.EQ.0.OR.ITEMP.EQ.2.OR.
     2 ITEMP.EQ.4.OR.ITEMP.EQ.6))IGNOPT(I)=ITEMP+IOPT
      IF(IGNOPT(I).NE.ITEMP)GO TO 805
      IF(IOPT.EQ.2.AND.
     1(ITEMP.EQ.0.OR.ITEMP.EQ.1.OR.
     2 ITEMP.EQ.4.OR.ITEMP.EQ.5))IGNOPT(I)=ITEMP+IOPT
      IF(IGNOPT(I).NE.ITEMP)GO TO 805
      IF(IOPT.EQ.4.AND.
     1(ITEMP.EQ.0.OR.ITEMP.EQ.1.OR.
     2 ITEMP.EQ.2.OR.ITEMP.EQ.3))IGNOPT(I)=ITEMP+IOPT
  805 IF(IBUG.GT.0)WRITE(IODBUG,931)I,IGNOPT(I),IGSDAT(I),IGEDAT(I)
  931 FORMAT(11X,'ENTRY NUMBER ',I3,' HAS BEEN CHANGED IN ',
     1 'THE FIGNOR COMMON BLOCK'/11X,'IGNOPT, IGSDAT, IGEDAT ='/
     2 9X,3I8)
      GO TO 888
C
  810 CONTINUE
C
C  DATES DO NOT MATCH - ADD TO /CB/ IF THERE IS ROOM
C
      IF(NIGNOR.LT.10)GO TO 820
C
C  NOT ENOUGH ROOM IN /CB/ - PRINT WARNING IF WANTED
C
      IF(MODWRN.EQ.0)GO TO 888
      WRITE(IPR,623)(MODCRD(I,NRDCRD),I=1,20)
  623 FORMAT(1H0,10X,'** WARNING ** IN IGNORETS MOD - ',
     1 'THERE IS NO ROOM IN THE /FIGNOR/ COMMON BLOCK FOR ',
     2 'THE FOLLOWING MOD CARD'/11X,20A4,11X,
     3 'PROCESSING OF MOD CARDS CONTINUES.')
      GO TO 888
C
C  ENOUGH ROOM - ADD TO END
C
  820 NIGNOR=NIGNOR+1
      IGNOPT(NIGNOR)=IOPT
      IGSDAT(NIGNOR)=IDATE
      IGEDAT(NIGNOR)=LDATE
      IF(IBUG.GT.0)WRITE(IODBUG,930)NIGNOR,IOPT,IDATE,LDATE
  930 FORMAT(11X,'A NEW ENTRY HAS BEEN ADDED TO THE FIGNOR ',
     1 'COMMON BLOCK'/11X,'NIGNOR, IGNOPT, IGSDAT, IGEDAT ='/
     2 9X,4I8)
      GO TO 888
C
  999 CONTINUE
      CALL FSTWHR(OLDOPN,IOLDOP,OLDOPN,IOLDOP)
      IF(IBUG.GT.0)WRITE(IODBUG,841)
  841 FORMAT(11X,'*** LEAVING MIGNOR ***')
      RETURN
      END
