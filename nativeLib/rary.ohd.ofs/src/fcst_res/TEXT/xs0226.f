C MEMBER XS0226
C  (from old member FCXS0226)
C
      SUBROUTINE XS0226(SUNUM,PO,W,D,LOCWS,IDPT)
C----------------------------------------------------------------------
C  SUBROUTINE TO EXTRACT ALL INFORMATION FROM PO ARRAY AND DATA FROM D
C  ARRAY AND PASS THESE TO THE ACTUAL COMPUTATION ROUTINE FOR THE SETQ
C  SCHEME, PREQ26.
C----------------------------------------------------------------------
C  WRITTEN BY - JOE OSTROWSKI - HRL AUGUST 1983
C----------------------------------------------------------------------
C
      INCLUDE 'common/resv26'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/exg26'
      INCLUDE 'common/pres26'
C
      DIMENSION PO(1),W(1),D(1),LOCWS(1),IDPT(1)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_res/RCS/xs0226.f,v $
     . $',                                                             '
     .$Id: xs0226.f,v 1.1 1995/09/17 19:06:52 dws Exp $
     . $' /
C    ===================================================================
C
      DATA DL3T/4HL3/T/
C
      IF (IBUG.GE.1) WRITE(IODBUG,1600)
 1600 FORMAT('   *** ENTER XS0226 ***')
C
C------------------------------------------------------------------
C  THINGS THAT MUST BE DONE ARE:
C    1) SET THE OUTFLOW VALUE AND ITS TYPE,
C    2) GET THE LOCATION OF CARRYOVER FOR THIS SCHEME,
C    3) MAKE THE COMPUTATIONS, AND
C    4) UPDATE THE CARRYOVER.
C
C  GET POINTER INFO FOR THIS SCHEME
C
      CALL XPTR26(SUNUM,PO,IORD,IBASE,LEVEL,LOCPM,LOCTS,LOCCO)
C
C  SET EXECUTION POINTER FOR THIS SCHEME
C
      LOCEX = IORD*3
      W(LOCEX) = 1.01
C
C  SET THE LOCATION OF CARRYOVER IN THE WORK ARRAY.
C
      LOCCOW = LOCWS(4)
      LOCCOT = LOCCOW + LOCCO - 1
C
C  NOW SET THE OUTFLOW VALUE AND ITS TYPE
C
      IWHICH = PO(LOCPM)
      IF (IWHICH.GT.0) GO TO 100
C
C  DISCHARGE IS SET BY USER AND IS STORED IN PO ARRAY
C  GET THE TYPE OF DATA FOR PROPER ASSIGNMENT
C
      IQO = PO(LOCPM+2)
      IOPT = 0
C  THE FOLLOWING CHANGES MADE ON 3/5/90
C      IF (ADJRUN .AND. .NOT.FCST) GO TO 500
      IF (.NOT.ADJRUN .OR. FCST) GO TO 9
      IF(WRAJQI .OR. WRAJQM) GO TO 500
    9 IF (IQO.EQ.0) GO TO 10
C  END OF CHANGE OF 3/5/90
      QO2 = PO(LOCPM+1)
      GO TO 20
C
C  TYPE IS MEAN. CONVERT TO UNITS OF TIMD.
C
   10 CONTINUE
C  THE FOLLOWING CHANGES MADE ON 2/8/90
C      QOM = PO(LOCPM+1) * NTIM24
      QOM = PO(LOCPM+1)
C  END OF CHANGE OF 2/8/90
C
C  SET MISSING VALUE OPTION
C
   20 CONTINUE
      IOPT = 0
      GO TO 500
C
C---------------------------------------------
C  VALUE IS TO COME FROM TIME SERIES
C
  100 CONTINUE
C
C  GET DATA TYPE
C
      CALL FDCODE(PO(LOCTS+2),X,DIM,IX,IX,X,IX,IX)
      IQO = 0
      IF (DIM.EQ.DL3T) IQO = 1
C
C  GET DATA VALUE FROM TIME SERIES
C
C  THE FOLLOWING CHANGES MADE ON 3/5/90
C      IF (ADJRUN .AND. .NOT.FCST) GO TO 300
      IF (.NOT.ADJRUN .OR. FCST) GO TO 110
      IF(WRAJQI .OR. WRAJQM) GO TO 300
  110 LOCTSP = W(LOCEX-1)
C  END OF CHANGE OF 3/5/90
C
C  NEED DELTA-T OF TIME SERIES TO SEE IF WE CAN LOOK FOR A VALUE
C  IN THIS TIME PERIOD.
C
      IDTTS = PO(LOCTS+3)
      MULT = IDTTS/MINODT
      IDLOC = NS2/MULT
      LOCTSD = IDPT(LOCTSP) + IDOFST*24/IDTTS
      QT = -999.0
      IF (MOD(NS2,MULT).EQ.0) QT = D(LOCTSD+IDLOC-1)
C
C  NOW ASSIGN VALUE TO PROPER VARIABLE
C
      IF (IQO.EQ.1) QO2 = QT
      IF (IQO.EQ.0) QOM = QT
C
C  CONVERT DISCHARGE VALUE TO UNITS OF TIMD IF MEAN VALUES ARE USED
C  AND IT IS NOT MISSING.
C
      NCON = 1
      IF (IQO .EQ. 0 .AND. IFMSNG(QOM) .NE. 1) NCON = NTIM24
      QOM = QOM * NCON
C
C  GET MISSING VALUE OPTION
C
  300 CONTINUE
      IOPT = PO(LOCPM+1)
C
C--------------------------------------------------------------
C  COMPUTE OUTPUT FOR THIS SCHEME
C
  500 CONTINUE
C
      CALL PREQ26(W(LOCCOT),PO(LESSTO),PO(LESELV))
C
C--------------------------------------------------------------
C  UPDATE CARRYOVER IF NEEDED
C
      IF (IWHICH.EQ.0.OR.IOPT.EQ.0) GO TO 9000
C
C  NOW SHIFT CARRYOVER DOWNWARD BY ONE POSITION (I.E. - 2 TO 1, 3 TO 2)
C  IF MORE THAN ONE CARRYOVER VALUE IS SAVED.
C
      IF (IOPT.EQ.1) GO TO 650
      DO 600 I=2,IOPT
      IDOWN = I-1
      W(LOCCOT+IDOWN-1) = W(LOCCOT+I-1)
  600 CONTINUE
C
C  NOW SET THE LAST POSITION
C
  650 CONTINUE
      QLAST = QOM
      IF (IQO .EQ. 1) QLAST = QO2
      W(LOCCOT+IOPT-1) = QLAST
C
C----------------------------------------------
C  ALL DONE WITH 'SETQ'
C
 9000 CONTINUE
      IF (IBUG.GE.1) WRITE(IODBUG,1699)
 1699 FORMAT('    *** EXIT XS0226 ***')
      RETURN
      END
