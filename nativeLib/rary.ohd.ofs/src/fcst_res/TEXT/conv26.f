C MEMBER CONV26
C  (from old member FCCONV26)
C
      SUBROUTINE CONV26(QOMEAN,DATMIN,QMIN,QOMBAC,QOMOBS,QOMSIM,
     $QOMADJ,FRACTN)
C
C THIS IS A UTILITY SUBROUTINE FOR CONVERTING 24-HR MEAN OUTFLOWS INTO
C TIME INTERVAL MEAN OUTFLOWS.  IF THE 24-HR MEAN OUTFLOW CONSISTS ONLY
C OF GENERATION DISCHARGE, FRACTIONS OF THE 24-HR OUTFLOW, AS DETERMINED
C FROM HISTORICAL RECORDS, ARE USED TO CONVERT THE 24-HR MEANS INTO TIME
C INTERVAL MEAN OUTFLOWS.  WHEN THE 24-HR OUTFLOW DOES NOT EXCEED
C MAXIMUM GEMERATION DISCHARGE, TIME INTERVAL MEAN OUTFLOW WILL NOT BE
C ALLOWED TO EXCEED MAXIMUM GENERATION DISCHARGE OR DROP BELOW THE
C REQUIRED MINIMUM OUTFLOW.
C     WHEN THE 24-HR OUTFLOW EXCEEDS MAXIMUM GENERATION DISCHARGE, TIME
C INTERVAL VALUES FROM THE SIMULATED RUN (IF AVAILABLE) WILL BE USED
C FOR DISTRIBUTING THE OUTFLOW OVER THE TIME INTERVALS.  IF A SIMULATED
C RUN HAS NOT BEEN MADE, CONVERSION WILL BE MADE BY USING A STRAIGHT
C LINE INTERPOLATION BETWEEN MIDPOINTS OF 24-HR MEAN DISCHARGES (JOPT=1)
C OR BY USING A CONSTANT DISCHARGE FOR ALL TIME INTERVALS (JOPT=2).
C
C THIS SUBROUTINE WAS ORIGINALLY PROGRAMMED BY
C     WILLIAM E. FOX
C     MAY,1982
C     REVISION NO. 1 BY WILLIAM E. FOX -- AUGUST, 1989
C
C SUBROUTINE CONV26 IS IN
C
C VARIABLES PASSED TO OR FROM THIS SUBROUTINE ARE DEFINED AS FOLLOWS:
C     NRUN -- ARRAY POSITION IN INFLOW, OUTFLOW AND STORAGE ARRAYS AT
C       RUN TIME.
C     KSTART -- ARRAY POSITION IN OUTFLOW ARRAY FOR FIRST TIME INTERVAL
C       IN COMPUTATIONAL PERIOD.
C     KEND -- ARRAY POSITION FOR LAST TIME INTERVAL IN COMPUTATIONS.
C     KEND24 -- COMPUTED ARRAY POSITION AT END OF LAST 24-HR PERIOD.
C       KEND24 MAY BE GREATERA THAN KEND IF THE LAST ARRAY POSITION FOR
C       INFLOW, OUTFLOW AND STORAGE ARRAYS IS LESS THAN KEND24.
C     LSTART -- POSITION IN FRACTN ARRAY CORRESPONDING TO KSTART POSIT-
C       ION IN OUTFLOW ARRAY.
C     JOPT -- OPTION FOR CONVERTING TO TIME INTERVAL OUTFLOWS WHEN 24-HR
C       OUTFLOW IS GREATER THAN MAXIMUM GENERATION DISCHARGE AND SIMULA-
C     TED ARRAY IS NOT AVAILABLE OR THIS IS THE SIMULATED RUN.
C       JOPT OF 1 INDICATES STRAIGHT LINE
C       INTERPOLATION BETWEEN MIDPOINTS OF 24-HR DISCHARGES WHILE JOPT
C       OF 2 INDICATES A CONSTANT OUTFLOW WILL BE USED FOR ALL TIME
C       INTERVALS.
C     JOBS -- VALUE OF 0 INDICATES QOMEAN VALUES ARE NOT OBSERVED.
C       VALUE OF 1 INDICATES OBSERVED QOMEAN VALUES.
C     NQMEAN -- NUMBER OF QOMEAN VALUES.
C     QOMEAN -- MEAN OUTFLOWS FOR 24-HR PERIODS.  ANY NUMBER OF CONSECU-
C       TIVE VALUES CAN BE USED IN THIS ARRAY BUT OBSERVED AND COMPUTED
C       VALUES MUST BE ENTERED SEPARATELY.  MISSING VALUES IN THE ARRAY
C       MUST BE ENTERED AS -999.0.
C     QGENMX -- MAXIMUM GENERATION DISCHARGE.  A SINGLE VALUE OF MAXIMUM
C       GENERATION DISCHARGE IS USED IN CONV26 EVEN IF A RELATION OF
C       ELEVATION VS MAXIMUM GENERATION DISCHARGE IS USED IN QGEN26.
C     QGENDS -- MAXIMUM GENERATION DISCHARGE AT DOWNSTREAM DAM.  IF NOT
C       USED, MUST BE SET TO SAME VALUE AS QGENMX.
C     OUTMIN -- REQUIRED MINIMUM INSTANTANEOUS OUTFLOW.  WILL BE -999.0
C       IF IT VARIES WITH DATE.
C     DATMIN -- JULIAN DATES FOR DATE VS MINIMUM OUTFLOW RELATION WHEN
C       MINIMUM OUTFLOW VARIES WITH DATE.
C     QMIN -- MINIMUM OUTFLOWS CORRESPONDING TO DATMIN VALUES.
C     NDATMN -- NO. OF PAIRS OF DATMIN AND QMIN VALUES.
C     JULSTR -- JULIAN DATE AT BEGINNING OF FIRST 24-HR MEAN OUTFLOW
C       VALUE.
C     NDAYR -- NO. OF DAYS IN YEAR FOR JULSTR.
C     QOMBAC -- ARRAY OF OUTFLOWS FOR NTIM24 TIME INTERVALS PRIOR TO
C       FIRST TIME INTERVAL IN OUTFLOW ARRAY.
C     QOMOBS -- ARRAY OF OBSERVED TIME INTERVAL MEAN OUTFLOWS.
C     QOMSIM -- ARRAY OF SIMULATED MEAN OUTFLOWS.  QOMSIM(1) MUST BE
C       -999.0 IF SIMULATED VALUES ARE NOT AVAILABLE.
C     QOMADJ -- ARRAY OF ADJUSTED MEAN OUTFLOWS.
C     QAVAIL -- WORKING ARRAY USED FOR INDICATING THE TIME INTERVALS
C       WHERE ADJUSTMENTS ARE NEEDED TO THE FIRST COMPUTATION OF
C       OUTFLOW.
C     FRACTN -- FRACTIONS OF 24-HR VOLUME FOR COMPUTING TIME INTERVAL
C       OUTFLOWS.
C     NTIM24 -- NO. OF FRACTN VALUES AND ALSO THE NO. OF TIME INTERVALS
C       IN 24 HRS.
C
C
      INCLUDE 'common/fdbug'
      INCLUDE 'common/resv26'
      INCLUDE 'common/cnvr26'
C
      DIMENSION QOMEAN(*),QOMBAC(*),QOMOBS(*),QOMSIM(*),QOMADJ(*),
     $QAVAIL(24),FRACTN(*),DATMIN(*),QMIN(*)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_res/RCS/conv26.f,v $
     . $',                                                             '
     .$Id: conv26.f,v 1.4 2004/06/21 14:09:33 hsu Exp $
     . $' /
C    ===================================================================
C
C
      JULIAN=JULSTR
C
C WRITE TRACE AND DEBUG IF REQUIRED.
C
      ibugsave=ibug
      ibug=0
      IF(IBUG-1)50,10,20
   10 WRITE(IODBUG,30)
      GO TO 50
   20 WRITE(IODBUG,30)
   30 FORMAT(1H0,10X,17H** CONV26 ENTERED)
      WRITE(IODBUG,40) KSTART,KEND,KEND24,LSTART,JOPT,JOBS,
     $JULIAN,NDAYR,NTIM24,QGENMX,QGENDS,OUTMIN
   40 FORMAT(1H0,' KSTART,KEND,KEND24,LSTART,JOPT,JOBS,',
     $'JULIAN,NDAYR,NTIM24,QGENMX,QGENDS,OUTMIN',/1X,10I5,3F10.0)
C
C SET BEGINNING (JSTART) AND ENDING ARRAY POSITION (JEND) FOR FIRST
C 24-HR PERIOD OR PARTIAL 24-HR PERIOD AND BEGINNING COUNTER (JJ) FOR
C ARRAY POSITION IN FRACTN ARRAY.
C
   50 JSTART=KSTART
      TIM24=NTIM24
      JEND24=JSTART+NTIM24-LSTART
      JEND=JEND24
      IF(JEND.GT.KEND) JEND=KEND
      JJ=LSTART-1
C
C DO LOOP 440 BREAKS EACH 24-HR MEAN OUTFLOW FROM QOMEAN ARRAY INTO TIME
C INTERVAL VALUES.  MISSING VALUES IN THE QOMEAN ARRAY MUST BE ENTERED
C AS -999.0.  FOR TEST PURPOSES, QGENMX IS MULTIPLIED BY 1.005 TO
C PREVENT SMALL COMPUTATIONAL ERRORS IN QOMEAN FROM CAUSING A BRANCH TO
C THE WRONG LOCATION IN THE SUBROUTINE.  COMPUTE QOMIN AT BEGINNING OF
C DO LOOP IF IT VARIES WITH DATE.
C
      DO 440 I=1,NQMEAN
      QOMIN=OUTMIN
      IF(OUTMIN.NE.-999.0) GO TO 80
      JULIAN =JULIAN+1
      IF(JULIAN.LE.NDAYR) GO TO 60
      JULIAN=1
      DATE=JULIAN
      GO TO 70
C
C IF JULIAN IS GREATER THAN 59 AND IT IS A LEAP YEAR, DATE SHOULD BE
C DECREASED BY 1 SINCE THE RELATION IS BASED ON A NON-LEAP YEAR,
C
   60 DATE=JULIAN
      IF(NDAYR.EQ.366.AND.JULIAN.GT.59) DATE=DATE-1
   70 CALL TERP26(DATE,QOMIN,DATMIN,QMIN,NDATMN,IFLAG,IBUG)
   80 VOLUME=QOMEAN(I)*TIM24
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      IF(QOMEAN(I).EQ.-999.0) GO TO 430
      IF(QOMEAN(I).EQ.-999.0) GO TO 435
      IF(QOMEAN(I).GT.QGENMX*1.005) GO TO 220
C
C FOLLOWING STATEMENTS APPLY WHEN MEAN 24-HR OUTFLOW IS LESS THAN OR
C EQUAL TO MAXIMUM GENERATION OUTFLOW.
C
      QLIMIT=QGENMX
CR1 MEAN OUTFLOW SHOULD NOT BE LIMITED TO QGENDS
CR1      IF(QOMEAN(I).LE.QGENDS)QLIMIT=QGENDS
      SUMDIF=0.
      IF(JJ.EQ.0) GO TO 130
CR1      IF(IFCST.EQ.0) GO TO 130
CR1 *** REVISION NO. 1 *** END ***
C
C FOR THE FOLLOWING STATEMENTS, JSTART IS NOT AT THE BEGINNING OF THE
C 24-HR PERIOD.  THE SUM OF THE DIFFERENCES BETWEEN COMPUTED AND ACTUAL
C OUTFLOWS PRIOR TO JSTART MUST BE COMPUTED IN ORDER TO MAKE CORRECTIONS
C BTWEEN JSTART AND JEND.  OUTFLOWS ARE IN THE QOMBAC ARRAY WHEN LBGN IS
C LESS THAN 1.
C
cc      LBGN=JEND24-NTIM24+1
      LBGN=MOD(JSTART,NTIM24)
      LL=1
cc      IF(LBGN.GT.0) GO TO 100
      IF(LBGN.LE.0) GO TO 130
cc      LBAC=NTIM24+LBGN
      LBAC=NTIM24-LBGN
CR1 *** REVISION NO. 1 *** BEGIN ***
   90 IF(QOMBAC(LBAC).EQ.-999.0) GO TO 91
C   90 SUMDIF=SUMDIF+VOLUME*FRACTN(LL)-QOMBAC(LBAC)
      SUMDIF=SUMDIF+VOLUME*FRACTN(LL)-QOMBAC(LBAC)
   91 LBAC=LBAC+1
CR1 *** REVISION NO. 1 *** END ***
      LL=LL+1
      IF (LL.GE.NTIM24) LL=1
      IF(LBAC.LE.NTIM24) GO TO 90
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      LBGN=1
      GO TO 130
CR1 *** REVISION NO. 1 *** END ***
  100 LEND=JSTART-1
      IF(LEND.EQ.0) GO TO 130
      LL=LL-1
      DO 120 L=LBGN,LEND
      LL=LL+1
      IF (LL.GE.NTIM24) LL=1
      IF(IFCST.EQ.1) GO TO 101
      QOMSIM(L)=VOLUME*FRACTN(LL)
      GO TO 120
  101 IF(QOMADJ(L).NE.-999.0) GO TO 110
      QOMADJ(L)=VOLUME*FRACTN(LL)
      GO TO 120
  110 SUMDIF=SUMDIF+VOLUME*FRACTN(LL)-QOMADJ(L)
  120 CONTINUE
C
C DO LOOP 160 COMPUTES TIME INTERVAL OUTFLOWS.
C
  130 KK=JJ
      DO 160 J=JSTART,JEND
      KK=KK+1
      QOMT=VOLUME*FRACTN(KK)
      IF(IFCST.EQ.1) GO TO 131
      QOMSIM(J)=QOMT
      GO TO 141
  131 QOMADJ(J)=QOMT
C$     IF(J.GT.NRUN) GO TO 140
C$     IF(QOMOBS(J).EQ.-999.0) GO TO 140
C$     QOMADJ(J)=QOMOBS(J)
C$     GO TO 150
  140 IF(QOMT.GT.QLIMIT) QOMADJ(J)=QLIMIT
      IF(QOMT.LT.QOMIN) QOMADJ(J)=QOMIN
      IF(QOMT.EQ.QOMADJ(J)) GO TO 160
      GO TO 150
  141 IF(QOMT.GT.QLIMIT) QOMSIM(J)=QLIMIT
      IF(QOMT.LT.QOMIN) QOMSIM(J)=QOMIN
      SUMDIF=SUMDIF+QOMT-QOMSIM(J)
      GO TO 160
C
C SUMDIF IS THE SUM OF THE DIFFERENCES BETWEEN COMPUTED TIME INTERVAL
C OUTFLOW AND OBSERVED OUTFLOWS, OUTFLOWS PRIOR TO FIRST TIME INTERVAL,
C OR OUTFLOW ADJUSTED DUE TO LIMITING UPPER OR LOWER VALUES.
C
  150 SUMDIF=SUMDIF+QOMT-QOMADJ(J)
  160 CONTINUE
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      IF(IFCST.EQ.0) GO TO 410
CR1      IF(SUMDIF.EQ.0.) GO TO 410
      IF(ABS(SUMDIF) .LT. 0.00001) GO TO 410
CR1 *** REVISION NO. 1 *** END ***
      IF(JEND.LT.JEND24) GO TO 410
C
C SET QAVAIL(JQ)=0 FOR TIME INTERVALS WHERE NO ADJUSTMENT CAN BE MADE
C AND EQUAL TO 1 WHERE ADJUSTMENT CAN BE MADE.
C
      DO 190 J=JSTART,JEND
      JQ = J-JSTART+1
CR1 *** REVISION NO. 1 *** BEGIN ***
       QAVAIL(JQ)=0.
CR1 *** REVISION NO. 1 *** END ***
C$     IF(IFCST.EQ.1) GO TO 170
      QOMT=QOMSIM(J)
C$     GO TO 181
C$  170 IF(J.GT.NRUN) GO TO 180
C$     QAVAIL(JQ)=0.
C$     IF(QOMOBS(J).EQ.-999.0) GO TO 180
C$     GO TO 190
C$  180 QOMT=QOMADJ(J)
  181 IF(SUMDIF.GT.0.) GO TO 182
      IF(QOMT.EQ.QOMIN) QAVAIL(JQ)=0.
      IF(QOMT.GT.QOMIN) QAVAIL(JQ)=1.
      GO TO 190
  182 IF(QOMT.EQ.QLIMIT) QAVAIL(JQ)=0.
      IF(QOMT.LT.QLIMIT) QAVAIL(JQ)=1.
  190 CONTINUE
C
C COMPUTE THE SUM OF FRACTIONS (FRACTN) FO THE TIME INTERVALS WHERE
C ADJUSTMENTS WILL BE MADE AND THE NUMBER (SUM) OF TIME INTERVALS
C WHERE FRACTN IS 0.
C
      KK=JJ
      SUMFRA=0.
      SUM=0.
      DO 200 J=JSTART,JEND
      JQ = J-JSTART+1
      KK=KK+1
      IF(QAVAIL(JQ).EQ.0.) GO TO 200
      SUMFRA=SUMFRA+FRACTN(KK)
  200 IF(FRACTN(KK).EQ.0.) SUM=SUM+1.
C
C DISTRIBUTE THE SUM OF DIFFERENCES ACCORDING TO THE DISTRIBUTION
C FRACTIONS (FRACTN).  SAVE SUMDIF IN SUMDF AS SUMDIF WILL BE
C CHANGED BUT THE ORIGINAL SUMDIF IS NEEDED TO COMPUTE ADJUSTMENTS.
C
      SUMDF=SUMDIF
CR1 *** REVISION NO. 1 *** BEGIN ***
      MM=0
      IF(ABS(SUMFRA).LT.0.00001) GO TO 209
C      IF(SUMFRA.EQ.0.) GO TO 209
C      KK=JJ
  191  KK=JJ
      DO 208 J=JSTART,JEND
      JQ = J-JSTART+1
      KK=KK+1
CR1  ADD FOLLOWING STATEMENT
      IF(J.EQ.JSTART) MM=MM+1
      IF(QAVAIL(JQ).EQ.0.) GO TO 208
      IF(IFCST.EQ.1) GO TO 201
      QOMT=QOMSIM(J)
      GO TO 202
  201 QOMT=QOMADJ(J)
  202 ADJ=SUMDF*FRACTN(KK)/SUMFRA
CR1  ADD FOLLOWING STATEMENT
      IF(MM.EQ.2) ADJ=SUMDIF
CR1 *** REVISION NO. 1 *** END ***
      QQ=QOMT+ADJ
      IF(SUMDIF.LT.0.) GO TO 203
      IF(QQ.LE.QLIMIT) GO TO 204
      ADJ=QLIMIT-QOMT
      GO TO 204
  203 IF(QQ.GE.QOMIN) GO TO 205
      ADJ=QOMIN-QOMT
      GO TO 205
  204 SUMDIF=SUMDIF-ADJ
      IF(SUMDIF.GE.0.) GO TO 206
      ADJ=SUMDIF-ADJ
      SUMDIF=0.
      GO TO 206
  205 SUMDIF=SUMDIF-ADJ
      IF(SUMDIF.LE.0.) GO TO 206
      ADJ=SUMDIF+ADJ
      SUMDIF=0.
  206 QOMT=QOMT+ADJ
  207 IF(IFCST.EQ.0) QOMSIM(J)=QOMT
      IF(IFCST.EQ.1) QOMADJ(J)=QOMT
  208 CONTINUE
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1 CHECK IF SUMDIF IS ESSENTIALLY 0, ADD GO TO STATEMENT AND
CR1 ADD STATEMENT NUMBER TO EXISTING STATEMENT
      IF(ABS(SUMDIF).LT.0.00001) GO TO 410
      GO TO (191,210),MM
C      IF(SUMDIF.LE.0.) GO TO 410
  210  IF(SUMDIF.LE.0.) GO TO 410
CR1 IF SUMDIF IS 0, NO FURTHER ADJUSTMENTS ARE NEEDED AND THE PROGRAM
CR1 GOES TO 410. IF SUMDIF IS NOT 0, THE COMPUTATIONS IN DO LOOP 208
CR1 NEED TO BE REPEATED BUT WITH THE EXCEPTION THAT ADJ=SUMDIF.
CR1 THIS IS ACCOMPLISHED WHEN COUNTER MM IS INCREMENTED TO 2.
CR1 THIS SECOND SET OF COMPUTATIONS IS NECESSARY BECAUSE, IN SOME
CR1 CASES, THE FIRST SET OF COMPUTATIONS IN DO LOOP 208 WILL
CR1 LEAVE AVAILABLE SPACE FOR ADJUSTMENT IN AN EARLIER TIME
CR1 INTERVAL WHEN LIMITS ARE EXCEEDED IN A LATER TIME INTERVAL
CR1 AND THE DESIRED ADJUSTMENTS CANNOT BE MADE IN THE LATER TIME
CR1 INTERVALS. IF POSSIBLE, DESIRED ADJUSTMENTS TO TAKE CARE OF SUMDIF
CR1 ARE MADE IN THE TIME INTERVALS WHERE FRACTN IS GREATER THAN 0
CR1 BEFORE MAKING ADJUSTMENTS WHERE FRACTN=0. THE GO TO STATEMENT FOR
CR1 MM AND ADDITION OF STATEMENT NUMBER 210 KEEPS DO LOOP 208 FROM
CR1 BEING REPEATED MORE THAN ONCE.
CR1 *** REVISION NO. 1 *** END ***
C
C EVENLY DISTRIBUTE THE REMAINING POSITIVE SUM OF DIFFERENCES (SUMDIF)
C IN TIME INTERVALS WHERE FRACTN IS 0.
C
  209 KK=JJ
      IF(SUM.EQ.0.) GO TO 410
      DO 212 J=JSTART,JEND
      KK=KK+1
      IF(FRACTN(KK).NE.0.) GO TO 212
      IF(IFCST.EQ.1) GO TO 211
      QOMSIM(J)=QOMSIM(J)+SUMDIF*1./SUM
      GO TO 212
  211 QOMADJ(J)=QOMADJ(J)+SUMDIF*1./SUM
  212 CONTINUE
      GO TO 410
C
C STATEMENT 410 AND SUBSEQUENT STATEMENTS SET OBSERVED VALUES IN QOMOBS
C APPLICABLE AND COMPUTE OR SET JSTART,JEND, AND JJ FOR THE NEXT LOOP OF
C DO LOOP 440.
C
C FOR FOLLOWING STATEMENTS, QOMEAN IS GREATER THAN QGENMX.  VOLUME WILL
C BE DISTRIBUTED IN TIME INTERVALS BY USING SIMULATED OUTFLOWS IF
C AVAILABLE.  IF NOT AVAILABLE (QOMSIM(1)=-999.0), STRAIGHT LINE
C INTERPOLATION BETWEEN MIDPOINTS OF 24-HR DISCHARGES (JOPT=1) OR CON-
C STANT OUTFLOW (JOPT=2) WILL BE USED.
C
  220 IF(IFCST.EQ.0) GO TO 300
      IF(QOMSIM(1).EQ.-999.0) GO TO 300
      NPRDS=JEND24-JSTART+1
      VOLSIM=0
      IF(NPRDS.EQ.NTIM24) GO TO 260
C
C FOR THE FOLLOWING STATEMENTS, JSTART IS NOT AT THE BEGINNING OF THE
C 24-HR PERIOD.  ADD OUTFLOWS PRIOR TO JSTART AND PUT TOTAL IN
C VOLSIM.   BACK OUTFLOWS ARE IN QOMBAC WHEN LBGN IS LESS THAN 1.
C
      LBGN=JEND24-NTIM24+1
      IF(LBGN.GT.0) GO TO 240
      LBAC=NTIM24+LBGN
  230 VOLSIM=VOLSIM+QOMBAC(LBAC)
      LBAC=LBAC+1
      IF(LBAC.LE.NTIM24) GO TO 230
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      LBGN=1
      GO TO 260
CR1 *** REVISION NO. 1 *** END ***
  240 LEND=JSTART-1
      IF(LEND.EQ.0) GO TO 260
      DO 250 J=LBGN,LEND
  250 VOLSIM=VOLSIM+QOMSIM(J)
  260 DO 270 J=JSTART,JEND
  270 VOLSIM=VOLSIM+QOMSIM(J)
      IF(JEND24.EQ.JEND) GO TO 280
C
C FOR THE FOLLOWING STATEMENTS, JEND DOES NOT EXTEND TO THE END OF THE
C 24-HR PERIOD AND VOLUME FOR 24-HR MEAN DISCHARGE MUST BE CHANGED TO
C VOLUME FOR SAME NUMBER OF PERIODS THAT WERE USED FOR VOLSIM.
C
      PRDS=NTIM24-JEND24+JEND
      VOLUME=QOMEAN(I)*PRDS
C
C COMPUTE TIME INTERVAL OUTFLOWS IN DO LOOP 290.
C
  280 DO 290 J=JSTART,JEND
  290 QOMADJ(J)=QOMSIM(J)*VOLUME/VOLSIM
      GO TO 410
C
C SIMULATED VALUES ARE BEING COMPUTED OR ARE NOT AVAILABLE
C FOR COMPUTING ADJUSTED VALUES IN FOLLOWING STATEMENTS.
C
  300 GO TO (310,390),JOPT
C
C STATEMENT 310 STARTS INTERPOLATION BETWEEN MIDPOINTS OF 24-HR MEAN
C DISCHARGES.  FIRST, COMPUTE MEAN OUTFLOWS TO MIDPOINT (JMID) OF THIS
C 24-HR PERIOD OR TO JEND IF JEND IS LESS THAN JMID.
C
  310 JMID=JEND24-NTIM24/2
      IF(I.EQ.1) GO TO 330
      IF(QOMEAN(I-1).EQ.-999.0) GO TO 330
      IF(JSTART.GT.JMID) GO TO 350
      DELQ=(QOMEAN(I)-QOMEAN(I-1))/TIM24
      DO 320 J=JSTART,JMID
      IF(J.GT.JEND) GO TO 410
      PRDS=NTIM24-JMID+J
      IF(IFCST.EQ.0) GO TO 311
      QOMADJ(J)=QOMEAN(I-1)+PRDS*DELQ
      GO TO 320
  311 QOMSIM(J)=QOMEAN(I-1)+PRDS*DELQ
  320 CONTINUE
      GO TO 350
C
C THERE IS NO PREVIOUS QOMEAN SO OUTFLOWS TO JMID ARE SET EQUAL TO
C QOMEAN(I) IN DO LOOP 340.
C
  330 DO 340 J=JSTART,JMID
      IF(J.GT.JEND) GO TO 410
      IF(IFCST.EQ.0) GO TO 331
      QOMADJ(J)=QOMEAN(I)
      GO TO 340
  331 QOMSIM(J)=QOMEAN(I)
  340 CONTINUE
C
C COMPUTE OUTFLOWS FROM MIDPOINT TO END OF 24-HR PERIOD (JEND24) OR TO
C JEND IF JEND IS LESS THAN JEND24.
C
  350 IF(JMID.GE.JEND) GO TO 410
      JBGN=JMID+1
      IF(JSTART.GT.JBGN) JBGN=JSTART
      IF((I+1).GT.NQMEAN) GO TO 370
      IF(QOMEAN(I+1).EQ.-999.0) GO TO 370
      DELQ=(QOMEAN(I+1)-QOMEAN(I))/TIM24
      DO 360 J=JBGN,JEND
      PRDS=NTIM24-JEND24+J
      IF(IFCST.EQ.0) GO TO 351
      QOMADJ(J)=QOMEAN(I)+PRDS*DELQ
      GO TO 360
  351 QOMSIM(J)=QOMEAN(I)+PRDS*DELQ
  360 CONTINUE
      GO TO 410
C
C SET OUTFLOWS EQUAL TO QOMEAN(I) IN DO LOOP 380 AS THERE IS NO
C QOMEAN(I+1).
C
  370 DO 380 J=JBGN,JEND
      IF(IFCST.EQ.0) GO TO 371
      QOMADJ(J)=QOMEAN(I)
      GO TO 380
  371 QOMSIM(J)=QOMEAN(I)
  380 CONTINUE
      GO TO 410
C
C THE OPTION IN THE FOLLOWING STATEMENTS  IS TO SET TIME INTERVAL OUT-
C FLOWS EQUAL TO THE 24-HR MEAN OUTFLOW.
C
  390 DO 400 J=JSTART,JEND
      IF(IFCST.EQ.0) GO TO 391
      QOMADJ(J)=QOMEAN(I)
      GO TO 400
  391 QOMSIM(J)=QOMEAN(I)
  400 CONTINUE
  410 CONTINUE
C$     IF(JOBS.EQ.0) GO TO 430
C$     IF(IFCST.EQ.0) GO TO 430
C
C WHEN JOBS IS 1, THE MEAN 24-HR OUTFLOW IS OBSERVED AND THE DISTRIBUTED
C VALUES WILL BE PUT IN THE OBSERVED ARRAY (QOMOBS) EVEN THOUGH THE
C INDIVIDUAL TIME INTERVAL VALUES MAY NOT BE CORRECT.
C
C$     DO 420 J=JSTART,JEND
C$  420 QOMOBS(J)=QOMADJ(J)
C
C SET ADJUSTED VALUES EQUAL TO SIMULATED VALUES IF THIS IS A SIMULATED
C RUN.  BOTH SETS OF VALUES ARE SENT BACK TO THE SAME ARRAY (QOMHYD) IN
C QGEN26 FOR THE SIMULATED RUN IF VALUES ARE SENT BACK TO QGEN26.
C
  430 IF(IFCST.EQ.1) GO TO 432
      DO 431 J=JSTART,JEND
  431 QOMADJ(J)=QOMSIM(J)
C
C COMPUTE 24-HR OR PARTIAL 24-HR MEAN DISCHARGE (QOFMN) FROM FINAL TIME
C INTERVAL VALUES OF OUTFLOW AND PRINT VALUES OF QOFMN AND ORIGINAL
C MEAN DISCHARGE (QOMEAN) IF REQUESTED BY DEBUG.
C
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      VOL=0.
CR1  432 DO 433 J=JSTART,JEND
  432 VOL=0.
      DO 433 J=JSTART,JEND
CR1 *** REVISION NO. 1 *** END ***
  433 VOL=VOL+QOMADJ(J)
      PRDS=JEND-JSTART+1
      QOFMN=VOL/PRDS
      IF(IBUG.EQ.2) WRITE(IODBUG,434) QOMEAN(I),QOFMN
  434 FORMAT(1H0,83H ORIGINAL AND FINAL MEAN DISCHARGES FOR THIS 24-HR
     $OR PARTIAL 24-HR TIME PERIOD IS/1X,2F10.0)
C
C COMPUTE OR SET JSTART,JEND, AND JJ FOR DISTRIBUTING NEXT VALUE OF
C 24-HR MEAN OUTFLOW.
C
CR1 *** REVISION NO. 1 *** BEGIN ***
CR1      JSTART=JEND+1
  435 JSTART=JEND+1
CR1 *** REVISION NO. 1 *** END ***
      JEND24=JEND+NTIM24
      JEND=JEND24
      IF(JEND.GT.KEND) JEND=KEND
      JJ=0
  440 CONTINUE
C
C WRITE TRACE AND DEBUG IF REQUIRED.
C
      IF(IBUG-1)560,540,450
  450 WRITE(IODBUG,460)
  460 FORMAT(1H0,52H VALUES OF VARIABLES AT END OF CONV26 ARE AS FOLLOWS
     $)
      WRITE(IODBUG,40) KSTART,KEND,KEND24,LSTART,JOPT,JOBS,
     $JULIAN,NDAYR,NTIM24,QGENMX,QGENDS,OUTMIN
      IF(OUTMIN.EQ.-999.0) WRITE(IODBUG,461)QOMIN
  461 FORMAT(1H0,42H MINIMUM OUTFLOW FOR LAST TIME INTERVAL IS,F8.0)
      WRITE(IODBUG,470) (QOMEAN(I),I=1,NQMEAN)
  470 FORMAT(1H0,24H 24-HR MEAN OUTFLOWS ARE/(1X,8F10.0))
      WRITE(IODBUG,480) (QOMBAC(I),I=1,NTIM24)
  480 FORMAT(1H0,42H BACK VALUES OF TIME INTERVAL OUTFLOWS ARE/(1X,10F12
     $.3))
C$     WRITE(IODBUG,490) (QOMOBS(I),I=1,NRUN)
C$  490 FORMAT(1H0,51H OBSERVED VALUES OF TIME INTERVAL MEAN OUTFLOWS ARE/
C$    $(1X,8F10.0))
C$     IF(IFCST.EQ.1) GO TO 510
      WRITE(IODBUG,500) (QOMSIM(I),I=1,KEND)
  500 FORMAT(1H0,' PERIOD MEAN OUTFLOWS FROM PERIOD NO. 1'/(1X,8F10.0))
C$  510 WRITE(IODBUG,520) (QOMADJ(I),I=1,KEND)
C$  520 FORMAT(1H0,33H ADJUSTED MEAN OUTFLOW VALUES ARE/(1X,8F10.0))
      WRITE(IODBUG,530) (FRACTN(I),I=1,NTIM24)
  530 FORMAT(1H0,57H FRACTIONS OF 24-HR VOLUME FOR TIME INTERVAL OUTFLOW
     $S ARE/(1X,10F8.3))
  540 WRITE(IODBUG,550)
  550 FORMAT(1H0,10X,17H** LEAVING CONV26)
  560 CONTINUE
      ibug=ibugsave  
      RETURN
      END
