C MEMBER EVAB26
C  (from old member FCEVAB26)
C
      SUBROUTINE EVAB26(STOR,ELEV)
C                             LAST UPDATE: 08/29/94.10:47:02 BY $WC30KH
C
C
C THIS UTILITY SUBROUTINE IS USED FOR OPTION 3B
C THIS UTILITY SUBROUTINE IS USED FOR OPTION 7 AND FOR STEP 2 OF OPTIONS
C 3,4,5,6, AND 8.  OPTIONS 9 AND 10 ALSO USE THIS UTILITY SINCE THOSE
C OPTIONS USE OPTION 8.
C     IN THIS UTILITY SUBROUTINE, OUTFLOW IS REDUCED AT A SPECIFIED RATE
C (REDUCE) PER TIME STEP UNTIL OUTFLOW REACHES A SPECIFIED VALUE
C (QTARG2), THE POOL RECEDES TO A SPECIFIED OR RULE CURVE ELEVATION
C (FALELB), OR INFLOW IS EQUAL TO OR A SPECIFIED AMOUNT (DIFQI3) LESS
C THAN OUTFLOW.  IF OUTFLOW REACHES THE SPECIFIED DISCHARGE (QTARG2)
C BEFORE  THE POOL DROPS TO THE SPECIFIED ELEVATION (FALELB), THE SPEC-
C IFIED DISCHARGE (QTARG2) WILL BE CONTINUED UNTIL THE POOL DROPS TO THE
C SPECIFIED ELEVATION.
C
C THIS SUBROUTINE WAS ORIGINALLY PROGRAMMED BY
C     WILLIAM E. FOX -- CONSULTING HYDROLOGIST
C     FEBRUARY, 1982
C
C SUBROUTINE EVAB26 IS IN
C
C VARIABLES PASSED TO OR FROM THIS SUBROUTINE ARE DEFINED AS FOLLOWS:
C     IOUT -- SURCHARGE EVACUATION OPERATION IS NO LONGER NEEDED
C       (IOUT=1) OR STILL NEEDED (IOUT=0).
C     IOPTEV -- EVACUATION OPTION.  CAN BE 3,4,5,6,7,8,9, AND 10 IN THIS
C       SUBROUTINE.  OPTIONS ARE DEFINED IN EVAA26.
C     FALELB -- LOWEST ELEVATION FOR SURCHARGE EVACUATION.  RULE CURVE
C       OR RULE CURVE PLUS AN ADDITION ARE DEFINED BY ADDING ADDITION
C       TO -999.0.  FOR EXAMPLE, RULE CURVE PLUS AN ADDITION OF -1.0
C       WOULD BE DEFINED AS -1000.0.
C     DIFQI3 -- SPECIFIED ADDITION TO INFLOW FOR COMPARISON WITH OUTFLOW
C       DIFQI3 MUST BE SPECIFIED EVEN IF IT IS 0.
C     QTARG2 -- SPECIFIED MINIMUM OUTFLOW FOR EVACUATION PROCEDURE IN
C       THIS SUBROUTINE.
C     REDUCE -- SPECIFIED RATE OF REDUCTION OF OUTFLOW PER TIME STEP.
C
C ALL OTHER VARIABLES ARE DEFINED IN THE THE PARENT SUBROUTINE NDUC26.
C  THIS SUBROUTINE (EVAB26) WILL COMPUTE OUTFLOW (QQO2), STORAGE (SS2),
C AND ELEVATION (ELRES2) AT THE END OF THE TIME STEP AND WILL SET AN
C INDICATOR (IOUT) FOR NEED TO CONTINUE OR NOT CONTINUE EVACUATION.
C
      INCLUDE 'common/fdbug'
      INCLUDE 'common/resv26'
      INCLUDE 'common/srcg26'
      INCLUDE 'common/evak26'
C
      DIMENSION STOR(1),ELEV(1)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_res/RCS/evab26.f,v $
     . $',                                                             '
     .$Id: evab26.f,v 1.2 1996/07/12 14:00:11 dws Exp $
     . $' /
C    ===================================================================
C
C
C WRITE TRACE AND DEBUG IF REQUIRED.
C
      IF(IBUG-1)50,10,20
   10 WRITE(IODBUG,30)
      GO TO 50
   20 WRITE(IODBUG,30)
   30 FORMAT(1H0,10X,17H** EVAB26 ENTERED)
      WRITE(IODBUG,40) IOUT,IOPTEV,FALELB,DIFQI3,QTARG2,REDUCE,FRPD,
     $SFRPD,QIMSUR,QQIM,QQO1,QQO2,SS1,SS2,ELRES1,ELRES2,RULEL1,RULEL2,
     $FALEL,IBUG
   40 FORMAT(1H0,'   IOUT,IOPTEV,FALELB,DIFQI3,QTARG2,REDUCE,FRPD,',
     $'SFRPD,QIMSUR,QQIM,QQO1,QQO2,SS1,SS2,ELRES1,ELRES2,RULEL1,',
     $'RULEL2,FALEL,IBUG'/1X,2I6,9F12.3/1X,8F12.3,I6)
C
C SET IOUT TO 0 FOR CONTINUED USE OF EVACUATION PROCEDURE UNLESS IOUT IS
C LATER CHANGED TO 1.  COMPUTE OUTFLOW (QQO2) AT END OF TIME STEP.
C
   50 IOUT=0
      QQO2=QQO1-REDUCE
C
C  DIFQI3 = DIFFQI3
      IF(QQO2.LT.(QIMSUR+DIFQI3)) QQO2=QIMSUR+DIFQI3
C
C  QTARG2 = QTARGET2
      IF(QQO2.LT.QTARG2) QQO2=QTARG2
      SS2=SS1+QQIM-(QQO1+QQO2)*0.5*FRPD
      CALL NTER26(SS2,ELRES2,STOR,ELEV,NSE,IFLAG,NTERP,IBUG)
C
C  FALELB = HEVACEND
      IF(FALELB.LT.-900.0) GO TO 60
      FALEL=FALELB
      GO TO 70
   60 FALEL=RULEL1+(RULEL2-RULEL1)*SFRPD+FALELB+999.0
   70 IF(ELRES2.GT.FALEL) GO TO 80
      IOUT=1
C
C WRITE TRACE AND DEBUG IF REQUIRED.
C
   80 CALL BETA26(STOR,ELEV)
      IF(IBUG-1)140,120,90
   90 WRITE(IODBUG,100)
  100 FORMAT(1H0,41H FOLLOWING ARE VARIABLES AT END OF EVAB26)
      WRITE(IODBUG,40) IOUT,IOPTEV,FALELB,DIFQI3,QTARG2,REDUCE,FRPD,
     $SFRPD,QIMSUR,QQIM,QQO1,QQO2,SS1,SS2,ELRES1,ELRES2,RULEL1,RULEL2,
     $FALEL,IBUG
      WRITE(IODBUG,110)(STOR(I),ELEV(I),I=1,NSE)
  110 FORMAT(1H0,78H ALTERNATING VALUES OF STORAGE AND ELEVATION FOR THE
     $ STORAGE - ELEV. CURVE ARE/(1X,5(F12.3,F10.3,2X)))
  120 WRITE(IODBUG,130)
  130 FORMAT(1H0,10X,17H** LEAVING EVAB26)
  140 RETURN
      END
