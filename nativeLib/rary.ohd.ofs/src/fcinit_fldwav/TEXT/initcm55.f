C THIS SUBROUTINE SETS MANNING'S N IF ZERO VALUES ARE GIVEN
C AND SETS N VALUES FOR INTERPOLATED CROSS-SECTIONS

      SUBROUTINE INITCM55(Z,JN,NU,XFACT,XT,CM,CML,CMR,
     1 HS,SLFI,NQCM,YQCM,NRCM1,NCM,NBT,K1,K2,K7,K8,K9,K23)


      COMMON/M3255/IOBS,KTERM,KPL,JNK,TEH
      COMMON/SS55/ NCS,A,B,DB,R,DR,AT,BT,P,DP,ZH
      COMMON/FLP55/KFLP
      COMMON/NPC55/NP,NPST,NPEND
      COMMON/FDBUG/IODBUG,ITRACE,IDBALL,NDEBUG,IDEBUG(20)
      COMMON/IONUM/IN,IPR,IPU

      INCLUDE 'common/ofs55'

      DIMENSION Z(1),XT(K23,K1)
      DIMENSION CM(K8,K7,K1),CML(K8,K7,K1),CMR(K8,K7,K1)
      DIMENSION HS(K9,K2,K1),NBT(K1),NRCM1(K1),NCM(K7,K1)
      DIMENSION SLFI(K2,K1),NQCM(K1),YQCM(K8,K7,K1)
      CHARACTER*8 SNAME
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcinit_fldwav/RCS/initcm55.f,v $
     . $',                                                             '
     .$Id: initcm55.f,v 1.4 2004/02/02 20:35:01 jgofus Exp $
     . $' /
C    ===================================================================
C
      DATA SNAME/ 'INITCM55' /

      CALL FPRBUG(SNAME, 1, 55, IBUG)

C  INTERPOLATE MANNING N CURVE FOR ALL INPUT CROSS SECTION REACHES
C  KFLP>0, USE CONVEYANCE; IMPLY NQCM=0
C  NQCM=>0 MANNING N IS FCN OF H; <0 MANNING N IS FCN OF Q

      DO 590 J=1,JN
      IF(KFLP.GE.1) NQCM(J)=0
      NQCMJ=NQCM(J)
      NCML=ABS(NQCMJ)
      IF(NCML.LE.0) NCML=NCS
      NRCM=NRCM1(J)
      DO 590 II=1,NRCM
      I=NRCM-II+1
      IS=NCM(I,J)
      ICKVAL=999999
      IF (IS.GT.ICKVAL) THEN
         WRITE (IPR,998) 'IS',IS,ICKVAL
998   FORMAT ('0**ERROR** IN INITCM55 - VALUE OF VARIABLE ',A,' (',I10,
     *   ') IS GREATER THAN ',I6,'.')
         CALL ERROR
         GO TO 999
         ENDIF
      DO 580 K=1,NCML
      CM(K,IS,J)=CM(K,I,J)
      IF(KFLP.EQ.1) THEN
        CML(K,IS,J)=CML(K,I,J)
        CMR(K,IS,J)=CMR(K,I,J)
      ENDIF
  580 YQCM(K,IS,J)=YQCM(K,I,J)
  590 CONTINUE
      DO 870 J=1,JN
      N=NBT(J)
      NM=N-1
      IF(KFLP.GE.1) NQCM(J)=0
      NQCMJ=NQCM(J)
      NCML=ABS(NQCMJ)
      IF(NCML.EQ.0) NCML=NCS
      NRCM=NRCM1(J)
      DO 769 II=1,NRCM
      IIP1=II+1
      IS=NCM(II,J)
      IE=NCM(IIP1,J)
      IF(II.EQ.NRCM) IE=N
      NPT=IE-IS-1
      IF(NPT.LE.0) GO TO 761
      DO 760 I=1,NPT
      IPT=IS+I
      DO 760 K=1,NCML
  760 CM(K,IPT,J)=CM(K,IS,J)
  761 IF(NQCMJ.NE.0) GO TO 764

C  NQCM<>0, USE MANNING EQUATION, IMPLY KFLP=0
      IF(KFLP.EQ.0) GO TO 768
      IF(NPT.LE.0) GO TO 768
      DO 762 I=1,NPT
      IPT=IS+I
      DO 762 K=1,NCML
      CML(K,IPT,J)=CML(K,IS,J)
  762 CMR(K,IPT,J)=CMR(K,IS,J)
      GO TO 768
  764 IF(NPT.LE.0) GO TO 768
      DO 766 I=1,NPT
      IPT0=IS+I-1
      IPT=IPT0+1
      HIPT0=0.0
      HIPT=0.0
      DO 766 K=1,NCML
  766 YQCM(K,IPT,J)=YQCM(K,IPT0,J)-HIPT0+HIPT
  768 CONTINUE
  769 CONTINUE
      IF(NRCM.EQ.N) GO TO 774
      HNM=0.0
      HN=0.0
      IF(NQCMJ.GT.0) THEN
        HNM=0.5*(HS(1,NM,J)+HS(1,N,J))
        HN=HS(1,N,J)
      ENDIF
      DO 772 K=1,NCML
  772 YQCM(K,N,J)=YQCM(K,NM,J)-HNM+HN
  774 IF (NQCMJ.NE.0) GO TO 778
      DO 775 I=1,NM
      IP1=I+1
      DO 775 K=1,NCS
  775 YQCM(K,I,J)=0.5*(HS(K,I,J)+HS(K,IP1,J))
      DO 776 K=1,NCS
  776 YQCM(K,N,J)=HS(K,N,J)
  778 CONTINUE
      IF(NCM(NRCM,J).EQ.N) GO TO 780
      DO 786 K=1,NCML
      CM(K,N,J)=CM(K,NM,J)
      IF(KFLP.EQ.0) GO TO 786
      CML(K,N,J)=CML(K,NM,J)
      CMR(K,N,J)=CMR(K,NM,J)
  786 CONTINUE
  780 IF(JNK.LT.9) GO TO 870
      IF(IBUG.EQ.1) WRITE(IODBUG,2090) J
 2090 FORMAT(/2X,'MANNING TABLE AT EACH SECTION REACH ON RIVER NO.',I3)
      DO 860 I=1,N
      IF(IBUG.EQ.1) WRITE(IODBUG,*)
      IF(IBUG.EQ.1) WRITE(IODBUG,2091) I,J,(CM(K,I,J),K=1,NCML)
      IF(KFLP.NE.1) GO TO 849
      IF(IBUG.EQ.1) WRITE(IODBUG,2092) I,J,(CML(K,I,J),K=1,NCML)
      IF(IBUG.EQ.1) WRITE(IODBUG,2093) I,J,(CMR(K,I,J),K=1,NCML)
  849 IF(NQCMJ.LT.0 .AND.IBUG.EQ.1)
     .  WRITE(IODBUG,2094) I,J,(YQCM(K,I,J),K=1,NCML)
      IF(NQCMJ.GE.0 .AND.IBUG.EQ.1)
     .  WRITE(IODBUG,2095) I,J,(YQCM(K,I,J),K=1,NCML)
  860 CONTINUE
  870 CONTINUE
 2091 FORMAT(5X,'  CM(K,',I2,1H,,I2,')= ',10F10.4,(/20X,10F10.4))
 2092 FORMAT(5X,' CML(K,',I2,1H,,I2,')= ',10F10.4,(/20X,10F10.4))
 2093 FORMAT(5X,' CMR(K,',I2,1H,,I2,')= ',10F10.4,(/20X,10F10.4))
 2094 FORMAT(5X,'YQCM(K,',I2,1H,,I2,')= ',10F10.0,(/20X,10F10.0))
 2095 FORMAT(5X,'YQCM(K,',I2,1H,,I2,')= ',10F10.2,(/20X,10F10.2))
  999 RETURN
      END
