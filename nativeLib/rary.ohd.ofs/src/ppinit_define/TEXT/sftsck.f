C MEMBER SFTSCK
C-----------------------------------------------------------------------
C
C                             LAST UPDATE: 03/04/94.08:59:51 BY $WC20SV
C
C @PROCESS LVL(77)
C
      SUBROUTINE SFTSCK (TSID,TYPE,MAXX,INDPM,IPMWRT,ITSWRT,ITIME,
     *   DISP,NUMERR,NUMWRN,ISTAT)
C
C  ROUTINE TO CHECK IF TIME SERIES EXISTS IN PROCESSED DATA BASE.
C
C
      REAL XOLD/4HOLD /
C
      DIMENSION TSID(2),FTSID(2)
      DIMENSION XBUF(1),IHEAD(22)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_define/RCS/sftsck.f,v $
     . $',                                                             '
     .$Id: sftsck.f,v 1.1 1995/09/17 19:11:56 dws Exp $
     . $' /
C    ===================================================================
C
C
C
      IF (ISTRCE.GT.0) WRITE (IOSDBG,110)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('DEFN')
C
      IF (LDEBUG.GT.0) WRITE (IOSDBG,115) TSID,TYPE,MAXX,INDPM,ITIME
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
      ISTAT=0
C
      LXBUF=1
C
      IPMWRT=0
      ITSWRT=0
C
C  CHECK TO SEE IF TIME SERIES EXISTS
      CALL SUDOPN (1,'PRD ',IERR)
      IF (IERR.EQ.0) GO TO 20
         ISTAT=1
         GO TO 100
20    CALL RPRDH (TSID,TYPE,MAXX,IHEAD,LXBUF,XBUF,FTSID,IERR)
      IF (LDEBUG.GT.0) WRITE (IOSDBG,117) IERR
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
      IF (IERR.NE.5) GO TO 30
         WRITE (LP,120) TYPE,TSID
         CALL SUERRS (LP,2,NUMERR)
         GO TO 100
30    IF (IERR.NE.2) GO TO 40
         WRITE (LP,130) LXBUF
         CALL SUERRS (LP,2,NUMERR)
         GO TO 100
C
40    INDTS=IERR
C
C  CHECK IF PARAMETERS EXIST
      IF (INDPM.EQ.1) GO TO 70
C
C  PARAMETER RECORD DOES NOT EXIST - CHECK IF TIME SERIES HEADER EXISTS
      IF (INDTS.EQ.0) GO TO 50
C
C  TIME SERIES DOES NOT EXIST - SET FLAG TO WRITE PARAMETERS AND TIME
C  SERIES HEADER
      IPMWRT=1
      ITSWRT=1
      GO TO 100
C
C  TIME SERIES EXISTS
50    IF (DISP.EQ.XOLD) GO TO 80
      WRITE (LP,150) TYPE
      CALL SUWRNS (LP,2,NUMWRN)
      GO TO 80
C
C  PARAMETER RECORDS EXIST - CHECK TIME SERIES
70    IF (INDTS.EQ.0) GO TO 80
C
C  TIME SERIES DOES NOT EXIST
      WRITE (LP,160) TYPE,TSID
      CALL SUERRS (LP,2,NUMERR)
      GO TO 100
C
C  CHECK IF TIME INTERVAL OK
80    IF (IHEAD(2).EQ.ITIME) GO TO 90
         WRITE (LP,140) IHEAD(2)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 100
C
C  TIME INTERVAL OK
90    IPMWRT=1
      ITSWRT=2
      GO TO 100
C
100   IF (LDEBUG.GT.0) WRITE (IOSDBG,165) IPMWRT,ITSWRT
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
      IF (ISTRCE.GT.0) WRITE (IOSDBG,170) ISTAT
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
110   FORMAT (' *** ENTER SFTSCK')
115   FORMAT (' TSID=',2A4,3X,'TYPE=',A4,3X,'MAXX=',I2,3X,
     *   'INDPM=',I2,3X,'ITIME=',I2)
117   FORMAT (' RPRDH CALLED : STATUS CODE=',I2)
120   FORMAT ('0*** ERROR - SYSTEM ERROR - READING ',A4,' TIME SERIES ',
     *   'HEADER FOR AREA ',2A4,'.')
130   FORMAT ('0*** ERROR - XBUF DIMENSION (',I4,') IS TOO SMALL.')
140   FORMAT ('0*** ERROR - EXISTING TIME SERIES HAS INVALID TIME ',
     *   'INTERVAL (',I2,').')
150   FORMAT ('0*** WARNING - TIME SERIES HEADER ALREADY EXISTS AND ',
     *   'WILL BE CHANGED IF ',A4,' PARAMETERS SUCCESSFULLY DEFINED.')
160   FORMAT ('0*** ERROR - ',A4,' PARAMETERS EXIST FOR AREA ',2A4,
     *   ' BUT TIME SERIES HEADER DOES NOT.')
165   FORMAT (' IPMWRT=',I1,3X,'ITSWRT=',I1)
170   FORMAT (' *** EXIT SFTSCK - STATUS CODE=',I2)
C
      END
