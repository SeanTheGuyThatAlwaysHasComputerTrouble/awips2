C MODULE SPBASN
C----------------------------------------------------------------------
C
C  ROUTINE TO PRINT BASIN DEFINITION PARAMETERS.
C
      SUBROUTINE SPBASN (BASNID,DESCRP,FLAT,FLON,NBPTS,AREA,ELEV,CAREA,
     *   IY,IXB,IXE,NSEGS,XC,YC,MAPFLG,MATFLG,PID,TID,PXID,UNITS,
     *   LFACTR,X,Y,JX,JY,IVER,IPLOT,JN,ISTAT)
C
      INCLUDE 'uiox'
      INCLUDE 'scommon/sudbgx'
C
      CHARACTER*4 UNITS,UNITA,UNITE,DMAP,DMAT
      CHARACTER*8 BASNID,PID,TID,PXID,PIDX,TIDX,PXIDX
      CHARACTER*20 DESCRP
C
      DIMENSION FLAT(NBPTS),FLON(NBPTS)
      DIMENSION X(NBPTS),Y(NBPTS),JX(NBPTS),JY(NBPTS),JN(NBPTS)
      DIMENSION IY(NSEGS),IXB(NSEGS),IXE(NSEGS)
      DIMENSION PXIDI(2)
      EQUIVALENCE (PXIDX,PXIDI)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_print/RCS/spbasn.f,v $
     . $',                                                             '
     .$Id: spbasn.f,v 1.3 2003/03/14 18:56:26 dws Exp $
     . $' /
C    ===================================================================
C
C
      IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,*) 'ENTER SPBASN'
         CALL SULINE (IOSDBG,1)
         ENDIF
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('BASN')
C
      ISTAT=0
C
      DMAP='YES'
      DMAT='YES'
C
C  SET PLOT TYPE AND NUMBER OF COLUMNS
      IPTYPE=1
      NPCOLS=132
C
C  CHECK NUMBER OF LINES LEFT ON PAGE
      IF (ISLEFT(10).GT.0) CALL SUPAGE
C
C  PRINT HEADING
      WRITE (LP,110)
      CALL SULINE (LP,2)
      WRITE (LP,120) BASNID
      CALL SULINE (LP,2)
      WRITE (LP,*)
      CALL SULINE (LP,1)
C
C  CHECK UNITS FOR PRINTING
      UNITA='MI2'
      IF (UNITS.EQ.'METR') UNITA='KM2'
      UNITE='FT'
      IF (UNITS.EQ.'METR') UNITE='M'
      PAREA=AREA
      PCAREA=CAREA
      PELEV=ELEV
C
      IF (UNITS.EQ.'METR') GO TO 30
C
      IF (ELEV.GT.-997.1.AND.ELEV.LT.-996.9) GO TO 10
      CALL UDUCNV ('M   ','FT  ',1,1,ELEV,PELEV,IERR)
      IF (IERR.NE.0) THEN
         WRITE (LP,140) 'ELEVATION'
         CALL SUERRS (LP,2,-1)
         ISTAT=1
         ENDIF
10    IERR1=0
      IERR2=0
      IF (AREA.GT.-997.1.AND.AREA.LT.-996.9) GO TO 20
      CALL UDUCNV ('KM2 ','MI2 ',1,1,AREA,PAREA,IERR1)
20    CALL UDUCNV ('KM2 ','MI2 ',1,1,CAREA,PCAREA,IERR2)
      IF (IERR1.NE.0.OR.IERR2.NE.0) THEN
         WRITE (LP,140) 'AREA'
         CALL SUERRS (LP,2,-1)
         ISTAT=1
         ENDIF
C
C  PRINT VERSION NUMBER
30    IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,*) 'IVER=',IVER
         CALL SULINE (IOSDBG,1)
         ENDIF
C
C  PRINT BASIN DESCRIPTION
      WRITE (LP,170) BASNID,DESCRP
      CALL SULINE (LP,2)
C
C  PRINT IDENTIFIERS OF AREAS THAT USE THIS BASIN IDENTIFIERS
      IF (MAPFLG.EQ.0) DMAP='NO'
      IF (MATFLG.EQ.0) DMAT='NO'
      CALL SUBSTR (PID,1,8,PIDX,1)
      CALL SUBSTR (PXID,1,8,PXIDX,1)
      IF (PXIDI(1).EQ.-999.0.AND.PXIDI(2).EQ.-999.0.OR.
     *    PXIDI(1).EQ.0.0.AND.PXIDI(2).EQ.0.0) THEN
         PXIDX=' '
         ENDIF
      CALL SUBSTR (TID,1,8,TIDX,1)
      CALL SUBLID (PIDX,IERR)
      CALL SUBLID (PXIDX,IERR)
      CALL SUBLID (TIDX,IERR)
      WRITE (LP,180) PIDX,DMAP
      CALL SULINE (LP,2)
      WRITE (LP,190) PXIDX
      CALL SULINE (LP,2)
      WRITE (LP,200) TIDX,DMAT
      CALL SULINE (LP,2)
C
C  PRINT USER SPECIFIED AREA
      IF (AREA.GT.-996.9) THEN
         WRITE (LP,220) PAREA,UNITA
         CALL SULINE (LP,2)
         ELSE
            WRITE (LP,210)
            CALL SULINE (LP,2)
         ENDIF
C
C  PRINT COMPUTED AREA
      WRITE (LP,230) PCAREA,UNITA
      CALL SULINE (LP,2)
C
C  PRINT BASIN ELEVATION
      IF (ELEV.GT.-996.9) THEN
         WRITE (LP,250) PELEV,UNITE
         CALL SULINE (LP,2)
         ELSE
            WRITE (LP,240)
            CALL SULINE (LP,2)
         ENDIF
C
C  PRINT LAT/LON POINTS
      NB=NBPTS+4
      IF (ISLEFT(NB).GT.0) CALL SUPAGE
      WRITE (LP,260)
      CALL SULINE (LP,2)
      CALL SBTABL (FLON,FLAT,NBPTS,IERR)
      IF (IERR.GT.0) ISTAT=1
C
C  PRINT HRAP LINE SEGMENTS
      IF (ISLEFT(8).GT.0) CALL SUPAGE
      WRITE (LP,261)
      CALL SULINE (LP,2)
      WRITE (LP,*)
      CALL SULINE (LP,1)
      WRITE (LP,262)
      CALL SULINE (LP,1)
      WRITE (LP,263)
      CALL SULINE (LP,1)
      WRITE (LP,264)
      CALL SULINE (LP,1)
      DO 75 I=1,NSEGS
         IF (ISNWPG(LP).EQ.1) THEN
            WRITE (LP,262)
            CALL SULINE (LP,1)
            WRITE (LP,263)
            CALL SULINE (LP,1)
            WRITE (LP,264)
            CALL SULINE (LP,1)
            ENDIF
         WRITE (LP,265) I,IY(I),IXB(I),IXE(I)
         CALL SULINE (LP,1)
75       CONTINUE
C
C  PRINT CENTROID OF BASIN
      IBLLGD=0
      CALL SBLLGD (CLON,CLAT,1,XC,YC,IBLLGD,IERR)
      IF (IERR.GT.0) ISTAT=1
      WRITE (LP,270) CLAT,CLON
      CALL SULINE (LP,2)
C
      IF (IPLOT.NE.1) GO TO 90
C
C  PRINT GRID SPACING FACTOR
      WRITE (LP,280) LFACTR
      CALL SULINE (LP,2)
C
C  PLOT BASIN BOUNDARY MAP
      NS=NSEGS+6
      IF (ISLEFT(NS).GT.0) CALL SUPAGE
      WRITE (LP,290)
      CALL SULINE (LP,2)
      CALL SBLLGD (FLON,FLAT,NBPTS,X,Y,1,IERR)
      IF (IERR.GT.0) ISTAT=1
      IF (ISTAT.NE.0) GO TO 90
      CALL SBPLOT (IPTYPE,NPCOLS,IY,IXB,IXE,NSEGS,X,Y,JX,JY,NBPTS,
     *   LFACTR,XC,YC,JN,IERR)
      IF (IERR.GT.0) GO TO 90
      WRITE (LP,*)
      CALL SULINE (LP,1)
      WRITE (LP,300)
      CALL SULINE (LP,2)
      WRITE (LP,110)
      CALL SULINE (LP,2)
C
90    IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,*) 'EXIT SPBASN'
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
110   FORMAT ('0',132('-'))
120   FORMAT ('0*--> BASN PARAMETERS :  IDENTIFIER = ',A)
140   FORMAT ('0*** ERROR - UNIT CONVERSION FOR ',A,' ',
     *   'VALUE NOT SUCCESSFUL.')
170   FORMAT ('0BASIN ID = ',A,10X,'BASIN DESCRIPTION = ',A)
180   FORMAT ('0MAP  AREA ID = ',A,5X,'MAP DEFINITION CONSISTENT ',
     *   'WITH BASIN DEFINITION? ',A)
190   FORMAT ('0MAPX AREA ID = ',A)
200   FORMAT ('0MAT  AREA ID = ',A,5X,'MAT DEFINITION CONSISTENT ',
     *   'WITH BASIN DEFINITION? ',A)
210   FORMAT ('0BASIN AREA SPECIFIED BY USER = NOT DEFINED')
220   FORMAT ('0BASIN AREA SPECIFIED BY USER = ',F10.2,1X,A)
230   FORMAT ('0BASIN AREA COMPUTED FROM LAT/LON POINTS = ',F10.2,
     *   1X,A)
240   FORMAT ('0BASIN ELEVATION = NOT DEFINED')
250   FORMAT ('0BASIN ELEVATION = ',F10.2,1X,A)
260   FORMAT ('0LATITUDE/LONGITUDE POINTS:')
261   FORMAT ('0HRAP GRID LINE SEGMENTS:')
262   FORMAT (' ',
     *   7X,3X,
     *   4X,3X,
     *   'FIRST ',3X,
     *   'LAST  ')
263   FORMAT (' '
     *   'SEGMENT',3X,
     *   'ROW ',3X,
     *   'COLUMN',3X,
     *   'COLUMN')
264   FORMAT (' ',
     *   7('-'),3X,
     *   4('-'),3X,
     *   6('-'),3X,
     *   6('-'))
265   FORMAT (' ',
     *   I7,3X,
     *   I4,3X,
     *   I6,3X,
     *   I6)
270   FORMAT ('0COMPUTED BASIN CENTROID : ',
     *   'LATITUDE=',F6.2,3X,
     *   'LONGITUDE=',F7.2)
280   FORMAT ('0COMPUTED GRID POINT SPACING FACTOR = ',I3)
290   FORMAT ('0COMPUTED BASIN BOUNDARY DEFINITION (@=COMPUTED ',
     *   'CENTROID) :')
300   FORMAT ('0NOTE: ONE OR MORE BASIN BOUNDARY POINTS MAY HAVE ',
     *   'BEEN OVERWRITTEN IN THE PLOT.')
C
      END
