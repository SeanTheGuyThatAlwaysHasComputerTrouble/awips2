C MEMBER SAVC21
C  (from old member FCSAVC21)
C DESC -- THIS SUBROUTINE STORES THE CARRYOVER DATA AT THE
C DESC -- APPROPIATE TIME
C                             LAST UPDATE: 03/08/94.08:22:27 BY $WC30JL
C
C @PROCESS LVL(77)
C
      SUBROUTINE SAVC21(PO,CCO,ICCO,YD,QD,NB,NQL,LQ,QL,LOQL,NDIV,DIV,
     1 LODIV,NUMLAD,LOPLT,LOIWT,POOLT,ITWT,T1,DDX,LAD,CHCTW)
C
C           THIS SUBROUTINE WAS WRITTEN  BY:
C           JANICE LEWIS      HRL   MARCH, 1988       VERSION NO. 1
C
C
      COMMON/FDBUG/IODBUG,ITRACE,IDBALL,NDEBUG,IDEBUG(20)
      COMMON/M121/N,NU,NS1,JN,JJ,KIT,G,DT,TT,TIMF,F1,GZN,NYQD
      COMMON/IVRSN21/IVER
C
      DIMENSION PO(*),CCO(*),ICCO(*),YD(*),QD(*),DDX(*),NB(*)
      DIMENSION NUMLAD(*),LOPLT(*),LOIWT(*),POOLT(*),ITWT(*),T1(*)
      DIMENSION NQL(*),LQ(*),QL(*),LOQL(*),NDIV(*),DIV(*),LODIV(*)
      DIMENSION LAD(*),CHCTW(*),SNAME(2)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_dwoper/RCS/savc21.f,v $
     . $',                                                             '
     .$Id: savc21.f,v 1.4 2001/06/13 12:31:06 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA SNAME/4HSAVC,4H21  /
C
      CALL FPRBUG(SNAME,1,21,IBUG)
C
      IYDI=0
      IQDI=PO(121)-1
      IQLI=PO(122)-1
      IDVI=PO(123)-1
      IPLTI=PO(124)-1
      IIWTI=PO(125)-1
C
      LCK=0
      LLD=1
      DO 1724 J=1,JN
C
C          SAVE WSEL'S AND DISCHARGES
C
      N=NB(J)
C     WRITE(6,1)
C   1 FORMAT(2X,'***********  IN SAVC21 AFTER INITIALIZATION *********')
      LIJ=LCAT21(1,J,NB)-1
C     WRITE(6,2) IYDI,N,LIJ
C   2 FORMAT(3X,'IYDI=',I5,3X,'N=',I5,3X,'LIJ=',I10)
      DO 1722 I=1,N
      CCO(IYDI+I)=YD(I+LIJ)
      CCO(IQDI+I)=QD(I+LIJ)
 1722 CONTINUE
C     WRITE(6,9999) (CCO(IYDI+I),I=1,N)
C9999 FORMAT(2X,'COYDI=',10F10.2)
C     WRITE(6,9998) (CCO(IQDI+I),I=1,N)
C9998 FORMAT(2X,'COQDI=',10F10.2)
      IYDI=IYDI+N
      IQDI=IQDI+N
C
C          SAVE LATERAL INFLOWS
C
      CALL INTP21(NU,TINP,IT1,IT2,T1)
      IF(NQL(J).EQ.0) GO TO 1730
      N=NQL(J)
      LQL=LCAT21(1,J,NQL)-1
C     WRITE(6,4) IQLI,N,LQL
C   4 FORMAT(3X,'IQLI=',I5,3X,'N=',I5,3X,'LQL=',I10)
      DO 1728 I=1,N
      L=LQ(I+LQL)
      LOQ=LOQL(I+LQL)-1
C     WRITE(6,6) L,LOQ,IT1,IT2,TINP,DDX(L+LIJ),QL(IT1+LOQ),QL(IT2+LOQ)
C   6 FORMAT(4X,'L  LOQ  IT1  IT2      TINP       DDX       QL1       QL
C    .2='/4I5,2F10.2,2F10.4)
      CCO(IQLI+I)=(QL(IT2+LOQ)+TINP*(QL(IT1+LOQ)-QL(IT2+LOQ)))
     . *DDX(L+LIJ)
 1728 CONTINUE
C     WRITE(6,9997) (CCO(IQLI+I),I=1,N)
C9997 FORMAT(2X,'COQLI=',10F10.2)
      IQLI=IQLI+N
C
C          SAVE PERCENT OF FLOW DIVERTED
C
 1730 IF(NDIV(J).EQ.0) GO TO 1734
      N=NDIV(J)
      LDV=LCAT21(1,J,NDIV)-1
      DO 1732 I=1,N
      LOD=LODIV(I+LDV)-1
      CCO(IDVI+I)=DIV(IT2+LOD)+TINP*(DIV(IT1+LOD)-DIV(IT2+LOD))
 1732 CONTINUE
C     WRITE(6,9996) (CCO(IDVI+I),I=1,N)
C9996 FORMAT(2X,'CODVI=',10F10.2)
      IDVI=IDVI+N
C
C          SAVE TARGET POOL ELEVATIONS AND GATE CONTROL SWITCHES
C
 1734 IF(NUMLAD(J).EQ.0) GO TO 1724
      N=NUMLAD(J)
      NLD=LCAT21(1,J,NUMLAD)-1
      LOCK=0
      DO 1736 I=1,N
      IF(IVER.LT.3) LLD=I+NLD
      IF(LAD(LLD).LT.0.OR.CHCTW(I+NLD).LT.0.) GO TO 1737
 1735 LOCK=LOCK+1
      LCK=LCK+1
      LON=LOPLT(LCK)-1
      LOT=LOIWT(LCK)-1
      CCO(IPLTI+LOCK)=POOLT(IT2+LON)+TINP*(POOLT(IT1+LON)-POOLT(IT2+LON)
     .)
      ICCO(IIWTI+LOCK)=ITWT(IT2+LOT)+TINP*(ITWT(IT1+LOT)-ITWT(IT2+LOT))
 1737 IF(IVER.GE.3) LLD=LLD+2
 1736 CONTINUE
C     WRITE(6,9995) (CCO(IPLTI+I),I=1,N)
C9995 FORMAT(2X,'COPLTI=',10F10.2)
C     WRITE(6,9994) (ICCO(IIWTI+I),I=1,LOCK)
C9994 FORMAT(2X,'COIWTI=',10F10.2)
      IPLTI=IPLTI+LOCK
      IIWTI=IIWTI+LOCK
C     WRITE(6,4) IQLI,N,LQL
 1724 CONTINUE
      RETURN
      END
