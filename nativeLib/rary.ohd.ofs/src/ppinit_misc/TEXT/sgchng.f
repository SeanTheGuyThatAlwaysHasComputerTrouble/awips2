C MODULE SGCHNG
C-----------------------------------------------------------------------
C
C  MAIN ROUTINE FOR CHANGING PARAMETERS.
C
      SUBROUTINE SGCHNG (LARRAY,ARRAY,NFLD,ISTAT)
C
      REAL XID/4HID  /
      REAL*8 BLNK8/8H        /
      REAL*8 OPTN(4),GROUP(4)
C
      DIMENSION ARRAY(LARRAY)
      DIMENSION CHAR(5),CHK(5)
C
      INCLUDE 'uio'
      INCLUDE 'ufreex'
      INCLUDE 'scommon/sudbgx'
      INCLUDE 'scommon/suoptx'
      INCLUDE 'scommon/suerrx'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_misc/RCS/sgchng.f,v $
     . $',                                                             '
     .$Id: sgchng.f,v 1.2 1998/07/06 12:36:28 page Exp $
     . $' /
C    ===================================================================
C
C
      DATA MOPTN/4/
      DATA OPTN/8H        ,8H        ,8H        ,8H        /
      DATA MGROUP/4/
      DATA GROUP/8HSTATION ,8HSTA     ,8H        ,8H        /
C
C
      IF (ISTRCE.GT.0) WRITE (IOSDBG,210)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('CHNG')
C
      ISTAT=0
C
      LCHAR=5
      LCHK=5
      LGROUP=0
      ILPFND=0
      IRPFND=0
      NCWARN=NTWARN
      NCERR=NTERR
      ICMERR=0
      NUMERR=0
      NUMWRN=0
C
C  CHECK IF RUNCHECK OPTION SPECIFIED
      IF (IOPRCK.EQ.0) GO TO 10
         WRITE (LP,220)
         WRITE (LP,220)
         CALL SULINE (LP,1)
         WRITE (LP,230)
         IF (IOPOVP.EQ.1) WRITE (LP,230)
         IF (IOPOVP.EQ.1) WRITE (LP,230)
         CALL SULINE (LP,1)
         IRUNCK=1
C
C  PRINT CARD
10    CALL SUPCRD
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK FIELDS FOR CHANGE OPTIONS
C
20    CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *   CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
      IF (NFLD.EQ.-1) GO TO 190
      IF (LDEBUG.GT.0)
     * CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *   CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
      IF (LDEBUG.GT.0) WRITE (IOSDBG,320) CHAR
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
C  CHECK IF ERROR ON PREVIOUS COMMAND
      IF (ICMERR.EQ.0) GO TO 30
         IF (LATSGN.EQ.0.AND.NFLD.EQ.1) CALL SUPCRD
         IF (LATSGN.EQ.0) GO TO 20
            ICMERR=0
            NSCARD=NRDCRD-NCSKIP
            IF (NSCARD.GT.0) WRITE (LP,250) NSCARD
            IF (NSCARD.GT.0) CALL SULINE (LP,2)
C
C  CHECK FOR NULL FIELD
30    IF (IERR.NE.1) GO TO 40
         IF (LDEBUG.GT.0) WRITE (IOSDBG,300) NFLD
         IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
         GO TO 20
C
C  CHECK FOR COMMAND
40    IF (LATSGN.EQ.1) GO TO 190
C
      IF (ILPFND.GT.0.AND.IRPFND.EQ.0) GO TO 50
         GO TO 60
50    WRITE (LP,270) NFLD
      CALL SULINE (LP,2)
      ILPFND=0
      IRPFND=0
60    IF (LLPAR.GT.0) ILPFND=1
C
C  CHECK FOR PARENTHESIS IN FIELD
      CALL UREPET (1H ,CHK,20)
      IF (LLPAR.EQ.1) CALL SUBSTR (CHAR,1,LENGTH,CHK,1)
      IF (LLPAR.GT.1) CALL UFPACK (LCHK,CHK,ISTRT,1,LLPAR-1,IERR)
      IF (LLPAR.EQ.0) CALL UFPACK (LCHK,CHK,ISTRT,1,LENGTH,IERR)
C
C  CHECK FOR OPTION
      DO 70 IOPTN=1,MOPTN
         CALL SUCOMP (2,CHK,OPTN(IOPTN),IMATCH)
         IF (IMATCH.EQ.1) GO TO 100
70       CONTINUE
C
C  CHECK FOR GROUP
      DO 80 IGROUP=1,MGROUP
         CALL SUCOMP (2,CHK,GROUP(IGROUP),IERR)
         IF (IERR.NE.1) GO TO 80
            LGROUP=IGROUP
            IF (LDEBUG.GT.0) WRITE (IOSDBG,310) GROUP(LGROUP)
            IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
            IF (NFLD.EQ.1) CALL SUPCRD
            GO TO 20
80       CONTINUE
C
C  CHECK FOR KEYWORD
      CALL SUIDCK ('CHNG',CHK,NFLD,0,IKEYWD,IERR)
      IF (IERR.EQ.0) GO TO 90
      GO TO 120
C
90    CALL SUPCRD
      WRITE (LP,280) NFLD,CHAR
      CALL SUERRS (LP,2,NUMERR)
      ILPFND=0
      GO TO 20
C
100   IF (NFLD.EQ.1) CALL SUPCRD
      ILPFND=0
      IRPFND=0
      GO TO (110,110,110,110),IOPTN
110      WRITE (LP,290) OPTN(IOPTN)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK WHICH PARAMETER TYPE IS TO BE CHANGED
C
120   IF (LGROUP.GT.0) GO TO 130
         WRITE (LP,330)
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
         GO TO 20
C
C  WRITE TO PROGRAM LOG
130   NPAGE=0
      ISTART=1
      CALL SUWLOG ('OPTN',GROUP(LGROUP),BLNK8,NPAGE,ISTART,IERR)
C
      GO TO (150,150,140,140),LGROUP
140      WRITE (LP,290) GROUP(LGROUP)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHANGE AREA
150   IF (ISUPRT('CNGS').EQ.0) GO TO 160
      IF (CHK(1).NE.XID) GO TO 170
      CALL SGSTA (LARRAY,ARRAY,NFLD,IRUNCK,IERR)
      GO TO 180
C
C  NON-SUPPORTED FEATURE SPECIFIED - SKIP TO NEXT COMMAND
160   IF (NFLD.EQ.1) CALL SUPCRD
      WRITE (LP,220)
      WRITE (LP,220)
      CALL SULINE (LP,1)
      WRITE (LP,260) GROUP(LGROUP)
      IF (IOPOVP.EQ.1) WRITE (LP,260) GROUP(LGROUP)
      IF (IOPOVP.EQ.1) WRITE (LP,260) GROUP(LGROUP)
      CALL SUERRS (LP,1,NUMERR)
      ICMERR=1
      NCSKIP=NRDCRD
      GO TO 20
C
C  KEYWORD FOUND IS NOT VALID FOR GROUP SPECIFIED
170   IF (NFLD.EQ.1) CALL SUPCRD
      WRITE (LP,340) (CHK(I),I=1,2),GROUP(LGROUP)
      CALL SUERRS (LP,2,NUMERR)
      ICMERR=1
      NCSKIP=NRDCRD
      GO TO 20
C
C  WRITE TO PROGRAM LOG
180   NPAGE=0
      ISTART=0
      CALL SUWLOG ('OPTN',GROUP(LGROUP),BLNK8,NPAGE,ISTART,IERR)
C
C  SET INDICATOR TO REREAD CURRENT FIELD
      ISTRT=-1
      GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PRINT NUMBER OF ERRORS AND WARNINGS ENCOUNTERED
190   NWARN=NTWARN-NCWARN
      NERR=NTERR-NCERR
      IF (NWARN.GT.0) WRITE (LP,350) NWARN
      IF (NWARN.GT.0) CALL SULINE (LP,2)
      IF (NERR.GT.0) WRITE (LP,360) NERR
      IF (NERR.GT.0) CALL SULINE (LP,2)
C
C  CHECK IF RUNCHECK OPTION SPECIFIED
      IF (IOPRCK.EQ.0) GO TO 200
         WRITE (LP,220)
         WRITE (LP,220)
         CALL SULINE (LP,1)
         WRITE (LP,240)
         IF (IOPOVP.EQ.1) WRITE (LP,240)
         IF (IOPOVP.EQ.1) WRITE (LP,240)
         CALL SULINE (LP,1)
C
200   IF (ISTRCE.GT.0) WRITE (IOSDBG,370)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
210   FORMAT (' *** ENTER SGCHNG')
220   FORMAT (1H )
230   FORMAT ('+*** NOTE - RUNCHECK OPTION HAS BEEN SPECIFIED. INPUT ',
     *   'WILL BE CHECKED FOR ERRORS.')
240   FORMAT ('+*** NOTE - RUNCHECK OPTION HAS BEEN SPECIFIED. INPUT ',
     *   'HAS BEEN CHECKED FOR ERRORS.')
250   FORMAT ('0*** NOTE - ',I4,' CARD IMAGES NOT PROCESSED BECAUSE ',
     *   'INVALID OPTION FOUND.')
260   FORMAT ('+*** ERROR - ',A8,' OPTION NOT CURRENTLY ALLOWED ',
     *   'CURRENTLY ALLOWED. ',
     *   'COMMAND WILL NOT BE PROCESSED.')
270   FORMAT ('0*** NOTE - RIGHT PARENTHESIS ASSUMED IN FIELD ',I2,
     *   '.')
280   FORMAT ('0*** ERROR - INVALID CHANGE OPTION IN CARD FIELD ',
     *   I2,' : ',5A4)
290   FORMAT ('0*** ERROR - ERROR PROCESSING OPTION : ',5A4)
300   FORMAT (' BLANK STRING FOUND IN FIELD ',I2)
310   FORMAT (' GROUP SET TO : ',A8)
320   FORMAT (' INPUT FIELD = ',5A4)
330   FORMAT ('0*** ERROR - NO GROUP NAME FOUND.')
340   FORMAT ('0*** ERROR - KEYWORD FOUND (',2A4,') IS NOT VALID FOR ',
     *   'GROUP NAME SPECIFIED (',A8, '). ',
     *   'COMMAND WILL NOT BE PROCESSED.')
350   FORMAT ('0*** NOTE - ',I4,' TOTAL WARNINGS ENCOUNTERED BY ',
     *   'CHANGE COMMAND.')
360   FORMAT ('0*** NOTE - ',I4,' TOTAL ERRORS   ENCOUNTERED BY ',
     *   'CHANGE COMMAND.')
370   FORMAT (' *** EXIT SGCHNG')
C
      END
