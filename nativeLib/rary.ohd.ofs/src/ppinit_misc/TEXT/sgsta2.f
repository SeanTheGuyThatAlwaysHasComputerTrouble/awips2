C MODULE SGSTA2
C-----------------------------------------------------------------------
C
C  ROUTINE TO CHECK IF IDENTIFIER REFERENCED IN PARAMETER DEFINITIONS.
C
      SUBROUTINE SGSTA2 (OLDID,NEWID,LARAY1,IARAY1,LARAY2,ARAY2,
     *   LARAY3,ARAY3,IFIRST,NUMID1,NUMID2,NUMERR,ISTAT)
C
      REAL PCPN/4HPCPN/,TEMP/4HTEMP/,PE/4HPE  /
      REAL BASN/4HBASN/
      REAL MAP/4HMAP /,MAT/4HMAT /,MAPE/4HMAPE/,FMAP/4HFMAP/
      REAL BLNK/4H    /
      REAL*8 BLNK8/8H        /
      CHARACTER*8 XOLDID
C
      DIMENSION IARAY1(LARAY1),ARAY2(LARAY2),ARAY3(LARAY3)
      DIMENSION OLDID(2),NEWID(2)
C
C  ARRAYS USED BY MORE THAN ONE AREA PARAMETER TYPE
      DIMENSION AREAID(2),DESCRP(5),CENTRD(2),BASNID(2)
C
C  STAN PARAMETER ARRAYS
      DIMENSION STAID(2),STALOC(2),STACOR(2)
C
      INCLUDE 'scommon/dimpcpn'
C
C  MAP PARAMETERS
      DIMENSION FMAPID(2)
      DIMENSION TSTAID(2,100),TSTAWT(100),CTSTA(2,100),CSTAID(2,100)
      DIMENSION CSTAWT(100),CCSTA(2,100)
      DIMENSION ITECHS(5),IPD6(100),IPD24(100),MDRBOX(100),CORMDR(100)
C
C  BASN PARAMETER ARRAYS
      DIMENSION BDESC(5),DUMYID(2)
      PARAMETER (MBPTS=3000)
      DIMENSION LAT(MBPTS),LON(MBPTS)
      DIMENSION IY(MBPTS),IXB(MBPTS),IXE(MBPTS)
      DIMENSION X(MBPTS),Y(MBPTS),JX(MBPTS),JY(MBPTS),JN(MBPTS)
C
C  MAT PARAMETER ARRAYS
      DIMENSION TEMPID(2,100),IPDMMT(100),WTMMT(100)
C
C  MAPE PARAMETER ARRAYS
      PARAMETER (MPE=5)
      DIMENSION PEMEAN(12),PECHNG(12)
      DIMENSION PSTAID(2,MPE),IPDPTR(MPE),STAWT(MPE)
C
      DIMENSION UNUSED(10)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_misc/RCS/sgsta2.f,v $
     . $',                                                             '
     .$Id: sgsta2.f,v 1.3 1998/04/07 15:16:53 page Exp $
     . $' /
C    ===================================================================
C
C
C
      IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,570)
         CALL SULINE (IOSDBG,1)
         ENDIF
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('CHNG')
C
      ISTAT=0
C
      ISORT=1
      ISTATE=0
      NWORDS=2
      MAXID=LARAY1/(NWORDS+1)
C
      IPRERR=1
      IPRNT=1
C
      NPX=0
      NMAP=0
      NFMAP=0
      NMAT=0
      NMAPE=0
      MSTWT=100
      MPCPN=100
      MBOX=100
      MTEMP=100
C
      IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,575) NUMID1,NUMID2,OLDID,NEWID,IFIRST
         CALL SULINE (IOSDBG,1)
         ENDIF
C         
      IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,*) 'IN SGSTA2 - MBPTS=',MBPTS
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      IPCPN=0
      ITEMP=0
      IPE=0
      IRRS=0
      IFMAP=0
      IMAP=0
      IMAT=0
      IMAPE=0
      IMARO=0
C 
      CALL SUBSTR (OLDID,1,LEN(XOLDID),XOLDID,1)
C
      IF (IPCPN.EQ.0) GO TO 70
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK IF PCPN STATION USED AS SIGNIFICANCE STATION IN PCPN STATION
C  DEFINITIONS
C
      IF (IFIRST.EQ.0) GO TO 5
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('PCPN',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
5     IF (NUMID1.EQ.0) GO TO 550
      IPTRNX=0
C
10    CALL SUBSTR (BLNK8,1,8,STAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NPX+1)
      IREAD=1
      INCLUDE 'scommon/callsrpcpn'
      IF (IERR.GT.0) GO TO 60
C
C  PRINT PARAMETERS
      LEVEL=1
      IPREST=0
      IF (LDEBUG.GT.0) THEN
         INCLUDE 'scommon/callsppcpn'
         ENDIF
      NPX=NPX+1
C
C  CHECK IF SIGNIFICANCE WEIGHTS USED
      IF (IPTWGT.GT.0) GO TO 30
         IF (LDEBUG.GT.0) THEN
             WRITE (IOSDBG,580) STAID
             CALL SULINE (IOSDBG,1)
             GO TO 60
             ENDIF
C
C  CHECK IF STATION IDENTIFIER REFERENCED
30    DO 50 I=1,IPTWGT
         IF (STASID(I).EQ.XOLDID) GO TO 40
         GO TO 50
40       WRITE (LP,590) OLDID,STAID
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
50       CONTINUE
C
60    IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NPX.EQ.NUMID1) GO TO 550
C      
      GO TO 10
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
70    IF (IPCPN.EQ.0) GO TO 190
C
C  CHECK IF STATION USED AS PREDETERMINED STATION IN MAP AREA
C
      IF (IFIRST.EQ.0) GO TO 75
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('MAP ',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
75    IF (NUMID1.EQ.0) GO TO 550
      IPTRNX=0
C
80    CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NMAP+1)
      IPTR2=0
      CALL SRMAP (IVMAP,AREAID,ITIME,ITMWT,POWER,MSTWT,NSTWT,
     *   ISTWT,MPCPN,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,
     *   TSTAID,TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   UNUSED,LARAY2,ARAY2,IPTR,IPRERR,IPTRNX,IERR)
      CALL SRMAPS (IVMAPS,AREAID,CENTRD,RADINF,IPMAP,NTECH,
     *   IBASN,MSTWT,NSTWT,MPCPN,NPCPN,MBOX,NBOX,ITECHS,IPD6,IPD24,
     *   MDRBOX,CORMDR,UNUSED,LARAY2,ARAY2,IPTR2,IPRERR,IPTRN2,IERR2)
      IF (IERR.EQ.0.AND.IERR2.EQ.0) GO TO 90
         IF (IERR.NE.2.OR.IERR2.NE.2) THEN
            WRITE (LP,600) MAP,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAP
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 180
C
90    IF (LDEBUG.EQ.0) GO TO 100
C
      IF (BASNID(1).EQ.BLNK.AND.BASNID(2).EQ.BLNK) GO TO 100
      IPTR3=0
      CALL SRBASN (ARAY2,LARAY2,IJ,BASNID,BDESC,LAT,LON,MBPTS,NBPTS,
     *   AREA,CAREA,ELEV,CENTRD(1),CENTRD(2),MAPFLG,MATFLG,
     *   DUMYID,DUMYID,DUMYID,
     *   MBPTS,NSEGS,IY,IXB,IXE,LFACTR,IPTR3,IPTRN3,IPRERR,IERR)
      IF (IERR.GT.0) GO TO 100
      CALL SPMAP (IPRNT,IVMAP,IVMAPS,AREAID,ITIME,ITMWT,POWER,NSTWT,
     *   ISTWT,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,TSTAID,
     *   TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   RADINF,IPMAP,NTECH,IBASN,NBOX,ITECHS,IPD6,IPD24,MDRBOX,
     *   CORMDR,UNUSED,IY,IXB,IXE,NSEGS,X,Y,JX,JY,NBPTS,
     *   LFACTR,PLOT,LARAY2,ARAY2,UNITS,AREA,CAREA,JN,IERR)
C
100   NMAP=NMAP+1
C
C  CHECK IF PREDETERMINED WEIGHTS USED FOR TIMING WEIGHTS
      IF (ITMWT.EQ.1) GO TO 110
         IF (LDEBUG.GT.0) THEN
             IF (ITMWT.EQ.2) THEN
                WRITE (IOSDBG,620) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             IF (ITMWT.EQ.3) THEN
                WRITE (IOSDBG,630) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             ENDIF
          GO TO 140
C
C  CHECK IF STATION IDENTIFIER REFERENCED
110   DO 130 I=1,NSTWT
         IF (TSTAID(1,I).EQ.OLDID(1).AND.TSTAID(2,I).EQ.OLDID(2))
     *      GO TO 120
         GO TO 130
120      WRITE (LP,640) TYPE,OLDID,MAP,AREAID
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
130      CONTINUE
C
C  CHECK IF PREDETERMINED WEIGHTS USED FOR STATION WEIGHTS
140   IF (ISTWT.EQ.1) GO TO 150
         IF (LDEBUG.GT.0) THEN
             IF (ISTWT.EQ.2) THEN
                WRITE (IOSDBG,650) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             IF (ISTWT.EQ.3) THEN
                WRITE (IOSDBG,660) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             IF (ISTWT.EQ.4) THEN
                WRITE (IOSDBG,670) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             ENDIF
          GO TO 180
C
C  CHECK IF STATION IDENTIFIER REFERENCED
150   DO 170 I=1,NPX
         IF (CSTAID(1,I).EQ.OLDID(1).AND.CSTAID(2,I).EQ.OLDID(2))
     *      GO TO 160
         GO TO 170
160      WRITE (LP,640) TYPE,OLDID,MAP,AREAID
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
170      CONTINUE
C
180   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NMAP.EQ.NUMID1) GO TO 550
C      
      GO TO 80
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
190   IF (ITEMP.EQ.0) GO TO 260
C
C  CHECK IF USED AS PREDETERMINED STATION IN MAT AREA
C
      IF (IFIRST.EQ.0) GO TO 195
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('MAT ',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
195   IF (NUMID1.EQ.0) GO TO 550
      IPTRNX=0
C
200   CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NMAT+1)
      CALL SRMAT (IVMAT,AREAID,DESCRP,CENTRD,BASNID,ISTWT,POWER,
     *   MTEMP,NTEMP,TEMPID,IPDMMT,WTMMT,UNUSED,LARAY2,ARAY2,
     *   IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 210
         IF (IERR.NE.2) THEN
            WRITE (LP,600) MAT,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAT
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 250
C
210   IF (LDEBUG.GT.0) THEN
         CALL SPMAT (IPRNT,UNITS,IVMAT,AREAID,DESCRP,CENTRD,BASNID,
     *     ISTWT,POWER,NTEMP,TEMPID,IPDMMT,WTMMT,
     *     UNUSED,LARAY2,ARAY2,IERR)
         ENDIF
C
      NMAT=NMAT+1
C
C  CHECK IF PREDETERMINED WEIGHTS USED FOR STATION WEIGHTS
      IF (ISTWT.EQ.1) GO TO 220
         IF (LDEBUG.GT.0) THEN
             IF (ISTWT.EQ.2) THEN
                WRITE (IOSDBG,690) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             IF (ISTWT.EQ.3) THEN
                WRITE (IOSDBG,670) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             ENDIF
          GO TO 250
C
C  CHECK IF STATION IDENTIFIER REFERENCED
220   DO 240 I=1,NTEMP
         IF (TEMPID(1,I).EQ.OLDID(1).AND.TEMPID(2,I).EQ.OLDID(2))
     *      GO TO 230
         GO TO 240
230      WRITE (LP,640) TYPE,OLDID,MAPE,AREAID
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
240      CONTINUE
C
250   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NMAT.EQ.NUMID1) GO TO 550
C      
      GO TO 200
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
260   IF (IPE.EQ.0) GO TO 330
C
C  CHECK IF USED AS PREDETERMINED STATION IN MAPE AREA
C
      IF (IFIRST.EQ.0) GO TO 275
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('MAPE',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
275   IF (NUMID1.EQ.0) GO TO 550
      IPTRNX=0
C
270   CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NMAPE+1)
      CALL SRMAPE (IVMAPE,AREAID,DESCRP,CENTRD,ISTWT,POWER,
     *   PEMEAN,PECHNG,MPE,NPE,PSTAID,IPDPTR,STAWT,
     *   UNUSED,LARAY2,ARAY2,IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 280
         IF (IERR.NE.2) THEN
            WRITE (LP,600) MAPE,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAPE
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 320
C
280   IF (LDEBUG.GT.0) THEN
         CALL SPMAPE (UNITS,IVMAPE,AREAID,DESCRP,CENTRD,ISTWT,
     *      POWER,PEMEAN,PECHNG,NPE,PSTAID,IPDPTR,STAWT,
     *      UNUSED,IERR)
         ENDIF
C
      NMAPE=NMAPE+1
C
C  CHECK IF PREDETERMINED WEIGHTS USED FOR STATION WEIGHTS
      IF (ISTWT.EQ.1) GO TO 290
         IF (LDEBUG.GT.0) THEN
             IF (ISTWT.EQ.2) THEN
                WRITE (IOSDBG,670) AREAID
                CALL SULINE (IOSDBG,1)
                ENDIF
             ENDIF
          GO TO 320
C
C  CHECK IF STATION IDENTIFIER REFERENCED
290   DO 310 I=1,NPE
         IF (PSTAID(1,I).EQ.OLDID(1).AND.PSTAID(2,I).EQ.OLDID(2))
     *      GO TO 300
         GO TO 310
300      WRITE (LP,640) TYPE,OLDID,MAPE,AREAID
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=2
310      CONTINUE
C
320   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NMAPE.EQ.NUMID1) GO TO 550
C      
      GO TO 270
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
330   IF (IRRS.EQ.0) GO TO 450
C
C  CHECK IF BASIN IS USED IN MAP AREA
C
      MAXID=LARAY1/((NWORDS+1)*2)
      IF (IFIRST.EQ.0) GO TO 335
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('MAP ',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
335   IF (NUMID1.EQ.0) GO TO 390
      IPTRNX=0
C
340   CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NMAP+1)
      IPTR2=0
      CALL SRMAP (IVMAP,AREAID,ITIME,ITMWT,POWER,MSTWT,NSTWT,
     *   ISTWT,MPCPN,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,
     *   TSTAID,TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   UNUSED,LARAY2,ARAY2,IPTR,IPRERR,IPTRNX,IERR)
      CALL SRMAPS (IVMAPS,AREAID,CENTRD,RADINF,IPMAP,NTECH,
     *   IBASN,MSTWT,NSTWT,MPCPN,NPCPN,MBOX,NBOX,ITECHS,IPD6,IPD24,
     *   MDRBOX,CORMDR,UNUSED,LARAY2,ARAY2,IPTR2,IPRERR,IPTRN2,IERR2)
      IF (IERR.EQ.0.AND.IERR2.EQ.0) GO TO 350
         IF (IERR.NE.2.AND.IERR2.NE.2) THEN
            WRITE (LP,600) MAP,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ISTAT=1
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAP
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 380
C
350   IF (LDEBUG.EQ.0) GO TO 360
C
      IF (LDEBUG.GT.1) GO TO 355
         WRITE (IOSDBG,705) AREAID,BASNID,OLDID
         CALL SULINE (IOSDBG,1)
         GO TO 360
355   IPTR3=0
      CALL SRBASN (ARAY2,LARAY2,IJ,BASNID,BDESC,LAT,LON,MBPTS,NBPTS,
     *   AREA,CAREA,ELEV,CENTRD(1),CENTRD(2),MAPFLG,MATFLG,
     *   DUMYID,DUMYID,DUMYID,
     *   MBPTS,NSEGS,IY,IXB,IXE,LFACTR,IPTR3,IPTRN3,IPRERR,IERR)
      IF (IERR.GT.0) GO TO 360
      CALL SPMAP (IPRNT,IVMAP,IVMAPS,AREAID,ITIME,ITMWT,POWER,NSTWT,
     *   ISTWT,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,TSTAID,
     *   TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   RADINF,IPMAP,NTECH,IBASN,NBOX,ITECHS,IPD6,IPD24,MDRBOX,
     *   CORMDR,UNUSED,IY,IXB,IXE,NSEGS,X,Y,JX,JY,NBPTS,
     *   LFACTR,PLOT,LARAY2,ARAY2,UNITS,AREA,CAREA,JN,IERR)
C
360   NMAP=NMAP+1
C
C  CHECK IF BASIN ID REFERENCED
      IF (BASNID(1).EQ.OLDID(1).AND.BASNID(2).EQ.OLDID(2)) GO TO 370
         GO TO 380
370   WRITE (LP,710) BASNID,AREAID
      CALL SUERRS (LP,2,NUMERR)
      ISTAT=2
C
380   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 390
      IF (IXSORT.EQ.1.AND.NMAP.EQ.NUMID1) GO TO 390
      GO TO 340
C
C  CHECK IF BASIN IS USED IN MAT AREA
C
390   MAXID=LARAY1/((NWORDS+1)*2)
      IF (IFIRST.EQ.0) GO TO 395
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*5+1)=1
      IPRMSG=1
      CALL SURIDS ('MAT ',IXSORT,MAXID,ISTATE,NWORDS,
     *   IARAY1(MAXID*(NWORDS+1)+1),IARAY1(MAXID*(NWORDS*2+1)+1),
     *   NUMID2,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
395   IF (NUMID2.EQ.0) GO TO 550
      IPTRNX=0
C
400   CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*5+NMAT+1)
      CALL SRMAT (IVMAT,AREAID,DESCRP,CENTRD,BASNID,ISTWT,POWER,
     *   MTEMP,NTEMP,TEMPID,IPDMMT,WTMMT,UNUSED,LARAY2,ARAY2,
     *   IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 410
         IF (IERR.NE.2) THEN
            WRITE (LP,600) MAT,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ISTAT=1
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAT
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 440
C
410   IF (LDEBUG.GT.0) THEN
         CALL SPMAT (IPRNT,UNITS,IVMAT,AREAID,DESCRP,CENTRD,BASNID,
     *      ISTWT,POWER,NTEMP,TEMPID,IPDMMT,WTMMT,
     *      UNUSED,LARAY2,ARAY2,IERR)
         ENDIF
C
      NMAT=NMAT+1
C
C  CHECK IF BASIN ID REQUESTED
      IF (BASNID(1).EQ.OLDID(1).AND.BASNID(2).EQ.OLDID(2)) GO TO 430
         GO TO 440
430   WRITE (LP,720) BASNID,AREAID
      CALL SUERRS (LP,2,NUMERR)
      ISTAT=2
C
440   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NMAT.EQ.NUMID2) GO TO 550
      GO TO 400
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
450   IF (IFMAP.EQ.0) GO TO 510
C
C  CHECK IF FMAP AREA ID USED IN MAP AREA
C
      IF (IFIRST.EQ.0) GO TO 455
C
C  GET SORTED LIST OF IDENTIFIERS
      IXSORT=ISORT
      IARAY1(MAXID*NWORDS+1)=1
      IPRMSG=1
      CALL SURIDS ('MAP ',IXSORT,MAXID,ISTATE,NWORDS,IARAY1,
     *   IARAY1(MAXID*NWORDS+1),NUMID1,LARAY2,ARAY2,IPRMSG,IPRERR,IERR)
      IF (IERR.GT.0) IXSORT=0
C
455   IF (NUMID1.EQ.0) GO TO 550
      IPTRNX=0
C
460   CALL SUBSTR (BLNK8,1,8,AREAID,1)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.EQ.1) IPTR=IARAY1(MAXID*NWORDS+NFMAP+1)
      CALL SRMAP (IVMAP,AREAID,ITIME,ITMWT,POWER,MSTWT,NSTWT,
     *   ISTWT,MPCPN,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,
     *   TSTAID,TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   UNUSED,LARAY2,ARAY2,IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 470
         IF (IERR.NE.2) THEN
            WRITE (LP,600) MAP,AREAID
            CALL SUERRS (LP,2,NUMERR)
            ENDIF
         IF (IERR.EQ.2.AND.LDEBUG.GT.0) THEN
            WRITE (IOSDBG,610) MAP
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 500
C
470   IF (LDEBUG.EQ.0) GO TO 480
C
      IF (LDEBUG.GT.1) GO TO 475
         WRITE (IOSDBG,705) AREAID,BASNID,OLDID
         CALL SULINE (IOSDBG,1)
         GO TO 480
475   IPTR2=0
      CALL SRMAPS (IVMAPS,AREAID,CENTRD,RADINF,IPMAP,NTECH,
     *   IBASN,MSTWT,NSTWT,MPCPN,NPCPN,MBOX,NBOX,ITECHS,IPD6,IPD24,
     *   MDRBOX,CORMDR,UNUSED,LARAY2,ARAY2,IPTR2,IPRERR,IPTRN2,IERR2)
      IF (BASNID(1).EQ.BLNK.AND.BASNID(2).EQ.BLNK) GO TO 480
      IPTR3=0
      CALL SRBASN (ARAY2,LARAY2,IJ,BASNID,BDESC,LAT,LON,MBPTS,NBPTS,
     *   AREA,CAREA,ELEV,CENTRD(1),CENTRD(2),MAPFLG,MATFLG,
     *   DUMYID,DUMYID,DUMYID,
     *   MBPTS,NSEGS,IY,IXB,IXE,LFACTR,IPTR3,IPTRN3,IPRERR,IERR)
      IF (IERR.GT.0) GO TO 480
      CALL SPMAP (IPRNT,IVMAP,IVMAPS,AREAID,ITIME,ITMWT,POWER,NSTWT,
     *   ISTWT,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,TSTAID,
     *   TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   RADINF,IPMAP,NTECH,IBASN,NBOX,ITECHS,IPD6,IPD24,MDRBOX,
     *   CORMDR,UNUSED,IY,IXB,IXE,NSEGS,X,Y,JX,JY,NBPTS,
     *   LFACTR,PLOT,LARAY2,ARAY2,UNITS,AREA,CAREA,JN,IERR)
C
480   NFMAP=NFMAP+1
C
C  CHECK IF FMAP AREA REFERENCED
      IF (FMAPID(1).EQ.OLDID(1).AND.FMAPID(2).EQ.OLDID(2)) GO TO 490
         GO TO 500
490   WRITE (LP,730) OLDID,AREAID
      CALL SUERRS (LP,2,NUMERR)
      ISTAT=2
C
500   IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 550
      IF (IXSORT.EQ.1.AND.NFMAP.EQ.NUMID1) GO TO 550
      GO TO 460
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
510   IF (IMAP.EQ.0.OR.IMAT.EQ.0.OR.IMAPE.EQ.0.OR.IMARO.EQ.1)
     *   GO TO 550
C
C  DIVIDE WORK SPACE
      MAXID=LARAY3/8
C  TIME SERIES IDS
      ID1=1
C  CARRYOVER GROUP IDS
      ID2=MAXID*NWORDS+1
C  FORECAST GROUP IDS
      ID3=MAXID*3+1
C  SEGMENT IDS
      ID4=MAXID*4+1
C
C  CHECK IF AREA IS USED IN A SEGMENT
C
      IF (IFIRST.EQ.0) GO TO 520
         IFILFC=1
         IPRMSG=1
         CALL SUGTFC (TYPE,MAXID,ARAY3(ID1),NUMID1,IFILFC,
     *      ARAY3(ID2),ARAY3(ID3),ARAY3(ID4),IPRMSG,IERR)
         IF (IERR.EQ.0) GO TO 520
            IF (IERR.EQ.1) GO TO 550
               WRITE (LP,760) TYPE
               CALL SUERRS (LP,2,NUMERR)
               ISTAT=2
               GO TO 550
C
C  CHECK AREA IDENTIFIER FOUND
520   NUM=NUMID1*2
      IREF=0
      DO 540 I=1,NUM,2
         J=ID1+I-1
         K=ID1+I
         IF (OLDID(1).NE.ARAY3(J).AND.OLDID(2).NE.ARAY3(K)) GO TO 540
         IF (IREF.NE.0) GO TO 530
            WRITE (LP,770) TYPE,OLDID
            CALL SUERRS (LP,2,NUMERR)
            IREF=1
530      WRITE (LP,780) ARAY3(ID2+I-1),ARAY3(ID2+I),
     *      ARAY3(ID3+I-1),ARAY3(ID3+I),ARAY3(ID4+I-1),ARAY3(ID4+I)
         CALL SULINE (LP,1)
         ISTAT=2
540      CONTINUE
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
550   IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,680) NPX,PCPN
         CALL SULINE (IOSDBG,1)
         WRITE (IOSDBG,740) NMAP,MAP
         CALL SULINE (IOSDBG,1)
         WRITE (IOSDBG,740) NMAT,MAT
         CALL SULINE (IOSDBG,1)
         WRITE (IOSDBG,740) NMAPE,MAPE
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,750)
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
570   FORMAT (' *** ENTER SGSTA2')
575   FORMAT (' NUMID1=',I5,3X,'NUMID2=',I5,3X,'OLDID=',2A4,3X,
     *   'NEWID=',2A4,3X,'IFIRST=',I2)
580   FORMAT (' STATION ',2A4,' HAS 1/D**2 WEIGHTS')
590   FORMAT ('0*** ERROR - PCPN STATION ',2A4,' IS USED AS A ',
     *   'SIGNIFICANCE STATION BY STATION ',2A4,'.')
600   FORMAT ('0*** ERROR - READING ',A4,' PARAMETERS FOR AREA ',
     *   2A4,'.')
610   FORMAT (' NO ',A4,' AREAS DEFINED')
620   FORMAT (' AREA ',2A4,' HAS 1/D**2 TIMING WEIGHTS')
630   FORMAT (' AREA ',2A4,' HAS 1/D**POWER TIMING WEIGHTS')
640   FORMAT ('0*** ERROR - ',A4,' STATION ',2A4,' IS USED AS A ',
     *   'PREDETERMINED STATION BY ',A4,' AREA ',2A4,'.')
650   FORMAT (' AREA ',2A4,' HAS GRID POINT STATION WEIGHTS')
660   FORMAT (' AREA ',2A4,' HAS THIESSEN STATION WEIGHTS')
670   FORMAT (' AREA ',2A4,' HAS 1/D**POWER TIMING WEIGHTS')
680   FORMAT (' ',I4,' STATIONS WITH ',A4,' PARAMETERS CHECKED')
690   FORMAT (' AREA ',2A4,' HAS GRID POINT STATION WEIGHTS')
700   FORMAT (' AREA ',2A4,' HAS 1/D**POWER TIMING WEIGHTS')
705   FORMAT (' AREAID=',2A4,3X,'BASNID=',2A4,3X,'OLDID=',2A4)
710   FORMAT('0*** ERROR - BASIN ',2A4,' IS USED BY MAP AREA ',2A4,'.')
720   FORMAT('0*** ERROR - BASIN ',2A4,' IS USED BY MAT AREA ',2A4,'.')
730   FORMAT ('0*** ERROR - FMAP AREA ',2A4,' IS USED BY MAP AREA ',
     *   2A4,'.')
740   FORMAT (' ',I4,1X,A4,' AREAS CHECKED')
760   FORMAT ('0*** ERROR - TIME SERIES IDENTIFIERS FOR ',A4,
     *   ' AREAS NOT SUCCESSFULLY BE READ. REQUIRED CHECKS CANNOT BE ',
     *   'MADE.')
770   FORMAT ('0*** ERROR - ',A4,' AREA ',2A4,' CANNOT BE DELETED ',
     *   'BECAUSE IT IS STILL REFERENCED BY:')
780   FORMAT (T14,'CARRYOVER GROUP = ',2A4,5X,'FORECAST GROUP = ',
     *    2A4,5X,'SEGMENT = ',2A4)
750   FORMAT (' *** EXIT SGSTA2')
C
      END
