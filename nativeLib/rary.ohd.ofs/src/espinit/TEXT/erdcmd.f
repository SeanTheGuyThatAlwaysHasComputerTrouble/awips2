C MODULE ERDCMD
C-----------------------------------------------------------------------
C
      SUBROUTINE ERDCMD (P,MP,T,MT,TS,MTS,PESP,MPESP,SPESP,MSPESP,
     *   TSESP,MTSESP,TTS,MTTS,MAXD)
C
C   THIS ROUTINE READS THE COMMANDS FOR THE INITIALIZATION PROGRAM
C
      INCLUDE 'common/fdbug'
      INCLUDE 'common/where'
      INCLUDE 'common/ionum'
      INCLUDE 'clbcommon/crwctl'
C
      CHARACTER*4 STRNG
C
      DIMENSION P(1),T(1),TS(1),PESP(1),SPESP(1),TSESP(1),TTS(1)
      DIMENSION OLDOPN(2),SBNAME(2)
      DIMENSION CMDNAM(20),COMAND(2),ISUB1(2),ISUB2(2)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/espinit/RCS/erdcmd.f,v $
     . $',                                                             '
     .$Id: erdcmd.f,v 1.2 2001/06/13 13:07:54 dws Exp $
     . $' /
C    ===================================================================
C
      DATA SBNAME/4HERDC,4HMD  /
      DATA CMDNAM/4HDEFS,4HEG  ,4HREDE,4HFSEG,4HPRIN,4HT   ,
     1 4HSTAT,4HUS  ,4HDELS,4HEG  ,4HRUNC,4HHECK,4HSEAR,4HCH  ,
     2 4HPUNC,4HH   ,4HUPDA,4HTE  ,4HSTOP,4H    /
C
C
      IOLDOP=IOPNUM
      IOPNUM=0
      DO 10 I=1,2
      OLDOPN(I)=OPNAME(I)
   10 OPNAME(I)=SBNAME(I)
      IF(ITRACE.GE.1) WRITE(IODBUG,900)
  900 FORMAT(1H ,17H** ERDCMD ENTERED)
C
   20 READ(IN,500,END=999) COMAND,ISUB1,ISUB2
  500 FORMAT(2A4,2X,2A4,2X,2A4)
      CALL UMEMOV (COMAND,STRNG,1)
      IF (STRNG(1:1).EQ.'$') GO TO 20
      DO 50 I=1,10
         K=2*I-1
         IF(COMAND(1).EQ.CMDNAM(K).AND.COMAND(2).EQ.CMDNAM(K+1)) THEN
            NUM=I
            GO TO 100
            ENDIF
   50    CONTINUE
      WRITE(IPR,910) COMAND
  910 FORMAT(1H0,10X,11H**ERROR**  ,2A4,24H  IS NOT A VALID COMMAND)
      CALL ERROR
      GO TO 20
  100 WRITE(IPR,600) COMAND,ISUB1,ISUB2
  600 FORMAT(1H1,20X,5H***  ,2A4,2X,2A4,2X,2A4,5H  ***//)
      GO TO (110,110,130,140,150,160,170,180,190,999), NUM
C
C   DEFINE / REDEFINE SEGMENT
C
  110 ISEG(1)=ISUB1(1)
      ISEG(2)=ISUB1(2)
      CALL EDEFSG(COMAND,ISUB1,P,MP,T,MT,TS,MTS,PESP,MPESP,SPESP,
     1 MSPESP,TSESP,MTSESP,TTS,MTTS,MAXD)
CEW CHANGED CLOSED TO CALL CCLOSL
C CLOSE CALB FILES
        CALL CCLOSL
      GO TO 300
C
C   PRINT SEGMENT(S)
C
130   IPUNCH=0
      ISEG(1)=ISUB2(1)
      ISEG(2)=ISUB2(2)
      CALL EPRINT(ISUB1,ISUB2,P,MP,T,MT,TS,MTS,PESP,MPESP,
     * SPESP,MSPESP,TSESP,MTSESP,IPUNCH)
      GO TO 300
C
C   STATUS
C
  140 CALL ESTS
      GO TO 300
C
C   DELETE SEGMENT
C
  150 ISEG(1)=ISUB1(1)
      ISEG(2)=ISUB1(2)
      CALL EDELSG(1,0,ISUB1,1)
      GO TO 300
C
C   RUN CHECK
C
  160 CALL ERNCHK(ISUB1,ISUB2,P,MP,T,MT,TS,MTS,PESP,MPESP,
     *SPESP,MSPESP,TSESP,MTSESP,TTS,MTTS)
      GO TO 300
C
C   SEARCH CALIBRATION FILES COMMAND
C
  170 ISFN=1
      GO TO 300
C
C  PUNCH SEGMENT INFORMATION
C
180   IPUNCH=1
      ISEG(1)=ISUB2(1)
      ISEG(2)=ISUB2(2)
      CALL EPRINT (ISUB1,ISUB2,P,MP,T,MT,TS,MTS,
     *PESP,MPESP,SPESP,MSPESP,TSESP,MTSESP,IPUNCH)
      GO TO 300
C
C    CALL ROUTINE UPDAT TO UPDATE THE CALIBRATION DATA FILE BLOCK
C    HEADER RECORDS IN THE TSESP ARRAY (IF NECESSARY)
C
C
  190 CALL EUPDAT(ISUB1,ISUB2,P,MP,T,MT,TS,MTS,PESP,MPESP,
     *SPESP,MSPESP,TSESP,MTSESP)
      GO TO 300
C
C
C CLOSE FILES
C
 300  CALL UCLOSL
      GO TO 20
C
  999 IOPNUM=IOLDOP
      OPNAME(1)=OLDOPN(1)
      OPNAME(2)=OLDOPN(2)
      RETURN
      END
