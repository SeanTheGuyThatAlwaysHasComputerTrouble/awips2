C MEMBER SMCHAR
C-----------------------------------------------------------------------
C
C  DESC ROUTINE TO READ AND PRINT PREPROCESSOR PARAMETRIC STATION
C  DESC CHARACTERISTICS.
C  DESC PPINIT COMMAND :  @DUMP CHAR
C
      SUBROUTINE SMCHAR (LARRAY,IARRAY,NFLD,ISTAT)
C
      REAL XCHAR/4HCHAR/
      REAL ALL/4HALL /
      INTEGER*2 IARRAY(12,1),IWORK(1)
C
      DIMENSION CHAR(5),CHK(5)
      DIMENSION IBUF(100),PXCHAR(12)
      INTEGER*2 I2BUF(100)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
      INCLUDE 'scommon/sworkx'
      INCLUDE 'pppcommon/ppxctl'
      INCLUDE 'pppcommon/ppdtdr'
      INCLUDE 'pppcommon/ppunts'
C
      EQUIVALENCE (IWORK(1),SWORK(1))
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_dump/RCS/smchar.f,v $
     . $',                                                             '
     .$Id: smchar.f,v 1.1 1995/09/17 19:12:39 dws Exp $
     . $' /
C    ===================================================================
C
C
C
      IF (ISTRCE.GT.0) WRITE (IOSDBG,220)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG(4HDUMP)
C
      ISTAT=0
C
      ISTRT=-1
      LCHAR=5
      LCHK=5
      ILPFND=0
      IRPFND=0
      NUMFLD=0
      NUMERR=0
      NUMPTR=0
      IENDIN=0
C
      WRITE (LP,230)
      CALL SULINE (LP,2)
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK FIELDS FOR TYPE
C
10    CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *   CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
      IF (LDEBUG.GT.0)
     *   CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *   CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
      IF (IERR.NE.1) GO TO 20
         IF (LDEBUG.GT.0) WRITE (IOSDBG,260) IFIELD
         IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
         GO TO 10
C
C  CHECK FOR END OF INPUT
20    IF (NFLD.EQ.-1) GO TO 55
C
C  CHECK FOR COMMAND
      IF (LATSGN.EQ.1) GO TO 55
C
C  CHECK FOR PAIRED PARENTHESIS
      IF (ILPFND.GT.0.AND.IRPFND.EQ.0) GO TO 30
         GO TO 40
30    IF (NFLD.EQ.1) CALL SUPCRD
      WRITE (LP,270) NFLD
      CALL SULINE (LP,2)
      ILPFND=0
      IRPFND=0
40    IF (LLPAR.GT.0) ILPFND=1
      IF (LRPAR.GT.0) IRPFND=1
C
C  CHECK FOR PARENTHESIS IN FIELD
      IF (LLPAR.GT.0) CALL UFPACK (LCHK,CHK,ISTRT,1,LLPAR-1,IERR)
      IF (LLPAR.EQ.0) CALL UFPACK (LCHK,CHK,ISTRT,1,LENGTH,IERR)
C
      IF (NFLD.EQ.1) CALL SUPCRD
      NUMFLD=NUMFLD+1
      IF (NUMFLD.GT.1) GO TO 50
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK OPTION
      IF (CHK(1).EQ.XCHAR) GO TO 10
         WRITE (LP,240) CHK(1)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 10
C
C  CHECK FOR KEYWORD
50    CALL SUIDCK (4HDMPG,CHK,NFLD,0,IKEYWD,IERR)
      IF (IERR.EQ.2) GO TO 55
      IF (LDEBUG.GT.0) WRITE (IOSDBG,250) CHK
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
C  CHECK FOR ALL OPTION
      IALL=0
      IF (CHK(1).EQ.ALL) IALL=1
C
C  SET POINTER VALUES
      IPCHAR=INTEGR
C
      IF (NFLD.EQ.1) CALL SUPCRD
      GO TO 60
C
C  CHECK IF ANY POINTERS VALUES PROCESSED
55    IF (NUMPTR.GT.0) GO TO 210
      IALL=1
      IENDIN=1
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
60    IF (NUMPTR.GT.0) GO TO 110
      NUMPTR=NUMPTR+1
C
C  OPEN DATA BASE
      CALL SUDOPN (1,4HPPP ,IERR)
      IF (IERR.GT.0) GO TO 210
C
C  FIND CONTROL INFORMATION FOR CHAR RECORD
      CALL SUBSTR (XCHAR,1,4,IPTYPE,1)
      DO 70 I=1,NMPTYP
         IF (IPDTDR(1,I).EQ.IPTYPE) GO TO 80
70       CONTINUE
         WRITE (LP,290) XCHAR
         CALL SUWRNS (LP,2,NUMERR)
         GO TO 205
C
C  READ CHAR CONTROL RECORD
80    IREC=IPDTDR(3,I)
      IF (IREC.GT.0) GO TO 90
         WRITE (LP,300) XCHAR
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 205
90    IUNIT=KPPRMU(IPDTDR(2,I))
      CALL UREADT (IUNIT,IREC,IBUF,IERR)
      IF (IERR.EQ.0) GO TO 100
         WRITE (LP,280) IREC,IUNIT
         CALL SUERRS (LP,2,NUMERR)
         GO TO 205
100   NWORDS=IBUF(1)
      NREC1=IBUF(2)
      NPER=IBUF(3)
      NRECS=IBUF(4)
      IPTYPE=IBUF(5)
      NENTRY=IBUF(6)
      NSTAS=IBUF(7)
      MAXSTA=IBUF(8)
      NXTSTA=IBUF(9)
      WRITE (LP,310) IPTYPE,MAXSTA,NSTAS
      CALL SULINE (LP,2)
      WRITE (LP,320) NWORDS
      CALL SULINE (LP,2)
      WRITE (LP,330) NREC1,NXTSTA
      CALL SULINE (LP,2)
      WRITE (LP,340) NPER,NENTRY
      CALL SULINE (LP,2)
C
C  CHECK IF ANY ENTRIES DEFINED
110   IF (NSTAS.GT.0) GO TO 120
         WRITE (LP,350)
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 205
C
C  CHECK IF ALL ENTRIES TO BE PROCESSED
120   IF (IALL.EQ.0) GO TO 190
C
C  PROCESS ALL VALUES
      MAXVAL=LARRAY/12*2
      DO 160 I=1,12
         CALL RPPCHR (I,LSWORK*2,IWORK(1),NFILL,IERR)
         IF (IERR.EQ.0) GO TO 130
            WRITE (LP,360) IERR
            CALL SULINE (LP,1)
            GO TO 205
130      IF (MAXVAL.GT.NFILL) GO TO 140
            WRITE (LP,370) NFILL,MAXVAL
            CALL SUERRS (LP,2,NUMERR)
            GO TO 205
140      DO 150 N=1,NFILL
            IARRAY(I,N)=IWORK(N)
150         CONTINUE
160      CONTINUE
      WRITE (LP,380)
      CALL SULINE (LP,2)
      WRITE (LP,390)
      CALL SULINE (LP,1)
      DO 180 I=1,NFILL
         DO 170 N=1,12
            PXCHAR(N)=IARRAY(N,I)/100.
170         CONTINUE
         WRITE (LP,400) I,PXCHAR
180      CONTINUE
      GO TO 205
C
C  PRINT VALUES FOR SPECIFIED POINTER
190   CALL RPP1CH (IPCHAR,PXCHAR,IERR)
      IF (IERR.EQ.0) GO TO 200
         IF (IERR.EQ.1) WRITE (LP,410)
         IF (IERR.EQ.2) WRITE (LP,411)
         IF (IERR.EQ.3) WRITE (LP,412) IPCHAR
         IF (IERR.GT.3) WRITE (LP,413) IERR
         CALL SUERRS (LP,2,NUMERR)
         GO TO 10
200   WRITE (LP,420) IPCHAR,PXCHAR
      CALL SULINE (LP,1)
C  CHECK FOR END IF INPUT
205   IF (IENDIN.EQ.0) GO TO 10
C
210   IF (ISTRCE.GT.0) WRITE (IOSDBG,430)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
220   FORMAT (' *** ENTER SMCHAR')
230   FORMAT ('0*--> DUMP STATION CHARACTERISTICS')
240   FORMAT ('0*** ERROR - IN SMCHAR - ',A4,' IS AN INVALID OPTION.')
250   FORMAT (' INPUT FIELD = ',5A4)
260   FORMAT (' NULL FIELD FOUND IN FIELD ',I2)
270   FORMAT ('0*** NOTE - RIGHT PARENTHESES ASSUMED IN FIELD ',
     *   I2,'.')
280   FORMAT ('0*** ERROR - IN SMCHAR - DAIO ERROR AT RECORD ',I5,
     *    ' OF UNIT ',I2,'.')
290   FORMAT ('0*** WARNING - PARAMETER TYPE ',A4,' NOT DEFINED ',
     *   'IN PARAMETRIC DATA BASE.')
300   FORMAT ('0*** WARNING - PARAMETER TYPE ',A4,' DEFINED ',
     *   'IN PARAMETRIC DATA BASE BUT CANNOT BE SPECIFIED FOR ',
     *   'STATIONS.')
310   FORMAT ('0TYPE=',A4,5X,'MAXIMUM STATIONS=',I4,5X,
     *   'STATIONS DEFINED=',I4)
320   FORMAT ('0NUMBER OF WORDS IN CONTROL RECORD=',I2)
330   FORMAT ('0FIRST RECORD=',I4,5X,'LAST SLOT USED=',I4)
340   FORMAT ('0NUMBER OF RECORDS PER ENTRY=',I2,5X,
     *   'NUMBER OF ENTRIES PER STATION=',I2)
350   FORMAT ('0*** WARNING - NO STATION CHARACTERISTICS ARE DEFINED.')
360   FORMAT (' RPPCH CALLED - STATUS CODE=',I2)
370   FORMAT ('0*** ERROR - IN SMCHAR - NUMBER OF STATIONS ',
     *   'DEFINED (',I4,') EXCEEDS MAXIMUM ALLOWED (',I5,').')
380   FORMAT ('0CHARACTERISTICS:  JAN',4X,'FEB',4X,'MAR',4X,'APR',4X,
     *   'MAY',4X,'JUN',4X,'JUL',4X,'AUG',4X,'SEP',4X,'OCT',4X,'NOV',4X,
     *   'DEC')
390   FORMAT (1H )
400   FORMAT (4X,'SLOT ',I4,5X,12(F5.2,2X))
410   FORMAT ('0*** ERROR - DAIO READ ERROR ENCOUNTERED IN ROUTINE ',
     *   'RPP1CH.')
411   FORMAT ('0*** ERROR - CHARACTERISTICS ARE NOT DEFINED IN THE ',
     *   'PREPROCESSOR PARAMETRIC DATA BASE.')
412   FORMAT ('0*** ERROR - INVALID VALUE POINTER TO CHARACTERISTICS ',
     *   ': ',I5)
413   FORMAT ('0*** ERROR - STATUS CODE ',I2,' FROM ROUTINE RPP1CH ',
     *   'NOT RECOGNIZED.')
420   FORMAT (' IPCHAR=',I4,3X,'PXCHAR=',12(F5.2,1X))
430   FORMAT (' *** EXIT SMCHAR')
C
      END
