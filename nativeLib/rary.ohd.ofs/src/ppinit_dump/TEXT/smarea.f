C MODULE SMAREA
C-----------------------------------------------------------------------
C
C  ROUTINE TO OUTPUT AREA PARAMETERS.
C
      SUBROUTINE SMAREA (LARRAY,ARRAY,OUTPUT,UNITS,SUMARY,PLOT,SORT,
     *   NSPACE,NFLD,ISTAT)
C
      CHARACTER*(*) OUTPUT,UNITS,PLOT,SUMARY,SORT
      CHARACTER*4 PARMTP,XTMWT,XSTWT,XMDR
C
      PARAMETER (LCHAR=5,LCHK=5)
      CHARACTER*4 CHAR(LCHAR),CHK(LCHK)
      PARAMETER (MOPTN=8)
      CHARACTER*4 OPTN(MOPTN)/
     *   'ALL ','MAP ','FMAP','MAT ',
     *   'MAPE','MARO','MAPX','    '/
      LOGICAL CFTYPE,PFTYPE
C
      DIMENSION ARRAY(LARRAY)
      DIMENSION ISWORK(1)
      DIMENSION IHEAD(22)
C
C  ARRAYS USED BY MORE THAN ONE AREA PARAMETER TYPE
      CHARACTER*4 AREAID(2),DESCRP(5),BASNID(2)
      
C LC added these mapx parameters to handle multiple basins
C  MAPX PARAMETERS
      PARAMETER (MAXBASN=99)                                   
      CHARACTER *4 BASNID00(MAXBASN*2)
C  MAP PARAMETERS
      CHARACTER*4 FMAPID(2)
      DIMENSION TSTAID(2,100),TSTAWT(100),CTSTA(2,100),CSTAID(2,100)
      DIMENSION CSTAWT(200),CCSTA(2,100)
      DIMENSION ITECHS(5),IPD6(100),IPD24(100),MDRBOX(100),CORMDR(10)
C
C  BASIN PARAMETER ARRAYS
      DIMENSION BDESC(5),XID(2)
C
C  MAT PARAMETER ARRAYS
      DIMENSION TEMPID(2,100),IPDMMT(100),WTMMT(100)
C
C  MAPE PARAMETER ARRAYS
      DIMENSION PEMEAN(12),PECHNG(12),PSTAID(2,5),IPDPTR(5),STAWT(5)
      INCLUDE 'scommon/dimmaro'
C
      DIMENSION UNUSED(10)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
      INCLUDE 'scommon/sufrex'
      INCLUDE 'scommon/suoptx'
      INCLUDE 'scommon/sntwkx'
      INCLUDE 'scommon/sworkx'
      INCLUDE 'scommon/swrk2x'
C
      EQUIVALENCE (SWORK(1),ISWORK(1))
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_dump/RCS/smarea.f,v $
     . $',                                                             '
     .$Id: smarea.f,v 1.6 2002/10/10 15:57:03 dws Exp $
     . $' /
C    ===================================================================
C
C
      IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,790)
         CALL SULINE (IOSDBG,1)
         ENDIF
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('DUMP')
C
      ISTAT=0
C
      ILPFND=0
      IRPFND=0
      NUMERR=0
      NUMWRN=0
      NUMOPT=0
      LOPTN=0
      IALL=0
      IDLIST=0
      LPUNCH=NPUCRD
      CFTYPE=.FALSE.
      IDEFLT=0
      IENDIN=0
      IPAREA=0
C
      MSTWT=100
      MPCPN=100
      MBOX=100
      MTEMP=100
      MPE=5
C
C  SET UP WORK SPACE POINTERS
      IDIV=15
      LWP=LSWRK2/IDIV
C  X:
      IWP1=1
C  Y:
      IWP2=LWP*1+1
C  LAT:
      IWP3=LWP*2+1
C  LON:
      IWP4=LWP*3+1
C  JX:
      IWP5=LWP*4+1
C  JY:
      IWP6=LWP*5+1
C  IY:
      IWP7=LWP*6+1
C  IXB:
      IWP8=LWP*8+1
C  IXE:
      IWP9=LWP*10+1
C  JN:
      IWP10=LWP*14+1
C
      MBPTS=LWP
      MSEGS=LWP
      IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,*) 'IN SMARES -',
     *      ' LSWRK2=',LSWRK2,
     *      ' IDIV=',IDIV,
     *      ' MBPTS=',MBPTS,
     *      ' MSEGS=',MSEGS,
     *      ' '
         CALL SULINE (IOSDBG,1)
         ENDIF   
C
      NMAP=0
      NFMAP=0
      NMAT=0
      NMAPE=0
      NMARO=0
      NMAPX=0
C
C  SET INDICATOR TO REREAD CURRENT FIELD
      ISTRT=-1
C
C  CHECK SORT OPTION
      ISORT=0
      IF (SORT.EQ.'ID') ISORT=1
      IF (SORT.EQ.'DESC') ISORT=2
      IF (ISORT.EQ.1.OR.ISORT.EQ.2) GO TO 10
         WRITE (LP,810) SORT
         CALL SUWRNS (LP,2,NUMWRN)
         ISORT=1
C
C  PRINT HEADER LINE
10    IF (ISLEFT(10).GT.0) CALL SUPAGE
      WRITE (LP,820)
      CALL SULINE (LP,2)
      WRITE (LP,800)
      CALL SULINE (LP,1)
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK FIELDS FOR DUMP AREA OPTIONS
C
20    PFTYPE=CFTYPE
C
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *   CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
      IF (NFLD.EQ.-1) GO TO 90
      IF (LDEBUG.GT.0) THEN
         CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,LCHAR,
     *      CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         ENDIF
      IF (IERR.NE.1) GO TO 30
         IF (LDEBUG.GT.0) THEN
            WRITE (IOSDBG,830) NFLD
            CALL SULINE (IOSDBG,1)
            ENDIF
         GO TO 20
C
30    IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,840) CHAR
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      IF (ILPFND.GT.0.AND.IRPFND.EQ.0) GO TO 40
         GO TO 50
40    WRITE (LP,850) NFLD
      CALL SULINE (LP,2)
      ILPFND=0
      IRPFND=0
50    IF (LLPAR.GT.0) ILPFND=1
C
C  CHECK FOR PARENTHESIS IN FIELD
      IF (LLPAR.GT.0) CALL UFPACK (LCHK,CHK,ISTRT,1,LLPAR-1,IERR)
      IF (LLPAR.EQ.0) CALL UFPACK (LCHK,CHK,ISTRT,1,LENGTH,IERR)
C
      IF (LENGTH.GT.LEN(OPTN(1))) GO TO 70
C
C  CHECK FOR OPTION
      DO 60 IOPTN=1,MOPTN
         CALL SUCOMP (1,CHK,OPTN(IOPTN),IERR)
         IF (IERR.NE.1) GO TO 60
            CFTYPE=.FALSE.
            IF (IOPTN.GT.1) CFTYPE=.TRUE.
            GO TO 100
60       CONTINUE
C
C  CHECK FOR GROUP
70    CALL SUIDCK ('DUMP',CHK,NFLD,0,IKEYWD,IERR)
      IF (IERR.EQ.0) GO TO 80
      GO TO 90
C
C  CHECK FOR COMMAND
80    IF (LATSGN.EQ.0) GO TO 140
C
90    IENDIN=1
      IF (IALL.EQ.1) GO TO 750
      IPAREA=1
      IF (IDLIST.EQ.1) GO TO 730
      GO TO 110
C
C  VALID OPTION FOUND
100   IF (LDEBUG.GT.0) THEN
         WRITE (IOSDBG,860) PFTYPE,CFTYPE,IOPTN
         CALL SULINE (IOSDBG,1)
         ENDIF
      IF (IPAREA.EQ.1) THEN
         CALL SMARE2 (LOPTN,OPTN,NMAP,NFMAP,NMAT,NMAPE,NMARO,NMAPX)
         ENDIF
      IPAREA=0
      IDLIST=0
      NMAP=0
      NFMAP=0
      NMAT=0
      NMAT=0
      IF (PFTYPE.AND.CFTYPE) GO TO 110
         GO TO 120
110      IALL=1
         IPAREA=1
         IDEFLT=1
         WRITE (LP,870) OPTN(LOPTN)
         CALL SULINE (LP,2)
         GO TO 170
120   IF (IOPTN.NE.1) GO TO 130
         IALL=1
         IPAREA=1
         IDEFLT=0
         IF (IOPNWP.EQ.1.AND.NFLD.EQ.1.AND.IENDIN.EQ.0) CALL SUPAGE
         IF (NFLD.EQ.1.AND.IENDIN.EQ.0) CALL SUPCRD
         GO TO 170
130   LOPTN=IOPTN
      IF (LOPTN.GE.2.AND.LOPTN.LE.6) IALL=0
      IF (NFLD.EQ.1) CALL SUPCRD
      IF (IOPNWP.EQ.1.AND.NFLD.EQ.1) CALL SUPAGE
      GO TO 20
C
C  CHECK FOR INVALID DUMP OPTION
140   IF (IALL.EQ.0) GO TO 150
         WRITE (LP,880) CHAR
         CALL SUERRS (LP,2,NUMERR)
         IALL=0
         LOPTN=0
         GO TO 20
C
C  SET AREA IDENTIFIER
150   CFTYPE=.FALSE.
      IF (LENGTH.LE.8) GO TO 160
         WRITE (LP,890) LENGTH,CHAR
         CALL SUWRNS (LP,2,NUMWRN)
160   CALL SUBSTR (CHAR,1,8,AREAID,1)
      IALL=0
      IDLIST=1
      IPAREA=0
      GO TO 180
C
170   IF (NFLD.EQ.1) CALL SUPCRD
      ILPFND=0
      IRPFND=0
C
      GO TO (180,180,180,180,180,180,180),LOPTN
         WRITE (LP,900) OPTN(LOPTN)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
180   IPRERR=0
      IPTR=0
      IPTRNX=0
      NAREA=0
      NUMID=0
      IXSORT=ISORT
C
C  CHECK IF ALL OPTION SPECIFIED OR IF FMAP AREAS TO BE PROCESSED
C  (FMAP AREAS HAVE NO PARAMETER ARRAYS)
      IF (IALL.EQ.0.OR.LOPTN.EQ.3) GO TO 230
C
C  CHECK IF NO AREA TYPE SPECIFIED
      IF (LOPTN.EQ.0) GO TO 230
C
      IF (IXSORT.EQ.0) GO TO 220
         IF (IXSORT.EQ.1.OR.IXSORT.EQ.2) GO TO 190
            IF (LOPTN.NE.2.AND.LOPTN.NE.4.AND.LOPTN.NE.5) GO TO 190
               WRITE (LP,930) SORT,OPTN(LOPTN)
               CALL SUWRNS (LP,2,NUMWRN)
               IXSORT=1
190      ISTATE=0
         IF (IXSORT.EQ.0.OR.IXSORT.EQ.1) NWORDS=2
         IF (IXSORT.EQ.2) NWORDS=5
         MAXID=LSWORK/(NWORDS+1)
         ISWORK(MAXID*NWORDS+1)=1
         IPRMSG=1
         IPRERR=0
         CALL SURIDS (OPTN(LOPTN),IXSORT,MAXID,ISTATE,NWORDS,
     *      ISWORK,ISWORK(MAXID*NWORDS+1),NUMID,
     *      LARRAY,ARRAY,IPRMSG,IPRERR,IERR)
         IF (IERR.EQ.0) GO TO 210
            IF (IERR.NE.2) GO TO 200
               WRITE (LP,950) OPTN(LOPTN)
               CALL SULINE (LP,2)
               GO TO 730
200         WRITE (LP,940)
            CALL SUWRNS (LP,2,NUMWRN)
            IXSORT=0
210      INWFIL=0
C
220   CALL UREPET (' ',AREAID,8)
      IF (IXSORT.EQ.0) IPTR=IPTRNX
      IF (IXSORT.GT.0) IPTR=ISWORK(MAXID*NWORDS+NAREA+1)
C
      IPRNT=IXSORT
C
C  CHECK IF AREA TYPE SPECIFIED
230   IF (LOPTN.GE.2.AND.LOPTN.LE.MOPTN) GO TO 240
         WRITE (LP,910)
         CALL SUERRS (LP,2,NUMERR)
         LOPTN=0
         GO TO 20
C
240   ILOPTN=LOPTN+1
      GO TO (260,250,270,360,460,530,600,670),ILOPTN
250      WRITE (LP,900) OPTN(ILOPTN)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 20
260   WRITE (LP,920)
      CALL SUERRS (LP,2,NUMERR)
      GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  READ MAP AREA PARAMETERS
C
270   CALL SRMAP (IVMAP,AREAID,ITIME,ITMWT,POWER,MSTWT,NSTWT,
     *   ISTWT,MPCPN,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,
     *   TSTAID,TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *   UNUSED,LARRAY,ARRAY,IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 300
         IF (IALL.EQ.0) GO TO 280
            IF (IERR.EQ.6) GO TO 350
            IF (NUMID.GT.0) GO TO 730
               WRITE (LP,1090) OPTN(2)
               CALL SULINE (LP,2)
               GO TO 730
280      IF (IERR.EQ.2) GO TO 290
            NFILL=0
            CALL SRPPST (AREAID,OPTN(2),IPTR,LARRAY,NFILL,IPTRNX,IERR)
            WRITE (LP,1110) OPTN(2),IERR
            CALL SUERRS (LP,2,NUMERR)
            GO TO 730
290      WRITE (LP,1100) OPTN(2),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 730
C
300   IPTR2=0
      CALL SRMAPS (IVMAPS,AREAID,CENTRD,RADINF,IPMAP,NTECH,
     *   IBASN,MSTWT,NSTWT,MPCPN,NPCPN,MBOX,NBOX,ITECHS,IPD6,IPD24,
     *   MDRBOX,CORMDR,UNUSED,LARRAY,ARRAY,IPTR2,IPRERR,IPTRN2,IERR2)
      IF (IERR.EQ.0) GO TO 310
         PARMTP='MAPS'
         NFILL=0
         CALL SRPPST (AREAID,PARMTP,IPTR2,LARRAY,NFILL,IPTRN2,IERR2)
         WRITE (LP,1110) PARMTP,IERR
         CALL SUERRS (LP,2,NUMERR)
         GO TO 730
C
310   IF (BASNID(1).EQ.' '.AND.BASNID(2).EQ.' ') GO TO 320
C
      IPTR3=0
      IPRER3=1
      CALL SRBASN (ARRAY,LARRAY,IVBASN,BASNID,BDESC,
     *   SWRK2(IWP3),SWRK2(IWP4),MBPTS,NBPTS,
     *   AREA,CAREA,ELEV,CENTRD(1),CENTRD(2),MAPFLG,MATFLG,
     *   XID,XID,XID,
     *   MSEGS,NSEGS,SWRK2(IWP7),SWRK2(IWP8),SWRK2(IWP9),LFACTR,
     *   IPTR3,IPTRN3,IPRER3,IERR)
      IF (IERR.GT.0) THEN
         WRITE (LP,1110) 'BASN',IERR
         CALL SUERRS (LP,2,NUMERR)
         ENDIF
C
320   IF (SUMARY.EQ.'NO') GO TO 330
C
C  PRINT SUMARY
C
      IF (NMAP.EQ.0) THEN
         IF (ISLEFT(10).GT.0) CALL SUPAGE
         WRITE (LP,960)
         CALL SULINE (LP,4)
         ENDIF
      IBLLGD=0
      CALL SBLLGD (CLON,CLAT,1,CENTRD(1),CENTRD(2),IBLLGD,IERR)
      CALL SUBLID (BASNID,IERR)
      CALL SUBLID (FMAPID,IERR)
      XTMWT='????'
      IF (ITMWT.EQ.1) XTMWT='PRE'
      IF (ITMWT.EQ.2) XTMWT='D2'
      IF (ITMWT.EQ.3) XTMWT='DP'
      XSTWT='????'
      IF (ISTWT.EQ.1) XSTWT='PRE'
      IF (ISTWT.EQ.2) XSTWT='GRID'
      IF (ISTWT.EQ.3) XSTWT='THIE'
      IF (ISTWT.EQ.4) XSTWT='DP'
      XMDR='????'
      IF (NBOX.EQ.0) XMDR='NMDR'
      IF (NBOX.GT.0) XMDR='MDR'
      IF (NSPACE.EQ.1.AND.ISNWPG(LP).NE.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      IF (NSPACE.EQ.1.AND.ISNWPG(LP).EQ.1) THEN
         WRITE (LP,960)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NMAP+1
      WRITE (LP,970) NUM,AREAID,DESCRP,CLAT,CLON,BASNID,XTMWT,XSTWT,
     *    XMDR,FMAPID
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,960)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 340
C
330   IF (OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SPMAP (IPRNT,IVMAP,IVMAPS,AREAID,ITIME,ITMWT,POWER,NSTWT,
     *      ISTWT,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,TSTAID,
     *      TSTAWT,CTSTA,CSTAID,CSTAWT,CCSTA,
     *      RADINF,IPMAP,NTECH,IBASN,NBOX,ITECHS,IPD6,IPD24,MDRBOX,
     *      CORMDR,UNUSED,
     *      SWRK2(IWP7),SWRK2(IWP8),SWRK2(IWP9),NSEGS,
     *      SWRK2(IWP1),SWRK2(IWP2),SWRK2(IWP5),SWRK2(IWP6),NBPTS,
     *      LFACTR,PLOT,LARRAY,ARRAY,UNITS,AREA,CAREA,SWRK2(IWP10),
     *      IERR)
         ENDIF
C
340   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SCMAP (IVMAP,IVMAPS,AREAID,ITMWT,POWER,NSTWT,
     *      ISTWT,NPCPN,NSETS,DESCRP,BASNID,FMAPID,CENTRD,TSTAID,
     *      TSTAWT,CSTAID,CSTAWT,IBASN,NBOX,CORMDR,IERR)
         ENDIF
C
      NMAP=NMAP+1
350   NAREA=NAREA+1
C
      GO TO 720
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PROCESS FMAP AREA PARAMETERS
C
360   NRDERR=0
      IPRERR=1
      IF (IALL.EQ.0) GO TO 370
         IF (IXSORT.EQ.0.OR.IXSORT.EQ.1) NWORDS=2
         IF (IXSORT.EQ.2) NWORDS=7
         MAXID=LSWORK/NWORDS
         CALL SUGTTS ('FMAP',IXSORT,NWORDS,MAXID,SWORK,NUMID,IERR)
         IF (IERR.GT.0) GO TO 730
         GO TO 380
370   CALL SUDOPN (1,'PRD ',IERR)
      IF (IERR.EQ.0) GO TO 380
         WRITE (LP,980)
         CALL SUERRS (LP,2,NUMERR)
         GO TO 720
C
380   IF (IALL.EQ.1) THEN
         CALL SUBSTR (SWORK((NFMAP+NRDERR)*NWORDS+1),1,8,AREAID,1)
         ENDIF
C
C  CHECK IF TIME SERIES EXISTS
      MAXX=1
      CALL RPRDFH (AREAID,'MAP ',MAXX,IHEAD,NUMX,XBUF,IERR)
      IF (IERR.EQ.0) GO TO 410
         IF (IERR.EQ.1) GO TO 390
            CALL SRPRST ('RPRDFH  ',AREAID,OPTN(3),MAXX,NUMERR,IERR)
            GO TO 400
390      WRITE (LP,1100) OPTN(3),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
400      IF (IALL.EQ.0) GO TO 440
            NRDERR=NRDERR+1
            GO TO 450
C
410   IF (SUMARY.EQ.'NO') GO TO 420
C
C  PRINT SUMARY
C
      IF (NFMAP.EQ.0.AND.ISLEFT(10).GT.0) CALL SUPAGE
      IF (NFMAP.EQ.0) THEN
         WRITE (LP,990)
         CALL SULINE (LP,4)
         ENDIF
      CALL SUBSTR (IHEAD(12),1,4,CLAT,1)
      CALL SUBSTR (IHEAD(13),1,4,CLON,1)
      IF (NSPACE.EQ.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NFMAP+1
      WRITE (LP,1000) NUM,AREAID,(IHEAD(I),I=18,22),CLAT,CLON
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,990)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 430
C
420   IF (OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SPFMAP (AREAID,IPRERR,IERR)
         ENDIF
      IF (IERR.EQ.0) GO TO 430
         IF (IALL.EQ.0) THEN
            WRITE (LP,1120) OPTN(3),AREAID
            CALL SUWRNS (LP,2,NUMWRN)
            ENDIF
         IF (IALL.EQ.1) THEN
            WRITE (LP,1090) OPTN(3)
            CALL SULINE (LP,2)
            ENDIF
         IF (IALL.EQ.0) GO TO 440
            NRDERR=NRDERR+1
            GO TO 450
C
430   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SCFMAP (AREAID,IERR)
         ENDIF
C
      NFMAP=NFMAP+1
440   NAREA=NAREA+1
C
      IF (IALL.EQ.0) GO TO 720
450      IF (NFMAP+NRDERR.GE.NUMID) GO TO 720
            GO TO 380
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PROCESS MAT AREA PARAMETERS
C
460   CALL SRMAT (IVMAT,AREAID,DESCRP,CENTRD,BASNID,ISTWT,POWER,
     *   MTEMP,NTEMP,TEMPID,IPDMMT,WTMMT,UNUSED,LARRAY,ARRAY,
     *   IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 490
         IF (IALL.EQ.0) GO TO 470
            IF (IERR.EQ.6) GO TO 520
            IF (NUMID.GT.0) GO TO 730
               WRITE (LP,1090) OPTN(4)
               CALL SULINE (LP,2)
               GO TO 730
470      IF (IERR.EQ.2) GO TO 480
            NFILL=0
            CALL SRPPST (AREAID,OPTN(4),IPTR,LARRAY,NFILL,IPTRNX,IERR)
            WRITE (LP,1110) OPTN(4),IERR
            CALL SUERRS (LP,2,NUMERR)
            GO TO 730
480      WRITE (LP,1100) OPTN(4),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 730
C
490   IF (SUMARY.EQ.'NO') GO TO 500
C
C  PRINT SUMARY
C
      IF (NMAT.EQ.0.AND.ISLEFT(10).GT.0) CALL SUPAGE
      IF (NMAT.EQ.0) THEN
         WRITE (LP,1010)
         CALL SULINE (LP,4)
         ENDIF
      CALL SUBLID (BASNID,IERR)
      XSTWT='????'
      IF (ISTWT.EQ.1) XSTWT='PRE'
      IF (ISTWT.EQ.2) XSTWT='GRID'
      IF (ISTWT.EQ.3) XSTWT='DP'
      IF (NSPACE.EQ.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NMAT+1
      WRITE (LP,1020) NUM,AREAID,DESCRP,CENTRD(1),CENTRD(2),BASNID,XSTWT
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,1010)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 510
C
500   IF (OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SPMAT (IPRNT,UNITS,IVMAT,AREAID,DESCRP,CENTRD,BASNID,
     *      ISTWT,POWER,NTEMP,TEMPID,IPDMMT,WTMMT,UNUSED,LARRAY,ARRAY,
     *      IERR)
         ENDIF
C
510   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SCMAT (IVMAT,AREAID,DESCRP,CENTRD,BASNID,ISTWT,POWER,
     *      NTEMP,TEMPID,WTMMT,IERR)
         ENDIF
C
      NMAT=NMAT+1
520   NAREA=NAREA+1
C
      GO TO 720
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PROCESS MAPE AREA PARAMETERS
C
530   CALL SRMAPE (IVMAPE,AREAID,DESCRP,CENTRD,ISTWT,POWER,
     *   PEMEAN,PECHNG,MPE,NPE,PSTAID,IPDPTR,STAWT,
     *   UNUSED,LARRAY,ARRAY,IPTR,IPRERR,IPTRNX,IERR)
      IF (IERR.EQ.0) GO TO 560
         IF (IALL.EQ.0) GO TO 540
            IF (IERR.EQ.6) GO TO 590
            IF (NUMID.GT.0) GO TO 730
               WRITE (LP,1090) OPTN(5)
               CALL SULINE (LP,2)
               GO TO 730
540      IF (IERR.EQ.2) GO TO 550
            NFILL=0
            CALL SRPPST (AREAID,OPTN(5),IPTR,LARRAY,NFILL,IPTRNX,IERR)
            WRITE (LP,1110) OPTN(5),IERR
            CALL SUERRS (LP,2,NUMERR)
            GO TO 730
550      WRITE (LP,1100) OPTN(5),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 730
C
560   IF (SUMARY.EQ.'NO') GO TO 570
C
C  PRINT SUMARY
C
      IF (NMAPE.EQ.0.AND.ISLEFT(10).GT.0) CALL SUPAGE
      IF (NMAPE.EQ.0) THEN
         WRITE (LP,1030)
         CALL SULINE (LP,4)
         ENDIF
      IBLLGD=0
      CALL SBLLGD (CLON,CLAT,1,CENTRD(1),CENTRD(2),IBLLGD,IERR)
      XSTWT='????'
      IF (ISTWT.EQ.1) XSTWT='PRE'
      IF (ISTWT.EQ.2) XSTWT='DP'
      IF (NSPACE.EQ.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NMAPE+1
      WRITE (LP,1040) NUM,AREAID,DESCRP,CLAT,CLON,XSTWT
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,1030)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 580
C
570   IF (OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SPMAPE (UNITS,IVMAPE,AREAID,DESCRP,CENTRD,ISTWT,
     *      POWER,PEMEAN,PECHNG,NPE,PSTAID,IPDPTR,STAWT,
     *      UNUSED,IERR)
         ENDIF
C
580   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SCMAPE (UNITS,IVMAPE,AREAID,DESCRP,CENTRD,ISTWT,
     *      POWER,PEMEAN,NPE,PSTAID,STAWT,IERR)
         ENDIF
C
      NMAPE=NMAPE+1
590   NAREA=NAREA+1
C
      GO TO 720
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PROCESS MARO AREA PARAMETERS
C
600   CALL SUBSTR (AREAID,1,8,XMAROI,1)
      INCLUDE 'scommon/callsrmaro'
      IF (IERR.EQ.0) GO TO 630
         IF (IALL.EQ.0) GO TO 610
            IF (IERR.EQ.6) GO TO 660
            IF (NUMID.GT.0) GO TO 730
               WRITE (LP,1090) OPTN(6)
               CALL SULINE (LP,2)
               GO TO 730
610      IF (IERR.EQ.2) GO TO 620
            NFILL=0
            CALL SRPPST (AREAID,OPTN(6),IPTR,LARRAY,NFILL,IPTRNX,IERR)
            WRITE (LP,1110) OPTN(6),IERR
            CALL SUERRS (LP,2,NUMERR)
            GO TO 730
620      WRITE (LP,1100) OPTN(6),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 730
C
630   CALL SUBSTR (XMAROI,1,8,AREAID,1)
C
      IF (SUMARY.EQ.'NO') GO TO 640
C
C  PRINT SUMARY
C
      IF (NMARO.EQ.0.AND.ISLEFT(10).GT.0) CALL SUPAGE
      IF (NMARO.EQ.0) THEN
         WRITE (LP,1050)
         CALL SULINE (LP,4)
         ENDIF
      IF (NSPACE.EQ.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NMARO+1
      WRITE (LP,1060) NUM,AREAID,XDESCR,CENTRD,XSTAID
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,1050)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 650
C
640   IF (OUTPUT.NE.'PRNT'.AND.OUTPUT.NE.'BOTH') GO TO 650
      INCLUDE 'scommon/callspmaro'
C
650   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
         CALL SCMARO (IVMARO,XMAROI,XDESCR,CENTRD,NGRID,
     *      ITSREC,XSTAID,MMDRBX,NMGPA,NMRFRO,
     *      IERR)
         ENDIF
C
      NMARO=NMARO+1
660   NAREA=NAREA+1
C
      GO TO 720
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  PROCESS MAPX AREA PARAMETERS
C
C LC new call to srmapx - numb returns the number of basins
      IPTR=0
      IPRERR=0
      ITIME=1
      NUMB=1
670   CALL SRMAPX (IVMAPX,AREAID,ITIME,DESCRP,BASNID00,FMAPID,   
     *   UNUSED,LARRAY,ARRAY,IPTR,IPRERR,IPTRNX,IERR,NUMB)       

      IF (IERR.GT.0) THEN
         IF (IALL.EQ.1) THEN
            IF (IERR.EQ.6) GO TO 700
            IF (NUMID.EQ.0) THEN
               WRITE (LP,1090) OPTN(6)
               CALL SULINE (LP,2)
               ENDIF
            GO TO 730
            ENDIF
         IF (IERR.EQ.2) GO TO 680
            NFILL=0
            CALL SRPPST (AREAID,OPTN(6),IPTR,LARRAY,NFILL,IPTRNX,IERR)
            WRITE (LP,1110) OPTN(6),IERR
            CALL SUERRS (LP,2,NUMERR)
            GO TO 730
680      WRITE (LP,1100) OPTN(6),AREAID
         CALL SUWRNS (LP,2,NUMWRN)
         GO TO 730
         ENDIF
C
      IF (SUMARY.EQ.'NO') GO TO 690
C
C  PRINT SUMARY
C
      IF (NMAPX.EQ.0.AND.ISLEFT(10).GT.0) CALL SUPAGE
      IF (NMAPX.EQ.0) THEN
         WRITE (LP,1070)
         CALL SULINE (LP,4)
         ENDIF
      IF (NSPACE.EQ.1) THEN
         WRITE (LP,800)
         CALL SULINE (LP,1)
         ENDIF
      NUM=NMAPX+1
      WRITE(LP,*)NUM,AREAID,DESCRP,FMAPID,(BASNID00(I),I=1,8*numb)
      CALL SULINE (LP,1)
      IF (ISNWPG(LP).EQ.1) THEN
         WRITE (LP,1070)
         CALL SULINE (LP,4)
         ENDIF
      GO TO 700
C
690   IF (OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH') THEN

C LC changed call to spmapx for multiple basins
      CALL SPMAPX (IPRNT,IVMAPX,AREAID,DESCRP,ITIME,
     *  BASNID00,FMAPID,UNUSED,IERR,NUMB)
        ENDIF
C
700   IF (OUTPUT.EQ.'PNCH'.OR.OUTPUT.EQ.'BOTH') THEN
C LC changed call to scmapx to handle multiple basins
         CALL SCMAPX (IVMAPX,AREAID,DESCRP,BASNID00,FMAPID,IERR,NUMB)
         ENDIF
C
      NMAPX=NMAPX+1
      NAREA=NAREA+1
C
      GO TO 720
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
720   IF ((OUTPUT.EQ.'PRNT'.OR.OUTPUT.EQ.'BOTH').AND.
     *    IALL.EQ.1.AND.LOPTN.EQ.0) THEN
         WRITE (LP,1130)
         CALL SULINE (LP,1)
         ENDIF
C
C  CHECK IF ALL AREAS OR ALL OF PARAMETER TYPE PROCESSED
      IF (IALL.EQ.0.OR.LOPTN.EQ.3) GO TO 730
         IF (IXSORT.GT.0.AND.NAREA.EQ.NUMID) GO TO 730
         IF (IXSORT.EQ.0.AND.IPTRNX.EQ.0) GO TO 730
         GO TO 220
C
730   NUMOPT=NUMOPT+1
      IF (IPAREA.EQ.0) GO TO 740
C
C  PRINT NUMBER OF AREAS PROCESSED
      CALL SMARE2 (LOPTN,OPTN,NMAP,NFMAP,NMAT,NMAPE,NMARO,NMAPX)
      IPAREA=0
C
740   IF (IENDIN.EQ.1) GO TO 750
C
C  CHECK IF 'ALL' DEFAULTED
      IF (IENDIN.EQ.0.AND.IDEFLT.EQ.1.AND.NFLD.EQ.1) CALL SUPCRD
      IF (IDEFLT.EQ.1) IALL=0
      IF (IDLIST.EQ.0) LOPTN=IOPTN
      GO TO 20
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
C  CHECK NUMBER OF OPTIONS PROCESSED
750   IF (NUMOPT.EQ.0) THEN
         WRITE (LP,1140)
         CALL SULINE (LP,2)
         ENDIF
C
      IF (OUTPUT.EQ.'PRNT') GO TO 770
C
C  PRINT NUMBER OF CARD IMAGES OUTPUT
      NPUNCH=NPUCRD-LPUNCH
      IF (NPUNCH.GT.0) THEN
         WRITE (LP,1150) NPUNCH
         CALL SULINE (LP,2)
         ENDIF
C
C  CHECK NUMBER OF ERRORS ENCOUNTERED
770   IF (NUMERR.GT.0) THEN
         WRITE (LP,1160) NUMERR
         CALL SULINE (LP,2)
         ENDIF
C
      IF (ISTRCE.GT.0) THEN
         WRITE (IOSDBG,1170)
         CALL SULINE (IOSDBG,1)
         ENDIF
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
790   FORMAT (' *** ENTER SMAREA')
800   FORMAT (' ')
810   FORMAT ('0*** WARNING - SORT BY ',A,' NOT AVAILABLE. SORT ',
     *   'OPTION SET TO ID.')
820   FORMAT ('0*--> DUMP AREA PARAMETERS')
830   FORMAT (' BLANK STRING FOUND IN FIELD ',I2)
840   FORMAT (' CHAR = ',5A4)
850   FORMAT ('0*** NOTE - RIGHT PARENTHESIS ASSUMED IN FIELD ',I2,
     *   '.')
860   FORMAT (' PFTYPE=',L1,3X,'CFTYPE=',L1,3X,'IOPTN=',I2)
870   FORMAT ('0*** NOTE - ''ALL'' ASSUMED FOR AREA TYPE ',A4,'.')
880   FORMAT ('0*** ERROR - INVALID DUMP AREA OPTION : ',5A4)
890   FORMAT ('0*** WARNING - NUMBER OF CHARACTERS (',I2,') IN ',
     *   'AREA IDENTIFIER ',5A4,' EXCEEDS 8. THE FIRST 8 ',
     *   'CHARACTERS WILL BE USED.')
900   FORMAT ('0*** ERROR - PROCESSING OPTION : ',A4)
910   FORMAT ('0*** ERROR - NO AREA TYPE (MAP, FMAP, MAT, MAPE OR ',
     *   'MARO) HAS BEEN SPECIFIED.')
920   FORMAT ('0*** ERROR - NO AREA TYPE (MAP, FMAP, MAT, MAPE ',
     *   'OR MARO) SPEFICIED.')
930   FORMAT ('0*** WARNING - SORT BY ',A4,' NOT AVAILABLE FOR ',
     *   A4,' AREAS. SORT OPTION SET TO BY ID.')
940   FORMAT ('0*** WARNING - SORTED LIST OF STATIONS NOT ',
     *   'SUCCESSFULLY OBTAINED. SORT OPTION CANCELLED.')
950   FORMAT ('0*** NOTE - NO ',A4,' AREAS ARE DEFINED.')
960   FORMAT ('0',3X,39X,'CENTROID',6X,'  BASIN   ',3X,'TIMING ',3X,
     *      'STATION',3X,' MDR ',3X,'FUTURE MAP' /
     *   T7,'MAP  ID ',3X,'DESCRIPTION',12X,' LAT  ',2X,' LON  ',3X,
     *      'IDENTIFIER',3X,'WEIGHTS',3X,'WEIGHTS',3X,
     *      'USAGE',3X,'IDENTIFIER' /
     *   T7,8('-'),3X,20('-'),3X,2(6('-'),2X),1X,
     *      10('-'),3X,7('-'),3X,7('-'),3X,5('-'),3X,10('-'))
970   FORMAT (' ',I4,1X,2A4,3X,5A4,3X,2(F6.2,2X),1X,2A4,5X,A4,6X,A4,6X,
     *   A4,4X,2A4)
980   FORMAT ('0*** ERROR - PROCESSED DATA BASE NOT SUCCESSFULLY ',
     *   'OPENED.')
990   FORMAT ('0',3X,39X,'CENTROID' /
     *   T7,'FMAP ID ',3X,'DESCRIPTION',12X,' LAT  ',2X,' LON  ' /
     *   T7,8('-'),3X,20('-'),3X,2(6('-'),2X))
1000  FORMAT (' ',I4,1X,2A4,3X,5A4,3X,2(F6.2,2X))
1010  FORMAT ('0',3X,39X,'CENTROID',6X,'  BASIN   ',3X,'STATION' /
     *   T7,'MAT  ID ',3X,'DESCRIPTION',9X,3X,' LAT  ',2X,' LON  ',3X,
     *      'IDENTIFIER',3X,'WEIGHTS' /
     *   T7,8('-'),3X,20('-'),3X,2(6('-'),2X),1X,
     *      10('-'),3X,7('-'))
1020  FORMAT (' ',I4,1X,2A4,3X,5A4,3X,2(F6.2,2X),1X,2A4,5X,A4)
1030  FORMAT ('0',3X,39X,'CENTROID',6X,'STATION' /
     *   T7,'MAPE ID ',3X,'DESCRIPTION',12X,' LAT  ',2X,' LON  ',3X,
     *      'WEIGHTS' /
     *   T7,8('-'),3X,20('-'),3X,2(6('-'),2X),1X,7('-'))
1040  FORMAT (' ',I4,1X,2A4,3X,5A4,3X,2(F6.2,2X),1X,A4)
1050  FORMAT ('0',3X,39X,'CENTROID',6X,'STATION' /
     *   T7,'MARO ID ',3X,'DESCRIPTION',12X,' LAT  ',2X,' LON  ',3X,
     *      'IDENTIFIER' /
     *   T7,8('-'),3X,20('-'),3X,2(6('-'),2X),1X,10('-'))
1060  FORMAT (' ',I4,1X,2A4,3X,5A4,3X,F6.2,2X,F6.2,3X,2A4)
1070  FORMAT ('0',3X,
     *   T7,'MAPX ID ',3X,'DESCRIPTION',12X,'FMAP ID ',3X,
     *      'BASN ID '/
     *   T7,8('-'),3X,20('-'),3X,8('-'),3X,8('-'))
1080  FORMAT (' ',I4,1X,2A4,3X,5A4,3X,2A4,3X,2A4)
1090  FORMAT ('0*** NOTE - NO ',A4,' AREAS ARE DEFINED.')
1100  FORMAT ('0*** WARNING - ',A4,' PARAMETERS FOR AREA ',2A4,
     *   ' ARE NOT DEFINED.')
1110  FORMAT ('0*** ERROR - IN SMAREA - UNSUCCESSFUL CALL TO SR',A4,
     *   ' : STATUS CODE=',I2)
1120  FORMAT ('0*** WARNING - TIME SERIES FOR ',A4,' AREA ',2A4,
     *   ' IS NOT DEFINED.')
1130  FORMAT (' ',132('#'))
1140  FORMAT ('0*** NOTE - NO DUMP AREA OPTIONS SUCCESSFULLY ',
     *   'PROCESSED.')
1150  FORMAT ('0*** NOTE - ',I4,' CARD IMAGES OUTPUT.')
1160  FORMAT ('0*** NOTE - ',I3,' ERRORS ENCOUNTERED IN DUMP AREA ',
     *   'COMMAND.')
1170  FORMAT (' *** EXIT SMAREA')
C
      END
