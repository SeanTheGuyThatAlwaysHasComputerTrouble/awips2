C MEMBER SWGMDR
C-----------------------------------------------------------------------
C
C                             LAST UPDATE: 03/09/94.07:53:44 BY $WC20SV
C
C @PROCESS LVL(77)
C
C DESC WRITE OR UPDATE MDR BOX GRID POINT ADDRESS (GMDR) PARAMETERS
C
      SUBROUTINE SWGMDR (IVGMDR,MDRWCL,MDRNCL,MDRSRW,MDRNRW,NMDRGP,
     *   UNUSED,LARRAY,ARRAY,IPTR,DISP,ISTAT)
C
      REAL NEW/4HNEW /,OLD/4HOLD /
      REAL*8 BLNK8/8H        /
      INTEGER*2 NMDRGP(42,1)
C
      DIMENSION ARRAY(LARRAY)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_write/RCS/swgmdr.f,v $
     . $',                                                             '
     .$Id: swgmdr.f,v 1.1 1995/09/17 19:16:08 dws Exp $
     . $' /
C    ===================================================================
C
C
C
      IF (ISTRCE.GT.0) WRITE (IOSDBG,110)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('GMDR')
C
      IF (LDEBUG.GT.0) WRITE (IOSDBG,120) IVGMDR,UNUSED,LARRAY
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
      ISTAT=0
C
C  CHECK FOR SUFFICIENT SPACE IN PARAMETER ARRAY
      MINLEN=7+(MDRNCL*MDRNRW+1)/2
      IF (LDEBUG.GT.0) WRITE (IOSDBG,140) MINLEN
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
      IF (MINLEN.LE.LARRAY) GO TO 10
         WRITE (LP,190) LARRAY,MINLEN
         CALL SUERRS (LP,2,-1)
         ISTAT=1
         GO TO 100
C
C  STORE PARAMETER ARRAY VERSION NUMBER
10    ARRAY(1)=IVGMDR+.01
C
C  STORE WESTERN MOST MDR COLUMN FOR WHICH GMDR PARAMETERS DEFINED
      ARRAY(2)=MDRWCL+.01
C
C  STORE NUMBER OF MDR COLUMNS
      ARRAY(3)=MDRNCL+.01
C
C  STORE SOUTHERN MOST MDR ROW
      ARRAY(4)=MDRSRW+.01
C
C  STORE NUMBER OF MDR ROWS
      ARRAY(5)=MDRNRW+.01
C
C  POSITIONS 6 AND 7 UNUSED
      ARRAY(6)=UNUSED
      ARRAY(7)=UNUSED
C
      NPOS=8
C
C  STORE GRID POINT ADDRESS OF GRID POINT NEAREST CENTROID OF MDR BOX
      ICOL=MDRWCL
      NCOL=MDRNCL
      LCOL=ICOL+NCOL-1
      IROW=MDRSRW
      NROW=MDRNRW
      LROW=IROW+NROW-1
      IPOS=0
      DO 70 IR=IROW,LROW
         DO 70 IC=ICOL,LCOL
            IVAL=NMDRGP(IC-ICOL+1,IR)
            IPOS=IPOS+1
            CALL SUI4I2 (IVAL,1,ARRAY(NPOS),IPOS,LDEBUG)
70          CONTINUE
      NPOS=NPOS+(IPOS+1)/2
C
C  WRITE PARAMETER RECORD TO FILE
      IF (LDEBUG.GT.0) WRITE (IOSDBG,130) NPOS
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
      IPTR=0
      CALL SUDOPN (1,'PPP ',IERR)
      CALL WPPREC (BLNK8,'GMDR',NPOS,ARRAY,IPTR,IERR)
      IF (IERR.EQ.0) GO TO 80
         CALL SWPPST (BLNK8,'GMDR',NPOS,IPTR,IERR)
         WRITE (LP,200) IERR
         CALL SUERRS (LP,2,-1)
         ISTAT=3
C
80    IF (LDEBUG.EQ.0) GOTO 90
         CALL SUPDMP ('GMDR','BOTH',0,NPOS,ARRAY,ARRAY)
         CALL SUPDMP ('GMDR','INT2',0,NPOS,ARRAY,ARRAY)
C
90    IF (ISTAT.EQ.0.AND.DISP.EQ.NEW) WRITE (LP,210)
      IF (ISTAT.EQ.0.AND.DISP.EQ.NEW) CALL SULINE (LP,2)
      IF (ISTAT.EQ.0.AND.DISP.EQ.OLD) WRITE (LP,220)
      IF (ISTAT.EQ.0.AND.DISP.EQ.OLD) CALL SULINE (LP,2)
      IF (ISTAT.EQ.0) CALL SUDWRT (1,'PPP ',IERR)
      IF (ISTAT.GT.0.AND.DISP.EQ.NEW) WRITE (LP,230)
      IF (ISTAT.GT.0.AND.DISP.EQ.NEW) CALL SULINE (LP,2)
      IF (ISTAT.GT.0.AND.DISP.EQ.OLD) WRITE (LP,240)
      IF (ISTAT.GT.0.AND.DISP.EQ.OLD) CALL SULINE (LP,2)
C
100   IF (ISTRCE.GT.0) WRITE (IOSDBG,250)
      IF (ISTRCE.GT.0) CALL SULINE (IOSDBG,1)
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
110   FORMAT (' *** ENTER SWGMDR')
120   FORMAT (' IVGMDR=',I2,3X,'UNUSED=',F7.2,3X,'LARRAY=',I5)
130   FORMAT (' NPOS=',I5)
140   FORMAT (' MINLEN=',I5)
190   FORMAT ('0*** ERROR - IN SWGMDR - NOT ENOUGH SPACE IN PARAMETER ',
     *   'ARRAY: NUMBER OF WORDS IN PARAMETER ARRAY=',I5,3X,
     *   'NUMBER OF WORDS NEEDED=',I5)
200   FORMAT ('0*** ERROR - IN SWGMDR - UNSUCCESSFUL CALL TO WPPREC : ',
     *   'STATUS CODE=',I3)
210   FORMAT ('0*** NOTE - GMDR PARAMETERS SUCCESSFULLY WRITTEN.')
220   FORMAT ('0*** NOTE - GMDR PARAMETERS SUCCESSFULLY UPDATED.')
230   FORMAT ('0*** NOTE - GMDR PARAMETERS NOT SUCCESSFULLY ',
     *   'WRITTEN.')
240   FORMAT ('0*** NOTE - GMDR PARAMETERS NOT SUCCESSFULLY ',
     *   'UPDATED.')
250   FORMAT (' *** EXIT SWGMDR')
C
      END
