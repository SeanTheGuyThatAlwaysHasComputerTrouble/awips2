C MEMBER SWMAPS
C-----------------------------------------------------------------------
C
C                             LAST UPDATE: 03/09/94.11:24:38 BY $WC20SV
C
C @PROCESS LVL(77)
C
C DESC WRITE OR UPDATE AREA MAPS PARAMETER RECORD
C
      SUBROUTINE SWMAPS (IVMAPS,XMAPID,CENTRD,RADINF,IPMAP,NTECH,
     *   IBASN,NSTWT,NPCPN,NBOX,ITECHS,IPD6,IPD24,MDRBOX,CORMDR,
     *   UNUSED,LARRAY,ARRAY,IPTR,DISP,NSPACE,ISTAT)
C
      REAL XNEW/4HNEW /
      REAL XOLD/4HOLD /
C
      DIMENSION ARRAY(LARRAY)
      DIMENSION XMAPID(2),CENTRD(*)
      DIMENSION ITECHS(*),IPD6(*),IPD24(*),MDRBOX(*),CORMDR(*)
      DIMENSION UNUSED(1)
C
      INCLUDE 'uio'
      INCLUDE 'scommon/sudbgx'
      INCLUDE 'scommon/suoptx'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/ppinit_write/RCS/swmaps.f,v $
     . $',                                                             '
     .$Id: swmaps.f,v 1.1 1995/09/17 19:16:13 dws Exp $
     . $' /
C    ===================================================================
C
C
      IF (ISTRCE.GT.1) WRITE (IOSDBG,140)
      IF (ISTRCE.GT.1) CALL SULINE (IOSDBG,1)
C
C  SET DEBUG LEVEL
      LDEBUG=ISBUG('MAPS')
C
      IF (LDEBUG.GT.0) WRITE (IOSDBG,160) IVMAPS,UNUSED,LARRAY
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
C
      ISTAT=0
      NUMERR=0
C
C  CHECK FOR SUFFICIENT SPACE IN PARAMETER ARRAY
      MINLEN=13+NTECH+NSTWT+NPCPN+NBOX+IBASN*8
      IF (LDEBUG.GT.0) WRITE (IOSDBG,180) MINLEN
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
      IF (MINLEN.LE.LARRAY) GO TO 10
         WRITE (LP,190) LARRAY,MINLEN
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=1
         GO TO 130
C
C  STORE PARAMETER ARRAY VERSION NUMBER
10    ARRAY(1)=IVMAPS+.01
C
C  STORE MAPS AREA IDENTIFIER
      ARRAY(2)=XMAPID(1)
      ARRAY(3)=XMAPID(2)
C
      NPOS=3
C
C  STORE CENTROID (NWSRFS/HRAP COORDINATES)
      DO 20 I=1,2
         NPOS=NPOS+1
         ARRAY(NPOS)=CENTRD(I)
20       CONTINUE
C
C  STORE RADIUS OF INFLUENCE (NWSRFS/HRAP COORDINATES)
      NPOS=NPOS+1
      ARRAY(NPOS)=RADINF
C
C  STORE POINTER TO MAP AREA PARAMETER RECORD
      NPOS=NPOS+1
      ARRAY(NPOS)=IPMAP+.01
C
C  STORE NUMBER OF WORDS RESERVED FOR NON-UNIVERSAL HCL TECNIQUES
      NPOS=NPOS+1
      ARRAY(NPOS)=NTECH+.01
C
C  THE NEXT POSITION IS UNUSED
      NPOS=NPOS+1
      ARRAY(NPOS)=UNUSED(1)
C STORE INDICATOR WHETHER BASIN BOUNDARY IS DEFINED IN MAP
C  PARAMETER RECORD
      NPOS=NPOS+1
      ARRAY(NPOS)=IBASN+.01
C
C  STORE NUMBER OF STATIONS USED FOR TIME DISTRIBUTION
      NPOS=NPOS+1
      ARRAY(NPOS)=NSTWT+.01
C
C  STORE NUMBER OF STATIONS USED TO COMPUTE MAP
      NPOS=NPOS+1
      ARRAY(NPOS)=NPCPN+.01
C
C  STORE NUMBER OF MDR BOXES FOR THIS AREA
      NPOS=NPOS+1
      ARRAY(NPOS)=NBOX+.01
C
C  STORE VALUES OF NON-UNIVERSAL TECHNIQUES
      DO 30 I=1,NTECH
         NPOS=NPOS+1
         ARRAY(NPOS)=ITECHS(I)+.01
30       CONTINUE
C
C  STORE ARRAY LOCATION OF POINTERS FOR 6 HR STATIONS USED FOR TIMING
      DO 40 I=1,NSTWT
         NPOS=NPOS+1
         ARRAY(NPOS)=IPD6(I)+.01
40       CONTINUE
C
C  STORE ARRAY LOCATION OF POINTERS FOR 24 HR STATIONS USED TO
C  COMPUTE MAP
      DO 50 I=1,NPCPN
         NPOS=NPOS+1
         ARRAY(NPOS)=IPD24(I)+.01
50       CONTINUE
C
      IF (IVMAPS.GT.1.AND.NBOX.EQ.0) GO TO 70
C
C  STORE MDR BOXES ASSIGNED TO THIS AREA
      DO 60 I=1,NBOX
         NPOS=NPOS+1
         ARRAY(NPOS)=MDRBOX(I)+.01
60       CONTINUE
C
70    IF (IBASN.EQ.1) GO TO 90
C
C  STORE LATITUDE/LOGITUDE PAIRS DEFINING SUBSET OF MDR GRID
      DO 80 I=1,8
         NPOS=NPOS+1
         ARRAY(NPOS)=CORMDR(I)
80       CONTINUE
C
C  WRITE PARAMTER RECORD TO FILE
90    IF (LDEBUG.GT.0) WRITE (IOSDBG,170) NPOS
      IF (LDEBUG.GT.0) CALL SULINE (IOSDBG,1)
      CALL SUDOPN (1,'PPP ',IERR)
      IPTR=0
      CALL WPPREC (XMAPID,'MAPS',NPOS,ARRAY,IPTR,IERR)
      IF (IERR.EQ.0) GO TO 100
         CALL SWPPST (XMAPID,'MAPS',NPOS,IPTR,IERR)
         WRITE (LP,200) IERR
         CALL SUERRS (LP,2,NUMERR)
         ISTAT=3
C
100   IF (LDEBUG.GT.0) CALL SUPDMP ('MAPS','BOTH',0,NPOS,ARRAY,ARRAY)
C
      IF (ISTAT.GT.0) GO TO 120
C
C  CHECK MESSAGE LEVEL VALUE
      IF (IOPMLV.LE.1) GO TO 110
C
      IF (NSPACE.EQ.1) WRITE (LP,150)
      IF (NSPACE.EQ.1) CALL SULINE (LP,1)
      IF (DISP.EQ.XNEW) WRITE (LP,210) XMAPID
      IF (DISP.EQ.XOLD) WRITE (LP,220) XMAPID
      CALL SULINE (LP,1)
110   CALL SUDWRT (1,'PPP ',IERR)
      GO TO 130
C
120   IF (DISP.EQ.XNEW) WRITE (LP,230) XMAPID
      IF (DISP.EQ.XOLD) WRITE (LP,240) XMAPID
      CALL SULINE (LP,2)
C
130   IF (ISTRCE.GT.1) WRITE (IOSDBG,250)
      IF (ISTRCE.GT.1) CALL SULINE (IOSDBG,1)
C
      RETURN
C
C- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C
140   FORMAT (' *** ENTER SWMAPS')
150   FORMAT (1H )
160   FORMAT (' IVMAPS=',I2,3X,'UNUSED=',F7.2,3X,'LARRAY=',I5)
170   FORMAT (' NPOS=',I2)
180   FORMAT (' MINLEN=',I3)
190   FORMAT ('0*** ERROR - IN SWMAPS - NOT ENOUGH SPACE IN PARAMETER ',
     *   'ARRAY: NUMBER OF WORDS IN PARAMETER ARRAY=',I5,3X,
     *   'NUMBER OF WORDS NEEDED=',I5)
200   FORMAT ('0*** ERROR - IN SWMAPS - UNSUCCESSFUL CALL TO WPPREC : ',
     *   'STATUS CODE=',I3)
210   FORMAT (' *** NOTE - MAPS PARAMETERS SUCCESSFULLY ',
     *   'WRITTEN FOR AREA ',2A4,'.')
220   FORMAT (' *** NOTE - MAPS PARAMETERS SUCCESSFULLY ',
     *   'UPDATED FOR AREA ',2A4,'.')
230   FORMAT ('0*** NOTE - MAPS PARAMETERS NOT SUCCESSFULLY ',
     *   'WRITTEN FOR AREA ',2A4,'.')
240   FORMAT ('0*** NOTE - MAPS PARAMETERS NOT SUCCESSFULLY ',
     *   'UPDATED FOR AREA ',2A4,'.')
250   FORMAT (' *** EXIT SWMAPS')
C
      END
