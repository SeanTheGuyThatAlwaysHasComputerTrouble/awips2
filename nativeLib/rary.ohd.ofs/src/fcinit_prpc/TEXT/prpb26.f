C MEMBER PRPB26
C  (from old member FCPRPB26)
C
      SUBROUTINE PRPB26(PO,LP,LT)
C
C***********************************************************************
C
C     STAGE AND POOL ELEVATION CONTROLLED OUTFLOW COMPUTATIONAL SCHEME
C
      DIMENSION PO(*),X(365),Y(365),IDAY(365),ANAME(5),ITRIB(2)
      COMMON/IONUM/IN,IPR,IPU
      COMMON/CNVP26/CONV1,CONV2,CONV3,CONV4,CONV5,UNT1,UNT2,UNT3,UNT4,
     .         UNT5
      COMMON/FATLGK/IATL,C1,C2
      LOGICAL FOP7
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcinit_prpc/RCS/prpb26.f,v $
     . $',                                                             '
     .$Id: prpb26.f,v 1.6 1999/04/22 14:58:02 page Exp $
     . $' /
C    ===================================================================
C
C
      DATA BLANK/4H    /
C
      NGAGEX=ABS(PO(LP))
      NGAGES=NGAGEX
C
C  SET UP TRIBUTARY CONTROL INDICATOR IF USED
C  = 0, D/S FLOW CONDITION CONTROL, =1, TRIBUTARY CONTROL
      ITRIB(1)=0
      ITRIB(2)=0
      IF(NGAGEX.GT.2) THEN
         NGAGES=NGAGEX/100
         DUM=PO(LP)-NGAGES*100
         ITRIB(1)=DUM/10
         ITRIB(2)=DUM-ITRIB(1)*10
      ENDIF
      LO=LP+1
      MINODT=PO(7)
      NTIM24=24/MINODT
      IDT=NTIM24
      IDA=PO(LO)
      LO=LO+1
      IF(IDA.EQ.0)WRITE(IPR,1710)
      IF(IDA.EQ.1)WRITE(IPR,1712)
 1710 FORMAT(1H0,25X,30HPERIOD RELEASE SPECIFICATIONS:)
 1712 FORMAT(1H0,25X,29HDAILY RELEASE SPECIFICATIONS:)
      NLO = 0
      IF (IDA .EQ. 0) GO TO 171
      DO 172 J=1,IDT
 172  X(J)=PO(LO+J-1)
      WRITE(IPR,1702)
 1702 FORMAT(1H0,20X,24HDAILY DISTRIBUTION CURVE)
      WRITE(IPR,1704)(X(J),J=1,IDT)
 1704 FORMAT(1H0,25X,16F6.3)
      NLO = IDT
 171  CONTINUE
      LO = LO + NLO
      WRITE(IPR,1706)NGAGES
 1706 FORMAT(1H0,20X,50HNUMBER OF GAGES
     1 =,I8)
C
      LTX=LT
      IADD=0
ccc      DO 174 IG=1,NGAGES
      DO 500 IG=1,NGAGES
      IF(ITRIB(IG).EQ.0) WRITE(IPR,1708) IG
 1708 FORMAT(1H0,20X,5HGAGE ,I1,2X,
     & 'CONTROL IS AT DOWNSTREAM')
      IF(ITRIB(IG).EQ.1) WRITE(IPR,1709) IG
 1709 FORMAT(1H0,20X,5HGAGE ,I1,2X,
     & 'CONTROL IS AT TRIBUTARY')
      LAG=PO(LO)
      ANAME(1)=PO(LO+1)
      ANAME(2)=PO(LO+2)
      CNV=CONV2
      UNT=UNT2
      JK=1
      WRITE(IPR,1714)LAG
 1714 FORMAT(1H0,25X,50HNO. OF HOURS IN FUTURE TO CHECK STAGE
     1 =,I8)
      IF(ANAME(1).EQ.BLANK.AND.ANAME(2).EQ.BLANK)GO TO 1717
      WRITE(IPR,1716)ANAME(1),ANAME(2)
 1716 FORMAT(1H0,25X,50HRATING CURVE NAME
     1 =,1X,2A4)
      CNV=CONV1
      UNT=UNT1
      JK=0
 1717 LO=LO+3

      NREL=PO(LO)
      LO=LO+1
      DO 175 J=1,NREL
      NPAIR=PO(LO)/2.0
      WRITE(IPR,1718)J
 1718 FORMAT(1H0,25X,16HCONTROL SCHEDULE,I2,1H:,/)
      DO 176 K=1,NPAIR
 176  X(K)=PO(LO+K)*CNV
      LO=LO+NPAIR
      DO 177 K=1,NPAIR
      Y(K)=PO(LO+K)
 177  IF(Y(K).GE.0) Y(K)=Y(K)*CONV2
      LO=LO+NPAIR
      JB=1
      JE=NPAIR
      IF(JE.GT.8)JE=8
 178  IF(JK.EQ.0)WRITE(IPR,1720)UNT,(X(L),L=JB,JE)
 1720 FORMAT(1H ,25X,6HSTAGE(,A4,1H),4X,8F11.2)
      IF(JK.EQ.1)WRITE(IPR,1722)UNT,(X(L),L=JB,JE)
 1722 FORMAT(1H ,25X,6HDISCH(,A4,1H),4X,8F11.2)
 1725 FORMAT(1H ,25X,6H RLSE(,A4,1H),4X,8F11.2)
      WRITE(IPR,1725)UNT2,(Y(L),L=JB,JE)
      IF(JE.GE.NPAIR)GO TO 179
      JB=JE+1
      JE=JE+8
      IF(JE.GT.NPAIR)JE=NPAIR
      GO TO 178
 179  LO = LO + 1
 175  CONTINUE
C
      NRISE=PO(LO)
      WRITE(IPR,1723)
 1723 FORMAT(1H0,25X,22HRISING STAGE RELATION:)
      DO 1750 J=1,NRISE
      Y(J)=PO(LO+J)
      IF(Y(J).GT.0.)Y(J)=Y(J)*CONV1
 1750 CONTINUE
      LO=LO+NRISE
      DO 1752 J=1,NRISE
 1752 IDAY(J)=PO(LO+J)
      LO=LO+NRISE+1
      JB=1
      JE=NRISE
      IF(JE.GT.8)JE=8
 1754 WRITE(IPR,1724)UNT1,(Y(J),J=JB,JE)
      WRITE(IPR,1726)(IDAY(J),J=JB,JE)
 1724 FORMAT(1H0,25X,5HELEV(,A4,1H),5X,8F11.2)
 1726 FORMAT(1H ,25X,8HRELATION,7X,8I11)
      IF(JE.GE.NRISE)GO TO 1756
      JB=JE+1
      JE=JE+8
      IF(JE.GT.NRISE)JE=NRISE
      GO TO 1754
 1756 CONTINUE
C
      NFALL=PO(LO)
      IF(NFALL.LE.0)GO TO 1764
      WRITE(IPR,1727)
 1727 FORMAT(1H0,25X,23HFALLING STAGE RELATION:)
      DO 1758 J=1,NFALL
      Y(J)=PO(LO+J)
      IF(Y(J).GT.0.)Y(J)=Y(J)*CONV1
 1758 CONTINUE
      LO=LO+NFALL
      DO 1760 J=1,NFALL
 1760 IDAY(J)=PO(LO+J)
      LO=LO+NFALL
      JB=1
      JE=NFALL
      IF(JE.GT.8)JE=8
 1762 WRITE(IPR,1724)UNT1,(Y(J),J=JB,JE)
      WRITE(IPR,1726)(IDAY(J),J=JB,JE)
      IF(JE.GE.NFALL)GO TO 1764
      JB=JE+1
      JE=JE+8
      IF(JE.GT.NFALL)JE=NFALL
      GO TO 1762
 1764 LO=LO+1
C
      IF(IG.EQ.2)GO TO 1776
      NRULE=PO(LO)
      IF(NRULE.EQ.0)GO TO 1775
      WRITE(IPR,1728)
 1728 FORMAT(1H0,25X,16HRULECURVE VALUES)
      MOVE=0
      NLOC=LO
      IF(NRULE.GT.0)GO TO 1766
      MOVE=1
      LO=-1*NRULE+PO(10)-1
      NRULE=PO(LO)
 1766 DO 1768 J=1,NRULE
 1768 IDAY(J)=PO(LO+J)
      LO=LO+NRULE
      DO 1770 J=1,NRULE
 1770 Y(J)=PO(LO+J)*CONV1
      LO=LO+NRULE+1
      JB=1
      JE=NRULE
      IF(JE.GT.8)JE=8
 1772 WRITE(IPR,825)(IDAY(J),J=JB,JE)
      WRITE(IPR,830)UNT1,(Y(J),J=JB,JE)
      IF(JE.GE.NRULE)GO TO 1774
      JB=JE+1
      JE=JE+8
      IF(JE.GT.NRULE)JE=NRULE
      GO TO 1772
 1774 ITIME=PO(LO)
      IF(ITIME.LT.0) ITIME=0
c      IF(MOVE.EQ.1) LO=NLOC
C      IF(ITIME.GE.0) WRITE(IPR,1730)ITIME
      WRITE(IPR,1730)ITIME
 1730 FORMAT(1H0,25X,50HTIME OF HYDROLOGIC DAY RULECURVE IS SET
     1 =,I8,6H HOURS)
      NTIMES=1
      QLIMRL=-999.0
      IF(MOVE.EQ.1) THEN
        NTIMES=PO(LO+1)
        IF(PO(LO+2).GE.0.0) QLIMRL=PO(LO+2)*CONV2
        LO=NLOC
      ENDIF
      IF(NGAGEX.LE.2) GO TO 1775
      WRITE(IPR,1740)NTIMES
 1740 FORMAT(1H0,25X,50HNO OF PERIODS TO BLEND BACK INTO RULECURVE
     1 =,I8)
      IF(QLIMRL.LE.-999.0) THEN
      WRITE(IPR,1741)
 1741 FORMAT(1H0,25X,'MAXIMUM ALLOWABLE OUTFLOW TO FOLLOW RULECURVE= ',
     1 'NO LIMIT')
      ELSE
      WRITE(IPR,1742) QLIMRL,UNT2
 1742 FORMAT(1H0,25X,'MAXIMUM ALLOWABLE OUTFLOW TO FOLLOW RULECURVE= ',
     1 F10.1,1X,A4)
      ENDIF
C
 1775 LO=LO+1
 1776 NLK=PO(LO)
      LO=LO+1
      DO 1778 JK=1,NLK
      WRITE(IPR,1732)JK,IG
 1732 FORMAT(1H0,25X,18HLAG/K DEFINITION #,I2,11H FOR GAGE #,I2)
      CALL PRP7(PO(LO))
      LR=LO+15
      NUMLGK = PO(LR)
      LOCK1 = PO(LR+2) + LO - 1
      LOCK2 = LOCK1+1
      IATL = 1
      IF(PO(LO-1 + 11) .GT. 0.0)IATL = 0
      IF(.NOT.FOP7(PO(LOCK1),PO(LOCK2)).OR.IATL.EQ.0) GO TO 1778
      NV7LK = PO(LO+NUMLGK)
      NV72LK= PO(LO+NUMLGK+1+2*NV7LK)
      NUMLGK = NUMLGK + 2 + 2*NV7LK + 2*NV72LK
 1778 LO = LO + NUMLGK
ccc  174 CONTINUE
C
C     PRINT TIME SERIES
      LTX=LTX+IADD
      IADD=2
      IF(PO(LTX).EQ.BLANK)GO TO 500
      IADD=5
      IT=PO(LTX+3)
      WRITE(IPR,795)
      WRITE(IPR,798) PO(LTX),PO(LTX+1),PO(LTX+2),IT
      if(ig.ge.1) go to 500
      IWRIT=0
      IF(PO(LT).EQ.BLANK)GO TO 1780
      IT=PO(LT+3)
      WRITE(IPR,795)
      WRITE(IPR,798) PO(LT),PO(LT+1),PO(LT+2),IT
      IWRIT=1
      LTX=LT+5
      IT=PO(LTX+3)
      GO TO 1782
 1780 LTX=LT+2
      IT=PO(LTX+3)
 1782 IF(NGAGES.LE.1)GO TO 1785
      IF(PO(LTX).EQ.BLANK)GO TO 1785
      IF(IWRIT.EQ.0)WRITE(IPR,795)
      WRITE(IPR,798)PO(LTX),PO(LTX+1),PO(LTX+2),IT
 1785 CONTINUE
C
 500  CONTINUE
 740  FORMAT(1H0,10X,37HLINEAR INTERPOLATION IS USED IN CURVE)
 742  FORMAT(1H0,10X,42HLOGARITHMIC INTERPOLATION IS USED IN CURVE)
 795  FORMAT(1H0,20X,64HLOCAL FLOW TIME SERIES:         ID         TYPE
     1        TIME(HR))
  798 FORMAT(1H ,52X,2A4,3X,A4,11X,I2)
 820  FORMAT(1H0,20X,16HRULECURVE VALUES)
 825  FORMAT(1H0,25X,10HJULIAN DAY,8I11)
 830  FORMAT(1H ,25X,5HELEV(,A4,1H),8F11.2)
 832  FORMAT(1H0,20X,50HTIME OF DAY RULE CURVE IS SET
     1 -,I8)
 862  FORMAT(1H0,20X,21HSPILLWAY RATING CURVE)
 864  FORMAT(1H0,25X,5HELEV(,A4,1H),1X,8F11.2)
 866  FORMAT(1H ,25X,6HDISCH(,A4,1H),8F11.2)
 874  FORMAT(1H0,20X,23HHEAD VS DISCHARGE CURVE)
 876  FORMAT(1H0,25X,5HHEAD(,A4,1H),1X,8F11.2)
 877  FORMAT(1H ,25X,6HDISCH(,A4,1H),8F11.2)
 872  FORMAT(1H0,20X,30HTAILWATER RATING CURVE NAME - ,2A4)
      RETURN
      END
