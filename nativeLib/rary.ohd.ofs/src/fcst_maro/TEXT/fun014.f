C MODULE FUN014
C-----------------------------------------------------------------------
C
C MODULE FUN014
C
      SUBROUTINE FUN014
C
C.....THIS IS THE MAIN DRIVER ROUTINE FOR THE WGRFC MARO FUNCTION.
C
C.....THIS ROUTINE RECEIVES TECHNIQUE AND ARGUMENT VALUES FROM CALLS
C.....TO THE HCL PROCESSING ROUTINES. THE VALUES PASSED TO THE VARIOUS
C.....VARIABLES FROM HCL ARE THEN STORED IN THE APPROPRIATE COMMON
C.....BLOCKS...AND CONTROL IS PASSED TO THE MARO CONTROLLER ROUTINE.
C
C.....ORIGINALLY WRITTEN BY:
C
C.....JERRY M. NUNN     WGRFC, FT. WORTH, TEXAS     MARCH 21, 1988
C
C.....VERSION 1.1     NOVEMBER 1, 1989     JERRY M. NUNN
C
C.....SIZE OF "X" ARRAY EXPANDED FROM 19000 FULLWORDS TO 20000
C.....FULLWORDS IN ORDER TO ACCOMODATE A 3000-STATION NETWORK.  OLD
C.....LOCAL COMMON BLOCK "GCOMMON.X" ELIMINATED FROM CODE. ALL THE
C.....FUNDAMENTAL HYDROLOGIC DATA ARRAYS...APIG...PG24...W6...GP6 ARE
C.....NOW BEING PASSED TO THE PROCESSING ROUTINES VIA COMMON BLOCKS.
C
C.....NEW TECHNIQUE "APISET" ADDED ALSO. APISET INITIALIZES ALL APIG
C.....VALUES TO A GIVEN NUMBER.
C
C
C.....SEVERAL CHANGES MADE WITH THIS REVISION:
C
C.....(1)  TECHNIQUE 'PP24TIME' IMPLEMENTED SO PARTIAL DAY REPORTS CAN
C.....BE REMOVED FROM OPERATIONAL PROCESSING AT THE DISCRETION OF THE
C.....FORECASTER.
C.....(2)  WARNING MESSAGES GENERATED IN ROUTINE GLST6 IMPROVED SO
C.....THE STATION NAME AND CALL LETTERS APPEAR...IN ADDITION TO THE
C.....ARRAY LOCATION.
C
C.....VERSION 2.0      OCTOBER 1, 1991         JERRY M. NUNN
C
C.....MAJOR CHANGE IN ESTIMATION ALGORITHM MADE WITH THIS SOFTWARE
C.....UPDATE.
C
C.....PROGRAM NO LONGER LOOKS AT ALL 90 ELEMENTS OF SEARCH MATRIX
C.....WHEN LOOKING FOR ESTIMATION GRID POINTS. PROGRAM NOW DOES A
C.....SEQUENTIAL SEARCH OF ADJACENT GRID POINTS...BEGINNING WITH
C.....THE CLOSEST...AND BUILDS A GRID ADDRESS TO SEARCH FOR THE
C.....PRECIPITATION IN. SEARCH CONTINUES UNTIL ALL NEEDED OBSERVATIONS
C.....ARE FOUND...OR UNTIL THE SEARCH DISTANCE EXCEEDS THE DISTANCE
C.....LIMIT.
C
C.....WITH THIS UPDATE...ROUTINES GCTRL, GESTMT, AND GPPEST WERE
C.....MODIFIED. NEW INTEGER FUNCTION NFGRD WAS WRITTEN...AND
C.....ROUTINE GSQUAD WAS REMOVED FROM THE SOFTWARE.
C
      INCLUDE 'gcommon/explicit'
      DIMENSION SNAME(2)
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/where'
      INCLUDE 'common/errdat'
      INCLUDE 'common/pudbug'
      INCLUDE 'common/killcd'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_maro/RCS/fun014.f,v $
     . $',                                                             '
     .$Id: fun014.f,v 1.2 2002/02/11 20:43:16 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA SNAME /4HFUN0, 4H14  /
C
  900 FORMAT(1H0, '*** ROUTINE FUN014 ENTERED ***')
  901 FORMAT(1H0, '*** EXIT ROUTINE FUN014 ***')
  902 FORMAT(1H0, '*** MARO FUNCTION TERMINATED WITH ERROR(S) ***')
C
C
      INCLUDE 'gcommon/setwhere'
C
C.....INITIALIZE ERROR AND WARNING COUNT...MAKE SURE ALL FILES ARE
C.....PROPERLY CLOSED.
C
      NWARN = 0
      NERRS = 0
C
C.....NOW GET TECHNIQUE VALUES FOR THOSE TECHNIQUES FOR WHICH WE MUST
C.....TECHNIQUE VALUES RIGHT NOW.
C
      IOUNT=0
      IF (IOUNT.EQ.1) THEN
C
C.....STANDARD PRINTER.
C
      CALL HPAST('PPPRINT ', IPR, ISTATC)
      IF(ISTATC .NE. 0) CALL FPHPWN(ISTATC, 'PPPRINT ')
      CALL FTEKCK(IPR, 'PPPRINT ', 6, IPR, 6, 9)
C
C.....DEBUG PRINTER.
C
      CALL HPAST('DEBUGPR ', IOPDBG, ISTATC)
      IF(ISTATC .NE. 0) CALL FPHPWN(ISTATC, 'DEBUGPR ')
      CALL FTEKCK(IOPDBG, 'DEBUGPR ', 8, IOPDBG, 6, 9)
C
      ENDIF
C
C.....TRACE LEVEL.
C
      CALL HPAST('PPTRACE ', IPTRCE, ISTATC)
      IF(ISTATC .NE. 0) CALL FPHPWN(ISTATC, 'PPTRACE ')
      CALL FTEKCK(IPTRCE, 'PPTRACE ', 0, IPTRCE, 0, 8)
C
      IF(IPTRCE .GT. 0) WRITE(IOPDBG,900)
C
C.....ERROR PRINTER.
C
      CALL HPAST('ERRORPR ', IOERR, ISTATC)
      IF(ISTATC .NE. 0) CALL FPHPWN(ISTATC, 'ERRORPR ')
      CALL FTEKCK(IOERR, 'ERRORPR ', 9, IOERR, 6, 9)
C
C.....NOW GET THE REMAINDER OF THE TECHNIQUES AND ARGUMENTS.
C
      CALL GILUVO
C
C.....IF A CALL TO KILLFN WAS MADE IN GILUVO...GET OUT OF THE MARO
C.....MARO FUNCTION IMMEDIATELY.
C
      IF(KLCODE .GT. 8) GOTO 100
C
C.....NOW CALL THE CONTROLLING MARO ROUTINE.
C
      CALL GCTRL(ISTATC)
      IF(ISTATC .EQ. 0) GOTO 999
  100 WRITE(IOERR,902)
C
  999 IF(IPTRCE .GT. 0) WRITE(IOPDBG,901)
C
      CALL STOPFN(8HMARO    )
      RETURN
      END
