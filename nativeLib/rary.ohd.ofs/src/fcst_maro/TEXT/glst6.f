C MEMBER GLST6
C  (from old member PPGLST6)
C
      SUBROUTINE GLST6(W6, GP6, PPVR, PVPTR, NVST, ITINT)
C
C.....THIS IS THE SUBROUTINE THAT PRINTS OUT 6-HOURLY PRECIPITATION
C.....LISTS.
C
C.....GLST6 HAS THE FOLLOWING ARGUMENTS:
C
C.....W6     - THE ARRAY OF SIX-HOUR PERCENTAGE DISTRIBUTIONS.
C.....GP6    - POINTER TO SIX-HOUR PERCENTAGE DISTRIBUTIONS (W6).
C.....PPVR   - THE ARRAY OF LESS THAN 24-HOUR PRECIPITATION.
C.....PVPTR  - THE POINTER ARRAY FOR PPVR.
C.....NVST   - THE NUMBER OF STATIONS IN PPVR.
C.....ITINT  - THE TIME INTERVAL.
C
C.....ORIGINALLY WRITTEN BY:
C
C.....JERRY M. NUNN     WGRFC, FT. WORTH, TEXAS     FEBRUARY 24, 1988
C
      INCLUDE 'gcommon/explicit'
      INTEGER*2 PPVR(1), PVPTR(1), W6(1), GP6(1)
      DIMENSION PP6(4), IBLNK(2), ISID(2), PGENL(100), CLTR(2)
      DIMENSION DESC(5), SNAME(2)
C
      INCLUDE 'common/where'
      INCLUDE 'common/pudbug'
      INCLUDE 'common/errdat'
      INCLUDE 'gcommon/gsize'
      INCLUDE 'common/ionum'
      INCLUDE 'gcommon/gopt'
      INCLUDE 'gcommon/gdispl'
      INCLUDE 'common/fctime'
      INCLUDE 'gcommon/gdate'
      INCLUDE 'gcommon/gversn'
      COMMON /TOTERZ/ NWARNT, NERRST
C
      EQUIVALENCE (CLTR(1),PGENL(2)),(DESC(1),PGENL(5))
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_maro/RCS/glst6.f,v $
     . $',                                                             '
     .$Id: glst6.f,v 1.1 1995/09/17 19:01:53 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA IBLNK, GENL, PPVRP, GGP6 /2*4h    , 4hGENL, 4hPPVR, 4hGP6 /
      DATA SNAME, PVRX /4hGLST, 4h6   , 4hPVRX/
C
C
  901 FORMAT(1H0, '*** GLST6 ENTERED ***')
  902 FORMAT(1H0, '*** EXIT GLST6 ***')
  903 FORMAT(1H1, 92X, 'TIME OF RUN ', 2A4, I2, ',', I5, ' - ', I2, ':',
     * I2, 'Z')
  904 FORMAT(1H0, 57X, 'NWSRFS VERSION 5.0', /, 52X, 'WGRFC FT. WORTH MA
     *RO FUNCTION', /, 54X, '(VERSION ', F4.2, ' - ', A4, I4, ')', //,
     * 26X, 'LISTING OF PRECIPITATION FROM SIX-HOURLY PRECIPITATION FILE
     * FOR ', 2A4, 1X, I2, ',', I5)
  905 FORMAT(48X, 'ONLY OBSERVED PRECIPITATION IS LISTED')
  906 FORMAT(36X, 'ESTIMATIONS ARE LISTED...AND ARE FLAGGED WITH AN ASTE
     *RISK (*)')
  907 FORMAT(///, 1X, 'END OF OUTPUT...', I4, ' STATIONS LISTED ON THIS
     *SUMMARY.')
  908 FORMAT(1H0, '*** NOTE ***  SUBROUTINE GLST6 FOUND ENTRY ', I4, ' I
     *N THE PPVR DATA ARRAY WITH A TIME INTERVAL OF ', I4, ' HOURS.',
     * /, 5X, 'ONLY TIME INTERVALS OF ', I4, ' HOURS CAN BE PROCESSED BY
     * SUBROUTINE GLST6.')
  909 FORMAT(1H0, '*** WARNING ***  SIX-HOURLY PRECIPITATION VALUE OF ',
     * F9.2, ' FOUND IN LOCATION ', I4, /, 5X, 'FOR STATION ', 2A4,
     * ' - ', 5A4, '. THIS VALUE IS INVALID...AND WILL BE CHANGED TO ZER
     *O.')
  910 FORMAT(1H0, '*** WARNING ***  SIX-HOURLY PRECIPITATION VALUE OF ',
     * F9.2, ' FOUND IN LOCATION ', I4, /, 5X, 'FOR STATION ', 2A4,
     * ' - ', 5A4, '. THIS VALUE EXCEEDS THE MAXIMUM ALLOWABLE SIX-HOURL
     *Y VALUE OF ', F9.2, '.', /, 5X, 'THIS AMOUNT WILL BE CHANGED TO ZE
     *RO.')
  911 FORMAT(1H0, '*** WARNING ***  SUBROUTINE GLST6 ENCOUNTERED STATUS
     *CODE OF ', I4, ' IN RPPREC FOR RECORD NO. ', I4, ' OF ', A4, ' PAR
     *AMETER ARRAY.', /, 5X, 'WILL PROCESS NEXT SIX-HOURLY REPORT.')
  912 FORMAT(1H0, 64X, 'TIME PERIOD BREAKDOWNS...FOR 6 HR. PERIODS', /,
     * 65X, 'AMOUNTS AND PERCENTAGES FOR THE PERIODS', /, 65X,
     *'ENDING AT THE SPECIFIED TIMES', //, 31X, 'STN',
     * 9X, '24 HR', /, 1X, 'NWS ID', 3X, 'NAME', 17X, 'NUM.  GRID  AMOUN
     *T   W6 ARRAY LOCNS', 5X, I2, 'Z', 10X, '0', I1, 'Z', 10X, '0', I1,
     * 'Z', 10X, I2, 'Z')
  913 FORMAT(34X, 'STATIONS WITH 24-HOUR TOTALS OF ZERO ARE NOT INCLUDED
     * IN THE LIST')
  914 FORMAT(36X, 'STATIONS WITH 24-HOUR TOTALS OF ZERO ARE INCLUDED IN
     *THE LIST')
  915 FORMAT(1H0, 2A4, 1X, 5A4, 1X, I4, 2X, I4, 2X, F5.2)
  916 FORMAT(1H0, 2A4, 1X, 5A4, 1X, I4, 2X, I4, 2X, F5.2, 3X, I4,
     * ' THRU ', I4, 1X, 4(2X, F5.2, 1X, '(', I3, ')'))
  917 FORMAT(1H0, 'CODE FOR MISSING SIX-HOUR PRECIPITATION IS ', I6)
  918 FORMAT(1H0, '*** WARNING ***  TIME INTERVAL OF ZERO ENCOUNTERED IN
     * STATION ', 2A4, ' - ', 5A4, /, 5X, 'THIS STATION WILL NOT BE USED
     *IN THE PRINTOUT. PROCESSING CONTINUES...HOWEVER.')
C
      INCLUDE 'gcommon/setwhere'
      IF(IPTRCE .GE. 3) WRITE(IOPDBG,901)
C
C.....INITIALIZE NUMBER COUNTER AND DEBUG CODE.
C
      NUM = 0
      JXWARN = 0
      PMAX = MAXPC6
      PMAX = PMAX/100.
      IBUG = IPBUG(PPVRP)
      JBUG = IPBUG(PVRX)
      KBUG = IPBUG(GGP6)
      IF(IBUG .EQ. 1) WRITE(IOPDBG,917) MSNG6
      IF(JBUG .EQ. 1) CALL GPDDMP(PPVRP, NVST, PPVR)
      IF(JBUG .EQ. 1) CALL GLPTVR(NVST, PVPTR)
      IF(KBUG .EQ. 1) CALL GDGP6(GP6)
C
C.....LOOP THRU THE NUMBER OF STATIONS IN THE PPVR ARRAY.
C
      IP = 1
      N = 1
C
C.....WRITE OUT THE HEADING INFORMATION AT THE TOP OF EACH NEW PAGE.
C
  100 WRITE(IPR,903) NWKDAY, MONTH, NDATE, NYEAR, ICHRS, ICMINS
      WRITE(IPR,904) VERNUM, NVMON, NVYR, IHYDAY, IHYMON, IHYDAT, IHYYR
      IPRINT = 1
C
      IF(IPREST .EQ. 0) WRITE(IPR,905)
      IF(IPREST .EQ. 1) WRITE(IPR,906)
      IF(IPRZRO .EQ. 0) WRITE(IPR,913)
      IF(IPRZRO .EQ. 1) WRITE(IPR,914)
      WRITE(IPR,912) (ITIME6(J), J = 1, NUMPD1)
C
C.....CHECK THE TIME INTERVAL.
C
  120 NTINT = PVPTR((N-1)*4 + 3)
      IF(NTINT .EQ. ITINT) GOTO 140
      IF(IBUG .EQ. 1) WRITE(IOPDBG,908) IP, NTINT, ITINT
      GOTO 380
C
  140 JP = PVPTR(N*4)
      KP = JP + 3
C
      NP = 1
      TP6 = 0.0
C
      DO 260 LP = JP, KP
C
C.....CHECK FOR MISSING PRECIPITATION.
C
      IF(PPVR(LP) .EQ. MSNG6) GOTO 200
C
C.....CHECK FOR INVALID PRECIPITATION VALUES...LESS THAN ZERO OR
C.....OVER THE MAXIMUM VALUE.
C
      IF(PPVR(LP) .LT. 0) GOTO 160
      IF(PPVR(LP) .GT. MAXPC6) GOTO 180
      GOTO 240
C
  160 PT6 = PPVR(LP)
      PT6 = PT6/100.0
      NREC = PVPTR((N-1)*4 + 1)
      ISID(1) = IBLNK(1)
      ISID(2) = IBLNK(2)
      CALL RPPREC(ISID, GENL, NREC, LGENL, PGENL, LFILL, IPTRNX, ISTATC)
      IF(ISTATC .NE. 0) GOTO 300
      WRITE(IPR,909) PT6, LP, CLTR, DESC
      NWARN = NWARN + 1
      JXWARN = JXWARN + 1
      GOTO 200
C
  180 PT6 = PPVR(LP)
      PT6 = PT6/100.0
      NREC = PVPTR((N-1)*4 + 1)
      ISID(1) = IBLNK(1)
      ISID(2) = IBLNK(2)
      CALL RPPREC(ISID, GENL, NREC, LGENL, PGENL, LFILL, IPTRNX, ISTATC)
      IF(ISTATC .NE. 0) GOTO 300
      WRITE(IPR,910) PT6, LP, CLTR, DESC, PMAX
      NWARN = NWARN + 1
      JXWARN = JXWARN + 1
C
C.....NOW CHECK NOEST6. THIS SECTION OF CODE IS HERE FOR THE TIME WHEN
C.....MARO WILL BE ABLE TO ESTIMATE MISSING SIX-HOURLY PRECIPITATION
C.....AT THE USER'S OPTION. FOR NOW...HOWEVER...MARO JUST SETS MISSING
C.....SIX-HOURLY PRECIPITATION TO ZERO.
C
  200 IF(NOEST6 .EQ. 0) GOTO 220
  220 PPVR(LP) = 0
C
C.....PUT THE PRECIPITATION IN THE HOLDING ARRAY FOR LATER PRINTOUT.
C
  240 P6 = PPVR(LP)
      PP6(NP) = P6/100.
      TP6 = TP6 + PP6(NP)
      NP = NP + 1
  260 CONTINUE
C
C.....CHECK FOR A ZERO TOTAL.
C
      IF(TP6 .GT. 0.005) GOTO 280
      IF(IPRZRO .EQ. 1) GOTO 280
      GOTO 380
C
C.....PRINT AN ENTRY IN THE SIX HOURLY PRECIPITATION LIST.
C
C.....GET THE RECORD NO. OF THE STATION.
C
  280 NREC = PVPTR((N-1)*4+1)
C
      ISID(1) = IBLNK(1)
      ISID(2) = IBLNK(2)
      CALL RPPREC(ISID, GENL, NREC, LGENL, PGENL, LFILL, IPTRNX, ISTATC)
      IF(ISTATC .EQ. 0) GOTO 320
  300 WRITE(IPR,911) ISTATC, NREC, GENL
      CALL WARN
      GOTO 380
C
C.....BREAK OUT THE GRID ADDRESS AND THE STATION NUMBER.
C
  320 IGRID = PGENL(17)
      ISTN = PGENL(4)
C
C.....TEST IF WE ARE TO PRINT OUT A ZERO AMOUNT. THERE IS A DIFFERENT
C.....PRINT LINE FOR ZERO PRECIPITATION THAN FOR NON-ZERO PRECIPITATION.
C
      IF((TP6 .GT. 0.005) .AND. (IGRID .NE. -999)) GOTO 340
      WRITE(IPR,915) CLTR, DESC, ISTN, IGRID, TP6
      GOTO 360
C
C.....THE AMOUNT IS NON-ZERO. GET THE BEGINNING ADDRESS OF THE
C.....DISTRIBUTION PERCENTAGES ASSOCIATED WITH THE PRECIPITATION AMOUNT.
C
  340 IW = GP6(IGRID)
      MP = IW + 3
      WRITE(IPR,916) CLTR, DESC, ISTN, IGRID, TP6, IW, MP, PP6(1),
     * W6(IW), PP6(2), W6(IW+1), PP6(3), W6(IW+2), PP6(4), W6(MP)
C
  360 NUM = NUM + 1
      IPRINT = 0
C
C.....SET THE POINTER TO POINT TO THE NEXT STATION.
C
C
C.....IF THE TIME INTERVAL IS ZERO...ISSUE A WARNING AND GET OUT OF
C.....THIS ROUTINE.
C
  380 IF(NTINT .NE. 0) GOTO 440
      NREC = PVPTR((N-1)*4+1)
      ISID(1) = IBLNK(1)
      ISID(2) = IBLNK(2)
      CALL RPPREC(ISID, GENL, NREC, LGENL, PGENL, LFILL, IPTRNX, ISTATC)
      IF(ISTATC .EQ. 0) GOTO 400
      WRITE(IPR,911) ISTATC, NREC, GENL
      CALL ERROR
      GOTO 420
C
  400 WRITE(IPR,918) CLTR, DESC
  420 N = N + 1
      IP = IP + 1
      IF(N .GT. NVST) GOTO 480
      GOTO 120
C
  440 IP = IP + 24/NTINT
      IF(IP .GT. NVST) GOTO 480
      N = N + 1
      J = MOD(NUM, NPAGE)
      IF(J .EQ. 0) GOTO 460
      GOTO 120
C
  460 IF(IPRINT .EQ. 0) GOTO 100
      GOTO 120
C
  480 WRITE(IPR,907) NUM
      IF(IPTRCE .GE. 3) WRITE(IOPDBG,902)
C
C.....TEST IF WARNING FOUND IN SIX-HOUR PRECIPITATION HANDLING
C.....ROUTINES. CALL WARN IF SUCH IS THE CASE.
C
      IF(JXWARN .EQ. 0) GOTO 999
      NWARN = NWARN - 1
      NWARNT = NWARNT + JXWARN - 1
C
      CALL WARN
C
  999 RETURN
      END
