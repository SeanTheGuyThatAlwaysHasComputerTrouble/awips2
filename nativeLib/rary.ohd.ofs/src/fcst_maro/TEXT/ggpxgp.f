C MODULE GGPXGP
C
      SUBROUTINE GGPXGP(NPGRID, WP, ITYPE, INTEGR, REAL, ISTRT, LENGTH,
     * IPCODE, ISTATF, IERROR, LENDMD, N6P, NRAIN, NFLAG6, PG24,
     * W6, GP6)
C
C.....THIS SUBROUTINE IS CALLED TO EXTRACT A GRID POINT ADDRESS FROM A
C.....NUMERIC FIELD.
C
C.....THIS ROUTINE ALSO HAS ANOTHER IMPORTANT FUNCTION. SINCE THE
C.....GRID POINT ADDRESS IS THE FIRST FIELD PROCESSED ON A NEW LINE...
C.....THIS ROUTINE WILL HAVE TO STORE DATA FROM THE PREVIOUS CARD
C.....BEFORE PROCESSING CAN BE DONE.
C
C.....ARGUMENT LIST IS AS FOLLOWS
C
C.....NPGRID - GRID POINT ADDRESS LAST PROCESSED.
C.....         NOTE:  IF NPGRID = -1 THE PREVIOUS PRECIP DATA CARD HAD
C.....         A FATAL ERROR OR NO GRID POINT ADDRESS HAS YET BEEN
C.....         PROCESSED.
C.....WP     - POINTER TO NEXT AVAILABLE LOCATION IN THE W6 ARRAY
C.....         TO STORE DISTRIBUTION PERCENTAGES.
C.....ITYPE  - DATA TYPE (RETURNED FROM UFIEL2).
C.....INTEGR - INTEGER NO. VALUE (RETURNED FROM UFIEL2).
C.....REAL   - REAL NO. VALUE (RETURNED FROM UFIEL2).
C.....ISTRT  - STARTING COL. NO. OF FIELD (RETURNED FROM UFIEL2).
C.....LENGTH - LENGTH OF FIELD (RETURNED FROM UFIEL2).
C.....IPCODE - CODE TO CONTINUE PROCESSING.
C.....          = 1   CONTINUE PROCESSING.
C.....          = 0   DO NOT CONTINUE PROCESSING.
C.....ISTATF - STATUS CODE (RETURNED FROM UFIEL2).
C.....IERROR - ERROR CODE RETURNED FROM THIS SUBROUTINE.
C.....LENDMD - A FLAG DENOTING WHETHER THE MOD PROCESSING ROUTINE HAS
C.....         REACHED THE END OF THE DATA.
C.....          = 0  END OF RUNTIME MOD DATA NOT YET REACHED.
C.....          = 1  END OF RUNTIME MOD DATA HAS BEEN REACHED.
C.....N6P    - THE ARRAY CONTAINING THE 6 HR DATA (NFLAG6 = 1).
C.....NRAIN  - THE 24 HR PRECIP AMOUNT LAST PROCESSED.
C.....NFLAG6 - A FLAG DENOTING WHETHER THE CARD LAST PROCESSED CONTAINED
C.....         SIX HOUR DATA.
C.....          = 1   IT DID
C.....          = 0   IT DID NOT.
C.....PG24   - ARRAY OF GRID POINT PRECIPITATION
C.....W6     - ARRAY OF SIX HOUR PERCENTAGE WEIGHTS.
C.....GP6    - ARRAY OF SIX HOUR FLAGS FOR GRID POINT.
C.....          GP6(NGRID) = 0  NO SIX HOUR DATA FOR GRID
C.....                          POINT NGRID
C.....          GP6(NGRID) > 0  PERCENT WEIGHTS FOR SIX HOUR
C.....                          DATA FOR GRID POINT NGRID BEGIN
C.....                          AT W6(GP6(NGRID)).
C
C.....ORIGINALLY WRITTEN BY
C
C.....JERRY M. NUNN       WGRFC FT. WORTH, TEXAS       SEPTEMBER 1986
C
      INTEGER*2 NRAIN, NFLAG6, N6P(1), PG24(1), W6(1), GP6(1)
      INCLUDE 'gcommon/explicit'
      DIMENSION SNAME(2)
C
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/where'
      INCLUDE 'common/pudbug'
      INCLUDE 'gcommon/gsize'
      INCLUDE 'ufreex'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_maro/RCS/ggpxgp.f,v $
     . $',                                                             '
     .$Id: ggpxgp.f,v 1.2 1998/07/02 20:33:56 page Exp $
     . $' /
C    ===================================================================
C
C
      DATA SNAME /4hGGPX, 4hGP  /
C
  901 FORMAT(1H0, '*** GGPXGP ENTERED ***')
  902 FORMAT(1H0, '*** EXIT GGPXGP -- ERROR RETURN CODE = ', I2, ' AND E
     *NDMOD RETURN CODE = ', I2, ' ***')
C
      INCLUDE 'gcommon/setwhere'
      IF(IPTRCE .GE. 3) WRITE(IOPDBG,901)
      IERROR = 0
C
C.....NOW PROCESS THE GRID POINT ADDRESS.
C
      IPCODE = 1
C
C.....CHECK THE GRID POINT ADDRESS. IF IT IS NOT -1 THEE IS A PREVIOUS
C.....CARD THAT NEEDS ITS DATA STORED.
C
      IF(NPGRID .EQ. -1) GOTO 100
C
      CALL GSODAT(PG24, W6, GP6, NPGRID, NRAIN, NFLAG6, N6P, WP)
      IF(LENDMD .EQ. 1) GOTO 999
C
C.....CHECK FOR A VALID REAL OR INTEGER NUMBER.
C
      IF(ISTATF .NE. 0) GOTO 900
  100 IF(ITYPE  .EQ. 0) GOTO 200
      IF(ITYPE  .EQ. 1) GOTO 150
      GOTO 800
C
C.....THE GRID POINT ADDRESS CAN BE A REAL NUMBER. IF IT IS -- TRUNCATE
C.....IT TO AN INTEGER.
C
  150 INTEGR = REAL
C
C.....CHECK IF THE NUMBER IS WITHIN RANGE.
C
  200 IF(INTEGR .LT.  100) GOTO 900
      IF(INTEGR .GT. 9899) GOTO 900
C
      NPGRID = INTEGR
      GOTO 999
C
C.....THE FIELD IS NOT NUMERIC. CHECK TO SEE IF IT IS A NEW MOD HEADER
C.....OR THE 'ENDMOD' CARD.  IF AN END-OF-FILE CONDITION HAS ALREADY
C.....BEEN DETECTED...DO NOT BOTHER TO CALL THIS SUBROUTINE.
C
  800 IF(LENDMD .EQ. 1) GOTO 999
      CALL GGENDM(ISTATC)
      IF(ISTATC .LT. 0) GOTO 900
      LENDMD = 1
      GOTO 999
C
C.....SET ERROR CODE IF THERE IS AN INPUT ERROR.
C
  900 IERROR = 4
C
  999 IF(IPTRCE .GE. 3) WRITE(IOPDBG,902) IERROR, LENDMD
      RETURN
      END
