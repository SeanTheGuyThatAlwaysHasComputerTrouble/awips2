C MEMBER PIN62
C-----------------------------------------------------------------------
C
C                             LAST UPDATE:          
C
C @PROCESS LVL(77)
C
      SUBROUTINE PIN62 (P,LEFTP,IUSEP)

C     THIS IS THE STAGE ADJUSTMENT ROUTINE FOR DWOPER.  THIS
C     ROUTINE INPUTS ALL CARDS FOR THE OPERATION AND FILLS THE
C     P ARRAY.

C     THIS ROUTINE ORIGINALLY WRITTEN BY
C        JOANNE R. SALERNO - NWRFC   DEC 1997

C     DEFINITION OF VARIABLES
C     IVERSN = I1     VERSION NUMBER OF OPERATION
C     CTITLE = C72    GENERAL NAME OR TITLE FOR OPERATION

C  INPUT
C     DW FORECASTED STAGE
C     CSTAP  = C8     DW FCST  STAGE TIME SERIES IDENTIFIER
C     STGP   = C4     DW FCST  STAGE DATA TYPE CODE

C     TIDAL RANGE/SLICE DEFINITION
C     RANGE  = C8     RANGE LIMIT SERIES IDENTIFIER
C     TIDB   = C4     RANGE LIMIT TYPE CODE
C                     RANGE(1) R1 LOWER LIMIT
C                     RANGE(2) R2 LOWER LIMIT
C                     RANGE(3) R3 LOWER LIMIT
C                     RANGE(4) R4 LOWER LIMIT
C                     RANGE(5) R4 UPPER LIMIT
C
C     OBSERVED AVERAGE BALANCE TIME SERIES PER RANGE
C     SBALR1 = C8     RANGE1 AVE TIDE BALANCE TIME SERIES IDENTIFIER
C     TIDB   = C4     RANGE1 AVE TIDE BALANCE TYPE CODE
C     SBALR2 = C8     RANGE2 AVE TIDE BALANCE TIME SERIES IDENTIFIER
C     TIDB   = C4     RANGE2 AVE TIDE BALANCE TYPE CODE
C     SBALR3 = C8     RANGE3 AVE TIDE BALANCE TIME SERIES IDENTIFIER
C     TIDB   = C4     RANGE3 AVE TIDE BALANCE TYPE CODE
C     SBALR4 = C8     RANGE4 AVE TIDE BALANCE TIME SERIES IDENTIFIER
C     TIDB   = C4     RANGE4 AVE TIDE BALANCE TYPE CODE

C  OUTPUT
C     ADJUSTED STAGE TIME SERIES
C     DWADJ  = C8    ADJUSTED CSTA TIME SERIES IDENTIFIER    
C     STGA   = C4    ADJUSTED CSTA DATA TYPE CODE


C        1         2         3         4         5         6         7
C23456789012345678901234567890123456789012345678901234567890123456789012

C     POSITION     CONTENTS OF P ARRAY

C      1           VERSION NUMBER OF OPERATION
C      2-19        GENERAL NAME OR TITLE

C  INPUT
C     20-22        DW FCST  STAGE      - CSTAP (STGP)
C
C     TIDAL RANGE/SLICE DEFINITION
C     23-24        RANGE LIMIT SERIES IDENTIFIER   -  RANGE
C     25           RANGE LIMIT TYPE CODE           -  TIDB
C                  RANGE(1) R1 LOWER LIMIT
C                  RANGE(2) R2 LOWER LIMIT
C                  RANGE(3) R3 LOWER LIMIT
C                  RANGE(4) R4 LOWER LIMIT
C                  RANGE(5) R4 UPPER LIMIT
C
C     OBSERVED PRTO3 AVERAGE  BALANCE TIME SERIES PER RANGE
C     26-27        RANGE1 AVE TIDE BALANCE TIME SERIES ID  -  SBALR1
C     28           RANGE1 AVE TIDE BALANCE TYPE CODE       -  TIDB
C     29-30        RANGE2 AVE TIDE BALANCE TIME SERIES ID  -  SBALR2
C     31           RANGE2 AVE TIDE BALANCE TYPE CODE       -  TIDB
C     32-33        RANGE3 AVE TIDE BALANCE TIME SERIES ID  -  SBALR3
C     34           RANGE3 AVE TIDE BALANCE TYPE CODE       -  TIDB
C     35-36        RANGE4 AVE TIDE BALANCE TIME SERIES ID  -  SBALR4
C     37           RANGE4 AVE TIDE BALANCE TYPE CODE       -  TIDB
C
C  OUTPUT
C     38-39	   DWADJ  ADJUSTED CSTA TIME SERIES ID    -  DWADJ
C     40           DWADJ  ADJUSTED CSTA TYPE CODE         -  STGA

C**********************************************************************

C     THE NUMBER OF ELEMENTS REQUIRED IN THE P ARRAY IS  40

C     THE NUMBER OF ELEMENTS REQUIRED IN THE C ARRAY IS   0

C        1         2         3         4         5         6         7
C23456789012345678901234567890123456789012345678901234567890123456789012

      CHARACTER *72 CTITLE
      CHARACTER * 8 CSTAP,RANGE,SBALR1,SBALR2,SBALR3,SBALR4,DWADJ
      CHARACTER * 4 STGP,TIDB,STGA

      DIMENSION RTITLE(18)
      DIMENSION RCSTAP(2),RRANGE(2),RSBALR1(2),RSBALR2(2),RSBALR3(2),
     +          RSBALR4(2),RDWADJ(2)
      DIMENSION P(*)

      EQUIVALENCE (CTITLE,RTITLE)
      EQUIVALENCE (CSTAP,RCSTAP),(STGP,RSTGP)
      EQUIVALENCE (RANGE,RRANGE),(TIDB,RTIDB)
      EQUIVALENCE (SBALR1,RSBALR1),(TIDB,RTIDB)
      EQUIVALENCE (SBALR2,RSBALR2),(TIDB,RTIDB)
      EQUIVALENCE (SBALR3,RSBALR3),(TIDB,RTIDB)
      EQUIVALENCE (SBALR4,RSBALR4),(TIDB,RTIDB)
      EQUIVALENCE (DWADJ,RDWADJ),(STGA,RSTGA)

C     COMMON BLOCKS
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'


C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcinit_pntb/RCS/pin62.f,v $
     . $',                                                             '
     .$Id: pin62.f,v 1.2 1998/10/14 13:46:30 page Exp $
     . $' /
C    ===================================================================
C

C     CHECK TRACE LEVEL
      CALL FPRBUG('PIN62   ',1,62,IBUG)


C        1         2         3         4         5         6         7
C23456789012345678901234567890123456789012345678901234567890123456789012

C                   NWRFS CARDS
C                   FREE FORMAT
C
C
C ADJUST STAGE
C CSTAP STGP RANGE TIDB 
C SBALR1 TIDB SBALR2 TIDB SBALR3 TIDB SBALR4 TIDB DWADJ STGA 
C
C     CARD 1 - GENERAL USER SUPPLIED INFORMATION
C     CARD 2 - TIME SERIES DEFINITION
C        FIELD 1  - DW OBS/FCST STAGE TIME SERIES ID  - 8 CHAR
C        FIELD 2  - DW OBS/FCST STAGE DATA TYPE CODE  - 4 CHAR
C        FIELD 3  - RANGE LIMIT TIME SERIES ID        - 8 CHAR
C        FIELD 4  - RANGE LIMIT DATA TYPE CODE        - 4 CHAR
C     CARD 3 - TIME SERIES DEFINITION
C        FIELD 1  - RANGE1 AVE TIDE BALANCE TIME SERIES ID -8 CHAR
C        FIELD 2  - RANGE1 AVE TIDE BALANCE TYPE CODE      -4 CHAR
C        FIELD 3  - RANGE2 AVE TIDE BALANCE TIME SERIES ID -8 CHAR
C        FIELD 4  - RANGE2 AVE TIDE BALANCE TYPE CODE      -4 CHAR
C        FIELD 5  - RANGE3 AVE TIDE BALANCE TIME SERIES ID -8 CHAR
C        FIELD 6  - RANGE3 AVE TIDE BALANCE TYPE CODE      -4 CHAR
C        FIELD 7  - RANGE4 AVE TIDE BALANCE TIME SERIES ID -8 CHAR
C        FIELD 8  - RANGE4 AVE TIDE BALANCE TYPE CODE      -4 CHAR
C        FIELD 9  - DWADJ ADJUSTED TIME SERIES ID          -8 CHAR
C        FIELD 10 - DWADJ ADJUSTED DATA TYPE CODE          -4 CHAR


C        1         2         3         4         5         6         7
C23456789012345678901234567890123456789012345678901234567890123456789012

C     READ IN CARDS IN FREE FORMAT
      IUSEP = 0
      IUSEC = 0
      IERROR = 0

      READ(IN,FMT='(A)',ERR=9981) CTITLE
      IF (IBUG.GE.1) WRITE(IODBUG,801) CTITLE
 801  FORMAT('PIN62: CTITLE: ',A72)

      READ(IN,*,ERR=9982) CSTAP,STGP,RANGE,TIDB
      IF (IBUG.GE.1) WRITE(IODBUG,805)
     +       CSTAP,STGP,RANGE,TIDB
 805  FORMAT('PIN62: CSTAP,STGP : ',2A8,/,
     +       '       RANGE,TIDB : ',2A8)

      READ(IN,*,ERR=9983) SBALR1,TIDB,SBALR2,TIDB,SBALR3,TIDB,
     +     SBALR4,TIDB,DWADJ,STGA
      IF (IBUG.GE.1) WRITE(IODBUG,806)
     +       SBALR1,TIDB,SBALR2,TIDB,SBALR3,TIDB,SBALR4,TIDB,
     +       DWADJ,STGA
 806  FORMAT('PIN62: SBALR1,TIDB: ',2A8,/,
     +       '       SBALR2,TIDB: ',2A8,/,
     +       '       SBALR3,TIDB: ',2A8,/,
     +       '       SBALR4,TIDB: ',2A8,/,
     +       '       DWADJ, STGA: ',2A8)

C23456789012345678901234567890123456789012345678901234567890123456789012

C     CHECK TS - CSTAP,STGP 
C                RANGE,TIDB
C                SBALR1,TIDB
C                SBALR2,TIDB
C                SBALR3,TIDB
C                SBALR4,TIDB
C                DWADJ, STGA

      CALL CHEKTS (CSTAP,STGP,1,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (RANGE,TIDB,24,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (SBALR1,TIDB,24,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (SBALR2,TIDB,24,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (SBALR3,TIDB,24,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (SBALR4,TIDB,24,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      CALL CHEKTS (DWADJ,STGA,1,1,'L   ',0,1,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

C        1         2         3         4         5         6         7
C23456789012345678901234567890123456789012345678901234567890123456789012

 
C     CHECK SPACE IN P AND C ARRAYS
C     NUMBER POINTS REQUIRED IN THE P ARRAY IS 40
C     NUMBER POINTS REQUIRED IN THE C ARRAY IS 0
C     IF ICARRY IS NONZERO

      IUSEP = 40 

      CALL CHECKP (IUSEP,LEFTP,IERFLG)
      IF (IERFLG.NE.0) IERROR = 1

      IF (IERROR.GE.1) GO TO 990

C     SAVE TIME SERIES IDENTIFIERS AND PARAMETERS TO P AND C ARRAYS

      IVERSN = 1
      P(1) = REAL(IVERSN)
      DO 500 I=1,18
 500  P(I+1) = RTITLE(I)

      P(20) = RCSTAP(1)
      P(21) = RCSTAP(2)
      P(22) = RSTGP

      P(23) = RRANGE(1)
      P(24) = RRANGE(2)
      P(25) = RTIDB

      P(26) = RSBALR1(1)
      P(27) = RSBALR1(2)
      P(28) = RTIDB

      P(29) = RSBALR2(1)
      P(30) = RSBALR2(2)
      P(31) = RTIDB

      P(32) = RSBALR3(1)
      P(33) = RSBALR3(2)
      P(34) = RTIDB

      P(35) = RSBALR4(1)
      P(36) = RSBALR4(2)
      P(37) = RTIDB

      P(38) = RDWADJ(1)
      P(39) = RDWADJ(2)
      P(40) = RSTGA

      GO TO 990

 9981 IERROR = 1
      WRITE(IPR,9901)
 9901 FORMAT(//,10X,'**ERROR**  ADJUST-H INPUT ERROR',/,
     +          10X,'CARD 1 READ: USER SUPPLIED INFORMATION')
      CALL ERROR
      GO TO 990

 9982 IERROR = 1
      WRITE(IPR,9902)
 9902 FORMAT(//,10X,'**ERROR**  ADJUST-H INPUT ERROR',/,
     +          10X,'CARD 2 READ: TIME SERIES INFORMATION')
      CALL ERROR
      GO TO 990

 9983 IERROR = 1
      WRITE(IPR,9903)
 9903 FORMAT(//,10X,'**ERROR**  ADJUST-H INPUT ERROR',/,
     +          10X,'CARD 3 READ: TIME SERIES INFORMATION')
      CALL ERROR
      GO TO 990

 990  IF (IERROR.GE.1) THEN
         IUSEP = 0
      ENDIF

      IF (ITRACE.GE.1) WRITE(IODBUG,999)
 999  FORMAT('PIN62 (ADJUST-H) EXITED')

      RETURN
      END
