C MEMBER FPRTPS
C  (from old member FCFPRTPS)
C
C DESC - FOR PRINTING CARRYOVER FOR SAC-SMA AND SNOW-17 OPERATIONS
C DESC - FROM THE FCST PROGRAM - A MODIFIED VERSION OF FPRTOP
C..................................................................
C
      SUBROUTINE FPRTPS(LASLIS,LISTYP,LIST,NUMOP,IOPN,NDATES,
     1  JUL2,IHR2,RECENT)
C......................................................................
C
C  OIGINALLY PROGRAMMED BY --
C      JOE OSTROWSKI -- HRL -- 820309
C      MODIFIED FOR USE AS PART OF FUNCTION PRINTOPS
C           BY GEORGE F. SMITH - HRL - DECEMBER, 1982
C
C.......................................................................
C
      INCLUDE 'common/where'
      INCLUDE 'common/fcsegn'
      INCLUDE 'common/fctime'
      INCLUDE 'common/fcfgs'
      INCLUDE 'common/fccgd'
      INCLUDE 'common/fcrunc'
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/errdat'
      INCLUDE 'common/fd'
      INCLUDE 'common/fengmt'
      INCLUDE 'common/fcsegc'
C
      DIMENSION SUBNAM(2),OLDSUB(2),
     . LIST(2,1),LISTYP(1),JULIAN(10),IHRP(10),
     . IOPN(2),GROUP(3,2),JUL2(1),IHR2(1)
C
      LOGICAL RECENT
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_printops/RCS/fprtps.f,v $
     . $',                                                             '
     .$Id: fprtps.f,v 1.1 1995/09/17 19:04:48 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA GROUP/4HCARR,4HYOVE,1HR,4HFORE,4HCAST,1H /
      DATA SUBNAM/4HFPRT,4HPS  /,IBLNK/4H    /
      DATA JBUG/4HPROP/
C
C...................
C  SET WHERE INFO
C
      DO 1 I=1,2
      OLDSUB(I) = OPNAME(I)
    1 OPNAME(I) = SUBNAM(I)
      IOLDOP = IOPNUM
      IOPNUM = 0
C
C     SET DEBUG FLAG
C
      IBUG=IFBUG(JBUG)
C
      IF(IBUG.EQ.1)WRITE(IPR,650)
  650 FORMAT(1H1,80(1H*),/2H *,78X,1H*/2H *,23X,
     .33HSAC-SMA/SNOW-17 CARRYOVER DISPLAY,22X,1H*,/2H *,78X,1H*/,
     . 1H ,80(1H*)///)
C........................................
C
C  NOW LOOP THROUGH OPERATIONS AND GROUPS TO PRINT THE CARRYOVER
C
      DO 700 I=1,NUMOP
      IGLOSS=1
      DO 590 J=1,LASLIS
      CALL FCORDR(LISTYP(J),LIST(1,J),IERF,D,MD)
      IF (IERF.LE.0) GO TO 520
      WRITE(IPR,613) (GROUP(N,LISTYP(J)),N=1,3),LIST(1,J),LIST(2,J)
  613 FORMAT(10X,13H*** ERROR ***,/22X,21HTHE SEGMENTS FOR THE ,2A4,A1,
     .  07H GROUP ,2A4,22H COULD NOT BE ORDERED./22X,21HFUNCTION PRNTOPT
     .S IS ,11HTERMINATED.)
      CALL ERROR
      GO TO 9999
C
  520 CONTINUE
      IF (IBUG.GE.1) WRITE(IODBUG,1615) (GROUP(KI,LISTYP(J)),KI=1,3),
     .(LIST(KI,J),KI=1,2),ISPEC
 1615 FORMAT(15H ** PROCESSING ,2A4,A1,07H GROUP ,2A4,10H. ISPEC = ,I2)
C..............................................
C  FOR THE CASE WHERE A FORECAST GROUP IS A SPECIAL FGROUP AND THE
C  MOST RECENT DATES OF CARRYOVER ARE TO BE DISPLAYED, THE SUBROUTINE
C  FPROPS WILL FIND THE MOST RECENT DATES OF CARRYOVER ON A SEGMENT
C  BY SEGMENT BASIS.
C
      ISPGR = 0
      N2DATE = NDATES
      IF (LISTYP(J).EQ.1) GO TO 530
      IF (ISPEC.EQ.0) GO TO 530
      ISPGR = 1
      IF (.NOT.RECENT) GO TO 530
      N2DATE = -N2DATE
      GO TO 580
  530 CONTINUE
      CALL FGETSG(IDSEGN,IRSGEX(1),0,X,0,X,0,X,1,1,IERS)
      IF (IERS.LE.0) GO TO 535
      WRITE(IPR,615) KSEG,IRSGEX(1)
  615 FORMAT(110X,13H*** ERROR ***,/22X,08HSEGMENT ,2A4,11H AT RECORD ,
     .   I3,' COULD NOT BE LOADED FOR USE IN FUNCTION PRINTOPS.')
      CALL ERROR
      GO TO 9999
C
C..........................
C  GET MOST RECENT DATES OF CARRYOVER FOR THIS CGROUP OR FGROUP
C
  535 CONTINUE
      CALL FCDATE(IDSEGN,0)
      CALL FCOBBL(ICDAYC,ICHRC,NSLOTS)
      IDC(1) = IBLNK
      IDC(2) = IBLNK
      IF (IBUG.GE.1) WRITE(IODBUG,1616) (IJ,ICDAYC(IJ),ICHRC(IJ),IJ=1,
     .NSLOTS)
 1616 FORMAT(17H  DATES ON SLOTS:/20(I5,I8,I3/))
C
C....................................
C  COUNT DATED CARRYOVER SLOTS
      NID = 0
      DO 540 ID=1,NSLOTS
      IF (ICDAYC(ID).LE.0) GO TO 540
      NID = NID+1
  540 CONTINUE
      ISTRT = NSLOTS - NID + 1
C........................................
C  DATED CARRYOVER MUST EXIST ON THE FILE FOR THIS FUNCTION TO WORK
C
      IF (NID.GT.0) GO TO 545
      WRITE(IPR,630)
  630 FORMAT(10X,13H*** ERROR ***/22X,31HALL CARRYOVER FOR THIS FORECAST
     ., 31H OR CARRYOVER GROUP IS UNDATED./22X,21HDATED CARRYOVER MUST ,
     .    'EXIST FOR THE PRINTOPS FUNCTION TO BE USED.')
      CALL ERROR
      GO TO 9999
C...................................................
C WHEN REQUESTING N MOST RECENT DATES, AT LEAST N DATED CARRYOVER SLOTS
C  MUST EXIST ON THE FILES.
C
  545 CONTINUE
      IF (NDATES.LE.NID.OR..NOT.RECENT) GO TO 550
      WRITE(IPR,616) N2DATE,NID,NID
  616 FORMAT(10X,15H*** WARNING ***,/22X,04HTHE ,I3,19H MOST RECENT DATE
     .S ,45HOF CARRYOVER HAVE BEEN REQUESTED FOR DISPLAY./22X,05HONLY ,I
     .2,   48H DATES OF CARRYOVER EXIST ON THE FILES, SO ONLY ,I2,07H DA
     .TES ,  18HWILL BE DISPLAYED.)
      CALL WARN
      N2DATE = NID
C
C....................................
C ASSIGN THE N MOST RECENT DATES HERE.
C
  550 IF(.NOT.RECENT) GO TO 560
      DO 555 L=1,N2DATE
      M = NSLOTS-L+1
      JULIAN(L) = ICDAYC(M)
      IHRP(L) = ICHRC(M)
  555 CONTINUE
      GO TO 570
C................................
C  LOOK FOR MATCH BETWEEN DATES INPUT AND DATES ON THE FILE
C
  560 CONTINUE
C........................
C  IF A SPECIAL FORECAST GROUP, DON'T REMOVE ANY DATES. JUST REASSIGN
C   THE ONES INPUT.
C
      IF (ISPGR.NE.1) GO TO 561
      DO 563 MX=1,N2DATE
      JULIAN(MX) = JUL2(MX)
  563 IHRP(MX) = IHR2(MX)
      GO TO 570
C......................
C  NOW LOOK FOR MATCHES
  561 NMATCH = 0
      DO 566 MX = 1,N2DATE
      DO 565 NX = ISTRT,NSLOTS
      IF (JUL2(MX).NE.ICDAYC(NX).OR.IHR2(MX).NE.ICHRC(NX)) GO TO 565
      NMATCH = NMATCH+1
      JULIAN(NMATCH) = JUL2(MX)
      IHRP(NMATCH) = IHR2(MX)
      GO TO 566
  565 CONTINUE
  566 CONTINUE
      IF (NMATCH.GT.0) GO TO 568
      WRITE(IPR,631)
  631 FORMAT(10X,13H*** ERROR ***,/22X,29HNONE OF THE DATES INPUT MATCH,
     .  30H ANY OF THE DATES ON THE FILE./22X,27HPLEASE CHECK LATEST STA
     .TUS ,27HREPORT FOR CARRYOVER DATES.)
      WRITE(IPR,620)(JUL2(IJ),IHR2(IJ),IJ=1,N2DATE)
  620 FORMAT(11X,'THE DATES INPUT ARE:'/(1X,I11,1X,I3))
      WRITE(IPR,621)(ICDAYC(IJ),ICHRC(IJ),IJ=1,NID)
  621 FORMAT(11X,'THE DATES ON FILE ARE:'/(1X,I11,1X,I3))
      CALL ERROR
      GO TO 9999
  568 CONTINUE
      N2DATE = NMATCH
C
C...............................
C  SORT DATES IN ASCENDING ORDER
C
  570 CALL FCOBBL(JULIAN,IHRP,N2DATE)
      IF (IBUG.GE.1) WRITE(IODBUG,1616) (IJ,JULIAN(IJ),IHRP(IJ),
     .IJ=1,N2DATE)
C
  580 IDIM = 10
      IF (IBUG.GE.1) WRITE(IODBUG,1617) IOPN(I),ISPGR,N2DATE,IDIM
 1617 FORMAT(13H ** OP. NO. =,I3,08H ISPGR =,I2,16H NO. OF DATES = ,I2,
     .   12H ARRAY DIM =,I3)
C
C.....................................
C  CALL SUBROUTINE TO ACTUALLY PRINT CARRYOVER
C
      CALL FPROPS(IOPN(I),ISPGR,N2DATE,IDIM,JULIAN,IHRP,IGLOSS)
  590 CONTINUE
  700 CONTINUE
C
C..........................................
C
 9999 CONTINUE
      IOPNUM = IOLDOP
      OPNAME(1) = OLDSUB(1)
      OPNAME(2) = OLDSUB(2)
C
      RETURN
      END
