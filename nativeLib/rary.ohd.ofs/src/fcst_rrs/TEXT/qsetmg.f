C MODULE QSETMG
C-----------------------------------------------------------------------
C
C  ROUTINE QSETMG SETS OBSERVATIONS TO MISSING FOR SPECIFIED STATIONS
C  AND DATA TYPES.
C
C  ORIGINALLY CODED BY DEBBIE VAN DEMARK - 1/9/84
C
C-----------------------------------------------------------------------
C
C  INPUT ARGUMENTS
C         STAID - IDENTIFIER
C         DTYPE - DATA TYPE CODE
C         MSCHAR - NUMBER OF NON BLANK CHARACTERS IN START DATE
C         MECHAR - NUMBER OF NON BLANK CAHRACTERS IN END DATE
C         ISTPD - JULIAN HOUR OF FIRST PERIOD TO BE SET TO MISSING
C         IENPD - JULIAN HOUR OF LAST PERIOD TO BE SET TO MISSING
C        INTVAL - TIME INTERVAL
C          WORK - WORK ARRAY
C         LWORK - LENGTH OF WORK ARRAY
C
C  OUTPUT ARGUMENTS
C          WORK - WORK ARRAY
C
C-----------------------------------------------------------------------
C
      SUBROUTINE QSETMG (STAID,DTYPE,MSCHAR,MECHAR,ISTRT,IEND,INTVAL,
     $    LWORK,WORK)
C     
      INTEGER ENDWK,STRTWK
      DIMENSION WORK(1),STAID(2),ISTRT(3),IEND(3)
      DIMENSION OLDOPN(2)
C      
      INCLUDE 'common/ionum'
      INCLUDE 'common/pudbug'
      INCLUDE 'common/pptime'
      INCLUDE 'common/fctim2'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_rrs/RCS/qsetmg.f,v $
     . $',                                                             '
     .$Id: qsetmg.f,v 1.3 1999/07/06 15:58:01 page Exp $
     . $' /
C    ===================================================================
C
      DATA IBLNK/4H    /
C
C
      IF (IPTRCE.GT.1) WRITE(IOPDBG,80)
C
      IOPNUM=-3
      CALL FSTWHR('QSETMG  ',IOPNUM,OLDOPN,IOLDOP)
C
C  CHECK DEBUG CODES
      IBUG=IPBUG(4HQSET)
C
C  CONVERT THE DATES FROM MMDDYY TO INTERNAL JULIAN HOUR
      IF (IBUG.GT.0) WRITE(IOPDBG,90)STAID,DTYPE,ISTRT,MSCHAR,IEND,
     $ MECHAR
C
      CALL HDATEA (MSCHAR,ISTRT,1,0,1,1,IJDAY,IIHR,ISTPD,ISTAT)
C
      IF (ISTAT.EQ.0) GO TO 10
      WRITE(IPR,130) ISTRT
      CALL WARN
      GO TO 70
C
10    IF (MECHAR.EQ.0)  GO TO 20
      CALL HDATEA (MECHAR,IEND,1,0,1,1,LJDAY,LIHR,IENPD,ISTAT)
C
      IF (ISTAT.EQ.0) GO TO 30
      WRITE(IPR,140) IEND
      CALL WARN
      GO TO 70
C
20    IENPD=ISTPD
30    CONTINUE
C
C  DETERMINE IF ANY PORTION OF THE SET MISSING PERIOD IS WITHIN
C  THE RUN PERIOD
C  SEE IF THE SET MISSING PERIOD IS TOTALLY OUTSIDE THE RUN PERIOD
      IF (IENPD.LT.IDSRUN) GO TO 70
      IF (ISTPD.GT.IDERUN) GO TO 70
C
C  CHECK IF THE PERIODS OVERLAP
      STRTWK=IDSRUN
      IF (ISTPD.GT.IDSRUN) STRTWK=ISTPD
      ENDWK=IDERUN
      IF (IENPD.LT.IDERUN) ENDWK=IENPD
C
C  DETERMINE THE NUMBER OF HOURLY VALUES TO SET TO MISSING
      NTIMES=ENDWK-STRTWK+1
C
C  DETERMINE WHERE IN THE ARRAY TO BEGIN TO SET THE VALUES TO MISSING
      J=STRTWK-IDSRUN
C
C  CHECK THAT THE WORK ARRAY IS NOT BEING OVERWRITTEN
      IF (NTIMES.LE.LWORK) GO TO 40
      IENDWK=ENDWK
      ENDWK=ENDWK-(LWORK-NTIMES)
      IDAWK=IENDWK/24+1
      IHRWK=IENDWK-IDAWK*24 + 24
C
      CALL MDYH2(IDAWK,IHRWK,IM,ID,IY,IH,NZXXX,NDXXX,INPTZC)
C
      LDAWK=ENDWK/24 + 1
      LHRWK=ENDWK-LDAWK*24 + 24
C
      CALL MDYH2(LDAWK,LHRWK,LM,LD,LY,LH,NZXXX,NDXXX,INPTZC)
C
      WRITE(IPR,120) NTIMES,LWORK,IM,ID,IY,IH,LM,LD,LY,LH,INPTZC
      NTIMES=LWORK
40    CONTINUE
C
C  SET THE WORK ARRAY TO MISSING
      DO 50 I=1,NTIMES
50    WORK(J+I)=-999.
C
      IDAPD=ISTPD/24 + 1
      IHRPD=ISTPD-IDAPD*24 + 24
C
      CALL MDYH2(IDAPD,IHRPD,IM,ID,IY,IH,NZXXX,NDXXX,INPTZC)
C
      IF (MECHAR.EQ.0) GO TO 60
C
      LDAPD=IENPD/24 + 1
      LHRPD=IENPD-LDAPD*24 + 24
C
      CALL MDYH2(LDAPD,LHRPD,LM,LD,LY,LH,NZXXX,NDXXX,INPTZC)
C
      WRITE(IPR,100) (STAID(I),I=1,2),DTYPE,IM,ID,IY,
     $  IH,LM,LD,LY,LH,INPTZC
C
      GO TO 70
60    WRITE (IPR,110) (STAID(I),I=1,2),DTYPE,
     $  IM,ID,IY,IH,INPTZC
C
70    CONTINUE
      IF (IPTRCE.GT.1) WRITE(IOPDBG,150)
C
      CALL FSTWHR(OLDOPN,IOLDOP,OLDOPN,IOLDOP)
C
80    FORMAT('0*** ENTER QSETMG')
90    FORMAT('0IN QSETMG, STAID=',2A4,'DTYPE=',A4,'ISTRT= ',3A4,
     $ ' MSCHAR= ',I2,' IEND= ',
     $ 3A4,' MECHAR= ',I2)
100   FORMAT('0*** THE DATA FOR STATION ',2A4,' AND DATA',
     $ ' TYPE ',A4,' IS BEING SET TO MISSING ',
     $ 'FROM ',I2,1H/,I2,1H/,I4,1H ,I2,1H ,
     $ ' THRU ',I2,1H/,I2,1H/,I4,1H ,I2,1H ,A4)
110   FORMAT('0*** THE DATA FOR STATION ',2A4,' AND DATA',
     $ ' TYPE ',A4,' IS BEING SET TO MISSING ',
     $ 'FOR HOUR ',I2,1H/,I2,1H/,I4,1H ,I2,1H ,A4)
120   FORMAT('0**WARNING** THE NUMBER OF VALUES TO BE SET TO MISSING,',
     $ I4,' EXCEEDS THE SIZE OF THE WORK ARRAY ',I4,/'0THE PERIOD',
     $ ' TO BE SET TO MISSING WILL BE TRUNCATED FROM ',I2,1H/,
     $ I2,1H/,I4,1H ,I2,' TO ',I2,1H/,I2,1H/,I4,1H ,I2,1H ,A4)
130   FORMAT('0**WARNING** THE STARTING DATE ',3A4,' COULD NOT BE',
     $ ' DECODED, THE MOD WILL NOT BE PROCESSED.')
140   FORMAT('0**WARNING** THE ENDING DATE ',3A4,' COULD NOT BE',
     $ ' DECODED, THE MOD WILL NOT BE PROCESSED.')
150   FORMAT('0*** EXIT QSETMG')
C
      RETURN
C
      END
