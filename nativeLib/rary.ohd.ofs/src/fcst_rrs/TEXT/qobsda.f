C MODULE QOBSDA
C-----------------------------------------------------------------------
C
C  WRITES THE OBSERVED INTEGER AND REAL DATA INTO A REAL ARRAY OR
C  OR WORK FILES.
C
C  ORIGINALLY CODED BY DEBBIE VAN DEMARK - 5/24/84
C
C----------------------------------------------------------------------
C
C  INPUT ARGUMENT
C        STAID - STATION IDENTIFIER
C        IMULT - MULTIPLE DATA TYPE PRINT INDICIATOR
C        IUNIT - WORK FILE UNIT
C         DESC - STATION DESCRIPTION
C       ISTNUM - STATION NUMBER FOR DATA ENTRY
C       NWROTE - NUMBER OF WORK FILES USED
C       IWROTE - ARRAY WITH UNIT NUMBERS OF WORK FILES USED
C       NVLPOB - NUMBER OF VALUES PER OBSERVATION
C                2 - INSTANEOUS DATA
C                3 - MEAN DATA
C          OBS - OBSERVED DATA ARRAY
C         IOBS - OBSERVED DATA ARRAY PASSED AS AN INTEGER
C       NUMOBS - NUMBER OF OBSERVATIONS
C        PRINT - ARRAY TO HOLD DATA FOR PRINT
C       IPRINT - ARRAY TO HOLD DATA FOR PRINT PASSED AS AN INTEGER
C       NUMHRS - NUMBER OF HOURS THAT CAN BE HELD IN THE PRINT ARRAY
C        FHOUR - FIRST HOUR OF OBSERVED DATA
C        LHOUR - LAST HOUR OF OBSERVED DATA
C
C  OUTPUT ARGUMENT
C        PRINT - PRINT DATA ARRAY
C
C----------------------------------------------------------------------
C
      SUBROUTINE QOBSDA (STAID,ST,DTYPE,DESC,ISTNUM,NWROTE,IWROTE,
     $   NVLPOB,OBS,IOBS,NUMOBS,PRINT,IPRINT,
     $   IMULT,IUNIT,NUMHRS,FHOUR,LHOUR)
C     
      DIMENSION OBS(1),IOBS(1),PRINT(1),IPRINT(1),STAID(2),DESC(5),
     $   IWROTE(1),OLDOPN(2)
C     
      INCLUDE 'common/pudbug'
      INCLUDE 'common/qprint'
      INCLUDE 'common/ionum'
      INCLUDE 'common/pptime'
      INCLUDE 'common/fctim2'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_rrs/RCS/qobsda.f,v $
     . $',                                                             '
     .$Id: qobsda.f,v 1.3 1999/07/06 15:56:59 page Exp $
     . $' /
C    ===================================================================
C
C
      IBUG=IPBUG(4HQOBS)
C
      IOPNUM=-3
      CALL FSTWHR('QOBSDA  ',IOPNUM,OLDOPN,IOLDOP)
C
      IF (IPTRCE.GT.2) WRITE(IOPDBG,140)
C
      NCOUNT=NUMOBS*NVLPOB
      IF (IMULT.EQ.1) GO TO 60
      DO 10 J=1,10
      IF (IWROTE(J).EQ.IUNIT) GO TO 30
10    CONTINUE
      NWROTE=NWROTE+1
      IF (NWROTE.LE.10) GO TO 20
      WRITE(IPR,210) NWROTE,(IWROTE(I),I=1,10),STAID,DTYPE
      CALL WARN
      GO TO 130
20    IWROTE(NWROTE)=IUNIT
      IF (IBUG.GT.0) WRITE(IOPDBG,200) NWROTE,(IWROTE(J),J=1,10)
C
C  IF THE PRLASTDY TECH IS ON, DETERMINE WHAT DATA WILL BE DISPLAYED
C
30    IBEG=1
      IF (IPLSTD.EQ.0) GO TO 50
      IBEG=0
      DO 40 I=1,NCOUNT,NVLPOB
      IF (IOBS(I)-NHOPDB.LT.((ILCRUN-1)/24)*24+1) GO TO 40
      IBEG=I
      GO TO 50
40    CONTINUE
C
50    WRITE(IUNIT) STAID,ST,ISTNUM,DTYPE,DESC,NVLPOB,NCOUNT,IBEG,
     $ (OBS(J),J=1,NCOUNT)
      IF (IBUG.GT.0) WRITE(IOPDBG,190)IUNIT,STAID,ST,DTYPE,NCOUNT,NVLPOB
     $, IBEG
      GO TO 130
C  INITIALIZE THE PRINT ARRAY
C
60    DO 70 I=1,NUMHRS
70    PRINT(I)=-10001.
C
C
      DO 90 I=1,NCOUNT,NVLPOB
      IPOINT=IOBS(I)-NHOPDB-ISTRUN+1
C  CHECK THAT ONLY PRINT OBSERVED DATA THAT IS WITHIN THE RUN PERIOD
C*******************************************************************
C  CHECK THAT DONT PRINT DATA AFTER THE END OF THE RUN PERIOD
      IF (IPOINT.LT.1) GO TO 90
C  CHECK DISPLAY TECHNIQUE
C
      IF (IPLSTD.EQ.0) GO TO 80
      IF (IOBS(I)-NHOPDB.LT.((ILCRUN-1)/24)*24+1) GO TO 90
C
C  WRITE TO WORK FILES FOR MULTIPLE DATA TYPE DISPLAY
C
C  WRITE MULTIPLE DATA TYPES TO PRINT ARRAY
80    PRINT(IPOINT)=OBS(I+1)
      IF (NVLPOB.EQ.2) GO TO 90
      IPRINT(IPOINT)=IOBS(I+2)
90    CONTINUE
C
C     IF (LHOUR-FHOUR.GT.NUMHRS) GO TO
C***********************************************************************
C
      IF (IBUG.EQ.0) GO TO 130
      IF(NVLPOB.EQ.3) GO TO 110
      WRITE(IOPDBG,150)
      DO 100 I=1,NUMHRS
      IF (PRINT(I).GT.-10001.) WRITE(IOPDBG,160) I,PRINT(I)
100   CONTINUE
      GO TO 130
110   WRITE(IOPDBG,170)
      DO 120 I=1,NUMHRS
      IF (PRINT(I).GT.-10001.) WRITE(IOPDBG,180) I,PRINT(I),IPRINT(I)
120   CONTINUE
      GO TO 130
C
C
130   CONTINUE
C
      CALL FSTWHR(OLDOPN,IOLDOP,OLDOPN,IOLDOP)
C
      IF (IPTRCE.GT.2) WRITE(IOPDBG,220)
C
140   FORMAT('0*** ENTER QOBSDA ')
150   FORMAT('0INSTANTANEOUS DATA WRITTEN INTO THE PRINT ARRAY'/
     $ ' THE ARRAY ELEMENT ',2X,' THE OBSERVATION ')
160   FORMAT(1X,I6,15X,G15.7)
170   FORMAT('0MEAN DATA WRITTEN INTO THE PRINT ARRAY'/
     $ ' THE ARRAY ELEMENT ',2X,' THE OBSERVATION ',2X,'THE OBS PERIOD')
180   FORMAT(1X,I6,15X,G15.7,2X,I6)
190   FORMAT('0DATA WRITTEN TO WORK FILE ',I6,'  FOR STATION ',2A4,
     $ ' STATE ',A2, ' AND DATA TYPE ',A4,'.'/'  THERE WERE ',I7,
     $ ' TOTAL OBSERVATIONS WITH ',I2,' VALUES PER OBS AND IBEG= ',I7)
200   FORMAT(' IN QOBSDA NWROTE= ',I5,' IWROTE= ',10(2X,I6))
210   FORMAT(1X,I6,' VALUES CANNOT BE WRITTEN INTO THE FILE UNIT',
     $ ' ARRAY WHICH IS DIMENSIONED AT 10. THE FILE UNIT ARRAY IS',
     $ ' AS FOLLOWS:',/10(I7),/' THIS OCCURRED FOR STATION' ,2A4,
     $ ' AND DATA TYPE ',A4)
220   FORMAT('0*** EXIT QOBSDA ')
      RETURN
      END
