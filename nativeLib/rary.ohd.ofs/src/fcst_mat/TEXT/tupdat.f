C   MODULE TUPDAT
C
      SUBROUTINE TUPDAT(MAXT,MINT,INSTT,NINST,IARY,LOC,IFUT,
     1 KODE,MSNG)
C
C   THIS SUBROUTINE COPIES CURRENT DATA INTO THE PREVIOUS
C   DATA ARRAYS.
C
C   THIS SUBROUTINE WAS ORIGINALLY WRITTEN BY GERALD N. DAY .
C
      LOGICAL*1 KODE,LKODE
      INTEGER   B,E,IKODE
      EQUIVALENCE( LKODE,IKODE )
      LOGICAL LBUG
C
      INTEGER*2 MAXT,MINT,INSTT,IARY,MEANMX,MEANMN,MSNG
C
      DIMENSION SBNAME(2),OLDOPN(2),KODE(10),INSTT(1),IARY(1)
C
      INCLUDE 'common/pudbug'
      INCLUDE 'common/tloc'
      INCLUDE 'common/where'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_mat/RCS/tupdat.f,v $
     . $',                                                             '
     .$Id: tupdat.f,v 1.1 1995/09/17 19:03:18 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA SBNAME/4HTUPD,4HAT  /,DCODE/4HTUPD/
      DATA B,E,IKODE / 4HB   ,4HE   ,4H     /
C
      IER=0
      IF(IPTRCE.GE.1) WRITE(IOPDBG,900)
  900 FORMAT(1H0,18H** TUPDAT ENTERED.)
C
      LBUG=.FALSE.
      IF(IPBUG(DCODE).EQ.1) LBUG=.TRUE.
C
      IOLDOP=IOPNUM
      IOPNUM=-2
      DO 10 I=1,2
      OLDOPN(I)=OPNAME(I)
   10 OPNAME(I)=SBNAME(I)
C
      IF(.NOT.LBUG) GO TO 110
      IF(NINST.LE.0) GO TO 20
      WRITE(IOPDBG,910) MAXT,MINT,LOC,IFUT,(INSTT(I),I=1,NINST)
  910 FORMAT(1H0,36HIN TUPDAT, MAXT,MINT,LOC,IFUT,INSTT=,12I6)
      GO TO 110
   20 WRITE(IOPDBG,920) MAXT,MINT,LOC,IFUT
  920 FORMAT(1H0,30HIN TUPDAT, MAXT,MINT,LOC,IFUT=,4I6)
C
  110 INDEX=(LOC-1)/5
C
      LMEAN=IARY(LOC+1)
      LIP=IARY(LOC+2)
      MEANMX=IARY(LMEAN-1+LOCMMX)
      MEANMN=IARY(LMEAN-1+LOCMMN)
C
C   MAXIMUM TEMPERATURE
C
      LOCP=INDEX*3+LOCPMX
      LKODE = KODE(1)
      IF(IKODE.NE.B) GO TO 150
C
C   MAXIMUM IS NOT AVAILABLE - UPDATE NDAYS
C
      IF(IARY(LOCP+2).GT.0) IARY(LOCP+2)=IARY(LOCP+2)+1
      GO TO 200
C
C   MAXIMUM IS AVAILABLE
C
  150 IARY(LOCP)=MAXT
      IARY(LOCP+1)=MEANMX
      IARY(LOCP+2)=1
C
C   MINIMUM TEMPERATURE
C
  200 LOCP=INDEX*3+LOCPMN
      LKODE = KODE(2)
      IF(IKODE.NE.B) GO TO 250
C
C   MINIMUM IS NOT AVAILABLE - UPDATE NDAYS
C
      IF(IARY(LOCP+2).GT.0) IARY(LOCP+2)=IARY(LOCP+2)+1
      GO TO 300
C
C   MINIMUM IS AVAILABLE
C
  250 IARY(LOCP)=MINT
      IARY(LOCP+1)=MEANMN
      IARY(LOCP+2)=1
C
  300 IF(IFUT.EQ.1.OR.LIP.EQ.0) GO TO 390
C
C   12Z INSTANTANEOUS TEMPERATURE
C
      IARY(INDEX+LOCC12)=INSTT(NINST)
      LKODE = KODE(2+NINST)
      IF(IKODE.EQ.E) IARY(INDEX+LOCC12)=IARY(INDEX+LOCC12)-5000
C
  390 CONTINUE
C
      IOPNUM=IOLDOP
      OPNAME(1)=OLDOPN(1)
      OPNAME(2)=OLDOPN(2)
C
      RETURN
      END

