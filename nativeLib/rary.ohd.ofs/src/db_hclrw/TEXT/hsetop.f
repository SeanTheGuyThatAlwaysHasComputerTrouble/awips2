C MODULE HSETOP
C-----------------------------------------------------------------------
C
      SUBROUTINE HSETOP
C
C  THIS ROUTINE CHECKS THE OPTIONS FILE FOR OPTIONS THAT DO NOT HAVE
C  ANY IDENTIFIERS AND THEREFORE ARE FOR ALL. IT IS SIMILAR TO SEGID,
C  BUT IT IS CALLED ONLY ONCE AT THE BEGINNING OF THE COMPUTE COMMAND.
C  
      INCLUDE 'uiox'
      INCLUDE 'udebug'
      INCLUDE 'hclcommon/hcurfc'
      INCLUDE 'hclcommon/hseg1'
      INCLUDE 'hclcommon/hgtech'
      INCLUDE 'hclcommon/htechn'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/db_hclrw/RCS/hsetop.f,v $
     . $',                                                             '
     .$Id: hsetop.f,v 1.2 2001/06/13 13:38:41 dws Exp $
     . $' /
C    ===================================================================
C
C
C  CHECK IF ANY OPTIONS RECORDS
      IF (MAXOPT.EQ.0) GO TO 130
C
      NUMRED=0
C
10    NXOPT=LRECOP
C
C  GET THE OPTION RECORD
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 130
C
C  COMPUTE RECORD NUMBER OF NEXT OPTION
      NXREC=IOPTRC(1)+NUMRED-1
C
C  CHECK IF OPTION MATCHES CURRENT FUNCTION (0 FOR ALL)
      NXOPT=2
      IF (IOPTRC(NXOPT).NE.0.AND.IOPTRC(NXOPT).NE.IHCFUN) GO TO 100
20    CALL HINCNX
      IF (ISTAT.NE.0) GO TO 130
C
C  CHECK IF END OF OPTION
30    IF (IOPTRC(NXOPT).EQ.0) GO TO 100
C
C  SET START OF NEXT OPTION AND COMPUTE RECORD NUMBER
      NEXT=IOPTRC(NXOPT)+NXOPT+1
      NR=(NEXT-1)/LRECOP
      NRSAVE=NUMRED+NR
C
C  CHECK THIS OPTION - SKIP IT IF THERE ARE ANY IDS
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 110
C
C CHECK IF TECHNIQUE OR MOD - IF MOD DO NOT USE
      ITN=IOPTRC(NXOPT)
      IF (ITN.EQ.0) GO TO 80
C
C  GET TECHNIQUE VALUE
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 110
      IVAL=IOPTRC(NXOPT)
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 110
C
C  SKIP IF THERE ARE ANY IDENTIFIERS
      IF (IOPTRC(NXOPT).NE.0) GO TO 80
C
C  USE THIS OPTION
      IF (ITN) 40,80,50
C
C  SET THE TECHNIQUE VALUE
40    IGTECH(-ITN)=IVAL
      GO TO 60
50    ITECH(ITN)=IVAL
C
60    IF (IHCLDB.GT.0) WRITE (IOGDB,70) ITN,IVAL
70    FORMAT (' IN HSETOP - SET TECH=',I4,' TO ',I4)
C
C  SET ARGUMENTS
      CALL HSETAR
      IF (ISTAT.NE.0) GO TO 110
      GO TO 20
C
C  SKIP TO NEXT TECHNIQUE WITHIN OPTION
80    IF (NRSAVE.LE.NUMRED) GO TO 90
C
C  NEED TO READ A RECORD TO GET TO NEXT OPTION
      NXOPT=LRECOP
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 110
      GO TO 80
C
90    NXOPT=NEXT-NR*LRECOP
      GO TO 30
C
C  ENTIRE OPTION SET IS TO BE SKIPPED
100   IF (NXREC.EQ.NUMRED) GO TO 10
      NUMRED=NXREC
      GO TO 10
C
110   WRITE (LP,120)
120   FORMAT ('0**ERROR** IN HSETOP - UNEXPECTED END OF FILE ',
     *   'ENCOUNTERED READING OPTIONS FILE.')
C
130   RETURN
C
      END
