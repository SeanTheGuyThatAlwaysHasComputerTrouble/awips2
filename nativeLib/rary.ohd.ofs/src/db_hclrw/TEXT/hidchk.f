C MODULE HIDCHK
C-----------------------------------------------------------------------
C
      SUBROUTINE HIDCHK (SEGID,FGID,CGID,MAXMOD,MODCRD,NUMMOD,IERR)
C
C  ROUTINE TO SET VALUES FOR TECHNIQUES AND ARGUMENTS USING THE 
C  RUN-TIME OPTIONS WHICH ARE STORED IN THE RUN-TIME OPTIONS FILE.
C
C  IF AN IDENTIFIER MATCHES THE DENTIFIER IN THE OPTION, THE TECHNIQUE
C  AND ARGUMENTS WILL BE INCLUDED OR EXCLUDED AS SPECIFIED.
C
C  ARGUMENT LIST:
C
C       NAME      TYPE  I/O   DIM     DESCRIPTION
C       ------    ----  ---   ---     -----------
C       SEGID      A8    I     1      SEGMENT NAME
C       FGID       A8    I     1      FORECAST GROUP NAME
C       CGID       A8    I     1      CARRYOVER GROUP NAME
C       MAXMOD     I*4   I     1      MAXIMUM NUMBER OF MOD CARDS
C       MODCRD     A80   O   MAXMOD   MOD CARDS
C       NUMMOD     I*4   O     1      ACTUAL NUMBER OF CARDS IN MODCRD
C       IERR       I*4   O     1      STATUS CODE: 0=OK, NOT 0, ERROR
C
      CHARACTER*8 SEGID,FGID,CGID
      CHARACTER*8 RTNNAM,RTNOLD
      CHARACTER*80 MODCRD(NUMMOD)
C
      INCLUDE 'uiox'
      INCLUDE 'udebug'
      INCLUDE 'udatas'
      INCLUDE 'hclcommon/hcurfc'
      INCLUDE 'hclcommon/htechn'
      INCLUDE 'hclcommon/hgtech'
      INCLUDE 'hclcommon/hseg1'
      INCLUDE 'hclcommon/hunits'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/db_hclrw/RCS/hidchk.f,v $
     . $',                                                             '
     .$Id: hidchk.f,v 1.2 2001/06/13 13:42:37 dws Exp $
     . $' /
C    ===================================================================
C
C   
      RTNNAM='HIDCHK'
C
      IF (IHCLTR.GT.1) WRITE (LP,*) 'ENTER ',RTNNAM
C
      IOPNUM=0
      CALL FSTWHR (RTNNAM,IOPNUM,RTNOLD,IOLDOP)
C
      IERR=0
      NUMMOD=0
      NUMRED=0
      IF (MAXMOD.GT.0) MODCRD(1)=' '
C
C  READ TEMPORAY FILE TO GET TECHNIQUE AND ARGUMENT VALKES
      CALL HGETTA
C
C START AT BEGINNING OF RUN-TIME OPTION FILE AND SEARCH FOR PERTINENT
C IDENTIFIERS
10    NXOPT=LRECOP
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 200
C
      NXREC=IOPTRC(1)+NUMRED-1
C
      IF (IOPTRC(2).NE.0.AND.IOPTRC(2).NE.IHCFUN) GO TO 170
C
      NXOPT=2
C
C  CHECK IF RECORD IS FINISHED AND NEED TO GET NEXT OPTION
20    CALL HINCNX
      IF (ISTAT.NE.0) GO TO 200
C
30    IF (IOPTRC(NXOPT).EQ.0) GO TO 170
C
C NEXT IS THE START OF THE NEXT TECH OR MOD IN THIS OPTION
C NRSAVE IS THE NEXT OPTION RECORD NUMBER IN CURRENT OPTION
C NR IS NUMBER OF RECORDS UNTIL NEXT OPTION WITHIN THIS OPTION REC
      NEXT=IOPTRC(NXOPT)+NXOPT+1
      NR=(NEXT-1)/LRECOP
      NRSAVE=NUMRED+NR
C
C  THIS IS AN OPTION TO BE EXAMINED
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 180
C
C  PICK UP TECHNIQUE NUMBER OR MOD (ZERO)
      ITN=IOPTRC(NXOPT)
C
C  IF A MOD, NO IDS WILL BE THERE
      IF (ITN.EQ.0) GO TO 130
C
C  IT IS A TECHNIQUE - GET VALUE TO SET
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 180
      IVAL=IOPTRC(NXOPT)
C
C  MATCH IDS AS SPECIFIED IN CALL
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 180
C
C  IF NO IDS USE OPTION AS IS
      IF (IOPTRC(NXOPT).EQ.0) GO TO 90
      NIDSET=IOPTRC(NXOPT)
      IFLAG=0
C
C  GET ID TYPE
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 180
      ITYPE=IOPTRC(NXOPT)
      GO TO (50,60,70),ITYPE
C
C  CHECK IF SEGMENT IDENTIFIER IS IN OPTIONS RECORD
50    CALL HMCHID (1,SEGID,NIDSET,IFLAG)
      GO TO 80
C
C  CHECK IF FORECAST GROUP IDENTIFIER IS IN OPTIONS RECORD
60    IF (FGID.NE.' ') CALL HMCHID (2,FGID,NIDSET,IFLAG)
      GO TO 80
C
C  CHECK IF CARRYOVER GROUP IDENTIFIER IS IN OPTIONS RECORD
70    IF (CGID.NE.' ') CALL HMCHID (3,CGID,NIDSET,IFLAG)
C
C  IF FLAG IS SET USE IT - ELSE SKIP TO NEXT
80    IF (IFLAG.LE.0) GO TO 140
C
90    IF (ITN) 100,130,110
C
C  SET GLOBAL TECHNIQE
100   IGTECH(-ITN)=IVAL
      GO TO 120
C
C  SET LOCAL TECHINIQUE
110   ITECH(ITN)=IVAL
C
C  LOOK FOR ARGUMENTS
120   CALL HSETAR
      IF (ISTAT.NE.0) GO TO 200
      GO TO 20
C
C  THIS IS A MOD - CHECK IF MODS WANTED
130   IF (MAXMOD.LE.0) GO TO 140
      CALL HPASMD (MAXMOD,MODCRD,NUMMOD,SEGID,FGID)
      IF (ISTAT.NE.0) GO TO 180
      GO TO 20
C 
C NOT USING THIS TECH OR MOD - TRY NEXT TECH OR MOD
140   IF (NRSAVE.LE.NUMRED) GO TO 150
C
C  READ RECORDS TO GET TO NEXT OPTION
      NXOPT=LRECOP
      CALL HINCNX
      IF (ISTAT.NE.0) GO TO 180
      GO TO 140
C
150   NXOPT=NEXT-NR*LRECOP
C
      IF (IHCLDB.GT.1) WRITE (IOGDB,160) NEXT,NR,NRSAVE,NUMRED,NXOPT
160   FORMAT (' IN HIDCHK - SKIPPING TO NEXT OPTION'/5X,' NEXT=',I4,
     *   ' NR=',I4,' NRSAVE=',I4,' NUMRED=',I4,' NXOPT=',I4)
      GO TO 30
C
C  GO TO NEXT OPTION
170   IF (NXREC.EQ.NUMRED) GO TO 10
      NUMRED=NXREC
      GO TO 10
C
180   WRITE (LP,190)
190   FORMAT ('0**ERROR** UNEXPECTED EOF ON RUN OPTIONS.')
      CALL ERROR
C
200   IF (IHCLDB.GT.1) WRITE (IOGDB,210) ITECH
210   FORMAT (' IN HIDCHK - ITECH=',50I2/(19X,50I2))
      IF (IHCLDB.GT.1) WRITE (IOGDB,220) IGTECH
220   FORMAT (' IN HIDCHK - IGTECH=',50I2/(19X,50I2))
C
      CALL FSTWHR (RTNOLD,IOLDOP,RTNOLD,IOLDOP)
C
      IF (IHCLTR.GT.1) WRITE (IOGDB,*) 'EXIT ',RTNNAM
C
      RETURN
C
      END
