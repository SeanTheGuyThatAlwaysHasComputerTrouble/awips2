C MODULE XNIT51
C-----------------------------------------------------------------
C DESC INITIALIZE VARIABLES FOR EXECUTION OF 'SSARRESV'
C----------------------------------------------------------------
C  ROUTINE TO SET VALUES FOR GENERAL PURPOSE VARIABLES FOR THE
C  EXECUTION ROUTINE FOR THE RESERVOIR OPERATION.
C----------------------------------------------------------------
C  WRITTEN BY KUANG HSU - HRL - OCTOBER 1994
C-----------------------------------------------------------------
      SUBROUTINE XNIT51(PO)
C 
      INCLUDE 'common/fctime'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/fprog'
      INCLUDE 'common/sarr51'
      INCLUDE 'common/xco51'
      INCLUDE 'common/fcary'
C
      DIMENSION PO(*)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_ssarresv/RCS/xnit51.f,v $
     . $',                                                             '
     .$Id: xnit51.f,v 1.2 1998/07/02 16:36:36 page Exp $
     . $' /
C    ===================================================================
C
C
C  DEBUG OUTPUT IF REQUESTED
C
      IF (IBUG.GE.1) WRITE(IODBUG,1600)
 1600 FORMAT('   *** ENTER XNIT51 ***')
      IF(IBUG.GE.2)
     & WRITE(IODBUG,892) IDA,IHR,LDA,LHR,IDADAT,LDACPD,LHRCPD
 892  FORMAT(8X,3HIDA,7X,3HIHR,7X,3HLDA,7X,3HLHR,4X,6HIDADAT,
     & 4X,6HLDACPD,4X,6HLHRCPD/1X,8I10)
C
C  SET NO. OF RESERVOIR: =2, FOR BACKWATER RESERVOIR SYSTEM
      NRES = PO(9)
C
C  SET NO. OF TIME PERIODS WITHIN THE DAY
C
      MINODT = PO(7)
      NTIM24 = 24/MINODT
C
C  SET PERIOD COUNTER TO FIRST PERIOD FOR ANY PRE-LOOP COMP. TASKS
C
      NS2 = 1
C
C  COMPUTE NO. OF DAYS DATA IS OFFSET FROM START OF D ARRAY POSTIONS
C  HOLDING DATA FOR TIME-SERIES. (NO. OF POSITIONS IS DEPENDENT ON
C  INTERVAL OF TIME-SERIES AND WILL BE COMPUTED WHEN TS IS USED.)
C
      IDOFST = IDA - IDADAT
C
C  SET TIMING INFORMATION (NO. OF PERIODS IN RUN, NO. OF PERIODS IN
C  OBSERVED PERIOD, AND THE CURRENT PERIOD (INITIALLY 1))
C  NOTE: ONLY FULL DAYS OF OBSERVED DATA WILL BE USED. ANY PARTIAL
C        DAYS ARE TRUNCATED.
C
      NUM = (LDA - IDA)*NTIM24 + (LHR-IHR)/MINODT + 1
      NRUN = (LDACPD - IDA)*NTIM24 + LHRCPD/MINODT
      IF (NRUN.LT.0) NRUN = 0
      IF (NRUN.GT.NUM) NRUN = NUM
C
      IF (IBUG.GE.2) WRITE(IODBUG,1605) MINODT,NTIM24,NUM,NRUN,IDOFST
 1605 FORMAT('   *** OPERATION DELTA-T =',I5/'    *** NO. OF PERIODS',
     .' PER DAY = ',I5/'     *** NO. OF PERIODS IN RUN = ',I5/
     .'      *** NO. OF PERIODS IN OBSERVED PART OF RUN = ',I5/
     .'       *** NO. OF DAYS OF DATA OFFSET = ',I5)
C
C  SET RELATIVE JULIAN DATE, THE DAY OF THE WEEK, THE NUMBER OF DAYS
C  IN THE YEAR, AND THE HOUR OF MIDNIGHT IN THE HYDROLOGIC DAY.
C
      CALL MDYH1(IDA,IHR,IMON,IDAY,IYEAR,IHRM,NLSTZ,NOUTDS,TZCS)
      CALL FCTZC(NLSTZ,NOUTDS,TZCS)
      CALL JULDA(IDABGN,IHRB,1,1,IYEAR,IHRM,NLSTZ,NOUTDS,TZCS)
C
C  SSARR USES HOUR 1-24 IN A DAY, RATHER THAN 0-23
C  STORE BEGINNING HOUR IN TENTH OF HOUR
      ITME(1) = (IHR-MINODT)*10
      JULDAT = IDA - IDABGN + 1
C
      JDAWEK = MTWT26(IDA,IHR)
C
      NODAYR = 365 + LEAP26(IDA,IHR)
      MIDNIT = 0
      IF (IBUG.GE.2) WRITE(IODBUG,1610) JULDAT,JDAWEK,NODAYR,
     .  IDA,IDABGN
 1610 FORMAT('   REL. JUL. DATE = ',I5/'   DAY OF WEEK = ',I3,
     ./'   NO. OF DAYS IN YEAR = ',I4/'   JULIAN DATE 1ST DAY OF RUN = '
     .,I6/'   JULIAN DATE 1ST DAY OF YR = ',I6)
C
C  SET INDICATOR FOR FIRST ENTRY INTO POWER GENERATION SCHEME
C
      IENTER = -999
C
C  NOW SET POSITIONS WITHIN RUN FOR SAVING CARRYOVER (IF CARRYOVER IS
C   REQUESTED (I.E. - BOTH IFILLC AND NCSTOR ARE > 0))
C
      ISAVCO = IFILLC*NCSTOR
      NUMCOV = NRES*4+1
C
      DO 500 I=1,20
      ICOPOS(I) = 0
  500 CONTINUE
C
C  IF WE NEED TO SAVE CARRYOVER, SET POSITIONS HERE
C
      IF (ISAVCO.LE.0) GO TO 9999
C
C  COMPUTE POSITIONS BY CONVERTING CARRY DATES TO JULIAN HOURS,
C  SUBTRACTING THE INITIAL RUN DATE (IN JULIAN HOURS) AND DIVIDING BY
C  THE OPERATION TIME INTERVAL.
C
      JULBGN = IDA*24
      IF (IBUG.GE.2) WRITE(IODBUG,1650)
 1650 FORMAT('  CARRYOVER TO BE SAVED. TIME PERIODS ARE :')
C
      DO 550 I=1,NCSTOR
      JULHR = ICDAY(I)*24 + ICHOUR(I)
      ICOPOS(I) = (JULHR-JULBGN)/MINODT
      IF (IBUG.GE.2) WRITE(IODBUG,1660) ICOPOS(I)
 1660 FORMAT(I5)
  550 CONTINUE
C
C  THAT'S IT!!!
C
 9999 CONTINUE
C
C  TRACE MESSAGE IF REQUESTED
C
      IF (IBUG.GE.1) WRITE(IODBUG,1699)
 1699 FORMAT('    *** EXIT XNIT51 ***')
      RETURN
      END
