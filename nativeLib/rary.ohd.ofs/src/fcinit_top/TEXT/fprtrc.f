C MEMBER FPRTRC
C  (from old member FCFPRTRC)
C-----------------------------------------------------------------------
C
C                             LAST UPDATE: 08/14/95.11:20:59 BY $WC21DT
C
C @PROCESS LVL(77)
C
C...................................................................
C
       SUBROUTINE FPRTRC
C
C......................................................................
C
C  SUBROUTINE FPRTRC READS DATA CARDS LISTING I.D.'S OF RATING CURVE
C  RECORDS THAT ARE TO BE PRINTED AND DETERMINES THE FILE LOATION FOR
C   EACH CURVE (ID=RCIDEN(I)) BY CALLING SUBROUTINE FINDRC.  SUB-
C   ROUTINE FCRDRC IS THEN CALLED TO MOVE THE DATA FROM THE FILE TO
C   /FRATNG/.  THEN SUBROUTINE FPRRC IS CALLED TO PRINT THAT DATA.
C  ** NOTE **  IN CALIBRATION PROGRAM, THIS SUBROUTINE IS NOT USED
C
C
C.....................................................................
C
C  SUBROUTINE ORIGINALLY WRITTEN BY --
C      JONATHAN WETMORE - HRL - 801031
C  FREE FORMAT ENTRY ADDED --
C      JOE OSTROWSKI -- HRL -- 810506
C  ALLRC OPTION ADDED --
C      JOE OSTROWSKI -- HRL -- 811124
C  UNITS AND IDS SUBCOMMAND ADDED --
C      JOE OSTROWSKI -- HRL -- 820323
C  CHANGED TO ALLOW 100 ITEMS IN RDLIST
C    GEORGE F. SMITH -- HRL -- 3/28/86
C  RCFORMAT SUBCOMMAND ADDED --
C      GEORGE SMITH -- HRL -- 5/1987
C
C....................................................................
C
      INCLUDE 'common/fprog'
      INCLUDE 'common/fratng'
      INCLUDE 'common/frcptr'
      INCLUDE 'common/frcfil'
      INCLUDE 'common/fcunit'
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/errdat'
      INCLUDE 'common/where'
      INCLUDE 'common/fctime'
C
      CHARACTER*80 IBUF,NCARD(30),WORD
      CHARACTER*10 XCOMD(8)
      DIMENSION SUBNAM(2),OLDSUB(2),RTCVNM(2),
     .ALIST(5,100),UNITS(4),RCFMT(2)
      DIMENSION NAME(2),NUMC(100),RLIST(5,100)
      LOGICAL PRTALL
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcinit_top/RCS/fprtrc.f,v $
     . $',                                                             '
     .$Id: fprtrc.f,v 1.2 1996/01/17 18:56:37 page Exp $
     . $' /
C    ===================================================================
C
      DATA RTCV,SUBNAM/4HRTCV,4HFPRT,4HRC  /,NAME/4HPRIN,4HTRC /
      DATA BLANK/4H    /
      DATA OBSO,OLETE/4HOBSO,4HLETE/
      DATA NCOMD/8/
      DATA XCOMD/'IDENTIFIER','IDS','ID','I','UNITS','U','RCFORMAT',
     .           'ALLRC'/
C
      DATA UNITS/4HENGL,4HE   ,4HMETR,4HM   /
      DATA RCFMT/4HMARF,4HC   /,HARC/4HHARC/
C
C  SET /WHERE/ INFO
C
      DO 500 I=1,2
      OLDSUB(I) = OPNAME(I)
  500 OPNAME(I) = SUBNAM(I)
      IOLDOP = IOPNUM
      IOPNUM = -1
C
      IBUG = 0
      IF (IFBUG(RTCV).EQ.1) IBUG = 1
C
      IF (ITRACE.GE.1) WRITE(IODBUG,1601)
 1601 FORMAT(1H ,21H *** ENTER FPRTRC ***)
C
C  PRINT HEADING
C
      WRITE(IPR,601)
  601 FORMAT(1H1,//,1X,80(1H*)/2H *,78X,1H*,/1X,1H*,29X,20HRATING CURVE
     1DISPLAY,29X,1H*,/2H *,78X,1H*/1X,80(1H*),///)
C
C......................
C  READ ALL INPUT RECORDS FOR PRINTRC COMMAND
C
      CALL CDINPT(NCARD,30,LASTCD,NAME,IERC)
      IF (IERC.GT.0) GO TO 8000
C
      IF (LASTCD.EQ.0) GO TO 110
      OPTN = BLANK
      PRTALL = .FALSE.
      NVAR = 2
      ICARD = 0
      NUMRC = 0
C
    5 ICARD = ICARD+1
      IF (ICARD.GT.LASTCD) GO TO 700
C................................
C  FUNPAK TAKES A CARD IN 20A4 FORMAT AND CONVERTS IT TO AN 80A1 FORMAT
C  FNEXT FINDS THE NEXT CHARACTER STRING ON A CARD (DELIMITED BY BLANKS
C   OR COMMAS).
      CALL UMEMOV(NCARD(ICARD),IBUF,20)
      IF (IBUG.GE.1) WRITE(IODBUG,1662) ICARD,LASTCD,IBUF
 1662 FORMAT(21H   * NOW ON CARD NO. ,I2,04H OF ,I2,01H./
     .    13H     CARD IS ,A)
      CALL USCAN2(IBUF,' ',1,WORD,LWORD,IERR)
      NCHAR=LWORD
      IF (IBUG.GE.1) WRITE(IODBUG,1663) NCHAR,WORD
 1663 FORMAT('  NEXT FIELD STARTS, NO. OF CHARS = ',I2,' STRING = ',A50)
C
C.............................
C  THE FUNCTION IFKYVL TRIES TO MATCH A CHARACTER STRING WITH AN ITEM
C  IN A LIST OF KEYWORDS.
C
C   IF IDEST = 0, NO MATCH FOUND
C            = 1,2,3,4,5,6, A LIST OF VALUES IS TO BE READ,
C            = 7, ALL NON-OBSOLETE RATING CURVES ARE TO BE PRINTED,
C
      IDEST=0
      DO 105 J=1,NCOMD
         IF (WORD.EQ.XCOMD(J)) IDEST=J
105   CONTINUE
      IF (IBUG.GE.1) WRITE(IODBUG,1604) IDEST
 1604 FORMAT(10H  IDEST = ,I2)
C
      ID = IDEST+1
      GO TO (9997,200,200,200,200,200,200,200,400),ID
C
C................................
C  LIST OF ITEMS IS TO BE READ
C
  200 CONTINUE
      CALL UMEMOV(NCARD(ICARD),IBUF,20)
C............................
C  READ LIST OF EITHER RC IDENTIFIERS OR UNITS SPECIFICATION
C
      CALL RDLIST(ICARD,LASTCD,NCARD,ALIST,NLIST,NVAR,NUMC,IERC)
      IF (IERC.GT.0) GO TO 8000
      IF (NLIST.EQ.0) GO TO 5
      IF (IDEST.LE.4) GO TO 210
      IF(IDEST.LE.6)GO TO 300
      GO TO 330
C
C.................................
C  LIST OF ID'S FOUND
C
  210 CONTINUE
      NUMRC = NLIST
      DO 250 I=1,NUMRC
      RLIST(1,I) = ALIST(1,I)
  250 RLIST(2,I) = ALIST(2,I)
      IF (IBUG.GE.1) WRITE(IODBUG,1603) ((ALIST(I,J),I=1,2),J=1,NLIST)
 1603 FORMAT(42H  ** LIST OF RC IDENTIFIERS TO BE PRINTED:/6(4X,2A4))
      GO TO 5
C
C........................................
C  'UNITS' SUBCOMMAND FOUND
C
  300 CONTINUE
      IF (IBUG.GE.1) WRITE(IODBUG,1655) (ALIST(I,1),I=1,2)
 1655 FORMAT(33H 'UNITS' SUBCOMMAND FOUND. ID IS ,2A4)
C
      DO 310 I=1,4
      IF (ALIST(1,1).EQ.UNITS(I)) GO TO 320
  310 CONTINUE
C......................
C  NO VALID UNITS ID FOUND
      WRITE(IPR,614) ALIST(1,1),ALIST(2,1)
  614 FORMAT('0**WARNING**'/22X,16HTHE UNITS TYPE ',2A4,
     . 22H' IS NOT A VALID CODE./22X,28HIT SHOULD BE EITHER 'METRIC',
     .13H OR 'ENGLISH',12H OR 'BLANK'.,/22X,27HDEFAULT UNITS WILL BE USE
     .D.)
      CALL WARN
      OPTN = BLANK
      GO TO 5
C
  320 CONTINUE
      MO = 2*((I-1)/2)+1
      OPTN = UNITS(MO)
      IF (IBUG.GE.1) WRITE(IODBUG,1656) OPTN
 1656 FORMAT(11H    OPTN = ,A4)
      GO TO 5
C
C......................
C  'RCFORMAT' SUBCOMMAND FOUND
C
 330  IF(IBUG.GT.0)WRITE(IODBUG,1650)(ALIST(I,1),I=1,2)
 1650 FORMAT(45H 'RCFORMAT' SUBCOMMAND FOUND. FORMAT TYPE IS ,2A4)
C
      IF(ALIST(1,1).EQ.RCFMT(1).AND.ALIST(2,1).EQ.RCFMT(2))GO TO 340
C
C  INVALID RCFORMAT KEYWORD FOUND
C
      WRITE(IPR,615) ALIST(1,1),ALIST(2,1)
  615 FORMAT('0**WARNING**'/22X,24HTHE RATING CURVE FORMAT ,
     1 6HTYPE ',2A4,22H' IS NOT A VALID TYPE./22X,
     2 'IT SHOULD BE EITHER ''MARFC'' OR ''BLANK''.'/22X,
     3 'THE DEFAULT TYPE OF ''BLANK'' WILL BE USED.')
      CALL WARN
      OPTN=BLANK
      GO TO 5
C
C VALID RCFORMAT OPTION FOUND - CURRENTLY ONLY 'MARFC'
C
 340  OPTN=HARC
      IF(IBUG.GT.0)WRITE(IODUBG,1656)OPTN
      GO TO 5
C
C  IF 'ALLRC' HAS BEEN ENTERED FIRST IN THE RATING CURVE LIST,
C   PRINT ALL NON-'OBSOLETE' RATING CURVES BY GETTING LIST FROM
C   /FRCPTR/
C
  400 CONTINUE
      PRTALL = .TRUE.
      IF (IBUG.GE.1) WRITE(IODBUG,1606)
 1606 FORMAT(51H  *****   ALL RATING CURVES ARE TO BE PRINTED *****)
      GO TO 5
C
C......................
C......................................
C  NOW LOOP THROUGH AND PRINT RATING CURVES
C
  700 CONTINUE
      IF (PRTALL) NUMRC = NRC
      IF (NUMRC.GT.0) GO TO 710
  110 WRITE(IPR,600)
  600 FORMAT('0**ERROR** -- NO IDENTIFIERS PROVIDED FOR THIS',
     . 17H PRINTRC COMMAND./22X,38HAT LEAST ONE IDENTIFIER MUST BE INPUT
     ..)
      GO TO 8000
C
  710 DO 800  I=1,NUMRC
      RTCVNM(1)=RLIST(1,I)
      RTCVNM(2)=RLIST(2,I)
C
C  IF 'ALLRC' IS SPECIFIED, GET RC NAME FROM /FRCPTR/.
C
      IF (.NOT.PRTALL) GO TO 810
C
      RTCVNM(1) = RCZZ(1,I)
      RTCVNM(2) = RCZZ(2,I)
C
C  CHECK FOR DELETED RC DEFINITIONS
C
      IF (RTCVNM(1).EQ.OBSO.AND.RTCVNM(2).EQ.OLETE) GO TO 800
C
C  CALL FINDRC TO LOCATE RTCVNM ON FILE
C
  810 CONTINUE
      CALL FINDRC(RTCVNM,LOFREC,IFOUND)
C
C  CHECK ERROR FLAG
      IF(IFOUND.GT.0) GO TO 820
C  ERROR ENCOUNTERED
      WRITE(IPR,602) RTCVNM
  602 FORMAT('0**WARNING** RATING CURVE ',2A4,' DOES NOT EXIST ',
     * 'ON THE',/20X,27HRATING CURVE FILE.  FPRTRC ,
     *23HWILL MOVE TO NEXT GIVEN,/20X,27H ID AND CONTINUE EXECUTION.)
      CALL WARN
      GO TO 800
C
  820 CONTINUE
C
C  NOW CALL FCRDRC TO MOVE R.C. INFO FROM FILE TO /FRATNG/
C
      CALL FCRDRC(LOFREC,RTCVNM,IERCHK)
C
C  CHECK FCRDRC ERROR CODE
      IF(IERCHK.LT.1) GO TO 830
C  ERROR ENCOUNTERED
      WRITE(IPR,603) RTCVNM
  603 FORMAT('0**WARNING**  FCRDRC ENCOUNTERED ERROR PREVENTING ',
     1 20HFPRTRC FROM PRINTING,/,22H INFO ON RATING CURVE ,2A4,10H.  FP
     1RTRC ,23HWILL MOVE TO NEXT GIVEN,/,27H ID AND CONTINUE EXECUTION.)
      CALL WARN
      GO TO 800
C
  830 CONTINUE
C  NOW CALL FPRRC TO PRINT NEW CONTENTS OF /FRATNG/
C
      CALL FPRRC(OPTN)
C
 800  CONTINUE
      GO TO 9999
C
 9997 CONTINUE
      WRITE(IPR,606) IBUF
  606 FORMAT('0**ERROR** '/22X,29HNO VALID SUBCOMMAND FOUND ON
     ., 28HTHE FOLLOWING INPUT RECORD ://5X,A)
 8000 WRITE(IPR,605)
  605 FORMAT(/52H  ***** PRINTRC COMMAND ABORTED DUE TO ABOVE ERRORS.)
      CALL ERROR
C
      IF (ICARD.GE.LASTCD) GO TO 9999
      WRITE(IPR,607)
  607 FORMAT(32H  SCANNING FOR 'END' SUBCOMMAND./)
      ICARD = ICARD+1
      DO 900 K=ICARD,LASTCD
      WRITE(IPR,608) NCARD(K)
  608 FORMAT(1H ,A)
  900 CONTINUE
 9999 CONTINUE
      OPNAME(1)=OLDSUB(1)
      OPNAME(2)=OLDSUB(2)
      IOPNUM=IOLDOP
      IF(ITRACE.GE.1) WRITE(IODBUG,1610)
 1610 FORMAT(1H ,23H  **** EXIT FPRTRC ****)
C
C
      RETURN
      END
