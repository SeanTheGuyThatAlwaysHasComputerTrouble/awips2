C MODULE FAZE1
C-----------------------------------------------------------------------
C
C  ROUTINE TO SET UP RUN INFORMATION BEFORE RUNNING A SEGMENT
C
      SUBROUTINE FAZE1 (MD,D)
C
C   ROUTINE ORIGINALLY WRITTEN BY - GEORGE SMITH - HRL - 3/80
C
      CHARACTER*8 RTNNAM,OLDOPN
      CHARACTER*16 XTYPRN(3)
     *    /'CARRYOVER GROUP',
     *     'FORECAST GROUP',
     *     'SINGLE SEGMENT'/
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/killcd'
      INCLUDE 'common/fcrunc'
      INCLUDE 'common/fcary'
      INCLUDE 'common/fcsegn'
      INCLUDE 'common/fctime'
      INCLUDE 'common/fctim2'
C
C
      DIMENSION D(MD)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/fcst_top/RCS/faze1.f,v $
     . $',                                                             '
     .$Id: faze1.f,v 1.4 2000/12/19 16:09:10 jgofus Exp $
     . $' /
C    ===================================================================
C
C
      RTNNAM='FAZE1'
C
      IF (ITRACE.GT.0) WRITE (IODBUG,*) 'ENTER ',RTNNAM
C
      IOPNUM=0
      CALL FSTWHR (RTNNAM,IOPNUM,OLDOPN,IOLDOP)
C
      IOPT=1
      NOPARM=1
C
C  CHECK FOR VALID RUNTYPE AND RUNID AND FILL COMMON BLOCK FCRUNC
      CALL FCORDR (ITYPRN,RUNID,IER,D,MD)
      IF (ITRACE.GE.1) WRITE (IODBUG,30)
30    FORMAT (' IN FAZE1 - FCORDR CALLED')
C
      IF (IER.EQ.0) GO TO 60
C
      IF (ITYPRN.EQ.0) THEN
         WRITE (IPR,40)
40    FORMAT ('0**ERROR** NO RUN TYPE TECHNIQUE WAS ENTERED. ',
     *  'A CGROUP, FGROUP OR ONSEG MUST BE SPECIFIED.')
         CALL ERROR
         GO TO 260
	 ENDIF
      IF (ITYPRN.GT.0) THEN
         WRITE (IPR,50) RUNID,XTYPRN(ITYPRN)
50    FORMAT ('0**ERROR** AN IDENTIFIER OF ',2A4,
     * ' CANNOT BE FOUND FOR THE ',A,'RUN REQUESTED.')
         CALL ERROR
         GO TO 260
	 ENDIF
C
C  GET SEGMENT INFORMATION FOR FIRST SEGMENT TO BE RUN (ONLY SEGMENT
C  FOR ONESEG RUN) - STORED TO COMMON FCSEGN - LOCATION OF FIRST SEGMENT 
C  TO BERUN IS IN IRSGEX(1) IN COMMON BLOCK FCRUNC WHICH WAS FILLED BY 
C  ROUTINE FCORDR
60    CALL FGETSG (ID,IRSGEX(1),1,X,1,X,1,X,IOPT,NOPARM,IER)
      IF (IER.NE.0) THEN
         WRITE (IPR,70) IDSEGN
70    FORMAT ('0**ERROR** COMMON FCSEGN CANNOT BE ',
     *   'FILLED FOR SEGMENT ',2A4,'.')
         CALL ERROR
         GO TO 260
	 ENDIF
C
C  GET DATES OF AVAILABLE CARRYOVER INTO COMMON BLOCK FCSEGC
      CALL FCDATE (IDSEGN,0)
C
C  CHECK FOR VALID TIMING INFORMATION AND FILL COMMON BLOCK FCTIME
      CALL FTMCHK
      IF (KLCODE.GT.4) GO TO 260
      IF (IHRRUN.NE.24) GO TO 90
         IDARUN=IDARUN+1
         IHRRUN=0
90    IF (LHRRUN.NE.0) GO TO 100
         LDARUN=LDARUN-1
         LHRRUN=24
100   IF (LHRCPD.NE.0) GO TO 110
         LDACPD=LDACPD-1
         LHRCPD=24
C
110   IFILLC=0
      IF (ITYPRN.NE.1) NCSTOR=0
      IF (NCSTOR.NE.0) IFILLC=1
C
C  IF SAVE CARRYOVER RUN, CALL FINICO TO SET UP CARRYOVER FILES
      ICHK=IFILLC*NCSTOR
      IF (ICHK.EQ.0) CALL FNOCSV
      IF (ICHK.NE.0) CALL FINICO (RUNID)
      IF (KLCODE.GT.4) GO TO 260
C
      CALL MDYH2 (IDARUN,IHRRUN,IM,ID,IY,IH,NZXX,NDXX,INPTZC)
      CALL MDYH2 (LDARUN,LHRRUN,LM,LD,LY,LH,NZXX,NDXX,INPTZC)
C
      CALL UPAGE (IPR)
      WRITE (IPR,120)
120   FORMAT ('0',45X,'FCEXEC FUNCTION')
C
      WRITE (IPR,140) XTYPRN(ITYPRN),RUNID
140   FORMAT ('0',40X,A,' ',2A4)
C
190   WRITE (IPR,200) IM,ID,IY,IH,INPTZC,LM,LD,LY,LH,INPTZC
200   FORMAT ('0',30X,'RUN PERIOD',2X,
     *  I2.2,'/',I2.2,'/',I4.4,'-',I2.2,A4,
     *  ' THRU ',I2.2,'/',I2.2,'/',I4.4,'-',I2.2,A4)
      WRITE (IPR,210)
210   FORMAT ('0')
C
      IF (ITYPRN.NE.1) GO TO 260
C
      IF (NCSTOR.EQ.0.OR.IFILLC.EQ.0) GO TO 260
C
      WRITE (IPR,220) NCSTOR
220   FORMAT ('0**NOTE** CARRYOVER WILL BE SAVED FOR THE FOLLOWING ',
     *  I2,' DATES:')
C
      DO 250 I=1,NCSTOR
         IF (ICHOUR(I).NE.0) GO TO 230
            ICDAY(I)=ICDAY(I)-1
            ICHOUR(I)=24
230      CALL MDYH2 (ICDAY(I),ICHOUR(I),IM,ID,IY,IH,NZXX,NDXX,INPTZC)
         WRITE (IPR,240) I,IM,ID,IY,IH,INPTZC
240   FORMAT (10X,I2,') ' ,I2.2,'/',I2.2,'/',I4,'-',I2.2,A4)
250      CONTINUE
C
260   CALL FSTWHR (OLDOPN,IOLDOP,OLDOPN,IOLDOP)
C
      IF (ITRACE.GE.1) WRITE (IODBUG,*) 'EXIT ',RTNNAM
C
      RETURN
C
      END
