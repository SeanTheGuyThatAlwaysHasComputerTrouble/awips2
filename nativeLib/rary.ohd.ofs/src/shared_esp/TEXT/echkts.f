C MODULE ECHKTS
C
      SUBROUTINE ECHKTS(TS,MTS,TSESP,MTSESP,IER)
C
C   THIS SUBROUTINE COMPARES TS() WITH TSESP() TO SEE IF
C   ALL THE TIME SERIES IN TS() HAVE BEEN DEFINED IN TSESP()
C
C   THIS SUBROUTINE WAS WRITTEN BY GERALD N DAY.
C
C   THIS SUBROUTINE WAS MODIFIED 2/91 TO PROVIDE A CHECK FOR
C   ADDITIONAL TIME SERIES IN THE TSESP() NOT DEFINED IN THE TS().
C
      INCLUDE 'common/espseg'
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'common/where'
C
      DIMENSION TS(1),TSESP(1)
      DIMENSION SBNAME(2),OLDOPN(2)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/ofs/src/shared_esp/RCS/echkts.f,v $
     . $',                                                             '
     .$Id: echkts.f,v 1.2 1998/07/02 19:08:50 page Exp $
     . $' /
C    ===================================================================
C
C
      DATA SBNAME/4HECHK,4HTS  /,DEBUG/4HEARY/
C
      IOLDOP=IOPNUM
      IOPNUM=0
      DO 10 I=1,2
      OLDOPN(I)=OPNAME(I)
   10 OPNAME(I)=SBNAME(I)
C
      IF(ITRACE.GE.1) WRITE(IODBUG,900)
  900 FORMAT(1H0,17H** ECHKTS ENTERED)
C
      IER=0
C   INITIALIZE LOCATIONS IN TS AND TSESP ARRAYS
      LOC=0
      LOCESP=0
C
C   DETERMINE TSTYPE
   20 ITSTP=TS(LOC+1)
      ITSTPE=TSESP(LOCESP+1)
C
C   CHECK FOR CONCURRENT END OF TS() AND TSESP() USING TSTYPE
      IF (ITSTP.GT.0.AND.ITSTPE.GT.0) GO TO 30
      IF (ITSTP.EQ.0.AND.ITSTPE.EQ.0) GO TO 999
      GO TO 200
   30 CONTINUE
C
C   COMPARE TSID AND DTYPE
      DO 50 I=1,3
      IF(TS(LOC+2+I).NE.TSESP(LOCESP+2+I)) GO TO 200
   50 CONTINUE
C
C   COMPARE IDT
      IDT=TS(LOC+6)
      IDTE=TSESP(LOCESP+6)
       IF(IDT.NE.IDTE) GO TO 200
C
C   COMPARE TSTYPE
      IF(ITSTP.EQ.ITSTPE) GO TO 150
      GO TO (200,110,150,150),ITSTP
C   TS IS UPDATE IN FC - MUST BE UPDATE OR INPUT IN ESP
  110 IF(ITSTPE.NE.1) GO TO 200
C
C   SET LOCATIONS OF NEXT TS IN TS & TSESP ARRAYS
  150 LOC=TS(LOC+2)-1
      LOCESP=TSESP(LOCESP+2)-1
C
C   CHECK FOR CONCURRENT END OF TS & TSESP () USING LOCATION & MTS
      IF (LOC.LT.MTS.AND.LOCESP.LT.MTSESP) GO TO 20
      IF (LOC.GE.MTS) GO TO 160
      ITSTP=TS(LOC+1)
      GO TO 165
  160 ITSTP=0
  165 IF (LOCESP.GE.MTSESP) GO TO 170
      ITSTPE=TSESP(LOCESP+1)
      GO TO 175
  170 ITSTPE=0
  175 IF (ITSTP.EQ.0.AND.ITSTPE.EQ.0) GO TO 999
C
  200 WRITE(IPR,600)
  600 FORMAT(1H0,10X,42H**ERROR** THE TSESP ARRAY IS OUT OF ORDER ,
     125HOR INCOMPLETE OR CONTAINS / 22X,25H TIME SERIES NOT DEFINED ,
     132HIN THE TS ARRAY.  CHECK THAT ALL / 22X,16H NECESSARY TIME ,
     137HSERIES WERE PROPERLY DEFINED FOR THIS / 22X,9H SEGMENT ,
     148HIN FCINIT AND ESPINIT.  THE SEGMENT PROBABLY HAS / 22X,
     154H BEEN REDEFINED IN FCINIT AND NOW MUST BE REDEFINED IN
     1/ 22X,9H ESPINIT.)

      write(ipr,*)
      write(ipr,601)
 601  format(22x,'THE COMPARISON FAILED FOR THE FOLLOWING TIME SERIES.')

      write(ipr,602) TS(LOC+2+1),TS(LOC+2+2), TS(LOC+2+3),TS(LOC+6)
 602  FORMAT(22X,'THE FCINIT TIME SERIES IS ',2A4,2X,A4,2X,I2)

      write(ipr,603) TSESP(LOCESP+2+1),TSESP(LOCESP+2+2),
     + TSESP(LOCESP+2+3),TSESP(LOCESP+6)
 603  format(22X,'THE ESPINIT TIME SERIES IS ',2A4,2X,A4,2X,I2)

      CALL ERROR
      IER=1
C
  999 IBUG=IFBUG(DEBUG)
      IF(IBUG.EQ.0) GO TO 1000
      WRITE(IPR,910)
  910 FORMAT(1H0,10X,5HTS = )
      WRITE(IPR,920) (TS(I),I=1,MTS)
  920 FORMAT(11X,10F10.2)
      WRITE(IPR,930)
  930 FORMAT(1H0,10X,8HTSESP = )
      WRITE(IPR,920) (TSESP(I),I=1,MTSESP)
C
 1000 IOPNUM=IOLDOP
      OPNAME(1)=OLDOPN(1)
      OPNAME(2)=OLDOPN(2)
      RETURN
      END
