C MEMBER TPLTMAIN
C-----------------------------------------------------------------------
C
C                             LAST UPDATE: 12/27/93.17:53:17 BY $WC20SV
C
C     PROGRAM TAPLOT3 IS USED TO PLOT MEAN MONTHLY MAXIMUM AND MINIMUM
C     AIR TEMPERATURE VERSUS ELEVATION PLOTS FOR EACH MONTH OF THE YEAR.
C     THESE PLOTS ARE USED TO ASSIST IN DETERMINING THE VARIATIONS IN
C     TEMPERATURE OVER A MOUNTANIOUS AREA.  THEY ARE ALSO USED TO
C     HELP DETERMINE THE APPROPRIATE MEAN MONTHLY MAXIMUM AND MINIMUM
C     TEMPERATURE FOR A SYNTHETIC MAX-MIN TEMPERATURE STATION.
C
C                   THE CARD INPUT SUMMARY IS AS FOLLOWS.
C
C CARD  FIELD#   FORMAT       CONTENTS
C
C   A     1       I           NUMBER OF STATIONS TO BE PLOTTED (MAX=26)
C         2      A4           UNITS IN WHICH TAPLOT IS TO BE DISPLAYED
C                             'METR'  'ENGL'  DEFAULT IS 'METR'
C         3     A60           HEADING INFORMATION -- NORMALLY WOULD
C                                  INCLUDE AREA COVERED AND PERIOD
C                                  OF RECORD ON WHICH THE MEAN MONTHLY
C                                  MAX-MIN TEMPERATURES ARE BASED.
C
C         4       I           USER SPECIFIED MAXIMUM ELEVATION TO BE
C                                  USED IN SCALING THE PLOT
C         5       I           USER SPECIFIED MINIMUM ELEVATION TO BE
C                                  USED IN SCALING THE PLOT
C                             NOTE THAT DEFAULT VALUES FOR FIELDS 3 & 4
C                                  CAN BE DETERMINED BY THE PROGRAM FROM
C                                  THE INPUT DATA.
C
C  *** NOTE *** REPEAT CARDS F THROUGH H FOR EACH STATION.  IT SHOULD
C               BE NOTED THAT THESE CARDS HAVE THE SAME FORMAT
C               SPECIFICATION AS INPUT CARDS F THROUGH H FOR THE
C               MEAN AREAL TEMPERATURE PROGRAM.  THUS THESE CARDS CAN
C               BE USED AS INPUT TO BOTH PROGRAMS.  MAT CARDS F-H ALSO
C               CONTAIN SOME ADDITION ENTRIES NOT REQUIRED BY TAPLOT.
C               THESE ADDITIONAL FIELDS MUST BE FILLED OR DELIMETED BY
C               COMMAS WHEN TAPLOT IS BEING RUN.  ONLY FIELDS 1 & 5
C               ARE REQUIRED FOR TAPLOT CARD F.
C  *** NOTE *** CARDS F THRU H CAN BE OBTAINED FROM THE SUMMARY PRODUCED
C               BY THE DAILY OBSERVATION DATA TRANSFER PROGRAM (DLYTRAN)
C               (SEE SECTION III.4.2). IT SHOULD BE NOTED THAT PROGRAM
C               DLYTRAN WILL PUNCH THESE CARDS IN THE PROPER FORMAT BY
C               INCLUDING THE COMMAND @PUNSTA IN THE INPUT.
C
C   F      1      A20         STATION NAME
C          2   R,I, OR I-I    STATION LATITUDE
C          3   R,I, OR I-I    STATION LONGITUDE
C          4      R           OBSERVATION TIME FOR INITIAL MONTH
C          5      R           STATION ELEVATION IN METERS OR FEET
C          6     A5           DUMMY STATION FLAG
C
C
C   G      1       R          ELEVATION WEIGHTING FACTOR FOR MAX T.
C                                USE NULL FIELD FOR TAPLOT.
C
C          2       R          MEAN MAXIMUM TEMPERATURE FOR EACH MONTH
C                                IN DEGREES CELSIUS OR FAHRENHEIT. THE
C                                ORDER IS JANUARY THROUGH DECEMBER.
C
C   H      1       R          ELEVATION WEIGHTING FACTOR FOR MIN T.
C                                USE NULL FIELD FOR TAPLOT.
C
C          2                  MEAN MINIMUM TEMPERATURE FOR EACH MONTH
C                                 IN DEGREES CELSIUS OR FAHRENHEIT.  THE
C                                 ORDER IS JANUARY THROUGH DECEMBER.
C
C
C     UPDATED APRIL - 1989  TO READ FREE FORMATTED INPUT
C                           TO ALLOW FOR METRIC AND ENGLISH UNITS
C                           TO ALLOW FOR USER SUPLIED MAX AND MIN
C                              ELEVATIONS
C
C           M.KANE  HRL
C
C
C.......................................................................
C
C     BEGIN TEMPERATURE-ELEVATION PLOT PROGRAM (TAPLOT)
C
      PROGRAM MAIN
C
      DIMENSION ELEV(26),TMAX(26,12),TMIN(26,12),SYM(26),
     1ORD(61,101),ISCALE(11),CHARMO(12)
C
      CHARACTER*4 METR,ENGL
      CHARACTER*4 UNITO
      CHARACTER*20 DUMMRD
      CHARACTER*60 HEADG,UCHAR
      CHARACTER*20 STAFLD(26)
C
      INCLUDE 'uiox'
      INCLUDE 'upagex'
C
      REAL LABEL
      REAL LABELA,LABELF,LABELG,LABELH
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/taplot/RCS/taplot3.f,v $
     . $',                                                             '
     .$Id: taplot3.f,v 1.3 2004/08/10 15:06:58 dsa Exp $
     . $' /
C    ===================================================================
C
C
      DATA SYM/1HA,1HB,1HC,1HD,1HE,1HF,1HG,1HH,1HI,1HJ,1HK,1HL,1HM,1HN,1
     1HO,1HP,1HQ,1HR,1HS,1HT,1HU,1HV,1HW,1HX,1HY,1HZ/
      DATA BLANK,PLUS,DASH,VERT/1H ,1H+,1H-,1HI/
      DATA CHARMO/4HJAN.,4HFEB.,4HMAR.,4HAPR.,4HMAY ,4HJUNE,4HJULY,4HAUG
     1.,4HSEPT,4HOCT.,4HNOV.,4HDEC./
C
C
C
C
C     Subroutine ARGVER outputs the version/date info and exits the
C      program if the first command line argument is "-version"
C
      CALL ARGVER()
C
      CALL UPRIMO_TAPLOT()
C
      METR='METR'
      ENGL='ENGL'
      EMAX=0.0
      EMIN=0.0
C***********************************************************************
C  SET FLAG TO NOT PRINT PAGE NUMBER
      IPSPAG(LP)=0
C
C  GET NAME OF DATA SET FROM WHICH PROGRAM IS BEING EXECUTED
CC    NUNIT=0
CC    IPRERR=-1
CC    CALL UPRDSN ('STEPLIB ',NUNIT,'NONE',IPRERR,LP,IERR)
C
C  PRINT DATASET ATTRIBUTES
CC    IPRERR=1
CC    NUNIT=ICD
CC    CALL UPRDSA ('NONE',NUNIT,'NONE',IPRERR,LP,IERR)
CC    NUNIT=LP
CC    CALL UPRDSA ('NONE',NUNIT,'NONE',IPRERR,LP,IERR)
C  *** CARD A ***
C
      NFLD=0
      ISTRT=0
   80 NCHAR=1
C
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      IF (NFLD.EQ.-1) GO TO 999
C
      IF (UCHAR(1:1).NE.'@') THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,950) SYM(1)
C
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
C     READ NUMBER OF STATIONS
C
      NCHAR=1
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,NSTA  ,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(NSTA.GT.26.OR.NSTA.LT.0) THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,85) NSTA
   85   FORMAT('+*** ERROR - INVALID VALUE FOR # STATIONS  ',I5///)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
C    READ ENGLISH OR METRIC UNITS
C
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UNITO,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(1)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C     READ THE HEADING FOR THE PLOT   (A60)
C
      NCHAR=15
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,HEADG,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(1)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
C     READ THE MAXIMUM ELEVATION FOR THE PLOT
C
      NCHAR=2
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,EMAX,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(UCHAR(1:1).EQ.'@') GO TO 100
C
C     READ THE MINIMUM ELEVATION FOR THE PLOT
C
C
      NCHAR=2
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,EMIN,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(UCHAR(1:1).EQ.'@') GO TO 100
C
      IF(EMIN.GT.EMAX.AND.EMAX.GT.1.) THEN
      CALL UEROR (LP,3,-1)
      WRITE(LP,970)
      GO TO 999
      ENDIF
C
C
C*********************************************************************
C   *** STATION INFO ***
C
C  ** CARD F **
C
  100 CONTINUE
      DO 10 IRG=1,NSTA
      NCHAR=1
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF (UCHAR(1:1).NE.'@') THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,950) SYM(6)
C
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
C
C      READ THE STATION NAME
C
      NCHAR=5
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,STAFLD(IRG),LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(6)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
      NCHAR=2
C
C      READ THE STATION LATITUDE
C
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,STLAT,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(6)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C      READ THE STATION LONGITUDE
C
      NCHAR=2
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,STLON,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(6)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C      READ THE TIME OF OBSERVATION
C
      NCHAR=2
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,TIMEOB,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(6)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C       READ THE ELEVATION OF THE STATION
C
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,ELEV(IRG),
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(6)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C      READ THE OPTION FOR A DUMMY STATION
C
      NCHAR=5
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,DUMMRD,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      IF (ISTAT.EQ.6)ISTRT=-1
      IF (DUMMRD(1:1).EQ.'@') GO TO 128
C**********************************************************************
C
  110 CONTINUE
C
C   READ ELEVATION WEIGHTING FACTORS AND MEAN MAX AND MIN TEMPERATURES
C
C   ** CARD G **
C
  127 CONTINUE
      NCHAR=1
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF (UCHAR(1:1).NE.'@') THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,950) SYM(7)
C
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
      NCHAR=1
  128 CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,FE,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(7)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
C
      NCHAR=2
      DO 130 MO=1,12
        CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,TMAX(IRG,MO),
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
  130 CONTINUE
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(7)
        WRITE(LP,131) (TMAX(IRG,MO),MO=1,12)
  131   FORMAT('CARD G  ',12F6.1)
      ENDIF
C
C   ** CARD H **
C
  132 CONTINUE
      NCHAR=1
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
      IF (UCHAR(1:1).NE.'@') THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,950) SYM(8)
C
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
        GO TO 999
      ENDIF
C
      NCHAR=1
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,FE,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
C
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(8)
        CALL UFLDST (NFLD,ISTRT,LENGTH,ITYPE,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,IERR,
     *   NUMERR,NUMWRN)
C
        CALL UPRFLD (NFLD,ISTRT,LENGTH,ITYPE,NREP,INTEGR,REAL,
     *   LCHAR,CHAR,LLPAT,LRPAT,LASK,LATSGN,LAMPS,LEQUAL,IERR)
         GO TO 999
      ENDIF
C
      NCHAR=2
      DO 135 MO=1,12
        CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,TMIN(IRG,MO),
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
  135 CONTINUE
C
      IF(ISTAT.GE.3.AND.ISTAT.NE.5) THEN
        WRITE(LP,955) ISTAT,SYM(8)
        WRITE(LP,134) (TMIN(IRG,MO), MO=1,12)
  134   FORMAT('CARD H  ', 12F6.1)
      ENDIF
  140 CONTINUE
   10 CONTINUE
C     PRINT TITLE PAGE.
      WRITE(LP,903)HEADG
  903 FORMAT(1H1,/////,1X,59HMONTHLY MAX AND MIN TEMPERATURE-ELEVATION R
     1ELATIONSHIPS FOR,1X,A60)
C
      IF(UNITO.EQ.ENGL) THEN
        WRITE(LP,890)
       ELSE
        WRITE(LP,904)
      END IF
  890 FORMAT (1H0,///,25X,6HSYMBOL,9X,12HSTATION NAME,13X,
     *15HELEVATION(FEET))
  904 FORMAT(1H0,///,25X,6HSYMBOL,9X,12HSTATION NAME,13X,17HELEVATION(ME
     1TERS))
      DO 11 N=1,NSTA
      WRITE(LP,905)SYM(N),STAFLD(N),ELEV(N)
  905 FORMAT(1H ,27X,1A1,7X,A20,12X,F7.0)
   11 CONTINUE
C
C     COMPUTE ELEVATION RANGE FOR PLOTS.
C
        EGMAX=0.0
        DO 12 N=1,NSTA
          IF(ELEV(N).GT.EGMAX)EGMAX=ELEV(N)
   12   CONTINUE
      IF(EMAX.LT.1.) EMAX=EGMAX
      IF(EGMAX.GT.EMAX) THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,960)
        GO TO 999
      END IF
C
C
        EGMIN=99999.
        DO 13 N=1,NSTA
          IF(ELEV(N).LT.EGMIN)EGMIN=ELEV(N)
   13   CONTINUE
      IF(EMIN.LT.1.) EMIN=EGMIN
      IF(EGMIN.LT.EMIN) THEN
        CALL UEROR (LP,3,-1)
        WRITE(LP,961)
        GO TO 999
      END IF
C
C
      MAX=(EMAX+1000.0)/1000.0
      MAX=MAX*1000
      FMAX=MAX
      IF((FMAX-EMAX).GT.500.0)FMAX=FMAX-499.5
      MAX=FMAX
      FMAX=MAX
      IRANGE=(FMAX-EMIN+1000.0)/1000.0
      IRANGE=IRANGE*1000
      RANGE=IRANGE
      IF((FMAX-RANGE).LT.-1.0)MAX=MAX+500
      FMAX=MAX
      IF (EMIN.GT.(FMAX-RANGE+500.0)) MAX=MAX+500
      ELMAX=MAX
      INC=IRANGE/10
      FINC=INC
      FINC=FINC/6.0
      MMAX=MAX
C     GENERATE PLOT FOR EACH MONTH.
      DO 20 MO=1,12
C     INITIALIZE FIELD
      DO 21 I=1,61
      DO 22 J=1,100
   22 ORD(I,J)=BLANK
      ORD(I,1)=VERT
      ORD(I,101)=VERT
   21 CONTINUE
      DO 24 I=1,61,6
      DO 25 J=1,100
   25 ORD(I,J)=DASH
      DO 26 J=1,101,10
   26 ORD(I,J)=PLUS
   24 CONTINUE
C
C      DETERMINE THE HIGHEST TEMPERATURE FOR THE MONTH
C
      EMAX=-40.0
      DO 23 N=1,NSTA
        IF(TMAX(N,MO).GT.EMAX) EMAX=TMAX(N,MO)
   23 CONTINUE
C
      IF(UNITO.EQ.ENGL) THEN
        MAX=(EMAX+30.0)/10
      ELSE
        MAX=(EMAX+10.0)/10
      ENDIF
      MAX=MAX*10
      FMAX=MAX
C
C     DETERMINE LOWEST TEMPERATURE FOR THE MONTH.
C
      EMIN=100.0
      DO 27 N=1,NSTA
        IF(TMIN(N,MO).LT.EMIN)EMIN=TMIN(N,MO)
   27 CONTINUE
      MIN=(EMIN-10.0)/10.0
      MIN=MIN*10
      FMIN=MIN
C
      IF(UNITO.EQ.ENGL) THEN
        DO 28 J=1,11
          ISCALE(J)=MAX-(11-J)*10
   28   CONTINUE
      ELSE
        DO 29 J=1,11
          ISCALE(J)=MAX-(11-J)*5
   29   CONTINUE
      ENDIF
C     DETERMINE PLOT LOCATIONS.
      DO 30 N=1,NSTA
      I=(ELMAX-ELEV(N))/FINC+1.5
C
      IF(UNITO.EQ.ENGL) THEN
        JX=100-(FMAX-TMAX(N,MO))+1.5
        JN=100-(FMAX-TMIN(N,MO))+1.5
      ELSE
        JX=100-(FMAX-TMAX(N,MO))*2+1.5
        JN=100-(FMAX-TMIN(N,MO))*2+1.5
      ENDIF
C
C
      IF (JX.GT.101) JX=101
      IF (JN.GT.101) JN=101
      ORD(I,JX)=SYM(N)
      ORD(I,JN)=SYM(N)
   30 CONTINUE
C     OUTPUT MONTHLY PLOT.
      WRITE(LP,910)CHARMO(MO),HEADG
  910 FORMAT(1H1,//,1X,50HMAX AND MIN TEMPERATURE-ELEVATION RELATIONSHIP
     1 FOR,1X,A4,5X,A60,///)
      WRITE(LP,906)ISCALE
  906 FORMAT(1H ,11I10)
      IELEV=MMAX
      DO 31 I=1,61
      IF((((I-1)/6)*6).EQ.(I-1))GO TO 32
      WRITE(LP,907)(ORD(I,J),J=1,101)
  907 FORMAT(1H ,8X,101A1)
      GO TO 31
  32  IF(UNITO.EQ.ENGL) THEN
         WRITE(LP,919)IELEV,(ORD(I,J),J=1,101),IELEV
      ELSE
         WRITE(LP,908)IELEV,(ORD(I,J),J=1,101),IELEV
      ENDIF
  908 FORMAT(1H ,I4,1X,2HM.,1X,101A1,I5,1X,2HM.)
  919 FORMAT(1H ,I5,1X,2HFT,101A1,I5,1X,2HFT)
      IELEV=IELEV-INC
   31 CONTINUE
      WRITE(LP,906)ISCALE
      IF(UNITO.EQ.ENGL) THEN
        WRITE(LP,911)
        ELSE
        WRITE(LP,909)
      END IF
  911 FORMAT(1H0,45X,32HTEMPERATURE-(DEGREES FAHRENHEIT))
  909 FORMAT(1H0,45X,29HTEMPERATURE-(DEGREES CELSIUS))
  950 FORMAT('+*** ERROR -  @',A2,' EXPECTED BUT WAS NOT FOUND '/
     *'   CHECK NRDCRD IN UPRFLD OUTPUT FOR CARD NUMBER WHERE ERROR ',
     *'OCCURRED '//
     * '  *****  OUTPUT FROM UPRFLD  ***** '//)
  955 FORMAT('+*** ERROR - ISTAT = ',I3,'  ON CARD ',A2 )
   20 CONTINUE
  960 FORMAT('+*** ERROR - USER SUPPLIED MAX ELEVATION IS LESS',
     *' THAN THE MAX ELEVATION OF THE INPUT DATA ')
  999 IUSTOP=0
  961 FORMAT('+*** ERROR - USER SUPPLIED MIN ELEVATION IS GREATER',
     *' THAN THE MIN ELEVATION OF THE INPUT DATA ')
  970 FORMAT('+*** ERROR - MAX ELEVATION IS LESS THAN THE MIN',
     *' ELEVATION ' )
      CALL USTOP (LP,IUSTOP)
      STOP
      END
