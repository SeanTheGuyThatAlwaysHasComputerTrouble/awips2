C MODULE TEMPCK
C-----------------------------------------------------------------------
C
      SUBROUTINE TEMPCK (MONUM,NTMO,IYR,IMO,PXNAME,TNORM,GMM,IEND,FEMAX,
     *   FEMIN,ND,SE2,EMAX,ISCALE,UNITI,NFLD,ISTRT)
C
C  ROUTINE TO COMPARE ESTIMATED AND OBSERVED MAX/MIN TEMPERATURE DATA.
C
      CHARACTER*4 UNITI
      CHARACTER*4 CLABEL
C
      DIMENSION LASTDA(2,12),SUM(4),ISCALE(2),TIME(2),GMM(2,62)
      DIMENSION PXNAME(5),ND(12),SE2(4,12),NUM(12)
      DIMENSION XY(2,120,120)
      DIMENSION TNORM(12,2),TN(2)
C
      INCLUDE 'common/ionum'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/mat/RCS/tempck.f,v $
     . $',                                                             '
     .$Id: tempck.f,v 1.2 1998/07/02 14:09:32 page Exp $
     . $' /
C    ===================================================================
C
      DATA BLANK,PLUS,ASTER,DOT/1H ,1H+,1H*,1H./
      DATA LASTDA/31,31,28,29,31,31,30,30,31,31,30,30,31,31,31,31,30,30,
     131,31,30,30,31,31/
      DATA TIME/3HMIN,3HMAX/
      DATA IXLEN/70/,IYLEN/70/,ISECT/10/,NSECT/7/
C
      IF (UNITI.EQ.'METR') GO TO 15
      IXLEN=120
      IYLEN=120
      ISECT=15
      NSECT=8
C 
15    IF (MONUM.GT.1) GO TO 90
      WRITE(IPR,10) (PXNAME(J),J=1,5),FEMAX,FEMIN
      WRITE(IPR,80)
C
      IF (IEND.GT.0) GO TO 30
      NFLD=0
      ISTRT=0
      NCHAR=1
C
C   ** CARD T **
      CLABEL='@T'
C
   20 CONTINUE
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,
     *   LENGTH,OPT2)
      IF (ISTAT.EQ.7) GOTO 20
      NCHAR=1
C
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,EMAX,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,1,ISTAT,
     *   LENGTH,OPT2)
      IF (ISTAT.EQ.6)ISTRT=-1
      IF (ISTAT.EQ.6) GOTO 30
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,ISCALE(2),UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,
     *   LENGTH,OPT2)
      IF (ISTAT.EQ.6)ISTRT=-1
      IF (ISTAT.EQ.6) GOTO 30
      CALL UFIELD(NFLD,ISTRT,LENGTH,ITYPEU,NREP,ISCALE(1),UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,
     *   LENGTH,OPT2)
      IF (ISTAT.EQ.6)ISTRT=-1
C
C  ONE IS FOR MIN--TWO IS FOR MAX
C  PLOT SCALE
C
   30 CONTINUE
      DO 60 IP=1,2
      DO 60 IX=1,IXLEN
      DO 60 IY=1,IYLEN
      IF (IY.EQ.IX) GO TO 50
      IF ((IY-ISECT*(IY/ISECT)).EQ.0) GO TO 40
      XY(IP,IX,IY)=BLANK
      GO TO 60
40    XY(IP,IX,IY)=DOT
      GO TO 60
50    XY(IP,IX,IY)=PLUS
60    CONTINUE
C
      DO 70 MO=1,12
      ND(MO)=0
      SE2(1,MO)=0.0
      SE2(2,MO)=0.0
      SE2(3,MO)=0.0
      SE2(4,MO)=0.0
70    CONTINUE
C
C  COMPUTATIONS FOR EACH MONTH
C
90    MO=MONUM
      NYR=(MO-1)/12
      IYRC=IYR+NYR-1900
      NMO=MO-NYR*12
      IMOC=IMO+NMO-1
      IF (IMOC.LT.13) GO TO 100
      IMOC=IMOC-12
      IYRC=IYRC+1
100   CONTINUE
C
      TN(2)=TNORM(IMOC,2)
      TN(1)=TNORM(IMOC,1)
      LY=0
      IF ((IYRC-4*(IYRC/4)).EQ.0)LY=1
      LAST=LASTDA((LY+1),IMOC)
      SUM(1)=0.0
      SUM(2)=0.0
      SUM(3)=0.0
      SUM(4)=0.0
      IL=LAST*2
      II=2
C
120   DO 150 I=II,IL,2
      TO=GMM(1,I)
      TE=GMM(2,I)
      IF (TE.EQ.TO) GO TO 150
      IF (ABS(TO-TE).LE.EMAX) GO TO 140
      ID=(I-1)/2+1
      WRITE(IPR,130) TIME(II),IMOC,ID,IYRC,TO,TE
140   SUM(II)=SUM(II)+(TO-TE)*(TO-TE)
      SUM(II+2)=SUM(II+2)+(TO-TN(II))*(TO-TN(II))
      IX=TE-ISCALE(II)+1.5
      IF (IX.LT.1) IX=1
      IF (IX.GT.IXLEN)IX=IXLEN
      IY=TO-ISCALE(II)+1.5
      IF (IY.LT.1) IY=1
      IF (IY.GT.IYLEN)IY=IYLEN
      XY(II,IX,IY)=ASTER
150   CONTINUE
C
      SE2(II,IMOC)=SE2(II,IMOC)+SUM(II)
      SE2((II+2),IMOC)=SE2((II+2),IMOC)+SUM(II+2)
      SUM(II)=SQRT(SUM(II)/LAST)
      IF (II.EQ.1) GO TO 160
      ND(IMOC)=ND(IMOC)+LAST
      II=1
      IL=IL-1
      GO TO 120
160   WRITE(IPR,170) IMOC,IYRC,SUM(2),SUM(1)
      IF (MONUM.LT.NTMO)RETURN
C  SUMMARY OF ALL MONTHS
      SUM(1)=0.0
      SUM(2)=0.0
      SUM(3)=0.0
      SUM(4)=0.0
      NDAYS=0
C
      DO 190 II=1,2
      DO 180 MO=1,12
      SUM(II)=SUM(II)+SE2(II,MO)
      SUM(II+2)=SUM(II+2)+SE2((II+2),MO)
      IF (ND(MO).EQ.0) GO TO 180
      SE2(II,MO)=SQRT(SE2(II,MO)/ND(MO))
      SE2((II+2),MO)=SQRT(SE2((II+2),MO)/ND(MO))
      IF (II.EQ.2) GO TO 180
      NDAYS=NDAYS+ND(MO)
180   CONTINUE
      SUM(II)=SQRT(SUM(II)/NDAYS)
      SUM(II+2)=SQRT(SUM(II+2)/NDAYS)
190   CONTINUE
C
      WRITE(IPR,80)
      WRITE(IPR,200)
      WRITE(IPR,210) (MO,MO=1,12)
C
      DO 250 IP=1,2
      II=3-IP
      WRITE(IPR,220) TIME(II),(SE2(II,MO),MO=1,12),SUM(II)
      WRITE(IPR,230) TIME(II),(SE2((II+2),MO),MO=1,12),SUM(II+2)
      WRITE(IPR,240)
250   CONTINUE
C  PLOTS
      DO 310 IP=1,2
      II=3-IP
      WRITE(IPR,260) TIME(II),(PXNAME(J),J=1,5)
      DO 270 I=1,NSECT
      NUM(I)=ISCALE(II)-1+(ISECT*I)
270   CONTINUE
C
      IF (UNITI.EQ.'METR') WRITE(IPR,280) (NUM(I),I=1,NSECT)
      IF (UNITI.EQ.'ENGL') WRITE(IPR,281) (NUM(I),I=1,NSECT)
      DO 300 IX=1,IXLEN
      ISC=ISCALE(II)-1+IX
      WRITE(IPR,290) ISC,(XY(II,IX,IY),IY=1,IYLEN)
300   CONTINUE
310   CONTINUE
C
      RETURN
C      
10    FORMAT(1H1,5X,53HCOMPARISON OF ESTIMATED AND OBSERVED TEMPERATURES
     1 FOR,1X,5A4,5X,7HFE MAX=,F5.1,5X,7HFE MIN=,F5.1)
80    FORMAT (1H0)
130   FORMAT (1H ,10X,21HMAX. ERROR EXCEEDED--,A3,1X,5HTEMP.,5X,I2,1H/,
     1I2,1H/,I2,5X,4HOBS=,F6.1,5X,4HEST=,F6.1)
170   FORMAT(1H ,20HROOT MEAN SQUARE FOR,I3,1H/,I2,10X,4HMAX=,F6.1,5X,
     14HMIN=,F6.1)
200   FORMAT(1H0,10X,86HSUMMARY OF ROOT MEAN SQUARE OF OBS. AND EST.--PL
     1US STANDARD DEVIATION OF OBS. AND MEAN)
210   FORMAT(1H0,5HMONTH,5X,12I8,5X,5HTOTAL)
220   FORMAT (1H ,3HRMS,1X,A3,3X,12F8.1,F10.1)
230   FORMAT (1H ,4HS.D.,1X,A3,2X,12F8.1,F10.1)
240   FORMAT (1H )
260   FORMAT(1H1,22HOBSERVED VS. ESTIMATED,1X,A3,1X,15HTEMPERATURE FOR,
     11X,5A4,10X,19H+ IS 45 DEGREE LINE)
280   FORMAT(1H0,7HEST/OBS,I11,6I10)
281   FORMAT(1H0,7HEST/OBS,I16,7I15)
290   FORMAT(1H ,I6,1X,120A1)
      END
