C MODULE MATCON
C-----------------------------------------------------------------------
C
      SUBROUTINE MATCON (NG,NPG,IGS,PXNAME,NTMO,IMO,IYR,UNITI,
     *   MXSTA,MXMON,PH,PL,DMAX,DMIN)
C
C  ROUTINE TO PRINT CONSISTENCY PLOT FOR PROGRAM MAT.
C
      INCLUDE 'uiox'
C
      CHARACTER*4 UNITI
      DIMENSION NPG(5),IGS(5,MXSTA),PXNAME(MXSTA,5)
      DIMENSION PH(MXSTA,2),PL(MXSTA,2)
      DIMENSION DMAX(MXSTA,MXMON),DMIN(MXSTA,MXMON)
      DIMENSION NAME(2),S(11),DEC(5),ORD(101)
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/mat/RCS/matcon.f,v $
     . $',                                                             '
     .$Id: matcon.f,v 1.3 2002/02/11 18:56:01 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA DOT,BLANK,ASK,DEC/1H.,1H ,1H*,1H1,1H2,1H3,1H4,1H5/
      DATA NAME/3HMAX,3HMIN/
      DATA C/1HC/,F/1HF/
C
      UNITT=C
      IF (UNITI.EQ.'ENGL') UNITT=F
C
C  TITLE PAGE
      WRITE(LP,10)
      WRITE(LP,20)
      WRITE(LP,30)
      WRITE(LP,40)
      DO 80 IG=1,NG
      WRITE(LP,50) IG
      WRITE(LP,60)
      N=NPG(IG)
      DO 80 J=1,N
      JRG=IGS(IG,J)
      IRG=JRG
      IF (IRG.LT.0)IRG=-1*IRG
      WRITE(LP,70) JRG,(PXNAME(IRG,K),K=1,5)
80    CONTINUE
C
C   DETERMINE PLOTTING INCREMENT
C
      MINC=1
      IF (NTMO.GT.180) MINC=2
      IF (NTMO.GT.360) MINC=3
      IF (NTMO.GT.540) MINC=4
C
C  PLOT DEVIATIONS OF EACH STATION FROM ITS GROUP BASE
C
      DO 260 IG=1,NG
      N=NPG(IG)
      NPLOTS=(N-1)/5+1
      DO 250 I=1,NPLOTS
      II=(I-1)*5+1
      IL=I*5
      IF (IL.GT.N)IL=N
      DO 240 NP=1,2
      WRITE(LP,90) IG,NAME(NP)
      WRITE(LP,100)
      SH=0.0
      SL=0.0
      DO 120 J=II,IL
      JRG=IGS(IG,J)
      IRG=JRG
      NS=J-II+1
      IF (IRG.LT.0)IRG=-1*IRG
      WRITE(LP,110) JRG,NS,(PXNAME(IRG,K),K=1,5)
      IF (PH(IRG,NP).GT.SH)SH=PH(IRG,NP)
      IF (PL(IRG,NP).LT.SL)SL=PL(IRG,NP)
120   CONTINUE
C
C  COMPUTE PLOT SCALE
      T=SH-SL
      KA=T*0.001+2.0
      K=T*0.1
      K=K+KA
      T=K*10.0
      DPL=T*0.01
      K=SH/DPL+1.0
      SH=K*DPL
      SL=SH-T
C  K IS LOCATION OF 0.0 LINE
      K=101-K
C  PRINT SCALE
      WRITE(LP,130) UNITT
      NC=0
      DO 140 L=1,101,10
      NC=NC+1
      S(NC)=SL+DPL*(L-1)
140   CONTINUE
      WRITE(LP,150) S
C
C  PLOT DEVIATIONS FOR EACH MONTH
      DO 230 MO=MINC,NTMO,MINC
      NYR=(MO-1)/12
      IYRC=IYR+NYR-1900
      NMO=MO-NYR*12
      IMOC=IMO+NMO-1
      IF (IMOC.LT.13) GO TO 160
      IMOC=IMOC-12
      IYRC=IYRC+1
160   DO 180 IC=1,101,10
      ORD(IC)=DOT
      IF (IC.EQ.101) GO TO 180
      DO 170 J=1,9
      ORD(IC+J)=BLANK
170   CONTINUE
180   CONTINUE
      ORD(K)=ASK
      DO 210 J=II,IL
      IRG=IGS(IG,J)
      IF (IRG.LT.0)IRG=-1*IRG
      NS=J-II+1
      IF (NP.EQ.2) GO TO 190
      IC=  (DPL*0.5+DMAX(IRG,MO))/DPL
      IC=IC+K
      IF (DMAX(IRG,MO).LT.-0.5*DPL) IC=IC-1
      GO TO 200
190   IC=  (DPL*0.5+DMIN(IRG,MO))/DPL
      IC=IC+K
      IF (DMIN(IRG,MO).LT.-0.5*DPL) IC=IC-1
200   ORD(IC)=DEC(NS)
210   CONTINUE
      WRITE(LP,220) IMOC,IYRC,ORD
230   CONTINUE
240   CONTINUE
250   CONTINUE
260   CONTINUE
C
      RETURN
10    FORMAT(1H1,20X,33HCONSISTENCY CHECK FOR MAT PROGRAM)
20    FORMAT(1H0,56HSTATIONS WITH POSITIVE RUN NUMBERS CONSTITUTE GROUP
     1BASE,1X,60HAND ARE PLOTTED AGAINST THE OTHER STATIONS IN THE GROUP
     2 BASE)
30    FORMAT(1H0,69HSTATIONS WITH NEGATIVE RUN NUMBERS ARE PLOTTED AGAIN
     1ST THE GROUP BASE)
40    FORMAT(1H0)
50    FORMAT(1H0,10X,17HSTATIONS IN GROUP,I2)
60    FORMAT(1H0,12HSTA. RUN NO.,8X,12HSTATION NAME)
70    FORMAT(1H ,5X,I3,12X,5A4)
90    FORMAT(1H1,76HDEVIATION OF STATION ACCUMULATED MEAN FROM GROUP ACC
     1UMULATED MEAN-----GROUP=,I1,5X,5HTEMP=,A3)
100   FORMAT(1H0,5X,12HSTA. RUN NO.,8X,13HSTA. PLOT NO.,7X,
     112HSTATION NAME)
110   FORMAT(1H ,9X,I3,19X,I2,12X,5A4)
130   FORMAT(1H0,10X,33HASTERISKS INDICATE ZERO DEVIATION,15X,
     118HUNITS ARE DEGREES ,A1)
150   FORMAT(1H0,5HMO/YR,11F10.1)
220   FORMAT(1H ,I2,1H/,I2,8X,101A1)
      END
