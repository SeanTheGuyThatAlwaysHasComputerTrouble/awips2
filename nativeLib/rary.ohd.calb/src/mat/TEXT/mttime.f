C MODULE MTTIME
C-----------------------------------------------------------------------
C
      SUBROUTINE MTTIME (NSTA,IFMON,ICTIM,IOBCGE,TIMEOB,IMO,IYR,
     *   PXNAME,NFLD,ISTRT,
     *   MXSTA,MXOB,MXOBD,ISTNUM,ISTSLT,ISTAMO,ISTAYR)
C
C  ROUTINE TO READ OBSERVATION TIME CHANGES FOR PROGRAM MAT.
C
      CHARACTER*4 CLABEL
C
      DIMENSION IOBCGE(MXSTA,MXOBD),TIMEOB(MXSTA,MXOBD)
      DIMENSION PXNAME(MXSTA,5)
      DIMENSION ISTNUM(MXSTA*MXOB),ISTSLT(MXSTA*MXOB)
      DIMENSION ISTAMO(MXSTA*MXOB),ISTAYR(MXSTA*MXOB)
C
      INCLUDE 'uiox'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/mat/RCS/mttime.f,v $
     . $',                                                             '
     .$Id: mttime.f,v 1.5 2001/06/13 09:31:31 mgm Exp $
     . $' /
C    ===================================================================
C
C
      LDEBUG=0
C      
      IFMON=IYR*12+IMO
C      
      DO 10 IRG=1,NSTA
         DO 10 I=1,MXOBD
            IOBCGE(IRG,I)=9999
10       CONTINUE
C
      IF (ICTIM.EQ.0) GO TO 60
C
      NUMOB=0    
C
C   ** CARD M **
      CLABEL='@M'
C
20    NCHAR=1
C
C  GET STATION NUMBER
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.7) GO TO 20
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,JSTA,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) THEN
         ISTRT=-1
         GO TO 30
         ENDIF
C
C  CHECK IF LAST TIME CHANGE      
      IF (JSTA.EQ.999) GO TO 55
      IF (NSTA.LT.99.AND.JSTA.EQ.99) GO TO 55
C
C  GET MONTH OF TIME CHANGE
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,JMO,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) THEN
         ISTRT=-1
         GO TO 30
         ENDIF
C 
C  GET YEAR OF TIME CHANGE     
      CALL UFIELD (NFLD,I STRT,LENGTH,ITYPEU,NREP,JYR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) THEN
         ISTRT=-1
         GO TO 30
         ENDIF
C
C  GET NEW OBSERVATION TIME      
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,OBNEW,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,1,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) THEN
         ISTRT=-1
         GO TO 30
         ENDIF
C
30    ICMON=JYR*12+JMO
      ICMON=ICMON-IFMON+1
C
      DO 40 I=1,10
         IF (IOBCGE(JSTA,I).LT.9999) GO TO 40
            IOBCGE(JSTA,I)=ICMON
            IOB=I
            GO TO 50
40       CONTINUE
      CALL UEROR (LP,0,-1)
      WRITE (LP,65) MXOB
      GO TO 20
C
50    NUMOB=NUMOB+1
      ISTNUM(NUMOB)=JSTA
      ISTSLT(NUMOB)=IOB+1
      ISTAMO(NUMOB)=JMO
      ISTAYR(NUMOB)=JYR
      IF (IOB+1.GT.MXOBD) THEN
         CALL UEROR (LP,0,-1)
         WRITE (LP,65) MXOB
         GO TO 20
         ENDIF
      IF (LDEBUG.GT.0) THEN
         WRITE (LP,70) JSTA,(PXNAME(JSTA,I),I=1,5),JMO,JYR,OBNEW
         ENDIF
      TIMEOB(JSTA,(IOB+1))=OBNEW
      GO TO 20
C
55    WRITE (LP,67)
      WRITE (LP,69)
      DO 57 I=1,NUMOB
         ISTA=ISTNUM(I)
         IOB=ISTSLT(I)
         WRITE (LP,70) ISTNUM(I),(PXNAME(ISTA,J),J=1,5),
     *      ISTAMO(I),ISTAYR(I),
     *      TIMEOB(ISTA,IOB)
57       CONTINUE
C
60    RETURN
C
C-----------------------------------------------------------------------
C
65    FORMAT ('0*** ERROR - MAXIMUM NUMBER OF ',
     *   'OBSERVATION TIME CHANGES ',
     *   'THAT CAN BE PROCESSED (',I2,') EXCEEDED.')
67    FORMAT ('0',10X,'*** OBSERVATION TIME CORRECTIONS ***')
69    FORMAT ('0',T72,'NEW'/ T5,'STATION',T26,'STATION',T68,
     *  'OBSERVATION'/ T5,'NUMBER',T27,'NAME',T47,'MONTH',T58,
     *  'YEAR',T72,'TIME'/ T5,7('-'),T17,25('-'),T47,5('-'),
     *  T58,4('-'),T68,11('-'))
70    FORMAT (' ',T6,I3,T17,5A4,T48,I3,T58,I4,T72,F4.0)
C
      END
