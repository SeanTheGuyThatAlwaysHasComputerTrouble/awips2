C MODULE MTRDCD
C-----------------------------------------------------------------------
C
      SUBROUTINE MTRDCD (IMO,IYR,LMO,LYR,NAREAS,IRGCK,IELEV,ICTMP,
     *   ICTIM,ICONS,ISTOP,ITYPE,IGRID,POWER,STMNWT,IPRINT,IPUNCH,
     *   NOOUT,IFSUMT,IFSUMP,FILEN,UNITI,UNITO,NFLD,ISTRT,ISFN,IERR)
C
C  ROUTINE TO READ THE A,B,C,D CARDS FOR PROGRAM MAT.
C
C   LATEST CHANGES BY HRL 10/1991
C     1) ADDED FLISFN OPTION TO END OF @B CARD: IF "MULT" AT END
C        END OF CARD, ISFN (MULTIPLE CALIBRATION FILES TO BE USED),
C        FLAG ISFN (OF COMMON/CRWCTL/) SET TO 1 (DEFAULT 0)
C     2) ADDED FLAGS FLSUMT AND FLSUMP ADDED TO END OF @D CARD:
C        IF "SUMT" SECOND TO LAST ON CARD, IFSUMT SET TO 1 (SUMMARY
C        TABLE TO BE PRINTED).  DEFAULT IS NO TABLE PRINTED (0)
C        IF "SUMP" AT END OF CARD, IFSUMP SET TO 1 (SUMMARY CARDS
C        PUNCHED IN @F,@G,@H FORMATS.  DEFAULT IS NO PUNCH (0)
C
      CHARACTER*4 UNITI,UNITO,FILEN(3)
      CHARACTER*4 CLABEL
C      
      INCLUDE 'uiox'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/mat/RCS/mtrdcd.f,v $
     . $',                                                             '
     .$Id: mtrdcd.f,v 1.3 2002/02/11 18:57:05 dws Exp $
     . $' /
C    ===================================================================
C
      DATA XMNT/4HMNT /, PRNT/4HPRNT/, PNCH/4HPNCH/
      DATA  OUT/4HOUT /, OUTP/4HOUTP/, CONS/4HCONS/,   OUTN/4HOUTN/
      DATA CTMP/4HCTMP/, CTIM/4HCTIM/, STOP/4HSTOP/,   CONT/4HCONT/
      DATA GRID/4HGRID/,  PRE/4HPRE /,   DP/4HDP  /, XMULTI/4HMULT/
      DATA SUMT/4HSUMT/, SUMP/4HSUMP/
C
C
      NFLD=0
      ISTRT=0
C      
C   ** CARD A **
C
10    CLABEL='@A'
C
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.7) GO TO 10
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,IMO   ,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 20
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,IYR   ,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 20
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,LMO   ,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 20
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,LYR   ,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
C
C   ** CARD B **
C
20    CLABEL='@B'
C
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.7) GO TO 20
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,NAREAS,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,IRGCK,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,0,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UNITI,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLMNT,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLCTMP,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLCTIM,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLCONS,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLSTOP,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 30
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLISFN,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
C
C   ** CARD C **
C
30    CLABEL='@C'
C
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.7) GO TO 30
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,WTYPE,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 40
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,POWER,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,1,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 40
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,STMNWT,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,1,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
C
C   ** CARD D **
C
40    CLABEL='@D'
C
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UCHAR,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,3,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.7) GO TO 40
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLPRNT,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLPNCH,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLNOUT,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,UNITO,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      NCHAR=3
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FILEN,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      IF (LENGTH.EQ.0) FILEN(1)=' '
      NCHAR=1
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLSUMT,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
      IF (ISTAT.EQ.6) GO TO 50
      CALL UFIELD (NFLD,ISTRT,LENGTH,ITYPEU,NREP,INTEGR,UREAL,
     * NCHAR,FLSUMP,LLPAR,LRPAR,LASK,LATSGN,LAMPS,LEQUAL,ISTAT)
      CALL AFTERU (LATSGN,ITYPEU,UCHAR,CLABEL,2,ISTAT,LENGTH,IERR)
      IF (ISTAT.EQ.6) ISTRT=-1
C
50    IF (FLMNT.EQ.XMNT)      IELEV=1
      IF (FLCTMP.EQ.CTMP)     ICTMP=1
      IF (FLCTIM.EQ.CTIM)     ICTIM=1
      IF (FLCONS.EQ.CONS)     ICONS=1
      IF (FLSTOP.EQ.CONT)     ISTOP=0
      IF (FLSTOP.EQ.STOP)     ISTOP=1
      IF (FLISFN.EQ.XMULTI)   ISFN=1
C
      IF (WTYPE.EQ.GRID)      ITYPE=1
      IF (WTYPE.EQ.DP)        ITYPE=3
      IF (WTYPE.EQ.PRE)       IGRID=0
C
      IF (POWER.EQ.0.0)       POWER=2.0
      IF (STMNWT.EQ.0.0)      STMNWT=0.01
C
      IF (FLPRNT.EQ.PRNT)     IPRINT=1
      IF (FLPNCH.EQ.PNCH)     IPUNCH=1
      IF (FLNOUT.EQ.OUT)      NOOUT=2
      IF (FLNOUT.EQ.OUTN)     NOOUT=3
      IF (FLNOUT.EQ.OUTP)     NOOUT=0
      IF (FLSUMT.EQ.SUMT)     IFSUMT=1
      IF (FLSUMP.EQ.SUMP)     IFSUMP=1
C
      IF (IFSUMP.EQ.1.AND.IELEV.NE.1) THEN
         IFSUMP=0
         WRITE (LP,60)
         ENDIF
C
      IF (UNITI.EQ.' '.OR.UNITI.EQ.'@C') UNITI='METR'
      IF (UNITO.EQ.' '.OR.UNITO.EQ.'@E') UNITO='METR'
C
      RETURN
C      
60    FORMAT('0*** NOTE - SUMMARY PUNCH CARDS IN @F @G @H CARD ',
     *   'FORMATS WILL NOT BE PRODUCED FOR NON-MOUNTAINOUS AREAS.')
C     
      END
