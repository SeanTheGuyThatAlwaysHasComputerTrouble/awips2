C     MEMBER OUGIN
C
      SUBROUTINE OUGIN(OPID,NUMOP,OPNEW,PARM,DELTA,CHECKL,CHECKU,
     *NOTHER,OA,MOA,P,MP,A,MA,NPARM,IU,LEFTOA,IERO)
C
C.......................................
C     THIS SUBROUTINE FILLS THE A AND OA ARRAYS WITH OPT3 INFORMATION
C     FOR THE UNIT-HG OPERATION AND PRINTS THE INPUT.
C.......................................
C     SUBROUTINE INITIALLY WRITTEN BY
C            LARRY BRAZIL - HRL   APRIL 1981   VERSION 1
C.......................................
C
      DIMENSION P(MP),A(MA),OA(MOA),PARM(2),OPID(2),OPNEW(2)
      DIMENSION PMNAM(2),ABSL(2),ABSU(2),OPIDD(2),OPNEWW(2),UG(2)
      DIMENSION OLDOPN(2)
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'ocommon/opschm'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/opt3_shared/RCS/ougin.f,v $
     . $',                                                             '
     .$Id: ougin.f,v 1.2 1996/07/11 20:58:07 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA PMNAM/4HUGH ,4HUGV /
      DATA BLNK/4H    /
      DATA ABSL/0.5,0.5/
      DATA ABSU/2.0,2.0/
      DATA UG/4HUNIT,4H-HG /
C
C     TRACE LEVEL=1.
      IF(ITRACE.EQ.1) WRITE(IODBUG,1000)
 1000 FORMAT(1H0,16H** OUGIN ENTERED)
C
      CALL FSTWHR('OUGIN   ',0,OLDOPN,IOLDOP)
C
C     INITIALIZE VARIABLES.
C
      IPLUS=0
      LOCP=0
      NOTH=1
C
C     CHECK AVAILABLE SPACE IN OA().
C
C     FIND NO. OF UNIT GRAPH ORDINATES.
C
      CALL FSERCH(NUMOP,OPNEW,LOCP,P,MP)
      IF(LOCP.NE.0) GO TO 124
      WRITE(IPR,903) OPID,OPNEW
  903 FORMAT(1H0,10X,15H**WARNING** ID(,2A4,7H) NAME(,2A4,39H) HAS NOT B
     *EEN DEFINED AS AN OPERATION.)
      CALL WARN
      NPARM=NPARM-1
      GO TO 9999
  124 CONTINUE
C
      INUM=P(LOCP+9)
C
      IF(NOTHER.GT.0) IPLUS=2
      IUSE=10+(NOTHER*4)+IPLUS
      IF(LEFTOA.GE.IUSE) GO TO 112
C
      WRITE(IPR,900)
  900 FORMAT(1H0,10X,79H**ERROR** THIS PARAMETER REQUIRES MORE SPACE THA
     *N IS AVAILABLE IN THE OA ARRAY.)
C
      CALL ERROR
C
      IERO=1
      GO TO 9999
C
C     SPACE IS AVAILABLE IN OA().
C
C     STORE PARAMETER INFO IN OA() AND A().
C
  112 CONTINUE
C
      LEFTOA=LEFTOA-IUSE
C
      IPNUM=0
C
C     CHECK FOR VALID PARAMETER.
C
      DO 120 I=1,2
      IPNUM=IPNUM+1
      IF(PARM(1).EQ.PMNAM(I).AND.PARM(2).EQ.BLNK) GO TO 122
  120 CONTINUE
C
      WRITE(IPR,902) PARM
  902 FORMAT(1H0,10X,12H**WARNING** ,2A4,42H IS NOT A PARAMETER THAN CAN
     * BE OPTIMIZED.)
C
      CALL WARN
C
      NPARM=NPARM-1
C
      IF(NOTHER.EQ.0) GO TO 9999
      DO 121 II=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  121 CONTINUE
C
      GO TO 9999
C
  122 CONTINUE
      OA(IU+1)=LOCP+0.01
      OA(IU+2)=NUMOP+0.01
      OA(IU+3)=PARM(1)
      OA(IU+4)=PARM(2)
      IPLOC=LOCP+P(LOCP+21)-1
      OA(IU+5)=IPLOC+0.01
      OA(IU+6)=DELTA
C
      OA(IU+10)=INUM+0.01
C
      A(NPARM)=1.0
C
C     CHECK LOWER AND UPPER BOUNDS.
C
      IF(CHECKL.LT.CHECKU) GO TO 138
C
C   INVALID USER BOUNDS
C
      WRITE(IPR,909) PARM,CHECKL,CHECKU,ABSL(IPNUM),ABSU(IPNUM)
909   FORMAT(1H0,1X,'** WARNING **  PARAMETER (',2A4,') LOWER BOUND (',
     *F8.2,') IS GREATER OR EQUAL TO THE UPPER LIMIT (',F8.2,')',/17X,
     *'THE USER BOUNDS HAVE BEEN REPLACED WITH THE ABSOLUTE LIMITS (',
     *F8.2,',',F8.2,')')
      CALL WARN
      OA(IU+7)=ABSL(IPNUM)
      OA(IU+8)=ABSL(IPNUM)
      GO TO 143
  138 IF(CHECKL.GE.ABSL(IPNUM)) GO TO 140
C
      WRITE(IPR,904) CHECKL,PARM,ABSL(IPNUM)
  904 FORMAT(1H0,6X,12H**WARNING** ,27HTHE SPECIFIED LOWER BOUND (,F8.2,
     *6H) FOR ,2A4,53H HAS BEEN REPLACED BY THE ABSOLUTE LOWER CONSTRAIN
     *T (,F8.2,2H).)
C
      CALL WARN
C
      OA(IU+7)=ABSL(IPNUM)
      GO TO 141
  140 OA(IU+7)=CHECKL
  141 IF(CHECKU.LE.ABSU(IPNUM)) GO TO 142
C
      WRITE(IPR,906) CHECKU,PARM,ABSU(IPNUM)
  906 FORMAT(1H0,6X,12H**WARNING** ,27HTHE SPECIFIED UPPER BOUND (,F8.2,
     *6H) FOR ,2A4,53H HAS BEEN REPLACED BY THE ABSOLUTE UPPER CONSTRAIN
     *T (,F8.2,2H).)
C
      CALL WARN
C
      OA(IU+8)=ABSU(IPNUM)
      GO TO 143
  142 OA(IU+8)=CHECKU
  143 CONTINUE
C     CHECK TO SEE THAT INITIAL VALUE IS NOT TOO CLOSE TO BOUNDS.
C
      ICLOSE=0
      CALL OBNDCK(PARM,OPID,OPNEW,A(NPARM),DELTA,OA(IU+7),OA(IU+8),
     *NPER,ICLOSE)
      IF(ICLOSE.NE.1) GO TO 145
      NPARM=NPARM-1
C
      IF(NOTHER.EQ.0) GO TO 9999
      DO 147 II=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  147 CONTINUE
C
      GO TO 9999
  145 CONTINUE
C
C     PRINT PARAMETER INPUT INFORMATION.
C
      WRITE(IPR,908) NPARM,OPID,OPNEW,PARM,A(NPARM),OA(IU+7),OA(IU+8),
     *OA(IU+6)
  908 FORMAT(1H0,I2,2H. ,2A4,2X,2A4,3X,2A4,2X,F9.3,1X,F9.3,1X,F9.3,5X,F9
     *.3)
C
C     CHECK TO SEE IF OTHER AREAS ARE AFFECTED.
C
      N=NOTHER
      IF(NOTHER.EQ.0) GO TO 200
      IULOC=IU+10
      OA(IULOC+1)=ABSL(IPNUM)
      OA(IULOC+2)=ABSU(IPNUM)
C
      DO 160 I=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  800 FORMAT(2A4,2X,2A4)
C
C     CHECK OPERATION I.D. AND GET INTERNAL NUMBER.
C
      CALL FOPCDE(OPIDD,NUMOPP)
C
      IF(NUMOPP.NE.0.AND.OPIDD(1).EQ.UG(1).AND.OPIDD(2).EQ.UG(2)) GO TO
     *144
C
      CALL OBADID(OPIDD)
      N=N-1
C
      GO TO 160
  144 CONTINUE
C
      LOCPP=0
      CALL FSERCH(NUMOPP,OPNEWW,LOCPP,P,MP)
C
      ILOCC=IULOC+3+(NOTH-1)*4
      NOTH=NOTH+1
      OA(ILOCC)=1.01
      OA(ILOCC+1)=LOCPP+0.01
      IPLOCC=LOCPP+P(LOCPP+21)-1
      OA(ILOCC+2)=IPLOCC+0.01
      OA(ILOCC+3)=P(LOCPP+9)
C
C
C     PRINT PARAMETER INPUT INFORMATION FOR OTHER AREAS.
C
      IF(I.NE.1) GO TO 150
      WRITE(IPR,910) OPNEWW
  910 FORMAT(1H+,88X,2A4,18X,5HRATIO)
      GO TO 160
  150 WRITE(IPR,912) OPNEWW
  912 FORMAT(1H ,88X,2A4,18X,5HRATIO)
C
  160 CONTINUE
  200 CONTINUE
      OA(IU+9)=N+0.01
      IUSE=10+(N*4)+IPLUS
C
      IU=IU+IUSE
C
 9999 CALL FSTWHR(OLDOPN,IOLDOP,OLDOPN,IOLDOP)
C
      IF(ITRACE.GE.1) WRITE(IODBUG,1002)
 1002 FORMAT(1H0,13H** EXIT OUGIN)
      RETURN
      END
