C     MEMBER OSNOIN
C
      SUBROUTINE OSNOIN(OPID,NUMOP,OPNEW,PARM,DELTA,CHECKL,CHECKU,
     *NOTHER,OA,MOA,P,MP,A,MA,NPARM,IU,LEFTOA,IERO)
C
C.......................................
C     THIS SUBROUTINE FILLS THE A AND OA ARRAYS WITH OPT3 INFORMATION
C     FOR THE SNOW-17 OPERATION AND PRINTS THE INPUT.
C.......................................
C     SUBROUTINE INITIALLY WRITTEN BY
C            LARRY BRAZIL - HRL   APRIL 1981   VERSION 1
C.......................................
C
      DIMENSION P(MP),A(MA),OA(MOA),PARM(2),OPID(2),OPNEW(2)
      DIMENSION PMNAM(2,14),ABSL(14),ABSU(14),IRD(14),OPIDD(2),OPNEWW(2)
      DIMENSION DIFF(3),RATIO(3),RDIFF(3),SNO(2)
      DIMENSION OLDOPN(2)
C
      INCLUDE 'common/ionum'
      INCLUDE 'common/fdbug'
      INCLUDE 'ocommon/opschm'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/opt3_shared/RCS/osnoin.f,v $
     . $',                                                             '
     .$Id: osnoin.f,v 1.2 1996/07/11 20:57:10 dws Exp $
     . $' /
C    ===================================================================
C
C
      DATA PMNAM/4HPXAD,4HJ   ,4HELEV,4H    ,4HSCF ,4H    ,
     *           4HMFMA,4HX   ,4HMFMI,4HN   ,4HUADJ,4H    ,
     *           4HSI  ,4H    ,4HNMF ,4H    ,4HTIPM,4H    ,
     *           4HMBAS,4HE   ,4H    ,4H    ,4HPLWH,4HC   ,
     *           4HDAYG,4HM   ,4HTAEL,4HEV  /
      DATA DIFF/4H DIF,4HFERE,4HNCE /
      DATA RATIO/4H   R,4HATIO,4H    /
      DATA ABSL/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0/
      DATA ABSU/10.,5000.,10.,10.,10.,1.,3000.,1.,1.,10.,99.,1.,1.,
     *   5000./
      DATA IRD/1,1,1,1,1,1,1,1,1,1,1,1,1,1/
      DATA SNO/4HSNOW,4H-17 /
C
C
C     TRACE LEVEL=1.
      IF(ITRACE.EQ.1) WRITE(IODBUG,1000)
 1000 FORMAT(1H0,17H** OSNOIN ENTERED)
C
C     INITIALIZE VARIABLES.
C
      CALL FSTWHR('OSNOIN  ',0,OLDOPN,IOLDOP)
      IPLUS=0
      LOCP=0
      NOTH=1
C
C     CHECK AVAILABLE SPACE IN OA().
C
      IF(NOTHER.GT.0) IPLUS=2
      IUSE=10+(NOTHER*4)+IPLUS
      IF(LEFTOA.GE.IUSE) GO TO 112
      WRITE(IPR,900)
  900 FORMAT(1H0,10X,79H**ERROR** THIS PARAMETER REQUIRES MORE SPACE THA
     *N IS AVAILABLE IN THE OA ARRAY.)
C
      CALL ERROR
C
      IERO=1
      GO TO 9999
C
C     SPACE IS AVAILABLE IN OA().
C     STORE PARAMETER INFO IN OA() AND A().
C
  112 CONTINUE
C
      LEFTOA=LEFTOA-IUSE
C
C
      IPNUM=0
      DO 120 I=1,14
      IPNUM=IPNUM+1
      IF(PARM(1).EQ.PMNAM(1,I).AND.PARM(2).EQ.PMNAM(2,I)) GO TO 122
  120 CONTINUE
C
      WRITE(IPR,902) PARM
  902 FORMAT(1H0,10X,12H**WARNING** ,2A4,42H IS NOT A PARAMETER THAT CAN
     * BE OPTIMIZED.)
C
      CALL WARN
C
      NPARM=NPARM-1
C
      IF(NOTHER.EQ.0) GO TO 9999
      DO 121 II=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  121 CONTINUE
C
      GO TO 9999
C
  122 CONTINUE
      CALL FSERCH(NUMOP,OPNEW,LOCP,P,MP)
      IF(LOCP.NE.0) GO TO 124
      WRITE(IPR,903) OPID,OPNEW
  903 FORMAT(1H0,10X,15H**WARNING** ID(,2A4,7H) NAME(,2A4,39H) HAS NOT B
     *EEN DEFINED AS AN OPERATION.)
      CALL WARN
      NPARM=NPARM-1
      GO TO 9999
  124 CONTINUE
      OA(IU+1)=LOCP+0.01
      OA(IU+2)=NUMOP+0.01
      OA(IU+3)=PARM(1)
      OA(IU+4)=PARM(2)
      LPM=P(LOCP+24)
      IPLOC=LOCP+LPM+IPNUM-2
      OA(IU+5)=IPLOC+0.01
      OA(IU+6)=DELTA
      A(NPARM)=P(IPLOC)
C
C     CHECK FOR TAELEV: SET SPECIAL INDEX
C
      IF (IPNUM .NE. 14) GO TO 700
      LTAPM=P(LOCP+26)
      IF(LTAPM.EQ.0) GO TO 126
      IPLOC=LTAPM + LOCP -1
      GO TO 128
  126 IPLOC=LOCP+P(LOCP+24)
  128 CONTINUE
      OA(IU+5)=IPLOC+0.01
      A(NPARM)=P(IPLOC)
  700 CONTINUE
C
C     CHECK LOWER AND UPPER BOUNDS.
C
      IF(CHECKL.LT.CHECKU) GO TO 129
C
C   INVALID USER BOUNDS
C
      WRITE(IPR,909) PARM,CHECKL,CHECKU,ABSL(IPNUM),ABSU(IPNUM)
  909 FORMAT(1H0,1X,'** WARNING **  PARAMETER (',2A4,') LOWER BOUND (',
     *F8.2,') IS GREATER OR EQUAL TO THE UPPER LIMIT (',F8.2,')',/17X,
     *'THE USER BOUNDS HAVE BEEN REPLACED WITH THE ABSOLUTE LIMITS (',
     *F8.2,',',F8.2,')')
      CALL WARN
      OA(IU+7)=ABSL(IPNUM)
      OA(IU+8)=ABSL(IPNUM)
      GO TO 136
  129 IF(CHECKL.GE.ABSL(IPNUM)) GO TO 130
C
      WRITE(IPR,904) CHECKL,PARM,ABSL(IPNUM)
  904 FORMAT(1H0,6X,12H**WARNING** ,27HTHE SPECIFIED LOWER BOUND (,F8.2,
     *6H) FOR ,2A4,53H HAS BEEN REPLACED BY THE ABSOLUTE LOWER CONSTRAIN
     *T (,F8.2,2H).)
C
      CALL WARN
C
      OA(IU+7)=ABSL(IPNUM)
      GO TO 132
  130 OA(IU+7)=CHECKL
  132 IF(CHECKU.LE.ABSU(IPNUM)) GO TO 134
C
      WRITE(IPR,906) CHECKU,PARM,ABSU(IPNUM)
  906 FORMAT(1H0,6X,12H**WARNING** ,27HTHE SPECIFIED UPPER BOUND (,F8.2,
     *6H) FOR ,2A4,53H HAS BEEN REPLACED BY THE ABSOLUTE UPPER CONSTRAIN
     *T (,F8.2,2H).)
C
      CALL WARN
C
      OA(IU+8)=ABSU(IPNUM)
      GO TO 136
  134 OA(IU+8)=CHECKU
  136 CONTINUE
C
C     CHECK TO SEE THAT INITIAL VALUE IS NOT TOO CLOSE TO BOUNDS.
C
      ICLOSE=0
      CALL OBNDCK(PARM,OPID,OPNEW,A(NPARM),DELTA,OA(IU+7),OA(IU+8),
     *NPER,ICLOSE)
      IF(ICLOSE.NE.1) GO TO 145
      NPARM=NPARM-1
C
      IF(NOTHER.EQ.0) GO TO 9999
      DO 140 II=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  140 CONTINUE
C
      GO TO 9999
  145 CONTINUE
C     PRINT PARAMETER INPUT INFORMATION.
C
      WRITE(IPR,908) NPARM,OPID,OPNEW,PARM,A(NPARM),OA(IU+7),
     *OA(IU+8),OA(IU+6)
  908 FORMAT(1H0,I2,2H. ,2A4,2X,2A4,3X,2A4,2X,F9.3,1X,F9.3,1X,F9.3,5X,F9
     *.3)
C
C     CHECK TO SEE IF OTHER AREAS ARE AFFECTED.
C
      N=NOTHER
      IF(NOTHER.EQ.0) GO TO 200
      IULOC=IU+10
      OA(IULOC+1)=ABSL(IPNUM)
      OA(IULOC+2)=ABSU(IPNUM)
C
      DO 160 I=1,NOTHER
      READ(IN,800) OPIDD,OPNEWW
  800 FORMAT(2A4,2X,2A4,2X)
C
C     CHECK OPERATION I.D. AND GET INTERNAL NUMBER.
C
      CALL FOPCDE(OPIDD,NUMOPP)
C
      IF(NUMOPP.NE.0.AND.OPIDD(1).EQ.SNO(1).AND.OPIDD(2).EQ.SNO(2)) GO
     *TO 144
C
      CALL OBADID(OPIDD)
      N=N-1
C
      GO TO 160
  144 CONTINUE
C
      LOCPP=0
      CALL FSERCH(NUMOPP,OPNEWW,LOCPP,P,MP)
C
      ILOCC=IULOC+3+(NOTH-1)*4
      NOTH=NOTH+1
      OA(ILOCC)=IRD(IPNUM)+0.01
      LPMM=P(LOCPP+24)
      OA(ILOCC+1)=LOCPP+0.01
      OA(ILOCC+3)=1.01
      IF(IPNUM .NE. 14) GO TO 710
      IPLOCC=P(LOCPP+26)
      GO TO 720
  710 IPLOCC=LOCPP+LPMM+IPNUM-2
  720 OA(ILOCC+2)=IPLOCC+0.01
C
C     PRINT PARAMETER INPUT INFORMATION FOR OTHER AREAS.
C
C
      IF(IRD(IPNUM).EQ.1) GO TO 175
      DO 170 IDR=1,3
  170 RDIFF(IDR)=DIFF(IDR)
      GO TO 184
  175 DO 180 IDR=1,3
  180 RDIFF(IDR)=RATIO(IDR)
  184 CONTINUE
C
      IF(I.NE.1) GO TO 150
      WRITE(IPR,910) OPNEWW,RDIFF
  910 FORMAT(1H+,88X,2A4,15X,3A4)
      GO TO 160
  150 WRITE(IPR,912) OPNEWW,RDIFF
  912 FORMAT(1H ,88X,2A4,15X,3A4)
C
  160 CONTINUE
  200 CONTINUE
      OA(IU+9)=N+0.01
      IUSE=10+(N*4)+IPLUS
      IU=IU+IUSE
C
 9999 CALL FSTWHR(OLDOPN,IOLDOP,OLDOPN,IOLDOP)
C
      IF(ITRACE.GE.1) WRITE(IODBUG,1002)
 1002 FORMAT(1H0,14H** EXIT OSNOIN)
      RETURN
      END
