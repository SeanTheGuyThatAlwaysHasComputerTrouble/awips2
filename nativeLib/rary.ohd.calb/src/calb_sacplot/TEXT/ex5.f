C MEMBER EX5
C  (from old member MCEX5)
C----------------------------------------------------------------------
C                             LAST UPDATE: 11/02/95.16:14:11 BY $WC21DT
C
C @PROCESS LVL(77)
C
      SUBROUTINE EX5(PO,LPLOTQ,LPX,PX,LRO,ROC,LSM,SM,LSAC,LSNW,ORD,ORDI,
     1LSYM,PSYM,P,MP,C,MC,D,MD)
C.......................................
C     THIS IS THE EXECUTION SUBROUTINE FOR THE 'SAC-PLOT' OPERATION.
C.......................................
C     SUBROUTINE INITIALLY WRITTEN BY . . .
C            ERIC ANDERSON - HRL     SEPTEMBER 1979
C.......................................
      DIMENSION P(MP),D(MD),C(MC)
      DIMENSION PX(*),ROC(*),SM(*)
      DIMENSION PO(*),LPLOTQ(*),LSAC(*),LSNW(*),ORD(101),ORDI(*),
     1LSYM(*),PSYM(*)
      DIMENSION UNIT(4),UNITS(4,3),SCALE(10),CMO(12),ENGUNT(4,3),PXUT(2)
C
C     COMMON BLOCKS.
      INCLUDE 'common/fdbug'
      INCLUDE 'common/ionum'
      INCLUDE 'common/fctime'
      INCLUDE 'common/fnopr'
      INCLUDE 'common/fengmt'
C
C    ================================= RCS keyword statements ==========
      CHARACTER*68     RCSKW1,RCSKW2
      DATA             RCSKW1,RCSKW2 /                                 '
     .$Source: /fs/hseb/ob72/rfc/calb/src/calb_sacplot/RCS/ex5.f,v $
     . $',                                                             '
     .$Id: ex5.f,v 1.2 1996/07/11 19:22:18 dws Exp $
     . $' /
C    ===================================================================
C
C
C     DATA STATEMENTS
      DATA UNITS/4HMM -,4H SEM,4HI LO,4HG   ,4HCMSD,4H    ,4H    ,
     14H    ,4H(CMS,4HD/SQ,4H.KM),4H*100/
      DATA ENGUNT/4HINCH,4HES-S,4HEMI ,4HLOG ,4HCFSD,4H    ,4H    ,
     14H    ,4HCFSD,4H/SQ.,4HMI. ,4H    /
      DATA PXUT/4H(IN),4H(MM)/
      DATA CMO/3HJAN,3HFEB,3HMAR,3HAPR,3HMAY,3HJUN,3HJUL,3HAUG,3HSEP,
     13HOCT,3HNOV,3HDEC/
      DATA BLANK,DOT/1H ,1H./
C.......................................
C     TRACE LEVEL FOR THIS SUBROUTINE=1.
      IF (ITRACE.GE.1) WRITE (IODBUG,10)
10    FORMAT (1H0,14H** EX5 ENTERED)
C     NO DEBUG OUTPUT.
C.......................................
C     RETURN IMMEDIATELY IF PRINTER OUTPUT NOT ALLOWED.
      IF (NOPROT.EQ.1) RETURN
C
C     INITIAL VALUES
      ITOP=0
C
C     OBTAIN VALUES OF CONTROL VARIABLES.
      NPLOT=PO(6)
      DO 20 N=1,NPLOT
      I=21+(N-1)*7
20    PSYM(N)=PO(I)
      IS=PO(7)
      AREA=PO(8)
      PMAX=PO(9)
      IF((IS.EQ.2).AND.(METRIC.EQ.0)) PMAX=PMAX*35.0
      NSAC=0
      I=PO(13)
      IF (I.GT.0) NSAC=PO(I)
      NSNOW=0
      I=PO(14)
      IF (I.GT.0) NSNOW=PO(I)
      IF (LPX.EQ.0) GO TO 30
      I=PO(10)
      IDT=PO(I+3)
C
C     GET INITIAL DATE AND LAST DATE.
30    CALL MDYH1 (IDA,IHR,MO,ID,IY,IH,NOUTZ,NOUTDS,TZCODE)
      CALL MDYH1 (LDA,LHR,LMO,LD,LY,LH,NOUTZ,NOUTDS,TZCODE)
C.......................................
C     OUTPUT INFORMATION FOR SAC-SMA OPERATIONS.
      IF (NSAC.EQ.0) GO TO 50
      WRITE (IPR,40) LMO,LD,LY,LH
40    FORMAT (1H1,35HSUMMARY OF SAC-SMA OPERATIONS AS OF,I3,1H/,I2,
     11H/,I4,2X,4HHOUR,I3,6X,41H(STORAGES, CONTENTS, AND SUMS ARE IN MM.
     2))
      ITOP=1
      CALL FPSAC5(NSAC,LSAC,PO,P,MP,C,MC)
C.......................................
C     OUTPUT INFORMATION FOR SNOW MODEL OPERATIONS
50    IF (NSNOW.EQ.0) GO TO 90
      IF (ITOP.EQ.1) GO TO 70
      WRITE (IPR,60)
60    FORMAT (1H1)
      ITOP=1
70    WRITE (IPR,80) LMO,LD,LY,LH
80    FORMAT (1H0,35HSUMMARY OF SNOW-17 OPERATIONS AS OF,I3,1H/,I2,1H/,
     1I4,2X,4HHOUR,I3,6X,17H(SUMS ARE IN MM.))
      CALL FPSNW5(NSNOW,LSNW,PO,P,MP,C,MC)
C.......................................
C     PLOT ALL OF THE TIME SERIES.
90    DO 110 I=1,4
      IF (METRIC.EQ.0)GO TO 100
      UNIT(I)=UNITS(I,IS)
      GO TO 110
100   UNIT(I)=ENGUNT(I,IS)
110   CONTINUE
C
C     SET UP SCALE FOR PLOT.
      IF (IS.GT.1) GO TO 140
C
C     SEMI-LOG PLOT.
      IF (METRIC.EQ.0) GO TO 120
C     METRIC UNITS -- MM.
      SCALE(1)=0.01
      SCALE(2)=0.1
      SCALE(3)=1.0
      SCALE(4)=10.
      SCALE(5)=100.
      CONV=1.0/(0.011574*AREA)
      BASE=ALOG(0.001)
      GO TO 130
C     ENGLISH UNITS -- INCHES.
120   SCALE(1)=0.001
      SCALE(2)=0.01
      SCALE(3)=0.1
      SCALE(4)=1.0
      SCALE(5)=10.
      CONV=1.0/(0.011574*25.4*AREA)
      BASE=ALOG(0.0001)
130   CYCLE=5.0
      IF (LRO.GT.0) BASE=BASE+(ALOG(10.0)*0.5)
      PMAX=BASE+ALOG(10.0)*CYCLE
      GO TO 190
140   IF (IS.GT.2) GO TO 160
C
C     ARITHMETRIC SCALE
      DO 150 I=1,10
      F=I
150   SCALE(I)=F*0.1*PMAX
      BASE=0.0
      CONV=1.0
      IF (METRIC.EQ.0) CONV=35.3147
      GO TO 190
C
C     MODIFIED ARITHMETRIC SCALE.
160   CYCLE=PMAX/6.0
      DO 170 I=1,5
      F=I
170   SCALE(I)=F*0.2*CYCLE
      F=CYCLE
      DO 180 I=6,10
      F=F+CYCLE
180   SCALE(I)=F
      BASE=0.0
      CONV=100.0/AREA
      IF (METRIC.EQ.0) CONV=35.3147*2.59/AREA
C
C     PRINT HEADING FOR PLOT.
190   IF (ITOP.EQ.1) GO TO 200
      WRITE (IPR,60)
      ITOP=1
200   WRITE (IPR,210) CMO(MO),IY,(PO(I),I=1,5),AREA,UNIT
210   FORMAT (1H0,A3,1H/,I4,3X,24HMEAN DAILY FLOW PLOT FOR,1X,5A4,5X,
     15HAREA=,F9.1,1X,5HSQ.KM,5X,9HUNITS ARE,1X,4A4)
      WRITE (IPR,220) PXUT(METRIC+1)
220   FORMAT (1H ,86X,24HPCN=PRECIP. OR RAIN+MELT,1X,A4)
      IF (LRO.GT.0) WRITE(IPR,230) PXUT(METRIC+1)
230   FORMAT (1H ,86X,29HINFW=RUNOFF OR CHANNEL INFLOW,1X,A4)
      WRITE (IPR,240)
240   FORMAT (1H ,10X,4HNUM.,3X,9HT.S. I.D.,3X,4HTYPE,6X,4HNAME,6X,
     13HSYM)
      IF ((LRO.GT.0).AND.(NPLOT.EQ.1)) WRITE (IPR,250)
250   FORMAT (1H+,111X,17HRUNOFF COMPONENTS)
      DO 280 N=1,NPLOT
      LOC=15+(N-1)*7
      LV=LOC+6
      WRITE (IPR,260) N,(PO(I),I=LOC,LV)
260   FORMAT (1H ,10X,I3,5X,2A4,3X,A4,2X,3A4,3X,A1)
      IF (LRO.EQ.0) GO TO 280
      IF (N.EQ.NPLOT-1) WRITE (IPR,250)
      IF (N.EQ.NPLOT) WRITE (IPR,270)
270   FORMAT (1H+,114X,11H% OF TOTAL.)
280   CONTINUE
      IF (LRO.GT.0) GO TO 320
C
C     PRINT SCALE--NO RUNOFF COMPONENTS
      IF (IS.GT.1) GO TO 300
C     SEMI-LOG PLOT.
      WRITE (IPR,290) (SCALE(I),I=1,5)
290   FORMAT (1H0,3HDAY,2X,3HPCN,3X,4HQ(1),3X,4HQ(2),14X,F10.3,
     14(10X,F10.2))
      GO TO 370
C     ARITHMETRIC OR MODIFIED
300   WRITE (IPR,310) SCALE
310   FORMAT (1H0,3HDAY,2X,3HPCN,3X,4HQ(1),3X,4HQ(2),4X,10F10.1)
      GO TO 370
C
C     PRINT SCALE--RUNOFF COMPONENTS INCLUDED.
320   WRITE (IPR,330)
330   FORMAT (1H ,112X,3HPRM,3X,3HIMP,3X,3HSUR)
      IF (IS.GT.1) GO TO 350
      WRITE (IPR,340) (SCALE(I),I=1,4)
340   FORMAT (1H ,3HDAY,2X,3HPCN,3X,4HQ(1),3X,4HQ(2),4X,F10.3,
     13(10X,F10.2),11X,4HINFW,4X,3HSUP,3X,3HDIR,3X,3HINT)
      GO TO 370
350   WRITE (IPR,360) (SCALE(I),I=1,8)
360   FORMAT (1H ,3HDAY,2X,3HPCN,3X,4HQ(1),3X,4HQ(2),4X,7F10.1,F9.0,2X,
     14HINFW,4X,3HSUP,3X,3HDIR,3X,3HINT)
C
C     INITIALIZE PLOT VALUES.
370   LIMIT=101
      IF (LRO.GT.0) LIMIT=81
      IF (LSM.GT.0) LMD=LIMIT-25
      DO 380 I=1,100
380   ORD(I)=BLANK
      DO 390 I=1,101,10
390   ORD(I)=DOT
      KD=ID
C.......................................
C     PLOT AND TABULATE VALUES FOR EACH DAY.
      CALL  FPMO5(NPLOT,KD,IDT,CONV,IS,CYCLE,BASE,PMAX,LIMIT,LMD,ORD,
     1ORDI,LSYM,PSYM,LPLOTQ,LPX,PX,LRO,ROC,LSM,SM,D,MD)
C.......................................
C     PRINT SOIL-MOISTURE STORAGE HEADING IF NEEDED.
      IF (LSM.EQ.0) GO TO 450
      IF (LRO.EQ.0) GO TO 420
      WRITE (IPR,400)
400   FORMAT (1H ,30X,36HUZTD AND LZTD=TENSION WATER DEFICITS,15X,
     14HUZTD,1X,4HUZFW,1X,4HLZTD,1X,4HLZFS,1X,4HLZFP)
      WRITE (IPR,410)
410   FORMAT (1H ,87X,12HUNITS ARE MM)
      GO TO 450
420   WRITE (IPR,430)
430   FORMAT (1H ,50X,36HUZTD AND LZTD=TENSION WATER DEFICITS,15X,
     14HUZTD,1X,4HUZFW,1X,4HLZTD,1X,4HLZFS,1X,4HLZFP)
      WRITE (IPR,440)
440   FORMAT (1H ,107X,12HUNITS ARE MM)
450   CONTINUE
C.......................................
C     COMPUTE AND PRINT RUNOFF VALUME FOR EACH TIME SERIES PLOTTED.
C     PRINT HEADING.
      WRITE (IPR,460) PXUT(METRIC+1)
460   FORMAT (1H0,36HRUNOFF VOLUMES FOR EACH TIME SERIES.,/3X,3HNUM,
     13X,9HT.S. I.D.,3X,4HTYPE,6X,4HNAME,6X,3HVOL, A4,3X,19HDEPARTURE FR
     1OM NO.1)
C
C     COMPUTE VOLUME
      DO 570 N=1,NPLOT
      I1=15+(N-1)*7
      I2=I1+5
      LOC=LPLOTQ(N)
      VOL=0.0
      CONV=86.4/AREA
      IF (METRIC.EQ.0) CONV=3.4/AREA
      DO 470 KDA=IDA,LDA
      Q=D(LOC+KDA-IDADAT)
      IF (Q.LT.-990.) GO TO 480
      VOL=VOL+Q*CONV
470   CONTINUE
      GO TO 490
480   VOL=-0.001
490   IF (N.EQ.1) VOL1=VOL
      IF ((VOL1.GE.0.0).AND.(VOL.GE.0.0)) GO TO 500
      MSG=1
      GO TO 510
500   T=VOL-VOL1
      MSG=0
C
C     PRINT VOLUME
510   IF (N.EQ.1) GO TO 550
      IF (MSG.EQ.1) GO TO 550
      IF (METRIC.EQ.1) GO TO 530
      WRITE (IPR,520) N,(PO(I),I=I1,I2),VOL,T
520   FORMAT (1H ,I4,5X,2A4,3X,A4,2X,3A4,F8.2,5X,F8.2,1X,2HIN)
      GO TO 570
530   WRITE (IPR,540) N,(PO(I),I=I1,I2),VOL,T
540   FORMAT (1H ,I4,5X,2A4,3X,A4,2X,3A4,F8.0,5X,F8.0,1X,2HMM)
      GO TO 570
550   IF (METRIC.EQ.1) GO TO 560
      WRITE (IPR,520) N,(PO(I),I=I1,I2),VOL
      GO TO 570
560   WRITE (IPR,540) N,(PO(I),I=I1,I2),VOL
570   CONTINUE
C.......................................
      RETURN
      END
